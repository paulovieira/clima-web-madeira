(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(null==obj)return obj;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;return obj};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,predicate,context){var result;return any(obj,function(value,index,list){return predicate.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(predicate,context):(each(obj,function(value,index,list){predicate.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)},_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(predicate,context):(each(obj,function(value,index,list){return(result=result&&predicate.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(predicate,context):(each(obj,function(value,index,list){return result||(result=predicate.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);var result=-(1/0),lastComputed=-(1/0);return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>lastComputed&&(result=value,lastComputed=computed)}),result},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);var result=1/0,lastComputed=1/0;return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;lastComputed>computed&&(result=value,lastComputed=computed)}),result},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)};_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.partition=function(array,predicate){var pass=[],fail=[];return each(array,function(elem){(predicate(elem)?pass:fail).push(elem)}),[pass,fail]},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);length>idx;)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;length>i;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){return function(obj){if(obj===attrs)return!0;for(var key in attrs)if(attrs[key]!==obj[key])return!1;return!0}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this),function(definition){"use strict";if("function"==typeof bootstrap)bootstrap("promise",definition);else if("object"==typeof exports&&"object"==typeof module)module.exports=definition();else if("function"==typeof define&&define.amd)define(definition);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=definition}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=definition()}}(function(){"use strict";function uncurryThis(f){return function(){return call.apply(f,arguments)}}function isObject(value){return value===Object(value)}function isStopIteration(exception){return"[object StopIteration]"===object_toString(exception)||exception instanceof QReturnValue}function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&"object"==typeof error&&null!==error&&error.stack&&-1===error.stack.indexOf(STACK_JUMP_SEPARATOR)){for(var stacks=[],p=promise;p;p=p.source)p.stack&&stacks.unshift(p.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0;i<lines.length;++i){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isNodeFrame(stackLine){return-1!==stackLine.indexOf("(module.js:")||-1!==stackLine.indexOf("(node.js:")}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&qEndingLine>=lineNumber}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return qFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack),callback.apply(callback,arguments)}}function Q(value){return value instanceof Promise?value:isPromiseAlike(value)?coerce(value):fulfill(value)}function defer(){function become(newPromise){resolvedPromise=newPromise,promise.source=newPromise,array_reduce(messages,function(undefined,message){Q.nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0),messages=void 0,progressListeners=void 0}var resolvedPromise,messages=[],progressListeners=[],deferred=object_create(defer.prototype),promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);messages?(messages.push(args),"when"===op&&operands[1]&&progressListeners.push(operands[1])):Q.nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})},promise.valueOf=function(){if(messages)return promise;var nearerValue=nearer(resolvedPromise);return isPromise(nearerValue)&&(resolvedPromise=nearerValue),nearerValue},promise.inspect=function(){return resolvedPromise?resolvedPromise.inspect():{state:"pending"}},Q.longStackSupport&&hasStacks)try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return deferred.promise=promise,deferred.resolve=function(value){resolvedPromise||become(Q(value))},deferred.fulfill=function(value){resolvedPromise||become(fulfill(value))},deferred.reject=function(reason){resolvedPromise||become(reject(reason))},deferred.notify=function(progress){resolvedPromise||array_reduce(progressListeners,function(undefined,progressListener){Q.nextTick(function(){progressListener(progress)})},void 0)},deferred}function promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function.");var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;len>i;i++)Q(answerPs[i]).then(resolve,reject)})}function Promise(descriptor,fallback,inspect){void 0===fallback&&(fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}),void 0===inspect&&(inspect=function(){return{state:"unknown"}});var promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,args){var result;try{result=descriptor[op]?descriptor[op].apply(promise,args):fallback.call(promise,op,args)}catch(exception){result=reject(exception)}resolve&&resolve(result)},promise.inspect=inspect,inspect){var inspected=inspect();"rejected"===inspected.state&&(promise.exception=inspected.reason),promise.valueOf=function(){var inspected=inspect();return"pending"===inspected.state||"rejected"===inspected.state?promise:inspected.value}}return promise}function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}function nearer(value){if(isPromise(value)){var inspected=value.inspect();if("fulfilled"===inspected.state)return inspected.value}return value}function isPromise(object){return object instanceof Promise}function isPromiseAlike(object){return isObject(object)&&"function"==typeof object.then}function isPending(object){return isPromise(object)&&"pending"===object.inspect().state}function isFulfilled(object){return!isPromise(object)||"fulfilled"===object.inspect().state}function isRejected(object){return isPromise(object)&&"rejected"===object.inspect().state}function resetUnhandledRejections(){unhandledReasons.length=0,unhandledRejections.length=0,trackUnhandledRejections||(trackUnhandledRejections=!0)}function trackRejection(promise,reason){trackUnhandledRejections&&(unhandledRejections.push(promise),reason&&"undefined"!=typeof reason.stack?unhandledReasons.push(reason.stack):unhandledReasons.push("(no stack) "+reason))}function untrackRejection(promise){if(trackUnhandledRejections){var at=array_indexOf(unhandledRejections,promise);-1!==at&&(unhandledRejections.splice(at,1),unhandledReasons.splice(at,1))}}function reject(reason){var rejection=Promise({when:function(rejected){return rejected&&untrackRejection(this),rejected?rejected(reason):this}},function(){return this},function(){return{state:"rejected",reason:reason}});return trackRejection(rejection,reason),rejection}function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},"delete":function(name){delete value[name]},post:function(name,args){return null===name||void 0===name?value.apply(void 0,args):value[name].apply(value,args)},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();return Q.nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}}),deferred.promise}function master(object){return Promise({isDef:function(){}},function(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}function async(makeGenerator){return function(){function continuer(verb,arg){var result;if("undefined"==typeof StopIteration){try{result=generator[verb](arg)}catch(exception){return reject(exception)}return result.done?Q(result.value):when(result.value,callback,errback)}try{result=generator[verb](arg)}catch(exception){return isStopIteration(exception)?Q(exception.value):reject(exception)}return when(result,callback,errback)}var generator=makeGenerator.apply(this,arguments),callback=continuer.bind(continuer,"next"),errback=continuer.bind(continuer,"throw");return callback()}}function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}function _return(value){throw new QReturnValue(value)}function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}function dispatch(object,op,args){return Q(object).dispatch(op,args)}function all(promises){return when(promises,function(promises){var countDown=0,deferred=defer();return array_reduce(promises,function(undefined,promise,index){var snapshot;isPromise(promise)&&"fulfilled"===(snapshot=promise.inspect()).state?promises[index]=snapshot.value:(++countDown,when(promise,function(value){promises[index]=value,0===--countDown&&deferred.resolve(promises)},deferred.reject,function(progress){deferred.notify({index:index,value:progress})}))},void 0),0===countDown&&deferred.resolve(promises),deferred.promise})}function allResolved(promises){return when(promises,function(promises){return promises=array_map(promises,Q),when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}function allSettled(promises){return Q(promises).allSettled()}function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}var hasStacks=!1;try{throw new Error}catch(e){hasStacks=!!e.stack}var qFileName,QReturnValue,qStartingLine=captureLine(),noop=function(){},nextTick=function(){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}var head={task:void 0,next:null},tail=head,flushing=!1,requestTick=void 0,isNodeJS=!1;if(nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestTick())},"undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestTick=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestTick="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick,channel.port1.onmessage=flush,flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0),requestPortTick()}}else requestTick=function(){setTimeout(flush,0)};return nextTick}(),call=Function.call,array_slice=uncurryThis(Array.prototype.slice),array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(1===arguments.length)for(;;){if(index in this){basis=this[index++];break}if(++index>=length)throw new TypeError}for(;length>index;index++)index in this&&(basis=callback(basis,this[index],index));
return basis}),array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return i;return-1}),array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this,collect=[];return array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0),collect}),object_create=Object.create||function(prototype){function Type(){}return Type.prototype=prototype,new Type},object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty),object_keys=Object.keys||function(object){var keys=[];for(var key in object)object_hasOwnProperty(object,key)&&keys.push(key);return keys},object_toString=uncurryThis(Object.prototype.toString);QReturnValue="undefined"!=typeof ReturnValue?ReturnValue:function(value){this.value=value};var STACK_JUMP_SEPARATOR="From previous event:";Q.resolve=Q,Q.nextTick=nextTick,Q.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(Q.longStackSupport=!0),Q.defer=defer,defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){error?self.reject(error):arguments.length>2?self.resolve(array_slice(arguments,1)):self.resolve(value)}},Q.Promise=promise,Q.promise=promise,promise.race=race,promise.all=all,promise.reject=reject,promise.resolve=Q,Q.passByCopy=function(object){return object},Promise.prototype.passByCopy=function(){return this},Q.join=function(x,y){return Q(x).join(y)},Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y)return x;throw new Error("Can't join: not the same: "+x+" "+y)})},Q.race=race,Promise.prototype.race=function(){return this.then(Q.race)},Q.makePromise=Promise,Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.then=function(fulfilled,rejected,progressed){function _fulfilled(value){try{return"function"==typeof fulfilled?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if("function"==typeof rejected){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return"function"==typeof progressed?progressed(value):value}var self=this,deferred=defer(),done=!1;return Q.nextTick(function(){self.promiseDispatch(function(value){done||(done=!0,deferred.resolve(_fulfilled(value)))},"when",[function(exception){done||(done=!0,deferred.resolve(_rejected(exception)))}])}),self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue,threw=!1;try{newValue=_progressed(value)}catch(e){if(threw=!0,!Q.onerror)throw e;Q.onerror(e)}threw||deferred.notify(newValue)}]),deferred.promise},Q.tap=function(promise,callback){return Q(promise).tap(callback)},Promise.prototype.tap=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall(value).thenResolve(value)})},Q.when=when,Promise.prototype.thenResolve=function(value){return this.then(function(){return value})},Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)},Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})},Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)},Q.nearer=nearer,Q.isPromise=isPromise,Q.isPromiseAlike=isPromiseAlike,Q.isPending=isPending,Promise.prototype.isPending=function(){return"pending"===this.inspect().state},Q.isFulfilled=isFulfilled,Promise.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},Q.isRejected=isRejected,Promise.prototype.isRejected=function(){return"rejected"===this.inspect().state};var unhandledReasons=[],unhandledRejections=[],trackUnhandledRejections=!0;Q.resetUnhandledRejections=resetUnhandledRejections,Q.getUnhandledReasons=function(){return unhandledReasons.slice()},Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections(),trackUnhandledRejections=!1},resetUnhandledRejections(),Q.reject=reject,Q.fulfill=fulfill,Q.master=master,Q.spread=spread,Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)},Q.async=async,Q.spawn=spawn,Q["return"]=_return,Q.promised=promised,Q.dispatch=dispatch,Promise.prototype.dispatch=function(op,args){var self=this,deferred=defer();return Q.nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)}),deferred.promise},Q.get=function(object,key){return Q(object).dispatch("get",[key])},Promise.prototype.get=function(key){return this.dispatch("get",[key])},Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])},Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])},Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])},Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])},Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])},Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])},Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])},Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])},Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])},Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])},Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])},Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])},Q.fbind=function(object){var promise=Q(object),args=array_slice(arguments,1);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Promise.prototype.fbind=function(){var promise=this,args=array_slice(arguments);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Q.keys=function(object){return Q(object).dispatch("keys",[])},Promise.prototype.keys=function(){return this.dispatch("keys",[])},Q.all=all,Promise.prototype.all=function(){return all(this)},Q.allResolved=deprecate(allResolved,"allResolved","allSettled"),Promise.prototype.allResolved=function(){return allResolved(this)},Q.allSettled=allSettled,Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){function regardless(){return promise.inspect()}return promise=Q(promise),promise.then(regardless,regardless)}))})},Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)},Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)},Q.progress=progress,Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)},Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)},Promise.prototype.fin=Promise.prototype["finally"]=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})},Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)},Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){Q.nextTick(function(){if(makeStackTraceLong(error,promise),!Q.onerror)throw error;Q.onerror(error)})},promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;"object"==typeof process&&process&&process.domain&&(onUnhandledError=process.domain.bind(onUnhandledError)),promise.then(void 0,onUnhandledError)},Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)},Promise.prototype.timeout=function(ms,error){var deferred=defer(),timeoutId=setTimeout(function(){error&&"string"!=typeof error||(error=new Error(error||"Timed out after "+ms+" ms"),error.code="ETIMEDOUT"),deferred.reject(error)},ms);return this.then(function(value){clearTimeout(timeoutId),deferred.resolve(value)},function(exception){clearTimeout(timeoutId),deferred.reject(exception)},deferred.notify),deferred.promise},Q.delay=function(object,timeout){return void 0===timeout&&(timeout=object,object=void 0),Q(object).delay(timeout)},Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();return setTimeout(function(){deferred.resolve(value)},timeout),deferred.promise})},Q.nfapply=function(callback,args){return Q(callback).nfapply(args)},Promise.prototype.nfapply=function(args){var deferred=defer(),nodeArgs=array_slice(args);return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)},Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(callback).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);return args.unshift(this),Q.denodeify.apply(void 0,args)},Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){function bound(){return callback.apply(thisp,arguments)}var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(bound).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nbind=function(){var args=array_slice(arguments,0);return args.unshift(this),Q.nbind.apply(void 0,args)},Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)},Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nodeify=nodeify,Promise.prototype.nodeify=function(nodeback){return nodeback?void this.then(function(value){Q.nextTick(function(){nodeback(null,value)})},function(error){Q.nextTick(function(){nodeback(error)})}):this};var qEndingLine=captureLine();return Q}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){function isDuplicateNotification(notification){var isDupe=!1;return $('[data-notify="container"]').each(function(i,el){var $el=$(el),title=$el.find('[data-notify="title"]').text().trim(),message=$el.find('[data-notify="message"]').html().trim(),isSameTitle=title===$("<div>"+notification.settings.content.title+"</div>").html().trim(),isSameMsg=message===$("<div>"+notification.settings.content.message+"</div>").html().trim(),isSameType=$el.hasClass("alert-"+notification.settings.type);return isSameTitle&&isSameMsg&&isSameType&&(isDupe=!0),!isDupe}),isDupe}function Notify(element,content,options){var contentObj={content:{message:"object"==typeof content?content.message:content,title:content.title?content.title:"",icon:content.icon?content.icon:"",url:content.url?content.url:"#",target:content.target?content.target:"-"}};options=$.extend(!0,{},contentObj,options),this.settings=$.extend(!0,{},defaults,options),this._defaults=defaults,"-"===this.settings.content.target&&(this.settings.content.target=this.settings.url_target),this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"},"number"==typeof this.settings.offset&&(this.settings.offset={x:this.settings.offset,y:this.settings.offset}),(this.settings.allow_duplicates||!this.settings.allow_duplicates&&!isDuplicateNotification(this))&&this.init()}var defaults={element:"body",position:null,type:"info",allow_dismiss:!0,allow_duplicates:!0,newest_on_top:!1,showProgressbar:!1,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){for(var str=arguments[0],i=1;i<arguments.length;i++)str=str.replace(RegExp("\\{"+(i-1)+"\\}","gm"),arguments[i]);return str},$.extend(Notify.prototype,{init:function(){var self=this;this.buildNotify(),this.settings.content.icon&&this.setIcon(),"#"!=this.settings.content.url&&this.styleURL(),this.styleDismiss(),this.placement(),this.bind(),this.notify={$ele:this.$ele,update:function(command,update){var commands={};"string"==typeof command?commands[command]=update:commands=command;for(var cmd in commands)switch(cmd){case"type":this.$ele.removeClass("alert-"+self.settings.type),this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+self.settings.type),self.settings.type=commands[cmd],this.$ele.addClass("alert-"+commands[cmd]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+commands[cmd]);break;case"icon":var $icon=this.$ele.find('[data-notify="icon"]');"class"===self.settings.icon_type.toLowerCase()?$icon.removeClass(self.settings.content.icon).addClass(commands[cmd]):($icon.is("img")||$icon.find("img"),$icon.attr("src",commands[cmd]));break;case"progress":var newDelay=self.settings.delay-self.settings.delay*(commands[cmd]/100);this.$ele.data("notify-delay",newDelay),this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",commands[cmd]).css("width",commands[cmd]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",commands[cmd]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",commands[cmd]);break;default:this.$ele.find('[data-notify="'+cmd+'"]').html(commands[cmd])}var posX=this.$ele.outerHeight()+parseInt(self.settings.spacing)+parseInt(self.settings.offset.y);self.reposition(posX)},close:function(){self.close()}}},buildNotify:function(){var content=this.settings.content;this.$ele=$(String.format(this.settings.template,this.settings.type,content.title,content.message,content.url,content.target)),this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align),this.settings.allow_dismiss||this.$ele.find('[data-notify="dismiss"]').css("display","none"),(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar)&&this.$ele.find('[data-notify="progressbar"]').remove()},setIcon:function(){"class"===this.settings.icon_type.toLowerCase()?this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon):this.$ele.find('[data-notify="icon"]').is("img")?this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon):this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')},styleDismiss:function(){this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:0,position:"absolute",top:0,width:"100%",zIndex:this.settings.z_index+1})},placement:function(){var self=this,offsetAmt=this.settings.offset.y,css={display:"inline-block",margin:"0px auto",position:this.settings.position?this.settings.position:"body"===this.settings.element?"fixed":"absolute",transition:"all .5s ease-in-out",zIndex:this.settings.z_index},hasAnimation=!1,settings=this.settings;switch($('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){offsetAmt=Math.max(offsetAmt,parseInt($(this).css(settings.placement.from))+parseInt($(this).outerHeight())+parseInt(settings.spacing))}),this.settings.newest_on_top===!0&&(offsetAmt=this.settings.offset.y),css[this.settings.placement.from]=offsetAmt+"px",this.settings.placement.align){case"left":case"right":css[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":css.left=0,css.right=0}this.$ele.css(css).addClass(this.settings.animate.enter),$.each(Array("webkit-","moz-","o-","ms-",""),function(index,prefix){self.$ele[0].style[prefix+"AnimationIterationCount"]=1}),$(this.settings.element).append(this.$ele),this.settings.newest_on_top===!0&&(offsetAmt=parseInt(offsetAmt)+parseInt(this.settings.spacing)+this.$ele.outerHeight(),this.reposition(offsetAmt)),$.isFunction(self.settings.onShow)&&self.settings.onShow.call(this.$ele),this.$ele.one(this.animations.start,function(){hasAnimation=!0}).one(this.animations.end,function(){$.isFunction(self.settings.onShown)&&self.settings.onShown.call(this)}),setTimeout(function(){hasAnimation||$.isFunction(self.settings.onShown)&&self.settings.onShown.call(this)},600)},bind:function(){var self=this;if(this.$ele.find('[data-notify="dismiss"]').on("click",function(){self.close()}),this.$ele.mouseover(function(){$(this).data("data-hover","true")}).mouseout(function(){$(this).data("data-hover","false")}),this.$ele.data("data-hover","false"),this.settings.delay>0){self.$ele.data("notify-delay",self.settings.delay);var timer=setInterval(function(){var delay=parseInt(self.$ele.data("notify-delay"))-self.settings.timer;if("false"===self.$ele.data("data-hover")&&"pause"===self.settings.mouse_over||"pause"!=self.settings.mouse_over){var percent=(self.settings.delay-delay)/self.settings.delay*100;self.$ele.data("notify-delay",delay),self.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",percent).css("width",percent+"%")}delay<=-self.settings.timer&&(clearInterval(timer),self.close())},self.settings.timer)}},close:function(){var self=this,posX=parseInt(this.$ele.css(this.settings.placement.from)),hasAnimation=!1;this.$ele.attr("data-closing","true").addClass(this.settings.animate.exit),self.reposition(posX),$.isFunction(self.settings.onClose)&&self.settings.onClose.call(this.$ele),this.$ele.one(this.animations.start,function(){hasAnimation=!0}).one(this.animations.end,function(){$(this).remove(),$.isFunction(self.settings.onClosed)&&self.settings.onClosed.call(this)}),setTimeout(function(){hasAnimation||(self.$ele.remove(),self.settings.onClosed&&self.settings.onClosed(self.$ele))},600)},reposition:function(posX){var self=this,notifies='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',$elements=this.$ele.nextAll(notifies);this.settings.newest_on_top===!0&&($elements=this.$ele.prevAll(notifies)),$elements.each(function(){$(this).css(self.settings.placement.from,posX),posX=parseInt(posX)+parseInt(self.settings.spacing)+$(this).outerHeight()})}}),$.notify=function(content,options){var plugin=new Notify(this,content,options);return plugin.notify},$.notifyDefaults=function(options){return defaults=$.extend(!0,{},defaults,options)},$.notifyClose=function(command){"undefined"==typeof command||"all"===command?$("[data-notify]").find('[data-notify="dismiss"]').trigger("click"):$('[data-notify-position="'+command+'"]').find('[data-notify="dismiss"]').trigger("click")}}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory:factory(jQuery)}(function($){$.extend($.fn,{livequery:function(selector,matchedFn,unmatchedFn){var q=$.livequery.findorcreate(this,selector,matchedFn,unmatchedFn);return q.run(),this},expire:function(selector,matchedFn,unmatchedFn){var q=$.livequery.find(this,selector,matchedFn,unmatchedFn);return q&&q.stop(),this}}),$.livequery=function(jq,selector,matchedFn,unmatchedFn){this.selector=selector,this.jq=jq,this.context=jq.context,this.matchedFn=matchedFn,this.unmatchedFn=unmatchedFn,this.stopped=!1,this.id=$.livequery.queries.push(this)-1,matchedFn.$lqguid=matchedFn.$lqguid||$.livequery.guid++,unmatchedFn&&(unmatchedFn.$lqguid=unmatchedFn.$lqguid||$.livequery.guid++)},$.livequery.prototype={run:function(){this.stopped=!1,this.jq.find(this.selector).each($.proxy(function(i,element){this.added(element)},this))},stop:function(){this.jq.find(this.selector).each($.proxy(function(i,element){this.removed(element)},this)),this.stopped=!0},matches:function(element){return!this.isStopped()&&$(element,this.context).is(this.selector)&&this.jq.has(element).length},added:function(element){this.isStopped()||this.isMatched(element)||(this.markAsMatched(element),this.matchedFn.call(element,element))},removed:function(element){!this.isStopped()&&this.isMatched(element)&&(this.removeMatchedMark(element),this.unmatchedFn&&this.unmatchedFn.call(element,element))},getLQArray:function(element){var arr=$.data(element,$.livequery.key)||[],index=$.inArray(this.id,arr);return arr.index=index,arr},markAsMatched:function(element){var arr=this.getLQArray(element);-1===arr.index&&(arr.push(this.id),$.data(element,$.livequery.key,arr))},removeMatchedMark:function(element){var arr=this.getLQArray(element);arr.index>-1&&(arr.splice(arr.index,1),$.data(element,$.livequery.key,arr))},isMatched:function(element){var arr=this.getLQArray(element);return-1!==arr.index},isStopped:function(){return this.stopped===!0}},$.extend($.livequery,{version:"2.0.0-pre",guid:0,queries:[],watchAttributes:!0,attributeFilter:["class","className"],setup:!1,timeout:null,method:"none",prepared:!1,key:"livequery",htcPath:!1,prepare:{mutationobserver:function(){var observer=new MutationObserver($.livequery.handle.mutationobserver);observer.observe(document,{childList:!0,attributes:$.livequery.watchAttributes,subtree:!0,attributeFilter:$.livequery.attributeFilter}),$.livequery.prepared=!0},mutationevent:function(){document.addEventListener("DOMNodeInserted",$.livequery.handle.mutationevent,!1),document.addEventListener("DOMNodeRemoved",$.livequery.handle.mutationevent,!1),$.livequery.watchAttributes&&document.addEventListener("DOMAttrModified",$.livequery.handle.mutationevent,!1),$.livequery.prepared=!0},iebehaviors:function(){$.livequery.htcPath&&($("head").append("<style>body *{behavior:url("+$.livequery.htcPath+")}</style>"),$.livequery.prepared=!0)}},handle:{added:function(target){$.each($.livequery.queries,function(i,query){query.matches(target)&&setTimeout(function(){query.added(target)},1)})},removed:function(target){$.each($.livequery.queries,function(i,query){query.isMatched(target)&&setTimeout(function(){query.removed(target)},1)})},modified:function(target){$.each($.livequery.queries,function(i,query){query.isMatched(target)?query.matches(target)||query.removed(target):query.matches(target)&&query.added(target)})},mutationevent:function(event){var map={DOMNodeInserted:"added",DOMNodeRemoved:"removed",DOMAttrModified:"modified"},type=map[event.type];"modified"===type?$.livequery.attributeFilter.indexOf(event.attrName)>-1&&$.livequery.handle.modified(event.target):$.livequery.handle[type](event.target)},mutationobserver:function(mutations){$.each(mutations,function(index,mutation){"attributes"===mutation.type?$.livequery.handle.modified(mutation.target):$.each(["added","removed"],function(i,type){$.each(mutation[type+"Nodes"],function(i,element){$.livequery.handle[type](element)})})})}},find:function(jq,selector,matchedFn,unmatchedFn){var q;return $.each($.livequery.queries,function(i,query){return selector!==query.selector||jq!==query.jq||matchedFn&&matchedFn.$lqguid!==query.matchedFn.$lqguid||unmatchedFn&&unmatchedFn.$lqguid!==query.unmatchedFn.$lqguid?void 0:(q=query)&&!1}),q},findorcreate:function(jq,selector,matchedFn,unmatchedFn){return $.livequery.find(jq,selector,matchedFn,unmatchedFn)||new $.livequery(jq,selector,matchedFn,unmatchedFn)}}),$(function(){if("MutationObserver"in window?$.livequery.method="mutationobserver":"MutationEvent"in window?$.livequery.method="mutationevent":"behavior"in document.documentElement.currentStyle&&($.livequery.method="iebehaviors"),!$.livequery.method)throw new Error("Could not find a means to monitor the DOM");$.livequery.prepare[$.livequery.method]()})}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(window.jQuery)}(function($){Array.prototype.reduce||(Array.prototype.reduce=function(callback){var value,t=Object(this),len=t.length>>>0,k=0;if(2===arguments.length)value=arguments[1];else{for(;len>k&&!(k in t);)k++;if(k>=len)throw new TypeError("Reduce of empty array with no initial value");value=t[k++]}for(;len>k;k++)k in t&&(value=callback(value,t[k],k,t));return value}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(func){for(var t=Object(this),len=t.length>>>0,res=[],thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t){var val=t[i];func.call(thisArg,val,i,t)&&res.push(val)}return res}),Array.prototype.map||(Array.prototype.map=function(callback,thisArg){var T,A,k;if(null===this)throw new TypeError(" this is null or not defined");var O=Object(this),len=O.length>>>0;if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(arguments.length>1&&(T=thisArg),A=new Array(len),k=0;len>k;){var kValue,mappedValue;k in O&&(kValue=O[k],mappedValue=callback.call(T,kValue,k,O),A[k]=mappedValue),k++}return A});var browserVersion,isSupportAmd="function"==typeof define&&define.amd,isFontInstalled=function(fontName){var testFontName="Comic Sans MS"===fontName?"Courier New":"Comic Sans MS",$tester=$("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),originalWidth=$tester.css("fontFamily",testFontName).width(),width=$tester.css("fontFamily",fontName+","+testFontName).width();return $tester.remove(),originalWidth!==width},userAgent=navigator.userAgent,isMSIE=/MSIE|Trident/i.test(userAgent);if(isMSIE){var matches=/MSIE (\d+[.]\d+)/.exec(userAgent);matches&&(browserVersion=parseFloat(matches[1])),matches=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(userAgent),matches&&(browserVersion=parseFloat(matches[1]))}var CodeMirror,agent={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:isMSIE,isFF:/firefox/i.test(userAgent),isWebkit:/webkit/i.test(userAgent),isSafari:/safari/i.test(userAgent),browserVersion:browserVersion,jqueryVersion:parseFloat($.fn.jquery),isSupportAmd:isSupportAmd,hasCodeMirror:isSupportAmd?require.specified("CodeMirror"):!!window.CodeMirror,isFontInstalled:isFontInstalled,isW3CRangeSupport:!!document.createRange},func=function(){var eq=function(itemA){return function(itemB){return itemA===itemB}},eq2=function(itemA,itemB){return itemA===itemB},peq2=function(propName){return function(itemA,itemB){return itemA[propName]===itemB[propName]}},ok=function(){return!0},fail=function(){return!1},not=function(f){return function(){return!f.apply(f,arguments)}},and=function(fA,fB){return function(item){return fA(item)&&fB(item)}},self=function(a){return a},idCounter=0,uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},rect2bnd=function(rect){var $document=$(document);return{top:rect.top+$document.scrollTop(),left:rect.left+$document.scrollLeft(),width:rect.right-rect.left,height:rect.bottom-rect.top}},invertObject=function(obj){var inverted={};for(var key in obj)obj.hasOwnProperty(key)&&(inverted[obj[key]]=key);return inverted},namespaceToCamel=function(namespace,prefix){return prefix=prefix||"",prefix+namespace.split(".").map(function(name){return name.substring(0,1).toUpperCase()+name.substring(1)}).join("")};return{eq:eq,eq2:eq2,peq2:peq2,ok:ok,fail:fail,self:self,not:not,and:and,uniqueId:uniqueId,rect2bnd:rect2bnd,invertObject:invertObject,namespaceToCamel:namespaceToCamel}}(),list=function(){var head=function(array){return array[0]},last=function(array){return array[array.length-1]},initial=function(array){return array.slice(0,array.length-1)},tail=function(array){return array.slice(1)},find=function(array,pred){for(var idx=0,len=array.length;len>idx;idx++){var item=array[idx];if(pred(item))return item}},all=function(array,pred){for(var idx=0,len=array.length;len>idx;idx++)if(!pred(array[idx]))return!1;return!0},indexOf=function(array,item){return $.inArray(item,array)},contains=function(array,item){return-1!==indexOf(array,item)},sum=function(array,fn){return fn=fn||func.self,array.reduce(function(memo,v){return memo+fn(v)},0)},from=function(collection){for(var result=[],idx=-1,length=collection.length;++idx<length;)result[idx]=collection[idx];return result},clusterBy=function(array,fn){if(!array.length)return[];var aTail=tail(array);return aTail.reduce(function(memo,v){var aLast=last(memo);return fn(last(aLast),v)?aLast[aLast.length]=v:memo[memo.length]=[v],memo},[[head(array)]])},compact=function(array){for(var aResult=[],idx=0,len=array.length;len>idx;idx++)array[idx]&&aResult.push(array[idx]);return aResult},unique=function(array){for(var results=[],idx=0,len=array.length;len>idx;idx++)contains(results,array[idx])||results.push(array[idx]);return results},next=function(array,item){var idx=indexOf(array,item);return-1===idx?null:array[idx+1]},prev=function(array,item){var idx=indexOf(array,item);return-1===idx?null:array[idx-1]};return{head:head,last:last,initial:initial,tail:tail,prev:prev,next:next,find:find,contains:contains,all:all,sum:sum,from:from,clusterBy:clusterBy,compact:compact,unique:unique}}(),NBSP_CHAR=String.fromCharCode(160),ZERO_WIDTH_NBSP_CHAR="\ufeff",dom=function(){var isEditable=function(node){return node&&$(node).hasClass("note-editable")},isControlSizing=function(node){return node&&$(node).hasClass("note-control-sizing")},buildLayoutInfo=function($editor){var makeFinder;if($editor.hasClass("note-air-editor")){var id=list.last($editor.attr("id").split("-"));return makeFinder=function(sIdPrefix){return function(){return $(sIdPrefix+id)}},{editor:function(){return $editor},holder:function(){return $editor.data("holder")},editable:function(){return $editor},popover:makeFinder("#note-popover-"),handle:makeFinder("#note-handle-"),dialog:makeFinder("#note-dialog-")}}makeFinder=function(className,$base){return $base=$base||$editor,function(){return $base.find(className)}};var options=$editor.data("options"),$dialogHolder=options&&options.dialogsInBody?$(document.body):null;return{editor:function(){return $editor},holder:function(){return $editor.data("holder")},dropzone:makeFinder(".note-dropzone"),toolbar:makeFinder(".note-toolbar"),editable:makeFinder(".note-editable"),
codable:makeFinder(".note-codable"),statusbar:makeFinder(".note-statusbar"),popover:makeFinder(".note-popover"),handle:makeFinder(".note-handle"),dialog:makeFinder(".note-dialog",$dialogHolder)}},makeLayoutInfo=function(descendant){var $target=$(descendant).closest(".note-editor, .note-air-editor, .note-air-layout");if(!$target.length)return null;var $editor;return $editor=$target.is(".note-editor, .note-air-editor")?$target:$("#note-editor-"+list.last($target.attr("id").split("-"))),buildLayoutInfo($editor)},makePredByNodeName=function(nodeName){return nodeName=nodeName.toUpperCase(),function(node){return node&&node.nodeName.toUpperCase()===nodeName}},isText=function(node){return node&&3===node.nodeType},isVoid=function(node){return node&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase())},isPara=function(node){return isEditable(node)?!1:node&&/^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase())},isLi=makePredByNodeName("LI"),isPurePara=function(node){return isPara(node)&&!isLi(node)},isTable=makePredByNodeName("TABLE"),isInline=function(node){return!(isBodyContainer(node)||isList(node)||isHr(node)||isPara(node)||isTable(node)||isBlockquote(node))},isList=function(node){return node&&/^UL|^OL/.test(node.nodeName.toUpperCase())},isHr=makePredByNodeName("HR"),isCell=function(node){return node&&/^TD|^TH/.test(node.nodeName.toUpperCase())},isBlockquote=makePredByNodeName("BLOCKQUOTE"),isBodyContainer=function(node){return isCell(node)||isBlockquote(node)||isEditable(node)},isAnchor=makePredByNodeName("A"),isParaInline=function(node){return isInline(node)&&!!ancestor(node,isPara)},isBodyInline=function(node){return isInline(node)&&!ancestor(node,isPara)},isBody=makePredByNodeName("BODY"),isClosestSibling=function(nodeA,nodeB){return nodeA.nextSibling===nodeB||nodeA.previousSibling===nodeB},withClosestSiblings=function(node,pred){pred=pred||func.ok;var siblings=[];return node.previousSibling&&pred(node.previousSibling)&&siblings.push(node.previousSibling),siblings.push(node),node.nextSibling&&pred(node.nextSibling)&&siblings.push(node.nextSibling),siblings},blankHTML=agent.isMSIE&&agent.browserVersion<11?"&nbsp;":"<br>",nodeLength=function(node){return isText(node)?node.nodeValue.length:node.childNodes.length},isEmpty=function(node){var len=nodeLength(node);return 0===len?!0:isText(node)||1!==len||node.innerHTML!==blankHTML?list.all(node.childNodes,isText)&&""===node.innerHTML?!0:!1:!0},paddingBlankHTML=function(node){isVoid(node)||nodeLength(node)||(node.innerHTML=blankHTML)},ancestor=function(node,pred){for(;node;){if(pred(node))return node;if(isEditable(node))break;node=node.parentNode}return null},singleChildAncestor=function(node,pred){for(node=node.parentNode;node&&1===nodeLength(node);){if(pred(node))return node;if(isEditable(node))break;node=node.parentNode}return null},listAncestor=function(node,pred){pred=pred||func.fail;var ancestors=[];return ancestor(node,function(el){return isEditable(el)||ancestors.push(el),pred(el)}),ancestors},lastAncestor=function(node,pred){var ancestors=listAncestor(node);return list.last(ancestors.filter(pred))},commonAncestor=function(nodeA,nodeB){for(var ancestors=listAncestor(nodeA),n=nodeB;n;n=n.parentNode)if($.inArray(n,ancestors)>-1)return n;return null},listPrev=function(node,pred){pred=pred||func.fail;for(var nodes=[];node&&!pred(node);)nodes.push(node),node=node.previousSibling;return nodes},listNext=function(node,pred){pred=pred||func.fail;for(var nodes=[];node&&!pred(node);)nodes.push(node),node=node.nextSibling;return nodes},listDescendant=function(node,pred){var descendents=[];return pred=pred||func.ok,function fnWalk(current){node!==current&&pred(current)&&descendents.push(current);for(var idx=0,len=current.childNodes.length;len>idx;idx++)fnWalk(current.childNodes[idx])}(node),descendents},wrap=function(node,wrapperName){var parent=node.parentNode,wrapper=$("<"+wrapperName+">")[0];return parent.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},insertAfter=function(node,preceding){var next=preceding.nextSibling,parent=preceding.parentNode;return next?parent.insertBefore(node,next):parent.appendChild(node),node},appendChildNodes=function(node,aChild){return $.each(aChild,function(idx,child){node.appendChild(child)}),node},isLeftEdgePoint=function(point){return 0===point.offset},isRightEdgePoint=function(point){return point.offset===nodeLength(point.node)},isEdgePoint=function(point){return isLeftEdgePoint(point)||isRightEdgePoint(point)},isLeftEdgeOf=function(node,ancestor){for(;node&&node!==ancestor;){if(0!==position(node))return!1;node=node.parentNode}return!0},isRightEdgeOf=function(node,ancestor){for(;node&&node!==ancestor;){if(position(node)!==nodeLength(node.parentNode)-1)return!1;node=node.parentNode}return!0},isLeftEdgePointOf=function(point,ancestor){return isLeftEdgePoint(point)&&isLeftEdgeOf(point.node,ancestor)},isRightEdgePointOf=function(point,ancestor){return isRightEdgePoint(point)&&isRightEdgeOf(point.node,ancestor)},position=function(node){for(var offset=0;node=node.previousSibling;)offset+=1;return offset},hasChildren=function(node){return!!(node&&node.childNodes&&node.childNodes.length)},prevPoint=function(point,isSkipInnerOffset){var node,offset;if(0===point.offset){if(isEditable(point.node))return null;node=point.node.parentNode,offset=position(point.node)}else hasChildren(point.node)?(node=point.node.childNodes[point.offset-1],offset=nodeLength(node)):(node=point.node,offset=isSkipInnerOffset?0:point.offset-1);return{node:node,offset:offset}},nextPoint=function(point,isSkipInnerOffset){var node,offset;if(nodeLength(point.node)===point.offset){if(isEditable(point.node))return null;node=point.node.parentNode,offset=position(point.node)+1}else hasChildren(point.node)?(node=point.node.childNodes[point.offset],offset=0):(node=point.node,offset=isSkipInnerOffset?nodeLength(point.node):point.offset+1);return{node:node,offset:offset}},isSamePoint=function(pointA,pointB){return pointA.node===pointB.node&&pointA.offset===pointB.offset},isVisiblePoint=function(point){if(isText(point.node)||!hasChildren(point.node)||isEmpty(point.node))return!0;var leftNode=point.node.childNodes[point.offset-1],rightNode=point.node.childNodes[point.offset];return leftNode&&!isVoid(leftNode)||rightNode&&!isVoid(rightNode)?!1:!0},prevPointUntil=function(point,pred){for(;point;){if(pred(point))return point;point=prevPoint(point)}return null},nextPointUntil=function(point,pred){for(;point;){if(pred(point))return point;point=nextPoint(point)}return null},isCharPoint=function(point){if(!isText(point.node))return!1;var ch=point.node.nodeValue.charAt(point.offset-1);return ch&&" "!==ch&&ch!==NBSP_CHAR},walkPoint=function(startPoint,endPoint,handler,isSkipInnerOffset){for(var point=startPoint;point&&(handler(point),!isSamePoint(point,endPoint));){var isSkipOffset=isSkipInnerOffset&&startPoint.node!==point.node&&endPoint.node!==point.node;point=nextPoint(point,isSkipOffset)}},makeOffsetPath=function(ancestor,node){var ancestors=listAncestor(node,func.eq(ancestor));return ancestors.map(position).reverse()},fromOffsetPath=function(ancestor,offsets){for(var current=ancestor,i=0,len=offsets.length;len>i;i++)current=current.childNodes.length<=offsets[i]?current.childNodes[current.childNodes.length-1]:current.childNodes[offsets[i]];return current},splitNode=function(point,options){var isSkipPaddingBlankHTML=options&&options.isSkipPaddingBlankHTML,isNotSplitEdgePoint=options&&options.isNotSplitEdgePoint;if(isEdgePoint(point)&&(isText(point.node)||isNotSplitEdgePoint)){if(isLeftEdgePoint(point))return point.node;if(isRightEdgePoint(point))return point.node.nextSibling}if(isText(point.node))return point.node.splitText(point.offset);var childNode=point.node.childNodes[point.offset],clone=insertAfter(point.node.cloneNode(!1),point.node);return appendChildNodes(clone,listNext(childNode)),isSkipPaddingBlankHTML||(paddingBlankHTML(point.node),paddingBlankHTML(clone)),clone},splitTree=function(root,point,options){var ancestors=listAncestor(point.node,func.eq(root));return ancestors.length?1===ancestors.length?splitNode(point,options):ancestors.reduce(function(node,parent){return node===point.node&&(node=splitNode(point,options)),splitNode({node:parent,offset:node?dom.position(node):nodeLength(parent)},options)}):null},splitPoint=function(point,isInline){var splitRoot,container,pred=isInline?isPara:isBodyContainer,ancestors=listAncestor(point.node,pred),topAncestor=list.last(ancestors)||point.node;pred(topAncestor)?(splitRoot=ancestors[ancestors.length-2],container=topAncestor):(splitRoot=topAncestor,container=splitRoot.parentNode);var pivot=splitRoot&&splitTree(splitRoot,point,{isSkipPaddingBlankHTML:isInline,isNotSplitEdgePoint:isInline});return pivot||container!==point.node||(pivot=point.node.childNodes[point.offset]),{rightNode:pivot,container:container}},create=function(nodeName){return document.createElement(nodeName)},createText=function(text){return document.createTextNode(text)},remove=function(node,isRemoveChild){if(node&&node.parentNode){if(node.removeNode)return node.removeNode(isRemoveChild);var parent=node.parentNode;if(!isRemoveChild){var i,len,nodes=[];for(i=0,len=node.childNodes.length;len>i;i++)nodes.push(node.childNodes[i]);for(i=0,len=nodes.length;len>i;i++)parent.insertBefore(nodes[i],node)}parent.removeChild(node)}},removeWhile=function(node,pred){for(;node&&!isEditable(node)&&pred(node);){var parent=node.parentNode;remove(node),node=parent}},replace=function(node,nodeName){if(node.nodeName.toUpperCase()===nodeName.toUpperCase())return node;var newNode=create(nodeName);return node.style.cssText&&(newNode.style.cssText=node.style.cssText),appendChildNodes(newNode,list.from(node.childNodes)),insertAfter(newNode,node),remove(node),newNode},isTextarea=makePredByNodeName("TEXTAREA"),value=function($node,stripLinebreaks){var val=isTextarea($node[0])?$node.val():$node.html();return stripLinebreaks?val.replace(/[\n\r]/g,""):val},html=function($node,isNewlineOnBlock){var markup=value($node);if(isNewlineOnBlock){var regexTag=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;markup=markup.replace(regexTag,function(match,endSlash,name){name=name.toUpperCase();var isEndOfInlineContainer=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name)&&!!endSlash,isBlockNode=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);return match+(isEndOfInlineContainer||isBlockNode?"\n":"")}),markup=$.trim(markup)}return markup};return{NBSP_CHAR:NBSP_CHAR,ZERO_WIDTH_NBSP_CHAR:ZERO_WIDTH_NBSP_CHAR,blank:blankHTML,emptyPara:"<p>"+blankHTML+"</p>",makePredByNodeName:makePredByNodeName,isEditable:isEditable,isControlSizing:isControlSizing,buildLayoutInfo:buildLayoutInfo,makeLayoutInfo:makeLayoutInfo,isText:isText,isVoid:isVoid,isPara:isPara,isPurePara:isPurePara,isInline:isInline,isBlock:func.not(isInline),isBodyInline:isBodyInline,isBody:isBody,isParaInline:isParaInline,isList:isList,isTable:isTable,isCell:isCell,isBlockquote:isBlockquote,isBodyContainer:isBodyContainer,isAnchor:isAnchor,isDiv:makePredByNodeName("DIV"),isLi:isLi,isBR:makePredByNodeName("BR"),isSpan:makePredByNodeName("SPAN"),isB:makePredByNodeName("B"),isU:makePredByNodeName("U"),isS:makePredByNodeName("S"),isI:makePredByNodeName("I"),isImg:makePredByNodeName("IMG"),isTextarea:isTextarea,isEmpty:isEmpty,isEmptyAnchor:func.and(isAnchor,isEmpty),isClosestSibling:isClosestSibling,withClosestSiblings:withClosestSiblings,nodeLength:nodeLength,isLeftEdgePoint:isLeftEdgePoint,isRightEdgePoint:isRightEdgePoint,isEdgePoint:isEdgePoint,isLeftEdgeOf:isLeftEdgeOf,isRightEdgeOf:isRightEdgeOf,isLeftEdgePointOf:isLeftEdgePointOf,isRightEdgePointOf:isRightEdgePointOf,prevPoint:prevPoint,nextPoint:nextPoint,isSamePoint:isSamePoint,isVisiblePoint:isVisiblePoint,prevPointUntil:prevPointUntil,nextPointUntil:nextPointUntil,isCharPoint:isCharPoint,walkPoint:walkPoint,ancestor:ancestor,singleChildAncestor:singleChildAncestor,listAncestor:listAncestor,lastAncestor:lastAncestor,listNext:listNext,listPrev:listPrev,listDescendant:listDescendant,commonAncestor:commonAncestor,wrap:wrap,insertAfter:insertAfter,appendChildNodes:appendChildNodes,position:position,hasChildren:hasChildren,makeOffsetPath:makeOffsetPath,fromOffsetPath:fromOffsetPath,splitTree:splitTree,splitPoint:splitPoint,create:create,createText:createText,remove:remove,removeWhile:removeWhile,replace:replace,html:html,value:value}}(),range=function(){var textRangeToPoint=function(textRange,isStart){var offset,prevContainer,container=textRange.parentElement(),tester=document.body.createTextRange(),childNodes=list.from(container.childNodes);for(offset=0;offset<childNodes.length;offset++)if(!dom.isText(childNodes[offset])){if(tester.moveToElementText(childNodes[offset]),tester.compareEndPoints("StartToStart",textRange)>=0)break;prevContainer=childNodes[offset]}if(0!==offset&&dom.isText(childNodes[offset-1])){var textRangeStart=document.body.createTextRange(),curTextNode=null;textRangeStart.moveToElementText(prevContainer||container),textRangeStart.collapse(!prevContainer),curTextNode=prevContainer?prevContainer.nextSibling:container.firstChild;var pointTester=textRange.duplicate();pointTester.setEndPoint("StartToStart",textRangeStart);for(var textCount=pointTester.text.replace(/[\r\n]/g,"").length;textCount>curTextNode.nodeValue.length&&curTextNode.nextSibling;)textCount-=curTextNode.nodeValue.length,curTextNode=curTextNode.nextSibling;curTextNode.nodeValue;isStart&&curTextNode.nextSibling&&dom.isText(curTextNode.nextSibling)&&textCount===curTextNode.nodeValue.length&&(textCount-=curTextNode.nodeValue.length,curTextNode=curTextNode.nextSibling),container=curTextNode,offset=textCount}return{cont:container,offset:offset}},pointToTextRange=function(point){var textRangeInfo=function(container,offset){var node,isCollapseToStart;if(dom.isText(container)){var prevTextNodes=dom.listPrev(container,func.not(dom.isText)),prevContainer=list.last(prevTextNodes).previousSibling;node=prevContainer||container.parentNode,offset+=list.sum(list.tail(prevTextNodes),dom.nodeLength),isCollapseToStart=!prevContainer}else{if(node=container.childNodes[offset]||container,dom.isText(node))return textRangeInfo(node,0);offset=0,isCollapseToStart=!1}return{node:node,collapseToStart:isCollapseToStart,offset:offset}},textRange=document.body.createTextRange(),info=textRangeInfo(point.node,point.offset);return textRange.moveToElementText(info.node),textRange.collapse(info.collapseToStart),textRange.moveStart("character",info.offset),textRange},WrappedRange=function(sc,so,ec,eo){this.sc=sc,this.so=so,this.ec=ec,this.eo=eo;var nativeRange=function(){if(agent.isW3CRangeSupport){var w3cRange=document.createRange();return w3cRange.setStart(sc,so),w3cRange.setEnd(ec,eo),w3cRange}var textRange=pointToTextRange({node:sc,offset:so});return textRange.setEndPoint("EndToEnd",pointToTextRange({node:ec,offset:eo})),textRange};this.getPoints=function(){return{sc:sc,so:so,ec:ec,eo:eo}},this.getStartPoint=function(){return{node:sc,offset:so}},this.getEndPoint=function(){return{node:ec,offset:eo}},this.select=function(){var nativeRng=nativeRange();if(agent.isW3CRangeSupport){var selection=document.getSelection();selection.rangeCount>0&&selection.removeAllRanges(),selection.addRange(nativeRng)}else nativeRng.select();return this},this.normalize=function(){var getVisiblePoint=function(point,isLeftToRight){if(dom.isVisiblePoint(point)&&!dom.isEdgePoint(point)||dom.isVisiblePoint(point)&&dom.isRightEdgePoint(point)&&!isLeftToRight||dom.isVisiblePoint(point)&&dom.isLeftEdgePoint(point)&&isLeftToRight||dom.isVisiblePoint(point)&&dom.isBlock(point.node)&&dom.isEmpty(point.node))return point;var block=dom.ancestor(point.node,dom.isBlock);if((dom.isLeftEdgePointOf(point,block)||dom.isVoid(dom.prevPoint(point).node))&&!isLeftToRight||(dom.isRightEdgePointOf(point,block)||dom.isVoid(dom.nextPoint(point).node))&&isLeftToRight){if(dom.isVisiblePoint(point))return point;isLeftToRight=!isLeftToRight}var nextPoint=isLeftToRight?dom.nextPointUntil(dom.nextPoint(point),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(point),dom.isVisiblePoint);return nextPoint||point},endPoint=getVisiblePoint(this.getEndPoint(),!1),startPoint=this.isCollapsed()?endPoint:getVisiblePoint(this.getStartPoint(),!0);return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset)},this.nodes=function(pred,options){pred=pred||func.ok;var includeAncestor=options&&options.includeAncestor,fullyContains=options&&options.fullyContains,startPoint=this.getStartPoint(),endPoint=this.getEndPoint(),nodes=[],leftEdgeNodes=[];return dom.walkPoint(startPoint,endPoint,function(point){if(!dom.isEditable(point.node)){var node;fullyContains?(dom.isLeftEdgePoint(point)&&leftEdgeNodes.push(point.node),dom.isRightEdgePoint(point)&&list.contains(leftEdgeNodes,point.node)&&(node=point.node)):node=includeAncestor?dom.ancestor(point.node,pred):point.node,node&&pred(node)&&nodes.push(node)}},!0),list.unique(nodes)},this.commonAncestor=function(){return dom.commonAncestor(sc,ec)},this.expand=function(pred){var startAncestor=dom.ancestor(sc,pred),endAncestor=dom.ancestor(ec,pred);if(!startAncestor&&!endAncestor)return new WrappedRange(sc,so,ec,eo);var boundaryPoints=this.getPoints();return startAncestor&&(boundaryPoints.sc=startAncestor,boundaryPoints.so=0),endAncestor&&(boundaryPoints.ec=endAncestor,boundaryPoints.eo=dom.nodeLength(endAncestor)),new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo)},this.collapse=function(isCollapseToStart){return isCollapseToStart?new WrappedRange(sc,so,sc,so):new WrappedRange(ec,eo,ec,eo)},this.splitText=function(){var isSameContainer=sc===ec,boundaryPoints=this.getPoints();return dom.isText(ec)&&!dom.isEdgePoint(this.getEndPoint())&&ec.splitText(eo),dom.isText(sc)&&!dom.isEdgePoint(this.getStartPoint())&&(boundaryPoints.sc=sc.splitText(so),boundaryPoints.so=0,isSameContainer&&(boundaryPoints.ec=boundaryPoints.sc,boundaryPoints.eo=eo-so)),new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var rng=this.splitText(),nodes=rng.nodes(null,{fullyContains:!0}),point=dom.prevPointUntil(rng.getStartPoint(),function(point){return!list.contains(nodes,point.node)}),emptyParents=[];return $.each(nodes,function(idx,node){var parent=node.parentNode;point.node!==parent&&1===dom.nodeLength(parent)&&emptyParents.push(parent),dom.remove(node,!1)}),$.each(emptyParents,function(idx,node){dom.remove(node,!1)}),new WrappedRange(point.node,point.offset,point.node,point.offset).normalize()};var makeIsOn=function(pred){return function(){var ancestor=dom.ancestor(sc,pred);return!!ancestor&&ancestor===dom.ancestor(ec,pred)}};this.isOnEditable=makeIsOn(dom.isEditable),this.isOnList=makeIsOn(dom.isList),this.isOnAnchor=makeIsOn(dom.isAnchor),this.isOnCell=makeIsOn(dom.isCell),this.isLeftEdgeOf=function(pred){if(!dom.isLeftEdgePoint(this.getStartPoint()))return!1;var node=dom.ancestor(this.sc,pred);return node&&dom.isLeftEdgeOf(this.sc,node)},this.isCollapsed=function(){return sc===ec&&so===eo},this.wrapBodyInlineWithPara=function(){if(dom.isBodyContainer(sc)&&dom.isEmpty(sc))return sc.innerHTML=dom.emptyPara,new WrappedRange(sc.firstChild,0,sc.firstChild,0);var rng=this.normalize();if(dom.isParaInline(sc)||dom.isPara(sc))return rng;var topAncestor;if(dom.isInline(rng.sc)){var ancestors=dom.listAncestor(rng.sc,func.not(dom.isInline));topAncestor=list.last(ancestors),dom.isInline(topAncestor)||(topAncestor=ancestors[ancestors.length-2]||rng.sc.childNodes[rng.so])}else topAncestor=rng.sc.childNodes[rng.so>0?rng.so-1:0];var inlineSiblings=dom.listPrev(topAncestor,dom.isParaInline).reverse();if(inlineSiblings=inlineSiblings.concat(dom.listNext(topAncestor.nextSibling,dom.isParaInline)),inlineSiblings.length){var para=dom.wrap(list.head(inlineSiblings),"p");dom.appendChildNodes(para,list.tail(inlineSiblings))}return this.normalize()},this.insertNode=function(node){var rng=this.wrapBodyInlineWithPara().deleteContents(),info=dom.splitPoint(rng.getStartPoint(),dom.isInline(node));return info.rightNode?info.rightNode.parentNode.insertBefore(node,info.rightNode):info.container.appendChild(node),node},this.pasteHTML=function(markup){var contentsContainer=$("<div></div>").html(markup)[0],childNodes=list.from(contentsContainer.childNodes),rng=this.wrapBodyInlineWithPara().deleteContents();return childNodes.reverse().map(function(childNode){return rng.insertNode(childNode)}).reverse()},this.toString=function(){var nativeRng=nativeRange();return agent.isW3CRangeSupport?nativeRng.toString():nativeRng.text},this.getWordRange=function(findAfter){var endPoint=this.getEndPoint();if(!dom.isCharPoint(endPoint))return this;var startPoint=dom.prevPointUntil(endPoint,function(point){return!dom.isCharPoint(point)});return findAfter&&(endPoint=dom.nextPointUntil(endPoint,function(point){return!dom.isCharPoint(point)})),new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset)},this.bookmark=function(editable){return{s:{path:dom.makeOffsetPath(editable,sc),offset:so},e:{path:dom.makeOffsetPath(editable,ec),offset:eo}}},this.paraBookmark=function(paras){return{s:{path:list.tail(dom.makeOffsetPath(list.head(paras),sc)),offset:so},e:{path:list.tail(dom.makeOffsetPath(list.last(paras),ec)),offset:eo}}},this.getClientRects=function(){var nativeRng=nativeRange();return nativeRng.getClientRects()}};return{create:function(sc,so,ec,eo){if(arguments.length)2===arguments.length&&(ec=sc,eo=so);else if(agent.isW3CRangeSupport){var selection=document.getSelection();if(!selection||0===selection.rangeCount)return null;if(dom.isBody(selection.anchorNode))return null;var nativeRng=selection.getRangeAt(0);sc=nativeRng.startContainer,so=nativeRng.startOffset,ec=nativeRng.endContainer,eo=nativeRng.endOffset}else{var textRange=document.selection.createRange(),textRangeEnd=textRange.duplicate();textRangeEnd.collapse(!1);var textRangeStart=textRange;textRangeStart.collapse(!0);var startPoint=textRangeToPoint(textRangeStart,!0),endPoint=textRangeToPoint(textRangeEnd,!1);dom.isText(startPoint.node)&&dom.isLeftEdgePoint(startPoint)&&dom.isTextNode(endPoint.node)&&dom.isRightEdgePoint(endPoint)&&endPoint.node.nextSibling===startPoint.node&&(startPoint=endPoint),sc=startPoint.cont,so=startPoint.offset,ec=endPoint.cont,eo=endPoint.offset}return new WrappedRange(sc,so,ec,eo)},createFromNode:function(node){var sc=node,so=0,ec=node,eo=dom.nodeLength(ec);return dom.isVoid(sc)&&(so=dom.listPrev(sc).length-1,sc=sc.parentNode),dom.isBR(ec)?(eo=dom.listPrev(ec).length-1,ec=ec.parentNode):dom.isVoid(ec)&&(eo=dom.listPrev(ec).length,ec=ec.parentNode),this.create(sc,so,ec,eo)},createFromNodeBefore:function(node){return this.createFromNode(node).collapse(!0)},createFromNodeAfter:function(node){return this.createFromNode(node).collapse()},createFromBookmark:function(editable,bookmark){var sc=dom.fromOffsetPath(editable,bookmark.s.path),so=bookmark.s.offset,ec=dom.fromOffsetPath(editable,bookmark.e.path),eo=bookmark.e.offset;return new WrappedRange(sc,so,ec,eo)},createFromParaBookmark:function(bookmark,paras){var so=bookmark.s.offset,eo=bookmark.e.offset,sc=dom.fromOffsetPath(list.head(paras),bookmark.s.path),ec=dom.fromOffsetPath(list.last(paras),bookmark.e.path);return new WrappedRange(sc,so,ec,eo)}}}(),defaults={version:"0.6.16",options:{width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,disableResizeImage:!1,shortcuts:!0,textareaAutoSync:!0,placeholder:!1,prettifyHtml:!0,iconPrefix:"fa fa-",icons:{font:{bold:"bold",italic:"italic",underline:"underline",clear:"eraser",height:"text-height",strikethrough:"strikethrough",superscript:"superscript",subscript:"subscript"},image:{image:"picture-o",floatLeft:"align-left",floatRight:"align-right",floatNone:"align-justify",shapeRounded:"square",shapeCircle:"circle-o",shapeThumbnail:"picture-o",shapeNone:"times",remove:"trash-o"},link:{link:"link",unlink:"unlink",edit:"edit"},table:{table:"table"},hr:{insert:"minus"},style:{style:"magic"},lists:{unordered:"list-ul",ordered:"list-ol"},options:{help:"question",fullscreen:"arrows-alt",codeview:"code"},paragraph:{paragraph:"align-left",outdent:"outdent",indent:"indent",left:"align-left",center:"align-center",right:"align-right",justify:"align-justify"},color:{recent:"font"},history:{undo:"undo",redo:"repeat"},misc:{check:"check"}},dialogsInBody:!1,codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],plugin:{},airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultFontName:"Helvetica Neue",fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],fontNamesIgnoreCheck:[],fontSizes:["8","9","10","11","12","14","18","24","36"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],insertTableMaxSize:{col:10,row:10},maximumImageFileSize:null,oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onMediaDelete:null,onToolbarClick:null,onsubmit:null,onCreateLink:function(sLinkUrl){return-1!==sLinkUrl.indexOf("@")&&-1===sLinkUrl.indexOf(":")&&(sLinkUrl="mailto:"+sLinkUrl),sLinkUrl},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},history:{undo:"Undo",redo:"Redo"}}}},async=function(){var readFileAsDataURL=function(file){return $.Deferred(function(deferred){$.extend(new FileReader,{onload:function(e){var sDataURL=e.target.result;deferred.resolve(sDataURL)},onerror:function(){deferred.reject(this)}}).readAsDataURL(file)}).promise()},createImage=function(sUrl,filename){return $.Deferred(function(deferred){var $img=$("<img>");$img.one("load",function(){$img.off("error abort"),deferred.resolve($img)}).one("error abort",function(){$img.off("load").detach(),deferred.reject($img)}).css({display:"none"}).appendTo(document.body).attr({src:sUrl,"data-filename":filename})}).promise()};return{readFileAsDataURL:readFileAsDataURL,createImage:createImage}}(),key=function(){var keyMap={BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,B:66,E:69,I:73,J:74,K:75,L:76,R:82,S:83,U:85,V:86,Y:89,Z:90,SLASH:191,LEFTBRACKET:219,BACKSLASH:220,RIGHTBRACKET:221};return{isEdit:function(keyCode){return list.contains([8,9,13,32],keyCode)},isMove:function(keyCode){return list.contains([37,38,39,40],keyCode)},nameFromCode:func.invertObject(keyMap),code:keyMap}}(),History=function($editable){var stack=[],stackOffset=-1,editable=$editable[0],makeSnapshot=function(){var rng=range.create(),emptyBookmark={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:$editable.html(),bookmark:rng?rng.bookmark(editable):emptyBookmark}},applySnapshot=function(snapshot){null!==snapshot.contents&&$editable.html(snapshot.contents),null!==snapshot.bookmark&&range.createFromBookmark(editable,snapshot.bookmark).select()};this.undo=function(){$editable.html()!==stack[stackOffset].contents&&this.recordUndo(),stackOffset>0&&(stackOffset--,applySnapshot(stack[stackOffset]))},this.redo=function(){stack.length-1>stackOffset&&(stackOffset++,applySnapshot(stack[stackOffset]))},this.recordUndo=function(){stackOffset++,stack.length>stackOffset&&(stack=stack.slice(0,stackOffset)),stack.push(makeSnapshot())},this.recordUndo()},Style=function(){var jQueryCSS=function($obj,propertyNames){if(agent.jqueryVersion<1.9){var result={};return $.each(propertyNames,function(idx,propertyName){result[propertyName]=$obj.css(propertyName)}),result}return $obj.css.call($obj,propertyNames);
};this.fromNode=function($node){var properties=["font-family","font-size","text-align","list-style-type","line-height"],styleInfo=jQueryCSS($node,properties)||{};return styleInfo["font-size"]=parseInt(styleInfo["font-size"],10),styleInfo},this.stylePara=function(rng,styleInfo){$.each(rng.nodes(dom.isPara,{includeAncestor:!0}),function(idx,para){$(para).css(styleInfo)})},this.styleNodes=function(rng,options){rng=rng.splitText();var nodeName=options&&options.nodeName||"SPAN",expandClosestSibling=!(!options||!options.expandClosestSibling),onlyPartialContains=!(!options||!options.onlyPartialContains);if(rng.isCollapsed())return[rng.insertNode(dom.create(nodeName))];var pred=dom.makePredByNodeName(nodeName),nodes=rng.nodes(dom.isText,{fullyContains:!0}).map(function(text){return dom.singleChildAncestor(text,pred)||dom.wrap(text,nodeName)});if(expandClosestSibling){if(onlyPartialContains){var nodesInRange=rng.nodes();pred=func.and(pred,function(node){return list.contains(nodesInRange,node)})}return nodes.map(function(node){var siblings=dom.withClosestSiblings(node,pred),head=list.head(siblings),tails=list.tail(siblings);return $.each(tails,function(idx,elem){dom.appendChildNodes(head,elem.childNodes),dom.remove(elem)}),list.head(siblings)})}return nodes},this.current=function(rng){var $cont=$(dom.isText(rng.sc)?rng.sc.parentNode:rng.sc),styleInfo=this.fromNode($cont);if(styleInfo["font-bold"]=document.queryCommandState("bold")?"bold":"normal",styleInfo["font-italic"]=document.queryCommandState("italic")?"italic":"normal",styleInfo["font-underline"]=document.queryCommandState("underline")?"underline":"normal",styleInfo["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",styleInfo["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",styleInfo["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",rng.isOnList()){var aOrderedType=["circle","disc","disc-leading-zero","square"],isUnordered=$.inArray(styleInfo["list-style-type"],aOrderedType)>-1;styleInfo["list-style"]=isUnordered?"unordered":"ordered"}else styleInfo["list-style"]="none";var para=dom.ancestor(rng.sc,dom.isPara);if(para&&para.style["line-height"])styleInfo["line-height"]=para.style.lineHeight;else{var lineHeight=parseInt(styleInfo["line-height"],10)/parseInt(styleInfo["font-size"],10);styleInfo["line-height"]=lineHeight.toFixed(1)}return styleInfo.anchor=rng.isOnAnchor()&&dom.ancestor(rng.sc,dom.isAnchor),styleInfo.ancestors=dom.listAncestor(rng.sc,dom.isEditable),styleInfo.range=rng,styleInfo}},Bullet=function(){this.insertOrderedList=function(){this.toggleList("OL")},this.insertUnorderedList=function(){this.toggleList("UL")},this.indent=function(){var self=this,rng=range.create().wrapBodyInlineWithPara(),paras=rng.nodes(dom.isPara,{includeAncestor:!0}),clustereds=list.clusterBy(paras,func.peq2("parentNode"));$.each(clustereds,function(idx,paras){var head=list.head(paras);dom.isLi(head)?self.wrapList(paras,head.parentNode.nodeName):$.each(paras,function(idx,para){$(para).css("marginLeft",function(idx,val){return(parseInt(val,10)||0)+25})})}),rng.select()},this.outdent=function(){var self=this,rng=range.create().wrapBodyInlineWithPara(),paras=rng.nodes(dom.isPara,{includeAncestor:!0}),clustereds=list.clusterBy(paras,func.peq2("parentNode"));$.each(clustereds,function(idx,paras){var head=list.head(paras);dom.isLi(head)?self.releaseList([paras]):$.each(paras,function(idx,para){$(para).css("marginLeft",function(idx,val){return val=parseInt(val,10)||0,val>25?val-25:""})})}),rng.select()},this.toggleList=function(listName){var self=this,rng=range.create().wrapBodyInlineWithPara(),paras=rng.nodes(dom.isPara,{includeAncestor:!0}),bookmark=rng.paraBookmark(paras),clustereds=list.clusterBy(paras,func.peq2("parentNode"));if(list.find(paras,dom.isPurePara)){var wrappedParas=[];$.each(clustereds,function(idx,paras){wrappedParas=wrappedParas.concat(self.wrapList(paras,listName))}),paras=wrappedParas}else{var diffLists=rng.nodes(dom.isList,{includeAncestor:!0}).filter(function(listNode){return!$.nodeName(listNode,listName)});diffLists.length?$.each(diffLists,function(idx,listNode){dom.replace(listNode,listName)}):paras=this.releaseList(clustereds,!0)}range.createFromParaBookmark(bookmark,paras).select()},this.wrapList=function(paras,listName){var head=list.head(paras),last=list.last(paras),prevList=dom.isList(head.previousSibling)&&head.previousSibling,nextList=dom.isList(last.nextSibling)&&last.nextSibling,listNode=prevList||dom.insertAfter(dom.create(listName||"UL"),last);return paras=paras.map(function(para){return dom.isPurePara(para)?dom.replace(para,"LI"):para}),dom.appendChildNodes(listNode,paras),nextList&&(dom.appendChildNodes(listNode,list.from(nextList.childNodes)),dom.remove(nextList)),paras},this.releaseList=function(clustereds,isEscapseToBody){var releasedParas=[];return $.each(clustereds,function(idx,paras){var head=list.head(paras),last=list.last(paras),headList=isEscapseToBody?dom.lastAncestor(head,dom.isList):head.parentNode,lastList=headList.childNodes.length>1?dom.splitTree(headList,{node:last.parentNode,offset:dom.position(last)+1},{isSkipPaddingBlankHTML:!0}):null,middleList=dom.splitTree(headList,{node:head.parentNode,offset:dom.position(head)},{isSkipPaddingBlankHTML:!0});paras=isEscapseToBody?dom.listDescendant(middleList,dom.isLi):list.from(middleList.childNodes).filter(dom.isLi),(isEscapseToBody||!dom.isList(headList.parentNode))&&(paras=paras.map(function(para){return dom.replace(para,"P")})),$.each(list.from(paras).reverse(),function(idx,para){dom.insertAfter(para,headList)});var rootLists=list.compact([headList,middleList,lastList]);$.each(rootLists,function(idx,rootList){var listNodes=[rootList].concat(dom.listDescendant(rootList,dom.isList));$.each(listNodes.reverse(),function(idx,listNode){dom.nodeLength(listNode)||dom.remove(listNode,!0)})}),releasedParas=releasedParas.concat(paras)}),releasedParas}},Typing=function(){var bullet=new Bullet;this.insertTab=function($editable,rng,tabsize){var tab=dom.createText(new Array(tabsize+1).join(dom.NBSP_CHAR));rng=rng.deleteContents(),rng.insertNode(tab,!0),rng=range.create(tab,tabsize),rng.select()},this.insertParagraph=function(){var rng=range.create();rng=rng.deleteContents(),rng=rng.wrapBodyInlineWithPara();var nextPara,splitRoot=dom.ancestor(rng.sc,dom.isPara);if(splitRoot){if(dom.isEmpty(splitRoot)&&dom.isLi(splitRoot))return void bullet.toggleList(splitRoot.parentNode.nodeName);nextPara=dom.splitTree(splitRoot,rng.getStartPoint());var emptyAnchors=dom.listDescendant(splitRoot,dom.isEmptyAnchor);emptyAnchors=emptyAnchors.concat(dom.listDescendant(nextPara,dom.isEmptyAnchor)),$.each(emptyAnchors,function(idx,anchor){dom.remove(anchor)})}else{var next=rng.sc.childNodes[rng.so];nextPara=$(dom.emptyPara)[0],next?rng.sc.insertBefore(nextPara,next):rng.sc.appendChild(nextPara)}range.create(nextPara,0).normalize().select()}},Table=function(){this.tab=function(rng,isShift){var cell=dom.ancestor(rng.commonAncestor(),dom.isCell),table=dom.ancestor(cell,dom.isTable),cells=dom.listDescendant(table,dom.isCell),nextCell=list[isShift?"prev":"next"](cells,cell);nextCell&&range.create(nextCell,0).select()},this.createTable=function(colCount,rowCount){for(var tdHTML,tds=[],idxCol=0;colCount>idxCol;idxCol++)tds.push("<td>"+dom.blank+"</td>");tdHTML=tds.join("");for(var trHTML,trs=[],idxRow=0;rowCount>idxRow;idxRow++)trs.push("<tr>"+tdHTML+"</tr>");return trHTML=trs.join(""),$('<table class="table table-bordered">'+trHTML+"</table>")[0]}},KEY_BOGUS="bogus",Editor=function(handler){var self=this,style=new Style,table=new Table,typing=new Typing,bullet=new Bullet;this.createRange=function($editable){return this.focus($editable),range.create()},this.saveRange=function($editable,thenCollapse){this.focus($editable),$editable.data("range",range.create()),thenCollapse&&range.create().collapse().select()},this.saveNode=function($editable){for(var copy=[],key=0,len=$editable[0].childNodes.length;len>key;key++)copy.push($editable[0].childNodes[key]);$editable.data("childNodes",copy)},this.restoreRange=function($editable){var rng=$editable.data("range");rng&&(rng.select(),this.focus($editable))},this.restoreNode=function($editable){$editable.html("");for(var child=$editable.data("childNodes"),index=0,len=child.length;len>index;index++)$editable[0].appendChild(child[index])},this.currentStyle=function(target){var rng=range.create(),styleInfo=rng&&rng.isOnEditable()?style.current(rng.normalize()):{};return dom.isImg(target)&&(styleInfo.image=target),styleInfo},this.styleFromNode=function($node){return style.fromNode($node)};var triggerOnBeforeChange=function($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data("callbacks"),"before.command")($editable.html(),$editable)},triggerOnChange=function($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data("callbacks"),"change")($editable.html(),$editable)};this.undo=function($editable){triggerOnBeforeChange($editable),$editable.data("NoteHistory").undo(),triggerOnChange($editable)},this.redo=function($editable){triggerOnBeforeChange($editable),$editable.data("NoteHistory").redo(),triggerOnChange($editable)};for(var beforeCommand=this.beforeCommand=function($editable){triggerOnBeforeChange($editable),self.focus($editable)},afterCommand=this.afterCommand=function($editable,isPreventTrigger){$editable.data("NoteHistory").recordUndo(),isPreventTrigger||triggerOnChange($editable)},commands=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","fontName"],idx=0,len=commands.length;len>idx;idx++)this[commands[idx]]=function(sCmd){return function($editable,value){beforeCommand($editable),document.execCommand(sCmd,!1,value),afterCommand($editable,!0)}}(commands[idx]);this.tab=function($editable,options){var rng=this.createRange($editable);rng.isCollapsed()&&rng.isOnCell()?table.tab(rng):(beforeCommand($editable),typing.insertTab($editable,rng,options.tabsize),afterCommand($editable))},this.untab=function($editable){var rng=this.createRange($editable);rng.isCollapsed()&&rng.isOnCell()&&table.tab(rng,!0)},this.insertParagraph=function($editable){beforeCommand($editable),typing.insertParagraph($editable),afterCommand($editable)},this.insertOrderedList=function($editable){beforeCommand($editable),bullet.insertOrderedList($editable),afterCommand($editable)},this.insertUnorderedList=function($editable){beforeCommand($editable),bullet.insertUnorderedList($editable),afterCommand($editable)},this.indent=function($editable){beforeCommand($editable),bullet.indent($editable),afterCommand($editable)},this.outdent=function($editable){beforeCommand($editable),bullet.outdent($editable),afterCommand($editable)},this.insertImage=function($editable,sUrl,filename){async.createImage(sUrl,filename).then(function($image){beforeCommand($editable),$image.css({display:"",width:Math.min($editable.width(),$image.width())}),range.create().insertNode($image[0]),range.createFromNodeAfter($image[0]).select(),afterCommand($editable)}).fail(function(){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data("callbacks"),"image.upload.error")()})},this.insertNode=function($editable,node){beforeCommand($editable),range.create().insertNode(node),range.createFromNodeAfter(node).select(),afterCommand($editable)},this.insertText=function($editable,text){beforeCommand($editable);var textNode=range.create().insertNode(dom.createText(text));range.create(textNode,dom.nodeLength(textNode)).select(),afterCommand($editable)},this.pasteHTML=function($editable,markup){beforeCommand($editable);var contents=range.create().pasteHTML(markup);range.createFromNodeAfter(list.last(contents)).select(),afterCommand($editable)},this.formatBlock=function($editable,tagName){beforeCommand($editable),tagName=agent.isMSIE?"<"+tagName+">":tagName,document.execCommand("FormatBlock",!1,tagName),afterCommand($editable)},this.formatPara=function($editable){beforeCommand($editable),this.formatBlock($editable,"P"),afterCommand($editable)};for(var idx=1;6>=idx;idx++)this["formatH"+idx]=function(idx){return function($editable){this.formatBlock($editable,"H"+idx)}}(idx);this.fontSize=function($editable,value){var rng=range.create();if(rng.isCollapsed()){var spans=style.styleNodes(rng),firstSpan=list.head(spans);$(spans).css({"font-size":value+"px"}),firstSpan&&!dom.nodeLength(firstSpan)&&(firstSpan.innerHTML=dom.ZERO_WIDTH_NBSP_CHAR,range.createFromNodeAfter(firstSpan.firstChild).select(),$editable.data(KEY_BOGUS,firstSpan))}else beforeCommand($editable),$(style.styleNodes(rng)).css({"font-size":value+"px"}),afterCommand($editable)},this.insertHorizontalRule=function($editable){beforeCommand($editable);var rng=range.create(),hrNode=rng.insertNode($("<HR/>")[0]);hrNode.nextSibling&&range.create(hrNode.nextSibling,0).normalize().select(),afterCommand($editable)},this.removeBogus=function($editable){var bogusNode=$editable.data(KEY_BOGUS);if(bogusNode){var textNode=list.find(list.from(bogusNode.childNodes),dom.isText),bogusCharIdx=textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);-1!==bogusCharIdx&&textNode.deleteData(bogusCharIdx,1),dom.isEmpty(bogusNode)&&dom.remove(bogusNode),$editable.removeData(KEY_BOGUS)}},this.lineHeight=function($editable,value){beforeCommand($editable),style.stylePara(range.create(),{lineHeight:value}),afterCommand($editable)},this.unlink=function($editable){var rng=this.createRange($editable);if(rng.isOnAnchor()){var anchor=dom.ancestor(rng.sc,dom.isAnchor);rng=range.createFromNode(anchor),rng.select(),beforeCommand($editable),document.execCommand("unlink"),afterCommand($editable)}},this.createLink=function($editable,linkInfo,options){var linkUrl=linkInfo.url,linkText=linkInfo.text,isNewWindow=linkInfo.isNewWindow,rng=linkInfo.range||this.createRange($editable),isTextChanged=rng.toString()!==linkText;options=options||dom.makeLayoutInfo($editable).editor().data("options"),beforeCommand($editable),options.onCreateLink&&(linkUrl=options.onCreateLink(linkUrl));var anchors=[];if(isTextChanged){var anchor=rng.insertNode($("<A>"+linkText+"</A>")[0]);anchors.push(anchor)}else anchors=style.styleNodes(rng,{nodeName:"A",expandClosestSibling:!0,onlyPartialContains:!0});$.each(anchors,function(idx,anchor){$(anchor).attr("href",linkUrl),isNewWindow?$(anchor).attr("target","_blank"):$(anchor).removeAttr("target")});var startRange=range.createFromNodeBefore(list.head(anchors)),startPoint=startRange.getStartPoint(),endRange=range.createFromNodeAfter(list.last(anchors)),endPoint=endRange.getEndPoint();range.create(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset).select(),afterCommand($editable)},this.getLinkInfo=function($editable){this.focus($editable);var rng=range.create().expand(dom.isAnchor),$anchor=$(list.head(rng.nodes(dom.isAnchor)));return{range:rng,text:rng.toString(),isNewWindow:$anchor.length?"_blank"===$anchor.attr("target"):!1,url:$anchor.length?$anchor.attr("href"):""}},this.color=function($editable,sObjColor){var oColor=JSON.parse(sObjColor),foreColor=oColor.foreColor,backColor=oColor.backColor;beforeCommand($editable),foreColor&&document.execCommand("foreColor",!1,foreColor),backColor&&document.execCommand("backColor",!1,backColor),afterCommand($editable)},this.insertTable=function($editable,sDim){var dimension=sDim.split("x");beforeCommand($editable);var rng=range.create().deleteContents();rng.insertNode(table.createTable(dimension[0],dimension[1])),afterCommand($editable)},this.floatMe=function($editable,value,$target){beforeCommand($editable),$target.removeClass("pull-left pull-right"),value&&"none"!==value&&$target.addClass("pull-"+value),$target.css("float",value),afterCommand($editable)},this.imageShape=function($editable,value,$target){beforeCommand($editable),$target.removeClass("img-rounded img-circle img-thumbnail"),value&&$target.addClass(value),afterCommand($editable)},this.resize=function($editable,value,$target){beforeCommand($editable),$target.css({width:100*value+"%",height:""}),afterCommand($editable)},this.resizeTo=function(pos,$target,bKeepRatio){var imageSize;if(bKeepRatio){var newRatio=pos.y/pos.x,ratio=$target.data("ratio");imageSize={width:ratio>newRatio?pos.x:pos.y/ratio,height:ratio>newRatio?pos.x*ratio:pos.y}}else imageSize={width:pos.x,height:pos.y};$target.css(imageSize)},this.removeMedia=function($editable,value,$target){beforeCommand($editable),$target.detach(),handler.bindCustomEvent($(),$editable.data("callbacks"),"media.delete")($target,$editable),afterCommand($editable)},this.focus=function($editable){$editable.focus(),agent.isFF&&!range.create().isOnEditable()&&range.createFromNode($editable[0]).normalize().collapse().select()},this.isEmpty=function($editable){return dom.isEmpty($editable[0])||dom.emptyPara===$editable.html()}},Button=function(){this.update=function($container,styleInfo){var checkDropdownMenu=function($btn,value){$btn.find(".dropdown-menu li a").each(function(){var isChecked=$(this).data("value")+""==value+"";this.className=isChecked?"checked":""})},btnState=function(selector,pred){var $btn=$container.find(selector);$btn.toggleClass("active",pred())};if(styleInfo.image){var $img=$(styleInfo.image);btnState('button[data-event="imageShape"][data-value="img-rounded"]',function(){return $img.hasClass("img-rounded")}),btnState('button[data-event="imageShape"][data-value="img-circle"]',function(){return $img.hasClass("img-circle")}),btnState('button[data-event="imageShape"][data-value="img-thumbnail"]',function(){return $img.hasClass("img-thumbnail")}),btnState('button[data-event="imageShape"]:not([data-value])',function(){return!$img.is(".img-rounded, .img-circle, .img-thumbnail")});var imgFloat=$img.css("float");btnState('button[data-event="floatMe"][data-value="left"]',function(){return"left"===imgFloat}),btnState('button[data-event="floatMe"][data-value="right"]',function(){return"right"===imgFloat}),btnState('button[data-event="floatMe"][data-value="none"]',function(){return"left"!==imgFloat&&"right"!==imgFloat});var style=$img.attr("style");return btnState('button[data-event="resize"][data-value="1"]',function(){return!!/(^|\s)(max-)?width\s*:\s*100%/.test(style)}),btnState('button[data-event="resize"][data-value="0.5"]',function(){return!!/(^|\s)(max-)?width\s*:\s*50%/.test(style)}),void btnState('button[data-event="resize"][data-value="0.25"]',function(){return!!/(^|\s)(max-)?width\s*:\s*25%/.test(style)})}var $fontname=$container.find(".note-fontname");if($fontname.length){var selectedFont=styleInfo["font-family"];if(selectedFont){for(var list=selectedFont.split(","),i=0,len=list.length;len>i&&(selectedFont=list[i].replace(/[\'\"]/g,"").replace(/\s+$/,"").replace(/^\s+/,""),!agent.isFontInstalled(selectedFont));i++);$fontname.find(".note-current-fontname").text(selectedFont),checkDropdownMenu($fontname,selectedFont)}}var $fontsize=$container.find(".note-fontsize");$fontsize.find(".note-current-fontsize").text(styleInfo["font-size"]),checkDropdownMenu($fontsize,parseFloat(styleInfo["font-size"]));var $lineHeight=$container.find(".note-height");checkDropdownMenu($lineHeight,parseFloat(styleInfo["line-height"])),btnState('button[data-event="bold"]',function(){return"bold"===styleInfo["font-bold"]}),btnState('button[data-event="italic"]',function(){return"italic"===styleInfo["font-italic"]}),btnState('button[data-event="underline"]',function(){return"underline"===styleInfo["font-underline"]}),btnState('button[data-event="strikethrough"]',function(){return"strikethrough"===styleInfo["font-strikethrough"]}),btnState('button[data-event="superscript"]',function(){return"superscript"===styleInfo["font-superscript"]}),btnState('button[data-event="subscript"]',function(){return"subscript"===styleInfo["font-subscript"]}),btnState('button[data-event="justifyLeft"]',function(){return"left"===styleInfo["text-align"]||"start"===styleInfo["text-align"]}),btnState('button[data-event="justifyCenter"]',function(){return"center"===styleInfo["text-align"]}),btnState('button[data-event="justifyRight"]',function(){return"right"===styleInfo["text-align"]}),btnState('button[data-event="justifyFull"]',function(){return"justify"===styleInfo["text-align"]}),btnState('button[data-event="insertUnorderedList"]',function(){return"unordered"===styleInfo["list-style"]}),btnState('button[data-event="insertOrderedList"]',function(){return"ordered"===styleInfo["list-style"]})},this.updateRecentColor=function(button,eventName,value){var $color=$(button).closest(".note-color"),$recentColor=$color.find(".note-recent-color"),colorInfo=JSON.parse($recentColor.attr("data-value"));colorInfo[eventName]=value,$recentColor.attr("data-value",JSON.stringify(colorInfo));var sKey="backColor"===eventName?"background-color":"color";$recentColor.find("i").css(sKey,value)}},Toolbar=function(){var button=new Button;this.update=function($toolbar,styleInfo){button.update($toolbar,styleInfo)},this.updateRecentColor=function(buttonNode,eventName,value){button.updateRecentColor(buttonNode,eventName,value)},this.activate=function($toolbar){$toolbar.find("button").not('button[data-event="codeview"]').removeClass("disabled")},this.deactivate=function($toolbar){$toolbar.find("button").not('button[data-event="codeview"]').addClass("disabled")},this.updateFullscreen=function($container,bFullscreen){var $btn=$container.find('button[data-event="fullscreen"]');$btn.toggleClass("active",bFullscreen)},this.updateCodeview=function($container,isCodeview){var $btn=$container.find('button[data-event="codeview"]');$btn.toggleClass("active",isCodeview),isCodeview?this.deactivate($container):this.activate($container)},this.get=function($editable,name){var $toolbar=dom.makeLayoutInfo($editable).toolbar();return $toolbar.find("[data-name="+name+"]")},this.setButtonState=function($editable,name,isActive){isActive=isActive===!1?!1:!0;var $button=this.get($editable,name);$button.toggleClass("active",isActive)}},EDITABLE_PADDING=24,Statusbar=function(){var $document=$(document);this.attach=function(layoutInfo,options){options.disableResizeEditor||layoutInfo.statusbar().on("mousedown",hStatusbarMousedown)};var hStatusbarMousedown=function(event){event.preventDefault(),event.stopPropagation();var $editable=dom.makeLayoutInfo(event.target).editable(),editableTop=$editable.offset().top-$document.scrollTop(),layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target),options=layoutInfo.editor().data("options");$document.on("mousemove",function(event){var nHeight=event.clientY-(editableTop+EDITABLE_PADDING);nHeight=options.minHeight>0?Math.max(nHeight,options.minHeight):nHeight,nHeight=options.maxHeight>0?Math.min(nHeight,options.maxHeight):nHeight,$editable.height(nHeight)}).one("mouseup",function(){$document.off("mousemove")})}},Popover=function(){var button=new Button,posFromPlaceholder=function(placeholder,options){var isAirMode=options&&options.isAirMode,isLeftTop=options&&options.isLeftTop,$placeholder=$(placeholder),pos=isAirMode?$placeholder.offset():$placeholder.position(),height=isLeftTop?0:$placeholder.outerHeight(!0);return{left:pos.left,top:pos.top+height}},showPopover=function($popover,pos){$popover.css({display:"block",left:pos.left,top:pos.top})},PX_POPOVER_ARROW_OFFSET_X=20;this.update=function($popover,styleInfo,isAirMode){button.update($popover,styleInfo);var $linkPopover=$popover.find(".note-link-popover");if(styleInfo.anchor){var $anchor=$linkPopover.find("a"),href=$(styleInfo.anchor).attr("href"),target=$(styleInfo.anchor).attr("target");$anchor.attr("href",href).html(href),target?$anchor.attr("target","_blank"):$anchor.removeAttr("target"),showPopover($linkPopover,posFromPlaceholder(styleInfo.anchor,{isAirMode:isAirMode}))}else $linkPopover.hide();var $imagePopover=$popover.find(".note-image-popover");styleInfo.image?showPopover($imagePopover,posFromPlaceholder(styleInfo.image,{isAirMode:isAirMode,isLeftTop:!0})):$imagePopover.hide();var $airPopover=$popover.find(".note-air-popover");if(isAirMode&&styleInfo.range&&!styleInfo.range.isCollapsed()){var rect=list.last(styleInfo.range.getClientRects());if(rect){var bnd=func.rect2bnd(rect);showPopover($airPopover,{left:Math.max(bnd.left+bnd.width/2-PX_POPOVER_ARROW_OFFSET_X,0),top:bnd.top+bnd.height})}}else $airPopover.hide()},this.updateRecentColor=function(button,eventName,value){button.updateRecentColor(button,eventName,value)},this.hide=function($popover){$popover.children().hide()}},Handle=function(handler){var $document=$(document),hHandleMousedown=function(event){if(dom.isControlSizing(event.target)){event.preventDefault(),event.stopPropagation();var layoutInfo=dom.makeLayoutInfo(event.target),$handle=layoutInfo.handle(),$popover=layoutInfo.popover(),$editable=layoutInfo.editable(),$editor=layoutInfo.editor(),target=$handle.find(".note-control-selection").data("target"),$target=$(target),posStart=$target.offset(),scrollTop=$document.scrollTop(),isAirMode=$editor.data("options").airMode;$document.on("mousemove",function(event){handler.invoke("editor.resizeTo",{x:event.clientX-posStart.left,y:event.clientY-(posStart.top-scrollTop)},$target,!event.shiftKey),handler.invoke("handle.update",$handle,{image:target},isAirMode),handler.invoke("popover.update",$popover,{image:target},isAirMode)}).one("mouseup",function(){$document.off("mousemove"),handler.invoke("editor.afterCommand",$editable)}),$target.data("ratio")||$target.data("ratio",$target.height()/$target.width())}};this.attach=function(layoutInfo){layoutInfo.handle().on("mousedown",hHandleMousedown)},this.update=function($handle,styleInfo,isAirMode){var $selection=$handle.find(".note-control-selection");if(styleInfo.image){var $image=$(styleInfo.image),pos=isAirMode?$image.offset():$image.position(),imageSize={w:$image.outerWidth(!0),h:$image.outerHeight(!0)};$selection.css({display:"block",left:pos.left,top:pos.top,width:imageSize.w,height:imageSize.h}).data("target",styleInfo.image);var sizingText=imageSize.w+"x"+imageSize.h;$selection.find(".note-control-selection-info").text(sizingText)}else $selection.hide()},this.hide=function($handle){$handle.children().hide()}},Fullscreen=function(handler){var $window=$(window),$scrollbar=$("html, body");this.toggle=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable(),resize=function(size){$editable.css("height",size.h),$codable.css("height",size.h),$codable.data("cmeditor")&&$codable.data("cmeditor").setsize(null,size.h)};$editor.toggleClass("fullscreen");var isFullscreen=$editor.hasClass("fullscreen");isFullscreen?($editable.data("orgheight",$editable.css("height")),$window.on("resize",function(){resize({h:$window.height()-$toolbar.outerHeight()})}).trigger("resize"),$scrollbar.css("overflow","hidden")):($window.off("resize"),resize({h:$editable.data("orgheight")}),$scrollbar.css("overflow","visible")),handler.invoke("toolbar.updateFullscreen",$toolbar,isFullscreen)}};agent.hasCodeMirror&&(agent.isSupportAmd?require(["CodeMirror"],function(cm){CodeMirror=cm}):CodeMirror=window.CodeMirror);var Codeview=function(handler){this.sync=function(layoutInfo){var isCodeview=handler.invoke("codeview.isActivated",layoutInfo);isCodeview&&agent.hasCodeMirror&&layoutInfo.codable().data("cmEditor").save()},this.isActivated=function(layoutInfo){var $editor=layoutInfo.editor();return $editor.hasClass("codeview")},this.toggle=function(layoutInfo){this.isActivated(layoutInfo)?this.deactivate(layoutInfo):this.activate(layoutInfo)},this.activate=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable(),$popover=layoutInfo.popover(),$handle=layoutInfo.handle(),options=$editor.data("options");if($codable.val(dom.html($editable,options.prettifyHtml)),$codable.height($editable.height()),handler.invoke("toolbar.updateCodeview",$toolbar,!0),handler.invoke("popover.hide",$popover),handler.invoke("handle.hide",$handle),$editor.addClass("codeview"),$codable.focus(),agent.hasCodeMirror){var cmEditor=CodeMirror.fromTextArea($codable[0],options.codemirror);if(options.codemirror.tern){var server=new CodeMirror.TernServer(options.codemirror.tern);cmEditor.ternServer=server,cmEditor.on("cursorActivity",function(cm){server.updateArgHints(cm)})}cmEditor.setSize(null,$editable.outerHeight()),$codable.data("cmEditor",cmEditor)}},this.deactivate=function(layoutInfo){var $holder=layoutInfo.holder(),$editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable(),options=$editor.data("options");if(agent.hasCodeMirror){var cmEditor=$codable.data("cmEditor");$codable.val(cmEditor.getValue()),cmEditor.toTextArea()}var value=dom.value($codable,options.prettifyHtml)||dom.emptyPara,isChange=$editable.html()!==value;$editable.html(value),$editable.height(options.height?$codable.height():"auto"),$editor.removeClass("codeview"),isChange&&handler.bindCustomEvent($holder,$editable.data("callbacks"),"change")($editable.html(),$editable),$editable.focus(),handler.invoke("toolbar.updateCodeview",$toolbar,!1)}},DragAndDrop=function(handler){var $document=$(document);this.attach=function(layoutInfo,options){options.airMode||options.disableDragAndDrop?$document.on("drop",function(e){e.preventDefault()}):this.attachDragAndDropEvent(layoutInfo,options)},this.attachDragAndDropEvent=function(layoutInfo,options){var collection=$(),$editor=layoutInfo.editor(),$dropzone=layoutInfo.dropzone(),$dropzoneMessage=$dropzone.find(".note-dropzone-message");$document.on("dragenter",function(e){var isCodeview=handler.invoke("codeview.isActivated",layoutInfo),hasEditorSize=$editor.width()>0&&$editor.height()>0;isCodeview||collection.length||!hasEditorSize||($editor.addClass("dragover"),$dropzone.width($editor.width()),$dropzone.height($editor.height()),$dropzoneMessage.text(options.langInfo.image.dragImageHere)),collection=collection.add(e.target)}).on("dragleave",function(e){collection=collection.not(e.target),collection.length||$editor.removeClass("dragover")}).on("drop",function(){collection=$(),$editor.removeClass("dragover")}),$dropzone.on("dragenter",function(){$dropzone.addClass("hover"),$dropzoneMessage.text(options.langInfo.image.dropImage)}).on("dragleave",function(){$dropzone.removeClass("hover"),$dropzoneMessage.text(options.langInfo.image.dragImageHere)}),$dropzone.on("drop",function(event){var dataTransfer=event.originalEvent.dataTransfer,layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length)event.preventDefault(),layoutInfo.editable().focus(),handler.insertImages(layoutInfo,dataTransfer.files);else for(var insertNodefunc=function(){layoutInfo.holder().summernote("insertNode",this)},i=0,len=dataTransfer.types.length;len>i;i++){var type=dataTransfer.types[i],content=dataTransfer.getData(type);type.toLowerCase().indexOf("text")>-1?layoutInfo.holder().summernote("pasteHTML",content):$(content).each(insertNodefunc)}}).on("dragover",!1)}},Clipboard=function(handler){var $paste;this.attach=function(layoutInfo){agent.isMSIE&&agent.browserVersion>10||agent.isFF?($paste=$("<div />").attr("contenteditable",!0).css({position:"absolute",left:-1e5,opacity:0}),layoutInfo.editable().on("keydown",function(e){e.ctrlKey&&e.keyCode===key.code.V&&(handler.invoke("saveRange",layoutInfo.editable()),$paste.focus(),setTimeout(function(){pasteByHook(layoutInfo)},0))}),layoutInfo.editable().before($paste)):layoutInfo.editable().on("paste",pasteByEvent)};var pasteByHook=function(layoutInfo){var $editable=layoutInfo.editable(),node=$paste[0].firstChild;if(dom.isImg(node)){for(var dataURI=node.src,decodedData=atob(dataURI.split(",")[1]),array=new Uint8Array(decodedData.length),i=0;i<decodedData.length;i++)array[i]=decodedData.charCodeAt(i);
var blob=new Blob([array],{type:"image/png"});blob.name="clipboard.png",handler.invoke("restoreRange",$editable),handler.invoke("focus",$editable),handler.insertImages(layoutInfo,[blob])}else{var pasteContent=$("<div />").html($paste.html()).html();handler.invoke("restoreRange",$editable),handler.invoke("focus",$editable),pasteContent&&handler.invoke("pasteHTML",$editable,pasteContent)}$paste.empty()},pasteByEvent=function(event){var clipboardData=event.originalEvent.clipboardData,layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target),$editable=layoutInfo.editable();if(clipboardData&&clipboardData.items&&clipboardData.items.length){var item=list.head(clipboardData.items);"file"===item.kind&&-1!==item.type.indexOf("image/")&&handler.insertImages(layoutInfo,[item.getAsFile()]),handler.invoke("editor.afterCommand",$editable)}}},LinkDialog=function(handler){var toggleBtn=function($btn,isEnable){$btn.toggleClass("disabled",!isEnable),$btn.attr("disabled",!isEnable)},bindEnterKey=function($input,$btn){$input.on("keypress",function(event){event.keyCode===key.code.ENTER&&$btn.trigger("click")})};this.showLinkDialog=function($editable,$dialog,linkInfo){return $.Deferred(function(deferred){var $linkDialog=$dialog.find(".note-link-dialog"),$linkText=$linkDialog.find(".note-link-text"),$linkUrl=$linkDialog.find(".note-link-url"),$linkBtn=$linkDialog.find(".note-link-btn"),$openInNewWindow=$linkDialog.find("input[type=checkbox]");$linkDialog.one("shown.bs.modal",function(){$linkText.val(linkInfo.text),$linkText.on("input",function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val()),linkInfo.text=$linkText.val()}),linkInfo.url||(linkInfo.url=linkInfo.text||"http://",toggleBtn($linkBtn,linkInfo.text)),$linkUrl.on("input",function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val()),linkInfo.text||$linkText.val($linkUrl.val())}).val(linkInfo.url).trigger("focus").trigger("select"),bindEnterKey($linkUrl,$linkBtn),bindEnterKey($linkText,$linkBtn),$openInNewWindow.prop("checked",linkInfo.isNewWindow),$linkBtn.one("click",function(event){event.preventDefault(),deferred.resolve({range:linkInfo.range,url:$linkUrl.val(),text:$linkText.val(),isNewWindow:$openInNewWindow.is(":checked")}),$linkDialog.modal("hide")})}).one("hidden.bs.modal",function(){$linkText.off("input keypress"),$linkUrl.off("input keypress"),$linkBtn.off("click"),"pending"===deferred.state()&&deferred.reject()}).modal("show")}).promise()},this.show=function(layoutInfo){var $editor=layoutInfo.editor(),$dialog=layoutInfo.dialog(),$editable=layoutInfo.editable(),$popover=layoutInfo.popover(),linkInfo=handler.invoke("editor.getLinkInfo",$editable),options=$editor.data("options");handler.invoke("editor.saveRange",$editable),this.showLinkDialog($editable,$dialog,linkInfo).then(function(linkInfo){handler.invoke("editor.restoreRange",$editable),handler.invoke("editor.createLink",$editable,linkInfo,options),handler.invoke("popover.hide",$popover)}).fail(function(){handler.invoke("editor.restoreRange",$editable)})}},ImageDialog=function(handler){var toggleBtn=function($btn,isEnable){$btn.toggleClass("disabled",!isEnable),$btn.attr("disabled",!isEnable)},bindEnterKey=function($input,$btn){$input.on("keypress",function(event){event.keyCode===key.code.ENTER&&$btn.trigger("click")})};this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke("editor.saveRange",$editable),this.showImageDialog($editable,$dialog).then(function(data){handler.invoke("editor.restoreRange",$editable),"string"==typeof data?handler.invoke("editor.insertImage",$editable,data):handler.insertImages(layoutInfo,data)}).fail(function(){handler.invoke("editor.restoreRange",$editable)})},this.showImageDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $imageDialog=$dialog.find(".note-image-dialog"),$imageInput=$dialog.find(".note-image-input"),$imageUrl=$dialog.find(".note-image-url"),$imageBtn=$dialog.find(".note-image-btn");$imageDialog.one("shown.bs.modal",function(){$imageInput.replaceWith($imageInput.clone().on("change",function(){deferred.resolve(this.files||this.value),$imageDialog.modal("hide")}).val("")),$imageBtn.click(function(event){event.preventDefault(),deferred.resolve($imageUrl.val()),$imageDialog.modal("hide")}),$imageUrl.on("keyup paste",function(event){var url;url="paste"===event.type?event.originalEvent.clipboardData.getData("text"):$imageUrl.val(),toggleBtn($imageBtn,url)}).val("").trigger("focus"),bindEnterKey($imageUrl,$imageBtn)}).one("hidden.bs.modal",function(){$imageInput.off("change"),$imageUrl.off("keyup paste keypress"),$imageBtn.off("click"),"pending"===deferred.state()&&deferred.reject()}).modal("show")})}},HelpDialog=function(handler){this.showHelpDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $helpDialog=$dialog.find(".note-help-dialog");$helpDialog.one("hidden.bs.modal",function(){deferred.resolve()}).modal("show")}).promise()},this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke("editor.saveRange",$editable,!0),this.showHelpDialog($editable,$dialog).then(function(){handler.invoke("editor.restoreRange",$editable)})}},EventHandler=function(){var self=this,modules=this.modules={editor:new Editor(this),toolbar:new Toolbar(this),statusbar:new Statusbar(this),popover:new Popover(this),handle:new Handle(this),fullscreen:new Fullscreen(this),codeview:new Codeview(this),dragAndDrop:new DragAndDrop(this),clipboard:new Clipboard(this),linkDialog:new LinkDialog(this),imageDialog:new ImageDialog(this),helpDialog:new HelpDialog(this)};this.invoke=function(){var moduleAndMethod=list.head(list.from(arguments)),args=list.tail(list.from(arguments)),splits=moduleAndMethod.split("."),hasSeparator=splits.length>1,moduleName=hasSeparator&&list.head(splits),methodName=hasSeparator?list.last(splits):list.head(splits),module=this.getModule(moduleName),method=module[methodName];return method&&method.apply(module,args)},this.getModule=function(moduleName){return this.modules[moduleName]||this.modules.editor};var bindCustomEvent=this.bindCustomEvent=function($holder,callbacks,eventNamespace){return function(){var callback=callbacks[func.namespaceToCamel(eventNamespace,"on")];return callback&&callback.apply($holder[0],arguments),$holder.trigger("summernote."+eventNamespace,arguments)}};this.insertImages=function(layoutInfo,files){var $editor=layoutInfo.editor(),$editable=layoutInfo.editable(),$holder=layoutInfo.holder(),callbacks=$editable.data("callbacks"),options=$editor.data("options");callbacks.onImageUpload?bindCustomEvent($holder,callbacks,"image.upload")(files):$.each(files,function(idx,file){var filename=file.name;options.maximumImageFileSize&&options.maximumImageFileSize<file.size?bindCustomEvent($holder,callbacks,"image.upload.error")(options.langInfo.image.maximumFileSizeError):async.readFileAsDataURL(file).then(function(sDataURL){modules.editor.insertImage($editable,sDataURL,filename)}).fail(function(){bindCustomEvent($holder,callbacks,"image.upload.error")(options.langInfo.image.maximumFileSizeError)})})};var commands={showLinkDialog:function(layoutInfo){modules.linkDialog.show(layoutInfo)},showImageDialog:function(layoutInfo){modules.imageDialog.show(layoutInfo)},showHelpDialog:function(layoutInfo){modules.helpDialog.show(layoutInfo)},fullscreen:function(layoutInfo){modules.fullscreen.toggle(layoutInfo)},codeview:function(layoutInfo){modules.codeview.toggle(layoutInfo)}},hMousedown=function(event){dom.isImg(event.target)&&event.preventDefault()},hKeyupAndMouseup=function(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);modules.editor.removeBogus(layoutInfo.editable()),hToolbarAndPopoverUpdate(event)};this.updateStyleInfo=function(styleInfo,layoutInfo){if(styleInfo){var isAirMode=layoutInfo.editor().data("options").airMode;isAirMode||modules.toolbar.update(layoutInfo.toolbar(),styleInfo),modules.popover.update(layoutInfo.popover(),styleInfo,isAirMode),modules.handle.update(layoutInfo.handle(),styleInfo,isAirMode)}};var hToolbarAndPopoverUpdate=function(event){var target=event.target;setTimeout(function(){var layoutInfo=dom.makeLayoutInfo(target),styleInfo=modules.editor.currentStyle(target);self.updateStyleInfo(styleInfo,layoutInfo)},0)},hScroll=function(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);modules.popover.hide(layoutInfo.popover()),modules.handle.hide(layoutInfo.handle())},hToolbarAndPopoverMousedown=function(event){var $btn=$(event.target).closest("[data-event]");$btn.length&&event.preventDefault()},hToolbarAndPopoverClick=function(event){var $btn=$(event.target).closest("[data-event]");if($btn.length){var $target,eventName=$btn.attr("data-event"),value=$btn.attr("data-value"),hide=$btn.attr("data-hide"),layoutInfo=dom.makeLayoutInfo(event.target);if(-1!==$.inArray(eventName,["resize","floatMe","removeMedia","imageShape"])){var $selection=layoutInfo.handle().find(".note-control-selection");$target=$($selection.data("target"))}if(hide&&$btn.parents(".popover").hide(),$.isFunction($.summernote.pluginEvents[eventName]))$.summernote.pluginEvents[eventName](event,modules.editor,layoutInfo,value);else if(modules.editor[eventName]){var $editable=layoutInfo.editable();$editable.focus(),modules.editor[eventName]($editable,value,$target),event.preventDefault()}else commands[eventName]&&(commands[eventName].call(this,layoutInfo),event.preventDefault());if(-1!==$.inArray(eventName,["backColor","foreColor"])){var options=layoutInfo.editor().data("options",options),module=options.airMode?modules.popover:modules.toolbar;module.updateRecentColor(list.head($btn),eventName,value)}hToolbarAndPopoverUpdate(event)}},PX_PER_EM=18,hDimensionPickerMove=function(event,options){var posOffset,$picker=$(event.target.parentNode),$dimensionDisplay=$picker.next(),$catcher=$picker.find(".note-dimension-picker-mousecatcher"),$highlighted=$picker.find(".note-dimension-picker-highlighted"),$unhighlighted=$picker.find(".note-dimension-picker-unhighlighted");if(void 0===event.offsetX){var posCatcher=$(event.target).offset();posOffset={x:event.pageX-posCatcher.left,y:event.pageY-posCatcher.top}}else posOffset={x:event.offsetX,y:event.offsetY};var dim={c:Math.ceil(posOffset.x/PX_PER_EM)||1,r:Math.ceil(posOffset.y/PX_PER_EM)||1};$highlighted.css({width:dim.c+"em",height:dim.r+"em"}),$catcher.attr("data-value",dim.c+"x"+dim.r),3<dim.c&&dim.c<options.insertTableMaxSize.col&&$unhighlighted.css({width:dim.c+1+"em"}),3<dim.r&&dim.r<options.insertTableMaxSize.row&&$unhighlighted.css({height:dim.r+1+"em"}),$dimensionDisplay.html(dim.c+" x "+dim.r)};this.bindKeyMap=function(layoutInfo,keyMap){var $editor=layoutInfo.editor(),$editable=layoutInfo.editable();$editable.on("keydown",function(event){var keys=[];event.metaKey&&keys.push("CMD"),event.ctrlKey&&!event.altKey&&keys.push("CTRL"),event.shiftKey&&keys.push("SHIFT");var keyName=key.nameFromCode[event.keyCode];keyName&&keys.push(keyName);var pluginEvent,keyString=keys.join("+"),eventName=keyMap[keyString];if(eventName){if(pluginEvent=$.summernote.pluginEvents[keyString],$.isFunction(pluginEvent)&&pluginEvent(event,modules.editor,layoutInfo))return!1;pluginEvent=$.summernote.pluginEvents[eventName],$.isFunction(pluginEvent)?pluginEvent(event,modules.editor,layoutInfo):modules.editor[eventName]?(modules.editor[eventName]($editable,$editor.data("options")),event.preventDefault()):commands[eventName]&&(commands[eventName].call(this,layoutInfo),event.preventDefault())}else key.isEdit(event.keyCode)&&modules.editor.afterCommand($editable)})},this.attach=function(layoutInfo,options){options.shortcuts&&this.bindKeyMap(layoutInfo,options.keyMap[agent.isMac?"mac":"pc"]),layoutInfo.editable().on("mousedown",hMousedown),layoutInfo.editable().on("keyup mouseup",hKeyupAndMouseup),layoutInfo.editable().on("scroll",hScroll),modules.clipboard.attach(layoutInfo,options),modules.handle.attach(layoutInfo,options),layoutInfo.popover().on("click",hToolbarAndPopoverClick),layoutInfo.popover().on("mousedown",hToolbarAndPopoverMousedown),modules.dragAndDrop.attach(layoutInfo,options),options.airMode||(layoutInfo.toolbar().on("click",hToolbarAndPopoverClick),layoutInfo.toolbar().on("mousedown",hToolbarAndPopoverMousedown),modules.statusbar.attach(layoutInfo,options));var $catcherContainer=options.airMode?layoutInfo.popover():layoutInfo.toolbar(),$catcher=$catcherContainer.find(".note-dimension-picker-mousecatcher");$catcher.css({width:options.insertTableMaxSize.col+"em",height:options.insertTableMaxSize.row+"em"}).on("mousemove",function(event){hDimensionPickerMove(event,options)}),layoutInfo.editor().data("options",options),agent.isMSIE||setTimeout(function(){document.execCommand("styleWithCSS",0,options.styleWithSpan)},0);var history=new History(layoutInfo.editable());layoutInfo.editable().data("NoteHistory",history),layoutInfo.editable().data("callbacks",{onInit:options.onInit,onFocus:options.onFocus,onBlur:options.onBlur,onKeydown:options.onKeydown,onKeyup:options.onKeyup,onMousedown:options.onMousedown,onEnter:options.onEnter,onPaste:options.onPaste,onBeforeCommand:options.onBeforeCommand,onChange:options.onChange,onImageUpload:options.onImageUpload,onImageUploadError:options.onImageUploadError,onMediaDelete:options.onMediaDelete,onToolbarClick:options.onToolbarClick});var styleInfo=modules.editor.styleFromNode(layoutInfo.editable());this.updateStyleInfo(styleInfo,layoutInfo)},this.attachCustomEvent=function(layoutInfo,options){var $holder=layoutInfo.holder(),$editable=layoutInfo.editable(),callbacks=$editable.data("callbacks");$editable.focus(bindCustomEvent($holder,callbacks,"focus")),$editable.blur(bindCustomEvent($holder,callbacks,"blur")),$editable.keydown(function(event){event.keyCode===key.code.ENTER&&bindCustomEvent($holder,callbacks,"enter").call(this,event),bindCustomEvent($holder,callbacks,"keydown").call(this,event)}),$editable.keyup(bindCustomEvent($holder,callbacks,"keyup")),$editable.on("mousedown",bindCustomEvent($holder,callbacks,"mousedown")),$editable.on("mouseup",bindCustomEvent($holder,callbacks,"mouseup")),$editable.on("scroll",bindCustomEvent($holder,callbacks,"scroll")),$editable.on("paste",bindCustomEvent($holder,callbacks,"paste"));var changeEventName=agent.isMSIE?"DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted":"input";$editable.on(changeEventName,function(){bindCustomEvent($holder,callbacks,"change")($editable.html(),$editable)}),options.airMode||(layoutInfo.toolbar().click(bindCustomEvent($holder,callbacks,"toolbar.click")),layoutInfo.popover().click(bindCustomEvent($holder,callbacks,"popover.click"))),dom.isTextarea(list.head($holder))&&$holder.closest("form").submit(function(e){layoutInfo.holder().val(layoutInfo.holder().code()),bindCustomEvent($holder,callbacks,"submit").call(this,e,$holder.code())}),dom.isTextarea(list.head($holder))&&options.textareaAutoSync&&$holder.on("summernote.change",function(){layoutInfo.holder().val(layoutInfo.holder().code())}),bindCustomEvent($holder,callbacks,"init")(layoutInfo);for(var i=0,len=$.summernote.plugins.length;len>i;i++)$.isFunction($.summernote.plugins[i].init)&&$.summernote.plugins[i].init(layoutInfo)},this.detach=function(layoutInfo,options){layoutInfo.holder().off(),layoutInfo.editable().off(),layoutInfo.popover().off(),layoutInfo.handle().off(),layoutInfo.dialog().off(),options.airMode||(layoutInfo.dropzone().off(),layoutInfo.toolbar().off(),layoutInfo.statusbar().off())}},Renderer=function(){var tplButton=function(label,options){var event=options.event,value=options.value,title=options.title,className=options.className,dropdown=options.dropdown,hide=options.hide;return(dropdown?'<div class="btn-group'+(className?" "+className:"")+'">':"")+'<button type="button" class="btn btn-default btn-sm'+(!dropdown&&className?" "+className:"")+(dropdown?" dropdown-toggle":"")+'"'+(dropdown?' data-toggle="dropdown"':"")+(title?' title="'+title+'"':"")+(event?' data-event="'+event+'"':"")+(value?" data-value='"+value+"'":"")+(hide?" data-hide='"+hide+"'":"")+' tabindex="-1">'+label+(dropdown?' <span class="caret"></span>':"")+"</button>"+(dropdown||"")+(dropdown?"</div>":"")},tplIconButton=function(iconClassName,options){var label='<i class="'+iconClassName+'"></i>';return tplButton(label,options)},tplPopover=function(className,content){var $popover=$('<div class="'+className+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content"></div></div>');return $popover.find(".popover-content").append(content),$popover},tplDialog=function(className,title,body,footer){return'<div class="'+className+' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">'+(title?'<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">'+title+"</h4></div>":"")+'<div class="modal-body">'+body+"</div>"+(footer?'<div class="modal-footer">'+footer+"</div>":"")+"</div></div></div>"},tplDropdown=function(contents,className,nodeName){var classes="dropdown-menu"+(className?" "+className:"");return nodeName=nodeName||"ul",contents instanceof Array&&(contents=contents.join("")),"<"+nodeName+' class="'+classes+'">'+contents+"</"+nodeName+">"},tplButtonInfo={picture:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.image.image,{event:"showImageDialog",title:lang.image.image,hide:!0})},link:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.link.link,{event:"showLinkDialog",title:lang.link.link,hide:!0})},table:function(lang,options){var dropdown=['<div class="note-dimension-picker">','<div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div>','<div class="note-dimension-picker-highlighted"></div>','<div class="note-dimension-picker-unhighlighted"></div>',"</div>",'<div class="note-dimension-display"> 1 x 1 </div>'];return tplIconButton(options.iconPrefix+options.icons.table.table,{title:lang.table.table,dropdown:tplDropdown(dropdown,"note-table")})},style:function(lang,options){var items=options.styleTags.reduce(function(memo,v){var label=lang.style["p"===v?"normal":v];return memo+'<li><a data-event="formatBlock" href="#" data-value="'+v+'">'+("p"===v||"pre"===v?label:"<"+v+">"+label+"</"+v+">")+"</a></li>"},"");return tplIconButton(options.iconPrefix+options.icons.style.style,{title:lang.style.style,dropdown:tplDropdown(items)})},fontname:function(lang,options){var realFontList=[],items=options.fontNames.reduce(function(memo,v){return agent.isFontInstalled(v)||list.contains(options.fontNamesIgnoreCheck,v)?(realFontList.push(v),memo+'<li><a data-event="fontName" href="#" data-value="'+v+'" style="font-family:\''+v+'\'"><i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+"</a></li>"):memo},""),hasDefaultFont=agent.isFontInstalled(options.defaultFontName),defaultFontName=hasDefaultFont?options.defaultFontName:realFontList[0],label='<span class="note-current-fontname">'+defaultFontName+"</span>";return tplButton(label,{title:lang.font.name,className:"note-fontname",dropdown:tplDropdown(items,"note-check")})},fontsize:function(lang,options){var items=options.fontSizes.reduce(function(memo,v){return memo+'<li><a data-event="fontSize" href="#" data-value="'+v+'"><i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+"</a></li>"},""),label='<span class="note-current-fontsize">11</span>';return tplButton(label,{title:lang.font.size,className:"note-fontsize",dropdown:tplDropdown(items,"note-check")})},color:function(lang,options){var colorButtonLabel='<i class="'+options.iconPrefix+options.icons.color.recent+'" style="color:black;background-color:yellow;"></i>',colorButton=tplButton(colorButtonLabel,{className:"note-recent-color",title:lang.color.recent,event:"color",value:'{"backColor":"yellow"}'}),items=['<li><div class="btn-group">','<div class="note-palette-title">'+lang.color.background+"</div>",'<div class="note-color-reset" data-event="backColor"',' data-value="inherit" title="'+lang.color.transparent+'">'+lang.color.setTransparent+"</div>",'<div class="note-color-palette" data-target-event="backColor"></div>','</div><div class="btn-group">','<div class="note-palette-title">'+lang.color.foreground+"</div>",'<div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+lang.color.reset+'">',lang.color.resetToDefault,"</div>",'<div class="note-color-palette" data-target-event="foreColor"></div>',"</div></li>"],moreButton=tplButton("",{title:lang.color.more,dropdown:tplDropdown(items)});return colorButton+moreButton},bold:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.bold,{event:"bold",title:lang.font.bold})},italic:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.italic,{event:"italic",title:lang.font.italic})},underline:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.underline,{event:"underline",title:lang.font.underline})},strikethrough:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.strikethrough,{event:"strikethrough",title:lang.font.strikethrough})},superscript:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.superscript,{event:"superscript",title:lang.font.superscript})},subscript:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.subscript,{event:"subscript",title:lang.font.subscript})},clear:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.clear,{event:"removeFormat",title:lang.font.clear})},ul:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.lists.unordered,{event:"insertUnorderedList",title:lang.lists.unordered})},ol:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.lists.ordered,{event:"insertOrderedList",title:lang.lists.ordered})},paragraph:function(lang,options){var leftButton=tplIconButton(options.iconPrefix+options.icons.paragraph.left,{title:lang.paragraph.left,event:"justifyLeft"}),centerButton=tplIconButton(options.iconPrefix+options.icons.paragraph.center,{title:lang.paragraph.center,event:"justifyCenter"}),rightButton=tplIconButton(options.iconPrefix+options.icons.paragraph.right,{title:lang.paragraph.right,event:"justifyRight"}),justifyButton=tplIconButton(options.iconPrefix+options.icons.paragraph.justify,{title:lang.paragraph.justify,event:"justifyFull"}),outdentButton=tplIconButton(options.iconPrefix+options.icons.paragraph.outdent,{title:lang.paragraph.outdent,event:"outdent"}),indentButton=tplIconButton(options.iconPrefix+options.icons.paragraph.indent,{title:lang.paragraph.indent,event:"indent"}),dropdown=['<div class="note-align btn-group">',leftButton+centerButton+rightButton+justifyButton,'</div><div class="note-list btn-group">',indentButton+outdentButton,"</div>"];return tplIconButton(options.iconPrefix+options.icons.paragraph.paragraph,{title:lang.paragraph.paragraph,dropdown:tplDropdown(dropdown,"","div")})},height:function(lang,options){var items=options.lineHeights.reduce(function(memo,v){return memo+'<li><a data-event="lineHeight" href="#" data-value="'+parseFloat(v)+'"><i class="'+options.iconPrefix+options.icons.misc.check+'"></i> '+v+"</a></li>"},"");return tplIconButton(options.iconPrefix+options.icons.font.height,{title:lang.font.height,dropdown:tplDropdown(items,"note-check")})},help:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.help,{event:"showHelpDialog",title:lang.options.help,hide:!0})},fullscreen:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.fullscreen,{event:"fullscreen",title:lang.options.fullscreen})},codeview:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.codeview,{event:"codeview",title:lang.options.codeview})},undo:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.undo,{event:"undo",title:lang.history.undo})},redo:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.redo,{event:"redo",title:lang.history.redo})},hr:function(lang,options){return tplIconButton(options.iconPrefix+options.icons.hr.insert,{event:"insertHorizontalRule",title:lang.hr.insert})}},tplPopovers=function(lang,options){var tplLinkPopover=function(){var linkButton=tplIconButton(options.iconPrefix+options.icons.link.edit,{title:lang.link.edit,event:"showLinkDialog",hide:!0}),unlinkButton=tplIconButton(options.iconPrefix+options.icons.link.unlink,{title:lang.link.unlink,event:"unlink"}),content='<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+linkButton+unlinkButton+"</div>";return tplPopover("note-link-popover",content)},tplImagePopover=function(){var fullButton=tplButton('<span class="note-fontsize-10">100%</span>',{title:lang.image.resizeFull,event:"resize",value:"1"}),halfButton=tplButton('<span class="note-fontsize-10">50%</span>',{title:lang.image.resizeHalf,event:"resize",value:"0.5"}),quarterButton=tplButton('<span class="note-fontsize-10">25%</span>',{title:lang.image.resizeQuarter,event:"resize",value:"0.25"}),leftButton=tplIconButton(options.iconPrefix+options.icons.image.floatLeft,{title:lang.image.floatLeft,event:"floatMe",value:"left"}),rightButton=tplIconButton(options.iconPrefix+options.icons.image.floatRight,{title:lang.image.floatRight,event:"floatMe",value:"right"}),justifyButton=tplIconButton(options.iconPrefix+options.icons.image.floatNone,{title:lang.image.floatNone,event:"floatMe",value:"none"}),roundedButton=tplIconButton(options.iconPrefix+options.icons.image.shapeRounded,{title:lang.image.shapeRounded,event:"imageShape",value:"img-rounded"}),circleButton=tplIconButton(options.iconPrefix+options.icons.image.shapeCircle,{title:lang.image.shapeCircle,event:"imageShape",value:"img-circle"}),thumbnailButton=tplIconButton(options.iconPrefix+options.icons.image.shapeThumbnail,{title:lang.image.shapeThumbnail,event:"imageShape",value:"img-thumbnail"}),noneButton=tplIconButton(options.iconPrefix+options.icons.image.shapeNone,{title:lang.image.shapeNone,event:"imageShape",value:""}),removeButton=tplIconButton(options.iconPrefix+options.icons.image.remove,{title:lang.image.remove,event:"removeMedia",value:"none"}),content=(options.disableResizeImage?"":'<div class="btn-group">'+fullButton+halfButton+quarterButton+"</div>")+'<div class="btn-group">'+leftButton+rightButton+justifyButton+'</div><br><div class="btn-group">'+roundedButton+circleButton+thumbnailButton+noneButton+'</div><div class="btn-group">'+removeButton+"</div>";return tplPopover("note-image-popover",content)},tplAirPopover=function(){for(var $content=$("<div />"),idx=0,len=options.airPopover.length;len>idx;idx++){for(var group=options.airPopover[idx],$group=$('<div class="note-'+group[0]+' btn-group">'),i=0,lenGroup=group[1].length;lenGroup>i;i++){var $button=$(tplButtonInfo[group[1][i]](lang,options));$button.attr("data-name",group[1][i]),$group.append($button)}$content.append($group)}return tplPopover("note-air-popover",$content.children())},$notePopover=$('<div class="note-popover" />');return $notePopover.append(tplLinkPopover()),$notePopover.append(tplImagePopover()),options.airMode&&$notePopover.append(tplAirPopover()),$notePopover},tplHandles=function(options){return'<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="'+(options.disableResizeImage?"note-control-holder":"note-control-sizing")+' note-control-se"></div>'+(options.disableResizeImage?"":'<div class="note-control-selection-info"></div>')+"</div></div>"},tplShortcut=function(title,keys){var keyClass="note-shortcut-col col-xs-6 note-shortcut-",body=[];for(var i in keys)keys.hasOwnProperty(i)&&body.push('<div class="'+keyClass+'key">'+keys[i].kbd+'</div><div class="'+keyClass+'name">'+keys[i].text+"</div>");return'<div class="note-shortcut-row row"><div class="'+keyClass+'title col-xs-offset-6">'+title+'</div></div><div class="note-shortcut-row row">'+body.join('</div><div class="note-shortcut-row row">')+"</div>"},tplShortcutText=function(lang){var keys=[{kbd:"⌘ + B",text:lang.font.bold},{kbd:"⌘ + I",text:lang.font.italic},{kbd:"⌘ + U",text:lang.font.underline},{kbd:"⌘ + \\",text:lang.font.clear}];return tplShortcut(lang.shortcut.textFormatting,keys)},tplShortcutAction=function(lang){var keys=[{kbd:"⌘ + Z",text:lang.history.undo},{kbd:"⌘ + ⇧ + Z",text:lang.history.redo},{kbd:"⌘ + ]",text:lang.paragraph.indent},{kbd:"⌘ + [",text:lang.paragraph.outdent},{kbd:"⌘ + ENTER",text:lang.hr.insert}];return tplShortcut(lang.shortcut.action,keys)},tplShortcutPara=function(lang){var keys=[{kbd:"⌘ + ⇧ + L",text:lang.paragraph.left},{kbd:"⌘ + ⇧ + E",text:lang.paragraph.center},{kbd:"⌘ + ⇧ + R",text:lang.paragraph.right},{kbd:"⌘ + ⇧ + J",text:lang.paragraph.justify},{kbd:"⌘ + ⇧ + NUM7",text:lang.lists.ordered},{kbd:"⌘ + ⇧ + NUM8",text:lang.lists.unordered}];return tplShortcut(lang.shortcut.paragraphFormatting,keys)},tplShortcutStyle=function(lang){var keys=[{kbd:"⌘ + NUM0",text:lang.style.normal},{kbd:"⌘ + NUM1",text:lang.style.h1},{kbd:"⌘ + NUM2",text:lang.style.h2},{kbd:"⌘ + NUM3",text:lang.style.h3},{kbd:"⌘ + NUM4",text:lang.style.h4},{kbd:"⌘ + NUM5",text:lang.style.h5},{kbd:"⌘ + NUM6",text:lang.style.h6}];return tplShortcut(lang.shortcut.documentStyle,keys)},tplExtraShortcuts=function(lang,options){var extraKeys=options.extraKeys,keys=[];for(var key in extraKeys)extraKeys.hasOwnProperty(key)&&keys.push({kbd:key,text:extraKeys[key]});return tplShortcut(lang.shortcut.extraKeys,keys)},tplShortcutTable=function(lang,options){var colClass='class="note-shortcut note-shortcut-col col-sm-6 col-xs-12"',template=["<div "+colClass+">"+tplShortcutAction(lang,options)+"</div><div "+colClass+">"+tplShortcutText(lang,options)+"</div>","<div "+colClass+">"+tplShortcutStyle(lang,options)+"</div><div "+colClass+">"+tplShortcutPara(lang,options)+"</div>"];return options.extraKeys&&template.push("<div "+colClass+">"+tplExtraShortcuts(lang,options)+"</div>"),'<div class="note-shortcut-row row">'+template.join('</div><div class="note-shortcut-row row">')+"</div>"},replaceMacKeys=function(sHtml){return sHtml.replace(/⌘/g,"Ctrl").replace(/⇧/g,"Shift")},tplDialogInfo={image:function(lang,options){var imageLimitation="";if(options.maximumImageFileSize){var unit=Math.floor(Math.log(options.maximumImageFileSize)/Math.log(1024)),readableSize=1*(options.maximumImageFileSize/Math.pow(1024,unit)).toFixed(2)+" "+" KMGTP"[unit]+"B";imageLimitation="<small>"+lang.image.maximumFileSize+" : "+readableSize+"</small>"}var body='<div class="form-group row note-group-select-from-files"><label>'+lang.image.selectFromFiles+'</label><input class="note-image-input form-control" type="file" name="files" accept="image/*" multiple="multiple" />'+imageLimitation+'</div><div class="form-group row"><label>'+lang.image.url+'</label><input class="note-image-url form-control col-md-12" type="text" /></div>',footer='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+lang.image.insert+"</button>";return tplDialog("note-image-dialog",lang.image.insert,body,footer)},link:function(lang,options){var body='<div class="form-group row"><label>'+lang.link.textToDisplay+'</label><input class="note-link-text form-control col-md-12" type="text" /></div><div class="form-group row"><label>'+lang.link.url+'</label><input class="note-link-url form-control col-md-12" type="text" value="http://" /></div>'+(options.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+lang.link.openInNewWindow+"</label></div>"),footer='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+lang.link.insert+"</button>";
return tplDialog("note-link-dialog",lang.link.insert,body,footer)},help:function(lang,options){var body='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+lang.shortcut.close+'</a><div class="title">'+lang.shortcut.shortcuts+"</div>"+(agent.isMac?tplShortcutTable(lang,options):replaceMacKeys(tplShortcutTable(lang,options)))+'<p class="text-center"><a href="//summernote.org/" target="_blank">Summernote 0.6.16</a> · <a href="//github.com/summernote/summernote" target="_blank">Project</a> · <a href="//github.com/summernote/summernote/issues" target="_blank">Issues</a></p>';return tplDialog("note-help-dialog","",body,"")}},tplDialogs=function(lang,options){var dialogs="";return $.each(tplDialogInfo,function(idx,tplDialog){dialogs+=tplDialog(lang,options)}),'<div class="note-dialog">'+dialogs+"</div>"},tplStatusbar=function(){return'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>'},representShortcut=function(str){return agent.isMac&&(str=str.replace("CMD","⌘").replace("SHIFT","⇧")),str.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]")},createTooltip=function($container,keyMap,sPlacement){var invertedKeyMap=func.invertObject(keyMap),$buttons=$container.find("button");$buttons.each(function(i,elBtn){var $btn=$(elBtn),sShortcut=invertedKeyMap[$btn.data("event")];sShortcut&&$btn.attr("title",function(i,v){return v+" ("+representShortcut(sShortcut)+")"})}).tooltip({container:"body",trigger:"hover",placement:sPlacement||"top"}).on("click",function(){$(this).tooltip("hide")})},createPalette=function($container,options){var colorInfo=options.colors;$container.find(".note-color-palette").each(function(){for(var $palette=$(this),eventName=$palette.attr("data-target-event"),paletteContents=[],row=0,lenRow=colorInfo.length;lenRow>row;row++){for(var colors=colorInfo[row],buttons=[],col=0,lenCol=colors.length;lenCol>col;col++){var color=colors[col];buttons.push(['<button type="button" class="note-color-btn" style="background-color:',color,';" data-event="',eventName,'" data-value="',color,'" title="',color,'" data-toggle="button" tabindex="-1"></button>'].join(""))}paletteContents.push('<div class="note-color-row">'+buttons.join("")+"</div>")}$palette.html(paletteContents.join(""))})};this.createLayoutByAirMode=function($holder,options){var langInfo=options.langInfo,keyMap=options.keyMap[agent.isMac?"mac":"pc"],id=func.uniqueId();$holder.addClass("note-air-editor note-editable panel-body"),$holder.attr({id:"note-editor-"+id,contentEditable:!0});var body=document.body,$popover=$(tplPopovers(langInfo,options));$popover.addClass("note-air-layout"),$popover.attr("id","note-popover-"+id),$popover.appendTo(body),createTooltip($popover,keyMap),createPalette($popover,options);var $handle=$(tplHandles(options));$handle.addClass("note-air-layout"),$handle.attr("id","note-handle-"+id),$handle.appendTo(body);var $dialog=$(tplDialogs(langInfo,options));$dialog.addClass("note-air-layout"),$dialog.attr("id","note-dialog-"+id),$dialog.find("button.close, a.modal-close").click(function(){$(this).closest(".modal").modal("hide")}),$dialog.appendTo(body)},this.createLayoutByFrame=function($holder,options){var langInfo=options.langInfo,$editor=$('<div class="note-editor panel panel-default" />');options.width&&$editor.width(options.width),options.height>0&&$('<div class="note-statusbar">'+(options.disableResizeEditor?"":tplStatusbar())+"</div>").prependTo($editor);var $editingArea=$('<div class="note-editing-area" />'),isContentEditable=!$holder.is(":disabled"),$editable=$('<div class="note-editable panel-body" contentEditable="'+isContentEditable+'"></div>').prependTo($editingArea);options.height&&$editable.height(options.height),options.direction&&$editable.attr("dir",options.direction);var placeholder=$holder.attr("placeholder")||options.placeholder;placeholder&&$editable.attr("data-placeholder",placeholder),$editable.html(dom.html($holder)||dom.emptyPara),$('<textarea class="note-codable"></textarea>').prependTo($editingArea);var $popover=$(tplPopovers(langInfo,options)).prependTo($editingArea);createPalette($popover,options),createTooltip($popover,keyMap),$(tplHandles(options)).prependTo($editingArea),$editingArea.prependTo($editor);for(var $toolbar=$('<div class="note-toolbar panel-heading" />'),idx=0,len=options.toolbar.length;len>idx;idx++){for(var groupName=options.toolbar[idx][0],groupButtons=options.toolbar[idx][1],$group=$('<div class="note-'+groupName+' btn-group" />'),i=0,btnLength=groupButtons.length;btnLength>i;i++){var buttonInfo=tplButtonInfo[groupButtons[i]];if($.isFunction(buttonInfo)){var $button=$(buttonInfo(langInfo,options));$button.attr("data-name",groupButtons[i]),$group.append($button)}}$toolbar.append($group)}var keyMap=options.keyMap[agent.isMac?"mac":"pc"];createPalette($toolbar,options),createTooltip($toolbar,keyMap,"bottom"),$toolbar.prependTo($editor),$('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo($editor);var $dialogContainer=options.dialogsInBody?$(document.body):$editor,$dialog=$(tplDialogs(langInfo,options)).prependTo($dialogContainer);$dialog.find("button.close, a.modal-close").click(function(){$(this).closest(".modal").modal("hide")}),$editor.insertAfter($holder),$holder.hide()},this.hasNoteEditor=function($holder){return this.noteEditorFromHolder($holder).length>0},this.noteEditorFromHolder=function($holder){return $holder.hasClass("note-air-editor")?$holder:$holder.next().hasClass("note-editor")?$holder.next():$()},this.createLayout=function($holder,options){options.airMode?this.createLayoutByAirMode($holder,options):this.createLayoutByFrame($holder,options)},this.layoutInfoFromHolder=function($holder){var $editor=this.noteEditorFromHolder($holder);if($editor.length)return $editor.data("holder",$holder),dom.buildLayoutInfo($editor)},this.removeLayout=function($holder,layoutInfo,options){options.airMode?($holder.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),layoutInfo.popover().remove(),layoutInfo.handle().remove(),layoutInfo.dialog().remove()):($holder.html(layoutInfo.editable().html()),options.dialogsInBody&&layoutInfo.dialog().remove(),layoutInfo.editor().remove(),$holder.show())},this.getTemplate=function(){return{button:tplButton,iconButton:tplIconButton,dialog:tplDialog}},this.addButtonInfo=function(name,buttonInfo){tplButtonInfo[name]=buttonInfo},this.addDialogInfo=function(name,dialogInfo){tplDialogInfo[name]=dialogInfo}};$.summernote=$.summernote||{},$.extend($.summernote,defaults);var renderer=new Renderer,eventHandler=new EventHandler;$.extend($.summernote,{renderer:renderer,eventHandler:eventHandler,core:{agent:agent,list:list,dom:dom,range:range},pluginEvents:{},plugins:[]}),$.summernote.addPlugin=function(plugin){$.summernote.plugins.push(plugin),plugin.buttons&&$.each(plugin.buttons,function(name,button){renderer.addButtonInfo(name,button)}),plugin.dialogs&&$.each(plugin.dialogs,function(name,dialog){renderer.addDialogInfo(name,dialog)}),plugin.events&&$.each(plugin.events,function(name,event){$.summernote.pluginEvents[name]=event}),plugin.langs&&$.each(plugin.langs,function(locale,lang){$.summernote.lang[locale]&&$.extend($.summernote.lang[locale],lang)}),plugin.options&&$.extend($.summernote.options,plugin.options)},$.fn.extend({summernote:function(){var type=$.type(list.head(arguments)),isExternalAPICalled="string"===type,hasInitOptions="object"===type,options=hasInitOptions?list.head(arguments):{};if(options=$.extend({},$.summernote.options,options),options.icons=$.extend({},$.summernote.options.icons,options.icons),options.langInfo=$.extend(!0,{},$.summernote.lang["en-US"],$.summernote.lang[options.lang]),!isExternalAPICalled&&hasInitOptions)for(var i=0,len=$.summernote.plugins.length;len>i;i++){var plugin=$.summernote.plugins[i];options.plugin[plugin.name]&&($.summernote.plugins[i]=$.extend(!0,plugin,options.plugin[plugin.name]))}this.each(function(idx,holder){var $holder=$(holder);if(!renderer.hasNoteEditor($holder)){renderer.createLayout($holder,options);var layoutInfo=renderer.layoutInfoFromHolder($holder);$holder.data("layoutInfo",layoutInfo),eventHandler.attach(layoutInfo,options),eventHandler.attachCustomEvent(layoutInfo,options)}});var $first=this.first();if($first.length){var layoutInfo=renderer.layoutInfoFromHolder($first);if(isExternalAPICalled){var moduleAndMethod=list.head(list.from(arguments)),args=list.tail(list.from(arguments)),params=[moduleAndMethod,layoutInfo.editable()].concat(args);return eventHandler.invoke.apply(eventHandler,params)}options.focus&&layoutInfo.editable().focus()}return this},code:function(html){if(void 0===html){var $holder=this.first();if(!$holder.length)return;var layoutInfo=renderer.layoutInfoFromHolder($holder),$editable=layoutInfo&&layoutInfo.editable();if($editable&&$editable.length){var isCodeview=eventHandler.invoke("codeview.isActivated",layoutInfo);return eventHandler.invoke("codeview.sync",layoutInfo),isCodeview?layoutInfo.codable().val():layoutInfo.editable().html()}return dom.value($holder)}return this.each(function(i,holder){var layoutInfo=renderer.layoutInfoFromHolder($(holder)),$editable=layoutInfo&&layoutInfo.editable();$editable&&$editable.html(html)}),this},destroy:function(){return this.each(function(idx,holder){var $holder=$(holder);if(renderer.hasNoteEditor($holder)){var info=renderer.layoutInfoFromHolder($holder),options=info.editor().data("options");eventHandler.detach(info,options),renderer.removeLayout($holder,info,options)}}),this}})}),Clima.summernoteOptions={focus:!0,airMode:!1,toolbar:[["toolbar-group",["style"]],["toolbar-group",["bold","italic","underline","clear"]],["toolbar-group",["fontname"]],["toolbar-group",["color"]],["toolbar-group",["ul","ol","paragraph"]],["toolbar-group",["height"]],["toolbar-group",["link","picture","hr"]],["toolbar-group",["undo","redo","codeview"]],["toolbar-group",["save"]],["toolbar-group",["close"]]]};var openEditor=function(e){var $target=$(e.target),$editableElem=$target.closest("[data-editable-id]");$editableElem.summernote(Clima.summernoteOptions),e.preventDefault(),$editorContainer=$editableElem.next(),$editorContainer.css("overflow","auto"),$editorContainer.css("z-index","1050"),$editorContainer.css("min-height","550px"),$editorContainer.css("min-width","600px"),$(".note-palette-title").first().parentsUntil("div[data-name='color']").last().css("min-width","340px"),$editorContainer.livequery('[data-event="floatMe"]',function(elem){$(elem).parent().css("display","none")})};$("*[data-editable-id]").on("click",openEditor),$("body").on("click",".THIS-IS-NOT-NECESSARY-NOW-note-editor",function(e){$target=$(e.target),$target.hasClass("note-image-input")||e.preventDefault()}),$.summernote.addPlugin({buttons:{save:function(){var buttonHtml="";return buttonHtml+='<button type="button" style="padding-top: 5px; padding-bottom: 4px;" class="btn btn-default btn-sm btn-save" title="Save changes in the database" data-event="save-data" data-hide="true" tabindex="-1">',buttonHtml+='<i class="fa fa-floppy-o"></i>',buttonHtml+='<span style="font-size: 110%; padding: 0; margin-left: 7px;" class="btn-save-text">Save</span>',buttonHtml+="</button>"},close:function(){var buttonHtml="";return buttonHtml+='<button type="button" style="padding-top: 5px; padding-bottom: 4px;" class="btn btn-default btn-sm btn-close" title="Close editor" data-event="close-editor" data-hide="true" tabindex="-1">',buttonHtml+='<i class="fa fa-times"></i>',buttonHtml+='<span style="font-size: 110%; padding: 0; margin-left: 7px;" class="btn-close-editor">Close</span>',buttonHtml+="</button>"}},events:{"save-data":function(event,editor,layoutInfo){var ajaxOptions,dataObj,$editorElem=$(event.target).closest(".note-editor"),$editableElem=$editorElem.prev(),editableId=$editableElem.data("editableId"),textObj=Clima.editableTexts[editableId];if(textObj){var textId=textObj.id,newContents={};newContents[Clima.lang]=$.trim($editableElem.code()),dataObj={id:textId,contents:_.extend(textObj.contents,newContents),tags:[]},ajaxOptions={url:"/api/v1/texts/"+textId,method:"PUT",data:dataObj}}else{var pathname=window.location.pathname.split("/");""===pathname[0]&&pathname.shift(),pathname.shift();var pageName=pathname.join("/"),contents={pt:"",en:""};contents[Clima.lang]=$.trim($editableElem.code()),dataObj={contents:contents,tags:[],pageName:pageName,editableId:editableId},ajaxOptions={url:"/api/v1/texts",method:"POST",data:dataObj}}$editorElem.find(".btn-save").prop("disabled",!0),$editorElem.find(".btn-save-text").html("Saving...");var msg="";Q($.ajax(ajaxOptions)).delay(300).then(function(newTextObj){Clima.editableTexts[editableId]=newTextObj[0],msg="pt"===Clima.lang?"As alterações ao texto "+editableId+" foram gravadas":"Changes to text "+editableId+" were saved",$editorElem.find(".btn-save").prop("disabled",!1),$editorElem.find(".btn-save-text").html("Save"),Clima.notify("success",msg)})["catch"](function(err){msg="pt"===Clima.lang?"ERRO: o texto "+editableId+" não foi actualizado":"ERROR: text "+editableId+" was not updated",msg=msg+" ("+Clima.getErrorMessage(err)+")",$editorElem.find(".btn-save").prop("disabled",!1),$editorElem.find(".btn-save-text").html("Save"),Clima.notify("danger",msg)})},"close-editor":function(event,editor,layoutInfo){setTimeout(function(){var $editableElem=$(event.target).closest(".note-editor").prev();$editableElem.destroy(),$editableElem.on("click",openEditor)},10)}}});