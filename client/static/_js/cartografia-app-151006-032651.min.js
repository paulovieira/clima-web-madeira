var Cartografia=new Mn.Application;Cartografia.addRegions({mapOneRegion:"#mn-r-map-1",mapTwoRegion:"#mn-r-map-2",modalOneRegion:"#mn-r-modal-contents-1"}),L.Browser.retina=!1,L.mapbox.accessToken="dummyAccessToken",Cartografia.updateUrl=function(){var leafletMap,center,url="?";if(map0M.get("active")){leafletMap=map0M.get("leafletMap"),url+="mapindex=0",center=leafletMap.getCenter(),url+="&lat="+center.lat.toFixed(4),url+="&lng="+center.lng.toFixed(4),url+="&zoom="+leafletMap.getZoom();var selectedLayers=map0M.get("layersC").selected;_.each(selectedLayers,function(layerM){var id=layerM.get("id"),opacity=layerM.get("opacity"),zindex=layerM.get("zindex");url+="&"+id+"="+opacity+","+zindex})}router.navigate(url,{replace:!0})},Cartografia.updateUrlDebounce=_.debounce(Cartografia.updateUrl,500),Cartografia.getMapModel=function(mapIndex){if(0===mapIndex)return map0M;if(1===mapIndex)return map1M;throw new Error("wrong map index")},Cartografia.hasUTFGrid=function(tileJson){return!!tileJson.interactivity&&!!$.trim(tileJson.interactivity.template_teaser)},Cartografia.init=function(){var map0IV=new MapIV({model:map0M});this.mapOneRegion.show(map0IV)};var Router=Backbone.BaseRouter.extend({onNavigate:function(routeData){var routeObj=routeData.linked;routeObj.updateModels(routeData.query)},routes:{"*any":{updateModels:function(query){delete query.mapindex;var updateAttrs={};query.lat&&query.lng&&(updateAttrs.center={lat:query.lat,lng:query.lng},delete query.lat,delete query.lng),query.zoom&&(updateAttrs.initialZoom=parseInt(query.zoom,10),delete query.zoom),Cartografia.queryParams=query;var layersC=map0M.get("layersC");_.each(query,function(value,layerId){var layerM=layersC.get(layerId);if(layerM&&layerM.get("tileLayer")instanceof L.TileLayer){var array=value.split(","),layerAttrs={opacity:parseInt(array[0],10),zindex:parseInt(array[1],10)};layerM.set(layerAttrs,{silent:!0}),layerM.get("tileLayer").setOpacity(layerAttrs.opacity/100),layerM.get("tileLayer").setZIndex(layerAttrs.zindex)}}),map0M.set(updateAttrs)}}}}),cartografiaChannel=Backbone.Radio.channel("cartografia");cartografiaChannel.reply("selectLayer",function(mapIndex,layerId){var mapM=Cartografia.getMapModel(mapIndex),layerM=mapM.get("layersC").get(layerId)||mapM.get("exclusiveLayersC").get(layerId);if(!layerM)throw new Error("Unknown layerId: ",layerId);layerM.select()}),cartografiaChannel.reply("deselectLayer",function(mapIndex,layerId){var mapM=Cartografia.getMapModel(mapIndex),layerM=mapM.get("layersC").get(layerId);if(!layerM)throw new Error("Unknown layerId: ",layerId);layerM.deselect()}),cartografiaChannel.reply("openFullscreen",function(selector){$.fullscreen.isFullScreen()||($("#navbar-container").css("display","none"),$(selector).css("top","0px"),$(selector).fullscreen())}),cartografiaChannel.reply("closeFullscreen",function(selector){$("#navbar-container").css("display","block"),$(selector).css("top","52px"),$.fullscreen.isFullScreen()&&$.fullscreen.exit()}),$("#map-container").on("fscreenclose",function(e){cartografiaChannel.request("closeFullscreen","#map-container")}),Clima.width={},Clima.width.document=$(document).width(),Clima.width.window=$(window).width(),Clima.width.body=$("body").width(),Clima.width.mapContainer=$("#map-container").width(),Clima.width2={},Clima.width2.document=$.documentWidth(),Clima.width2.window=$.windowWidth(),Clima.width2.visualViewport=$.windowWidth("visual"),Clima.width2.layoutViewport=$.windowWidth("layout"),Clima.width2.pinchZoomFactor=$.pinchZoomFactor(),Clima.width2.scrollbarWidth=$.scrollbarWidth();var ControlLV=Mn.LayoutView.extend({onRender:function(){this.disableMouseInteractions()},disableMouseInteractions:function(){$(this.el).on("mousewheel DOMMouseScroll MozMousePixelScroll dblclick",function(e){e.stopPropagation()});var eventName="mousedown";("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(eventName="touchstart"),$(this.el).on(eventName,function(e){e.stopPropagation()}),$(this.el).on("dblclick",function(e){e.stopPropagation()}),$(this.el).on("click",function(e){e.stopPropagation()})}});L.Control.BackboneView=L.Control.extend({options:{position:"bottomright"},initialize:function(options){console.log("control initialize"),L.Util.setOptions(this,options),options.view&&(this._view=options.view)},onAdd:function(map){return this._view&&(this._view._map=this._map),this._view.el},onRemove:function(map){},getView:function(){return this._view}}),Clima.exclusiveLayers=[{id:"mapa-base-freguesias",name:"Mapa base",description:"",format:"png8",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["/api/v1/tiles/mapa-base-freguesias/{z}/{x}/{y}.png"],grids:["/api/v1/tiles/mapa-base-freguesias/{z}/{x}/{y}.grid.json"],template:"{{#__location__}}{{/__location__}}{{#__teaser__}}Freguesia: {{{freguesia}}}{{/__teaser__}}{{#__full__}}{{/__full__}}",interactivity:{layer:"freguesias",template_teaser:"Freguesiasx {{{ freguesias }}}"},isExclusive:!0,zIndex:-1},{id:"hydda-base",name:"Mapa base (Open Street Map)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://a.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png"],isExclusive:!0,zIndex:-1},{id:"open-topo-map",name:"Mapa topográfico (OSM)",description:"",descriptionx:"Mapa topográfico renderizado com dados do Open Street Map e do projecto SRTM. Mais informações: <a href='http://wiki.openstreetmap.org/wiki/OpenTopoMap' target='_blank'>Wiki do Open Street Map</a>",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://a.tile.opentopomap.org/{z}/{x}/{y}.png"],isExclusive:!0,zIndex:-1},{id:"esri-world-shaded-relief",name:"Modelo digital de terreno (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-gray-canvas",name:"Mapa das ribeiras (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"mapquest",name:"Mapa geral (MapQuest)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-street-map",name:"Mapa geral (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"esri-world-imagery",name:"Mapa de satélite (ESRI)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.jpg"],isExclusive:!0,zIndex:-1},{id:"here-satellite-day",name:"Mapa de satélite (Here)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",format:"png",tiles:["http://1.aerial.maps.cit.api.here.com/maptile/2.1/maptile/newest/satellite.day/{z}/{x}/{y}/256/png8?app_id=Y8m9dK2brESDPGJPdrvs&app_code=dq2MYIvjAotR8tHvY8Q_Dg"],isExclusive:!0,zIndex:-1},{id:"mapquest-places",name:"Nomes das localidades (MapQuest)",description:"",minzoom:5,maxzoom:13,legend:"",tilejson:"2.0.0",attribution:"",tiles:["http://otile1.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png"]}];var SequenceControlIV=ControlLV.extend({template:"sequence/templates/sequence.html",ui:{sequenceBtn:"button.js-select-layer-seq",playBtn:"button.js-play-seq",stopBtn:"button.js-stop-seq"},events:{"click @ui.sequenceBtn":"buttonClicked","click @ui.playBtn":"playSequence","click @ui.stopBtn":"stopSequence"},playSequence:function(e){if(!this.intervalHandle){var self=this;this.intervalHandle=setInterval(function(){self.selectNext()},1600),this.$el.find("div.btn-group").eq(0).children().eq(0).removeClass("btn-default").addClass("btn-info")}},stopSequence:function(e){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0,this.$el.find("div.btn-group").eq(0).children().eq(0).removeClass("btn-info").addClass("btn-default"))},buttonClicked:function(e){var $btn=$(e.target);this.toggleButtonsState($btn),this.deselectAllMaps(),this.selectClickedMap($btn),this.$currentSelectedButton=$btn},toggleButtonsState:function($buttonEl){$buttonEl.siblings().removeClass("active"),$buttonEl.addClass("active")},deselectAllMaps:function($buttonEl){var $children=this.$el.find("div.btn-group").eq(1).children(),mapIds=[];$children.each(function(i,el){mapIds.push($(el).data("mapId"))});for(var mapIndex=$children.first().data("mapIndex"),i=0;i<mapIds.length;i++)cartografiaChannel.request("deselectLayer",mapIndex,mapIds[i])},selectClickedMap:function($buttonEl){var mapId=$buttonEl.data("mapId"),mapIndex=$buttonEl.data("mapIndex");cartografiaChannel.request("selectLayer",mapIndex,mapId)},selectFirst:function(){var $first=this.$el.find("div.btn-group").eq(1).children().first();$first.trigger("click")},selectNext:function(){var $next=this.$currentSelectedButton.next();$next.length?$next.trigger("click"):this.selectFirst()}}),LayerM=Backbone.Model.extend({initialize:function(){Backbone.Select.Me.applyTo(this),this.on("change:opacity",this.changeOpacity),this.on("change:zindex",this.changeZIndex)},changeOpacity:function(model,newOpacity){this.get("tileLayer").setOpacity(newOpacity/100),Cartografia.updateUrlDebounce()},changeZIndex:function(model,newZIndex){this.get("tileLayer").setZIndex(newZIndex),Cartografia.updateUrlDebounce()},addSequentialControl:function(){if(this.get("tileLayer")instanceof Backbone.Collection){this.sequenceControlIV=new SequenceControlIV({collection:this.get("tileLayer")}),this.sequenceControlIV.render(),this.sequenceControl=new L.Control.BackboneView({view:this.sequenceControlIV,position:"topright"});var leafletMap=this.collection.parent.get("leafletMap");leafletMap.addControl(this.sequenceControl),this.sequenceControlIV.selectFirst()}},removeSequentialControl:function(){if(this.sequenceControl){this.sequenceControlIV.stopSequence(),this.sequenceControlIV.deselectAllMaps();var leafletMap=this.collection.parent.get("leafletMap");leafletMap.removeControl(this.sequenceControl),this.sequenceControlIV.destroy(),this.sequenceControlIV=void 0}}}),LayersBaseC=Backbone.Collection.extend({addTileLayer:function(layerM){var leafletMap=layerM.collection.parent.get("leafletMap");if(leafletMap&&!leafletMap.hasLayer(layerM.get("tileLayer"))){leafletMap.addLayer(layerM.get("tileLayer")),layerM.get("tileJson").isExclusive&&layerM.get("tileLayer").setZIndex(-1),layerM.has("gridLayer")&&(leafletMap.addLayer(layerM.get("gridLayer")),leafletMap.addControl(layerM.get("gridControl")));var legend=layerM.get("tileJson").legend;legend&&leafletMap.legendControl.addLegend(legend)}},removeTileLayer:function(layerM){var leafletMap=layerM.collection.parent.get("leafletMap");if(leafletMap&&leafletMap.hasLayer(layerM.get("tileLayer"))){leafletMap.removeLayer(layerM.get("tileLayer")),layerM.has("gridLayer")&&(leafletMap.removeLayer(layerM.get("gridLayer")),leafletMap.removeControl(layerM.get("gridControl")));var legend=layerM.get("tileJson").legend;legend&&leafletMap.legendControl.removeLegend(legend);var mapsMenu=layerM.collection.parent.get("mapsMenu");_.each(mapsMenu,function(groupObj){_.each(groupObj.maps,function(mapObj){mapObj.mapId===layerM.get("id")&&(mapObj.active=!1)},this)},this)}},updateMenuEntry:function(layerM,status){var mapsMenu=layerM.collection.parent.get("mapsMenu");_.each(mapsMenu,function(groupObj){_.each(groupObj.maps,function(mapObj){mapObj.mapId===layerM.get("id")&&(mapObj.active=status)},this)},this)},addLayer:function(layerM){var tileLayer=layerM.get("tileLayer");if(tileLayer&&tileLayer instanceof L.TileLayer)this.addTileLayer(layerM),this.updateMenuEntry(layerM,!0);else{if(!(tileLayer instanceof Backbone.Collection))throw new Error("invalid Tilelayer");layerM.addSequentialControl(),this.updateMenuEntry(layerM,!0)}},removeLayer:function(layerM){var tileLayer=layerM.get("tileLayer");if(tileLayer&&tileLayer instanceof L.TileLayer)this.removeTileLayer(layerM),this.updateMenuEntry(layerM,!1);else{if(!(tileLayer instanceof Backbone.Collection))throw new Error("invalid Tilelayer");layerM.removeSequentialControl(),this.updateMenuEntry(layerM,!1)}}}),LayersC=LayersBaseC.extend({model:LayerM,initialize:function(models){Backbone.Select.Many.applyTo(this,models),this.on("select:some select:all select:none",this.updateLayers)},updateLayers:function(diff){var i,l,selected=diff.selected,deselected=diff.deselected;for(i=0,l=selected.length;l>i;i++)this.addLayer(selected[i]);for(i=0,l=deselected.length;l>i;i++)this.removeLayer(deselected[i])}}),ExclusiveLayersC=LayersBaseC.extend({model:LayerM,initialize:function(models){Backbone.Select.One.applyTo(this,models),this.on("select:one",this.addLayer),this.on("deselect:one",this.removeLayer)}}),MapM=Backbone.Model.extend({initialize:function(){}}),map0M=new MapM({mapIndex:0,active:!1,menuOpen:!1,layersC:new LayersC,exclusiveLayersC:new ExclusiveLayersC,center:{lat:32.75,lng:-17.15},initialZoom:10,maxZoom:13,minZoom:7});map0M.get("layersC").parent=map0M,map0M.get("exclusiveLayersC").parent=map0M;var map1M=new MapM({mapIndex:1,active:!1,menuOpen:!1,layersC:new LayersC,exclusiveLayersC:new ExclusiveLayersC,center:{lat:32.75,lng:-17.15},initialZoom:10,maxZoom:13,minZoom:7});map1M.get("layersC").parent=map1M,map1M.get("exclusiveLayersC").parent=map1M,Clima.mapsMenu.unshift({groupName:"Mapas base",maps:[{mapId:"mapa-base-freguesias",radio:!0},{mapId:"mapquest",radio:!0},{mapId:"esri-world-imagery",radio:!0},{mapId:"esri-world-shaded-relief",radio:!0},{mapId:"esri-world-gray-canvas",radio:!0},{mapId:"mapquest-places",radio:!1}]}),_.each(Clima.exclusiveLayers,function(tileJson){Clima.maps.unshift(tileJson)}),map0M.set("mapsMenu",JSON.parse(JSON.stringify(Clima.mapsMenu))),map1M.set("mapsMenu",JSON.parse(JSON.stringify(Clima.mapsMenu))),_.each(map0M.get("mapsMenu"),function(groupObj){_.each(groupObj.maps,function(mapObj){var tileJson=_.findWhere(Clima.maps,{id:mapObj.mapId});if(tileJson){var mapIndex=0;mapObj.mapIndex=mapIndex,mapObj.name=tileJson.name,mapObj.hasInfo=$.trim(tileJson.description).length>0,tileJson.maxzoom=13;var layerM=new LayerM({id:tileJson.id,zindex:tileJson.zIndex||0,opacity:100,tileJson:tileJson,mapIndex:mapIndex});tileJson.tiles&&tileJson.minzoom&&tileJson.maxzoom?(layerM.set("tileLayer",L.mapbox.tileLayer(tileJson)),Cartografia.hasUTFGrid(tileJson)&&(layerM.set("gridLayer",L.mapbox.gridLayer(tileJson)),layerM.set("gridControl",L.mapbox.gridControl(layerM.get("gridLayer"))))):tileJson.sequence&&(layerM.set("tileLayer",new Backbone.Collection(tileJson.sequence)),layerM.get("tileLayer").each(function(model){model.set("mapIndex",mapIndex)})),tileJson.isExclusive?map0M.get("exclusiveLayersC").push(layerM):map0M.get("layersC").push(layerM)}})}),window.Behaviors=window.Behaviors||{},window.Behaviors.ShowModal=Marionette.Behavior.extend({events:function(){var eventsHash={},eventType=this.options.eventType||"click";return eventsHash[eventType+" @ui."+this.options.uiKey]="showModal",eventsHash},showModal:function(e){var $anchor=$(e.currentTarget);e.preventDefault();var mapIndex=this.view.model.get("mapIndex"),mapM=Cartografia.getMapModel(mapIndex),layerId=$anchor.data("mapId"),layerM=mapM.get("layersC").get(layerId);layerM||(layerM=mapM.get("exclusiveLayersC").get(layerId));var modalView=new this.options.viewClass({model:layerM}),$modal=$("#modal-1"),region=Cartografia.modalOneRegion;region.show(modalView),$modal.modal("show")}}),window.Behaviors.CloseModal=Marionette.Behavior.extend({events:{"click @ui.closeBtn":"closeModal"},closeModal:function(){var $modal=$("#modal-1");$modal.modal("hide"),this.view.destroy()}});var ModalMoreInfoIV=Mn.ItemView.extend({template:"menu/templates/modal-map-info.html",ui:{closeBtn:"button.js-modal-cancel"},behaviors:{CloseModal:{behaviorClass:window.Behaviors.CloseModal}}}),ModalMapOptionsIV=Mn.ItemView.extend({template:"menu/templates/modal-map-options.html",ui:{closeBtn:"button.js-modal-cancel",updateBtn:"button.js-modal-update"},events:{"click @ui.updateBtn":"updateMap"},behaviors:{CloseModal:{behaviorClass:window.Behaviors.CloseModal}},updateMap:function(){var opacity=parseInt(this.$("#opacity").val(),10);_.isNumber(opacity)&&opacity>=0&&100>=opacity&&this.model.set("opacity",opacity);var zindex=parseInt(this.$("#zindex").val(),10);_.isNumber(zindex)&&zindex!==this.model.get("zindex")&&this.model.set("zindex",zindex),$("#modal-1").modal("hide"),this.destroy()}}),MenuBodyIV=Mn.ItemView.extend({template:"menu/templates/menu-body.html",ui:{chkBox:"input.js-select-layer[type='checkbox']",radio:"input.js-select-layer[type='radio']",infoBtn:"a.js-map-more-info",optionsBtn:"a.js-map-options"},events:{"change @ui.radio":"inputClicked","change @ui.chkBox":"inputClicked","click @ui.infoBtn":"showInfoModal","click @ui.optionsBtn":"showOptionsModal"},behaviors:{ShowOptionsModal:{behaviorClass:window.Behaviors.ShowModal,uiKey:"optionsBtn",eventType:"click",viewClass:ModalMapOptionsIV},ShowInfoModal:{behaviorClass:window.Behaviors.ShowModal,uiKey:"infoBtn",eventType:"click",viewClass:ModalMoreInfoIV}},inputClicked:function(e){var $input=$(e.target),mapId=$input.data("mapId"),mapIndex=this.model.get("mapIndex");$input.is(":checked")?cartografiaChannel.request("selectLayer",mapIndex,mapId):cartografiaChannel.request("deselectLayer",mapIndex,mapId)},onAttach:function(){this.$("#tree-menu").treed({openedClass:"glyphicon-chevron-right",closedClass:"glyphicon-chevron-down"}),this.$(".js-map-group").trigger("click")}}),MenuLV=ControlLV.extend({template:"menu/templates/menu.html",modelEvents:{"change:menuOpen":"toggleRegion"},ui:{menuBtn:"i.menu-icon",fullscreenBtn:"a.js-full-screen"},events:{"click @ui.menuBtn":"toggleMenuOpen","click @ui.fullscreenBtn":"fullscreenBtnClicked"},regions:{bodyRegion:"div.mn-r-menu-body"},fullscreenBtnClicked:function(){$.fullscreen.isFullScreen()?cartografiaChannel.request("closeFullscreen","#map-container"):cartografiaChannel.request("openFullscreen","#map-container")},toggleMenuOpen:function(){var menuOpen=this.model.get("menuOpen");this.model.set("menuOpen",!menuOpen)},toggleRegion:function(e){this.model.get("menuOpen")===!0?this.show():this.reset()},show:function(){this.$el.css("height","95%"),this.$(".menu-container").addClass("map-menu-open");var menuBodyIV=new MenuBodyIV({model:this.model});this.bodyRegion.show(menuBodyIV);var menuBodyHeight=this.$(".menu-container").height()-this.$(".menu-header").height();this.bodyRegion.currentView.$el.css("height",menuBodyHeight),this.bodyRegion.currentView.$el.css("overflow-x","auto")},reset:function(){this.bodyRegion.reset(),this.$el.css("height",""),this.$(".menu-container").removeClass("map-menu-open")}}),MapIV=Mn.ItemView.extend({attributes:{style:"height: 100%; xborder: solid green 1px; "},template:"map/templates/map-container.html",initialize:function(){},initializeMap:function(){var mapIndex=this.model.get("mapIndex"),center=this.model.get("center"),initialZoom=this.model.get("initialZoom"),maxZoom=this.model.get("maxZoom"),minZoom=this.model.get("minZoom"),div=this.$("div.mn-leaflet-map").get(mapIndex);this.map=L.mapbox.map(div,void 0,{zoomControl:!1,attributionControl:!1,zoom:initialZoom,maxZoom:maxZoom,minZoom:minZoom,center:[center.lat,center.lng]}),this.map.on("moveend",Cartografia.updateUrlDebounce),this.map.on("layeradd",Cartografia.updateUrlDebounce),this.map.on("layerremove",Cartografia.updateUrlDebounce),this.model.set("active",!0),this.model.set("leafletMap",this.map),cartografiaChannel.request("selectLayer",0,"mapa-base-freguesias"),_.each(Cartografia.queryParams,function(value,layerId){cartografiaChannel.request("selectLayer",0,layerId)}),delete Cartografia.queryParams},initializeMapMenu:function(){this.menuLV=new MenuLV({model:this.model}),this.menuLV.render(),this.menuControl=new L.Control.BackboneView({view:this.menuLV,position:"topleft"}),this.map.addControl(this.menuControl),this.menuLV.$el.parent().css("height","100%"),this.menuLV.$el.parent().parent().css("height","100%")},initializeZoom:function(options){var defaultOptions={position:"topright"},zoomControl=L.control.zoom(_.extend(defaultOptions,options));this.map.addControl(zoomControl)},initializeScale:function(options){var defaultOptions={position:"bottomright",imperial:!1,maxWidth:130},scaleControl=L.control.scale(_.extend(defaultOptions,options));window.scaleControl=scaleControl,this.map.addControl(scaleControl)},initializeMiniMap:function(options){var osmUrl="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",osm2=new L.TileLayer(osmUrl,{minZoom:0,maxZoom:13}),miniMap=new L.Control.MiniMap(osm2,{toggleDisplay:!0}).addTo(this.map);miniMap._toggleDisplayButtonClicked()},onAttach:function(){this.initializeMap(),this.initializeMapMenu(),this.initializeZoom(),this.initializeScale(),map0M.set("menuOpen",!0)}});Cartografia.tileProviders={"Hydda.Base":L.tileLayer.provider("Hydda.Base"),"Esri.WorldShadedRelief":L.tileLayer.provider("Esri.WorldShadedRelief"),"OpenMapSurfer.Grayscale":L.tileLayer.provider("OpenMapSurfer.Grayscale"),"Esri.WorldGrayCanvas":L.tileLayer.provider("Esri.WorldGrayCanvas"),"Esri.WorldTopoMap":L.tileLayer.provider("Esri.WorldTopoMap"),"Esri.WorldStreetMap":L.tileLayer.provider("Esri.WorldStreetMap"),"MapQuestOpen.OSM":L.tileLayer.provider("MapQuestOpen.OSM",{maxZoom:19}),"HERE.normalDayGrey":L.tileLayer.provider("HERE.normalDayGrey",{app_id:"Y8m9dK2brESDPGJPdrvs",app_code:"dq2MYIvjAotR8tHvY8Q_Dg",maxZoom:19}),"Esri.DeLorme":L.tileLayer.provider("Esri.DeLorme"),"Acetate.hillshading":L.tileLayer.provider("Acetate.hillshading"),"Thunderforest.Outdoors":L.tileLayer.provider("Thunderforest.Outdoors"),"HERE.terrainDay":L.tileLayer.provider("HERE.terrainDay",{app_id:"Y8m9dK2brESDPGJPdrvs",app_code:"dq2MYIvjAotR8tHvY8Q_Dg"}),"MapQuestOpen.Aerial":L.tileLayer.provider("MapQuestOpen.Aerial"),"Esri.WorldImagery":L.tileLayer.provider("Esri.WorldImagery"),"HERE.satelliteDay":L.tileLayer.provider("HERE.satelliteDay",{app_id:"Y8m9dK2brESDPGJPdrvs",app_code:"dq2MYIvjAotR8tHvY8Q_Dg",maxZoom:19}),MapQuestOpen_HybridOverlay:L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.{ext}",{type:"hyb",ext:"png",subdomains:"1234",opacity:.9})},Cartografia.init(),Cartografia.supportsFullscreen=$.fullscreen.isNativelySupported()+"";var router=new Router;Backbone.history.start({});