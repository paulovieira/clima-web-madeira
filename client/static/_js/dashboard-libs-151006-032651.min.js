(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(null==obj)return obj;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;return obj};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,predicate,context){var result;return any(obj,function(value,index,list){return predicate.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(predicate,context):(each(obj,function(value,index,list){predicate.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)},_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(predicate,context):(each(obj,function(value,index,list){return(result=result&&predicate.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(predicate,context):(each(obj,function(value,index,list){return result||(result=predicate.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);var result=-(1/0),lastComputed=-(1/0);return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>lastComputed&&(result=value,lastComputed=computed)}),result},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);var result=1/0,lastComputed=1/0;return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;lastComputed>computed&&(result=value,lastComputed=computed)}),result},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)};_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.partition=function(array,predicate){var pass=[],fail=[];return each(array,function(elem){(predicate(elem)?pass:fail).push(elem)}),[pass,fail]},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);length>idx;)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;length>i;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){return function(obj){if(obj===attrs)return!0;for(var key in attrs)if(attrs[key]!==obj[key])return!1;return!0}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.s=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var trim=_dereq_("./trim"),decap=_dereq_("./decapitalize");module.exports=function(str,decapitalize){return str=trim(str).replace(/[-_\s]+(.)?/g,function(match,c){return c?c.toUpperCase():""}),decapitalize===!0?decap(str):str}},{"./decapitalize":9,"./trim":60}],2:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return str=makeString(str),str.charAt(0).toUpperCase()+str.slice(1)}},{"./helper/makeString":19}],3:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return makeString(str).split("")}},{"./helper/makeString":19}],4:[function(_dereq_,module,exports){module.exports=function(str,step){return null==str?[]:(str=String(str),step=~~step,step>0?str.match(new RegExp(".{1,"+step+"}","g")):[str])}},{}],5:[function(_dereq_,module,exports){var capitalize=_dereq_("./capitalize"),camelize=_dereq_("./camelize"),makeString=_dereq_("./helper/makeString");module.exports=function(str){return str=makeString(str),capitalize(camelize(str.replace(/[\W_]/g," ")).replace(/\s/g,""))}},{"./camelize":1,"./capitalize":2,"./helper/makeString":19}],6:[function(_dereq_,module,exports){var trim=_dereq_("./trim");module.exports=function(str){return trim(str).replace(/\s+/g," ")}},{"./trim":60}],7:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,substr){if(str=makeString(str),substr=makeString(substr),0===str.length||0===substr.length)return 0;for(var count=0,pos=0,length=substr.length;;){if(pos=str.indexOf(substr,pos),-1===pos)break;count++,pos+=length}return count}},{"./helper/makeString":19}],8:[function(_dereq_,module,exports){var trim=_dereq_("./trim");module.exports=function(str){return trim(str).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}},{"./trim":60}],9:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return str=makeString(str),str.charAt(0).toLowerCase()+str.slice(1)}},{"./helper/makeString":19}],10:[function(_dereq_,module,exports){function getIndent(str){for(var matches=str.match(/^[\s\\t]*/gm),indent=matches[0].length,i=1;i<matches.length;i++)indent=Math.min(matches[i].length,indent);return indent}var makeString=_dereq_("./helper/makeString");module.exports=function(str,pattern){str=makeString(str);var reg,indent=getIndent(str);return 0===indent?str:(reg="string"==typeof pattern?new RegExp("^"+pattern,"gm"):new RegExp("^[ \\t]{"+indent+"}","gm"),str.replace(reg,""))}},{"./helper/makeString":19}],11:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),toPositive=_dereq_("./helper/toPositive");module.exports=function(str,ends,position){return str=makeString(str),ends=""+ends,position="undefined"==typeof position?str.length-ends.length:Math.min(toPositive(position),str.length)-ends.length,position>=0&&str.indexOf(ends,position)===position}},{"./helper/makeString":19,"./helper/toPositive":21}],12:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),escapeChars=_dereq_("./helper/escapeChars"),reversedEscapeChars={};for(var key in escapeChars)reversedEscapeChars[escapeChars[key]]=key;reversedEscapeChars["'"]="#39",module.exports=function(str){return makeString(str).replace(/[&<>"']/g,function(m){return"&"+reversedEscapeChars[m]+";"})}},{"./helper/escapeChars":17,"./helper/makeString":19}],13:[function(_dereq_,module,exports){module.exports=function(){var result={};for(var prop in this)this.hasOwnProperty(prop)&&!prop.match(/^(?:include|contains|reverse|join)$/)&&(result[prop]=this[prop]);return result}},{}],14:[function(_dereq_,module,exports){"use strict";function s(value){return this instanceof s?void(this._wrapped=value):new s(value)}function fn2method(key,fn){"function"==typeof fn&&(s.prototype[key]=function(){var args=[this._wrapped].concat(Array.prototype.slice.call(arguments)),res=fn.apply(null,args);return"string"==typeof res?new s(res):res})}function prototype2method(methodName){fn2method(methodName,function(context){var args=Array.prototype.slice.call(arguments,1);return String.prototype[methodName].apply(context,args)})}s.VERSION="3.0.3",s.isBlank=_dereq_("./isBlank"),s.stripTags=_dereq_("./stripTags"),s.capitalize=_dereq_("./capitalize"),s.decapitalize=_dereq_("./decapitalize"),s.chop=_dereq_("./chop"),s.trim=_dereq_("./trim"),s.clean=_dereq_("./clean"),s.count=_dereq_("./count"),s.chars=_dereq_("./chars"),s.swapCase=_dereq_("./swapCase"),s.escapeHTML=_dereq_("./escapeHTML"),s.unescapeHTML=_dereq_("./unescapeHTML"),s.splice=_dereq_("./splice"),s.insert=_dereq_("./insert"),s.replaceAll=_dereq_("./replaceAll"),s.include=_dereq_("./include"),s.join=_dereq_("./join"),s.lines=_dereq_("./lines"),s.dedent=_dereq_("./dedent"),s.reverse=_dereq_("./reverse"),s.startsWith=_dereq_("./startsWith"),s.endsWith=_dereq_("./endsWith"),s.pred=_dereq_("./pred"),s.succ=_dereq_("./succ"),s.titleize=_dereq_("./titleize"),s.camelize=_dereq_("./camelize"),s.underscored=_dereq_("./underscored"),s.dasherize=_dereq_("./dasherize"),s.classify=_dereq_("./classify"),s.humanize=_dereq_("./humanize"),s.ltrim=_dereq_("./ltrim"),s.rtrim=_dereq_("./rtrim"),s.truncate=_dereq_("./truncate"),s.prune=_dereq_("./prune"),s.words=_dereq_("./words"),s.pad=_dereq_("./pad"),s.lpad=_dereq_("./lpad"),s.rpad=_dereq_("./rpad"),s.lrpad=_dereq_("./lrpad"),s.sprintf=_dereq_("./sprintf"),s.vsprintf=_dereq_("./vsprintf"),s.toNumber=_dereq_("./toNumber"),s.numberFormat=_dereq_("./numberFormat"),s.strRight=_dereq_("./strRight"),s.strRightBack=_dereq_("./strRightBack"),s.strLeft=_dereq_("./strLeft"),s.strLeftBack=_dereq_("./strLeftBack"),s.toSentence=_dereq_("./toSentence"),s.toSentenceSerial=_dereq_("./toSentenceSerial"),s.slugify=_dereq_("./slugify"),s.surround=_dereq_("./surround"),s.quote=_dereq_("./quote"),s.unquote=_dereq_("./unquote"),s.repeat=_dereq_("./repeat"),s.naturalCmp=_dereq_("./naturalCmp"),s.levenshtein=_dereq_("./levenshtein"),s.toBoolean=_dereq_("./toBoolean"),s.exports=_dereq_("./exports"),s.escapeRegExp=_dereq_("./helper/escapeRegExp"),s.strip=s.trim,s.lstrip=s.ltrim,s.rstrip=s.rtrim,s.center=s.lrpad,s.rjust=s.lpad,s.ljust=s.rpad,s.contains=s.include,s.q=s.quote,s.toBool=s.toBoolean,s.camelcase=s.camelize,s.prototype={value:function(){return this._wrapped}};for(var key in s)fn2method(key,s[key]);fn2method("tap",function(string,fn){return fn(string)});var prototypeMethods=["toUpperCase","toLowerCase","split","replace","slice","substring","substr","concat"];for(var key in prototypeMethods)prototype2method(prototypeMethods[key]);module.exports=s},{"./camelize":1,"./capitalize":2,"./chars":3,"./chop":4,"./classify":5,"./clean":6,"./count":7,"./dasherize":8,"./decapitalize":9,"./dedent":10,"./endsWith":11,"./escapeHTML":12,"./exports":13,"./helper/escapeRegExp":18,"./humanize":22,"./include":23,"./insert":24,"./isBlank":25,"./join":26,"./levenshtein":27,"./lines":28,"./lpad":29,"./lrpad":30,"./ltrim":31,"./naturalCmp":32,"./numberFormat":33,"./pad":34,"./pred":35,"./prune":36,"./quote":37,"./repeat":38,"./replaceAll":39,"./reverse":40,"./rpad":41,"./rtrim":42,"./slugify":43,"./splice":44,"./sprintf":45,"./startsWith":46,"./strLeft":47,"./strLeftBack":48,"./strRight":49,"./strRightBack":50,"./stripTags":51,"./succ":52,"./surround":53,"./swapCase":54,"./titleize":55,"./toBoolean":56,"./toNumber":57,"./toSentence":58,"./toSentenceSerial":59,"./trim":60,"./truncate":61,"./underscored":62,"./unescapeHTML":63,"./unquote":64,"./vsprintf":65,"./words":66}],15:[function(_dereq_,module,exports){var makeString=_dereq_("./makeString");module.exports=function(str,direction){return str=makeString(str),0===str.length?"":str.slice(0,-1)+String.fromCharCode(str.charCodeAt(str.length-1)+direction)}},{"./makeString":19}],16:[function(_dereq_,module,exports){var escapeRegExp=_dereq_("./escapeRegExp");module.exports=function(characters){return null==characters?"\\s":characters.source?characters.source:"["+escapeRegExp(characters)+"]"}},{"./escapeRegExp":18}],17:[function(_dereq_,module,exports){var escapeChars={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"};module.exports=escapeChars},{}],18:[function(_dereq_,module,exports){var makeString=_dereq_("./makeString");module.exports=function(str){return makeString(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}},{"./makeString":19}],19:[function(_dereq_,module,exports){module.exports=function(object){return null==object?"":""+object}},{}],20:[function(_dereq_,module,exports){module.exports=function(str,qty){if(1>qty)return"";for(var result="";qty>0;)1&qty&&(result+=str),qty>>=1,str+=str;return result}},{}],21:[function(_dereq_,module,exports){module.exports=function(number){return 0>number?0:+number||0}},{}],22:[function(_dereq_,module,exports){var capitalize=_dereq_("./capitalize"),underscored=_dereq_("./underscored"),trim=_dereq_("./trim");module.exports=function(str){return capitalize(trim(underscored(str).replace(/_id$/,"").replace(/_/g," ")))}},{"./capitalize":2,"./trim":60,"./underscored":62}],23:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,needle){return""===needle?!0:-1!==makeString(str).indexOf(needle)}},{"./helper/makeString":19}],24:[function(_dereq_,module,exports){var splice=_dereq_("./splice");module.exports=function(str,i,substr){return splice(str,i,0,substr)}},{"./splice":44}],25:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return/^\s*$/.test(makeString(str))}},{"./helper/makeString":19}],26:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),slice=[].slice;module.exports=function(){var args=slice.call(arguments),separator=args.shift();return args.join(makeString(separator))}},{"./helper/makeString":19}],27:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str1,str2){str1=makeString(str1),str2=makeString(str2);for(var prev,value,current=[],i=0;i<=str2.length;i++)for(var j=0;j<=str1.length;j++)value=i&&j?str1.charAt(j-1)===str2.charAt(i-1)?prev:Math.min(current[j],current[j-1],prev)+1:i+j,prev=current[j],current[j]=value;return current.pop()}},{"./helper/makeString":19}],28:[function(_dereq_,module,exports){module.exports=function(str){return null==str?[]:String(str).split(/\r?\n/)}},{}],29:[function(_dereq_,module,exports){var pad=_dereq_("./pad");module.exports=function(str,length,padStr){return pad(str,length,padStr)}},{"./pad":34}],30:[function(_dereq_,module,exports){var pad=_dereq_("./pad");module.exports=function(str,length,padStr){return pad(str,length,padStr,"both");
}},{"./pad":34}],31:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),defaultToWhiteSpace=_dereq_("./helper/defaultToWhiteSpace"),nativeTrimLeft=String.prototype.trimLeft;module.exports=function(str,characters){return str=makeString(str),!characters&&nativeTrimLeft?nativeTrimLeft.call(str):(characters=defaultToWhiteSpace(characters),str.replace(new RegExp("^"+characters+"+"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":19}],32:[function(_dereq_,module,exports){module.exports=function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;for(var cmpRegex=/(\.\d+)|(\d+)|(\D+)/g,tokens1=String(str1).match(cmpRegex),tokens2=String(str2).match(cmpRegex),count=Math.min(tokens1.length,tokens2.length),i=0;count>i;i++){var a=tokens1[i],b=tokens2[i];if(a!==b){var num1=+a,num2=+b;return num1===num1&&num2===num2?num1>num2?1:-1:b>a?-1:1}}return tokens1.length!=tokens2.length?tokens1.length-tokens2.length:str2>str1?-1:1}},{}],33:[function(_dereq_,module,exports){module.exports=function(number,dec,dsep,tsep){if(isNaN(number)||null==number)return"";number=number.toFixed(~~dec),tsep="string"==typeof tsep?tsep:",";var parts=number.split("."),fnums=parts[0],decimals=parts[1]?(dsep||".")+parts[1]:"";return fnums.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+tsep)+decimals}},{}],34:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),strRepeat=_dereq_("./helper/strRepeat");module.exports=function(str,length,padStr,type){str=makeString(str),length=~~length;var padlen=0;switch(padStr?padStr.length>1&&(padStr=padStr.charAt(0)):padStr=" ",type){case"right":return padlen=length-str.length,str+strRepeat(padStr,padlen);case"both":return padlen=length-str.length,strRepeat(padStr,Math.ceil(padlen/2))+str+strRepeat(padStr,Math.floor(padlen/2));default:return padlen=length-str.length,strRepeat(padStr,padlen)+str}}},{"./helper/makeString":19,"./helper/strRepeat":20}],35:[function(_dereq_,module,exports){var adjacent=_dereq_("./helper/adjacent");module.exports=function(str){return adjacent(str,-1)}},{"./helper/adjacent":15}],36:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),rtrim=_dereq_("./rtrim");module.exports=function(str,length,pruneStr){if(str=makeString(str),length=~~length,pruneStr=null!=pruneStr?String(pruneStr):"...",str.length<=length)return str;var tmpl=function(c){return c.toUpperCase()!==c.toLowerCase()?"A":" "},template=str.slice(0,length+1).replace(/.(?=\W*\w*$)/g,tmpl);return template=template.slice(template.length-2).match(/\w\w/)?template.replace(/\s*\S+$/,""):rtrim(template.slice(0,template.length-1)),(template+pruneStr).length>str.length?str:str.slice(0,template.length)+pruneStr}},{"./helper/makeString":19,"./rtrim":42}],37:[function(_dereq_,module,exports){var surround=_dereq_("./surround");module.exports=function(str,quoteChar){return surround(str,quoteChar||'"')}},{"./surround":53}],38:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),strRepeat=_dereq_("./helper/strRepeat");module.exports=function repeat(str,qty,separator){if(str=makeString(str),qty=~~qty,null==separator)return strRepeat(str,qty);for(var repeat=[];qty>0;repeat[--qty]=str);return repeat.join(separator)}},{"./helper/makeString":19,"./helper/strRepeat":20}],39:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,find,replace,ignorecase){var flags=ignorecase===!0?"gi":"g",reg=new RegExp(find,flags);return makeString(str).replace(reg,replace)}},{"./helper/makeString":19}],40:[function(_dereq_,module,exports){var chars=_dereq_("./chars");module.exports=function(str){return chars(str).reverse().join("")}},{"./chars":3}],41:[function(_dereq_,module,exports){var pad=_dereq_("./pad");module.exports=function(str,length,padStr){return pad(str,length,padStr,"right")}},{"./pad":34}],42:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),defaultToWhiteSpace=_dereq_("./helper/defaultToWhiteSpace"),nativeTrimRight=String.prototype.trimRight;module.exports=function(str,characters){return str=makeString(str),!characters&&nativeTrimRight?nativeTrimRight.call(str):(characters=defaultToWhiteSpace(characters),str.replace(new RegExp(characters+"+$"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":19}],43:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),defaultToWhiteSpace=_dereq_("./helper/defaultToWhiteSpace"),trim=_dereq_("./trim"),dasherize=_dereq_("./dasherize");module.exports=function(str){var from="ąàáäâãåæăćčĉęèéëêĝĥìíïîĵłľńňòóöőôõðøśșšŝťțŭùúüűûñÿýçżźž",to="aaaaaaaaaccceeeeeghiiiijllnnoooooooossssttuuuuuunyyczzz",regex=new RegExp(defaultToWhiteSpace(from),"g");return str=makeString(str).toLowerCase().replace(regex,function(c){var index=from.indexOf(c);return to.charAt(index)||"-"}),trim(dasherize(str.replace(/[^\w\s-]/g,"-")),"-")}},{"./dasherize":8,"./helper/defaultToWhiteSpace":16,"./helper/makeString":19,"./trim":60}],44:[function(_dereq_,module,exports){var chars=_dereq_("./chars");module.exports=function(str,i,howmany,substr){var arr=chars(str);return arr.splice(~~i,~~howmany,substr),arr.join("")}},{"./chars":3}],45:[function(_dereq_,module,exports){var strRepeat=_dereq_("./helper/strRepeat"),toString=Object.prototype.toString,sprintf=function(){function get_type(variable){return toString.call(variable).slice(8,-1).toLowerCase()}var str_repeat=strRepeat,str_format=function(){return str_format.cache.hasOwnProperty(arguments[0])||(str_format.cache[arguments[0]]=str_format.parse(arguments[0])),str_format.format.call(null,str_format.cache[arguments[0]],arguments)};return str_format.format=function(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,cursor=1,tree_length=parse_tree.length,node_type="",output=[];for(i=0;tree_length>i;i++)if(node_type=get_type(parse_tree[i]),"string"===node_type)output.push(parse_tree[i]);else if("array"===node_type){if(match=parse_tree[i],match[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw new Error(sprintf('[_.sprintf] property "%s" does not exist',match[2][k]));arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if(/[^s]/.test(match[8])&&"number"!=get_type(arg))throw new Error(sprintf("[_.sprintf] expecting number but found %s",get_type(arg)));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?"0"==match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}return output.join("")},str_format.cache={},str_format.parse=function(fmt){for(var _fmt=fmt,match=[],parse_tree=[],arg_names=0;_fmt;){if(null!==(match=/^[^\x25]+/.exec(_fmt)))parse_tree.push(match[0]);else if(null!==(match=/^\x25{2}/.exec(_fmt)))parse_tree.push("%");else{if(null===(match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)))throw new Error("[_.sprintf] huh?");if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field)))throw new Error("[_.sprintf] huh?");for(field_list.push(field_match[1]);""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)))field_list.push(field_match[1]);else{if(null===(field_match=/^\[(\d+)\]/.exec(replacement_field)))throw new Error("[_.sprintf] huh?");field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree},str_format}();module.exports=sprintf},{"./helper/strRepeat":20}],46:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),toPositive=_dereq_("./helper/toPositive");module.exports=function(str,starts,position){return str=makeString(str),starts=""+starts,position=null==position?0:Math.min(toPositive(position),str.length),str.lastIndexOf(starts,position)===position}},{"./helper/makeString":19,"./helper/toPositive":21}],47:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,sep){str=makeString(str),sep=makeString(sep);var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(0,pos):str}},{"./helper/makeString":19}],48:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,sep){str=makeString(str),sep=makeString(sep);var pos=str.lastIndexOf(sep);return~pos?str.slice(0,pos):str}},{"./helper/makeString":19}],49:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,sep){str=makeString(str),sep=makeString(sep);var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str}},{"./helper/makeString":19}],50:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,sep){str=makeString(str),sep=makeString(sep);var pos=sep?str.lastIndexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str}},{"./helper/makeString":19}],51:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return makeString(str).replace(/<\/?[^>]+>/g,"")}},{"./helper/makeString":19}],52:[function(_dereq_,module,exports){var adjacent=_dereq_("./helper/adjacent");module.exports=function(str){return adjacent(str,1)}},{"./helper/adjacent":15}],53:[function(_dereq_,module,exports){module.exports=function(str,wrapper){return[wrapper,str,wrapper].join("")}},{}],54:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return makeString(str).replace(/\S/g,function(c){return c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()})}},{"./helper/makeString":19}],55:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str){return makeString(str).toLowerCase().replace(/(?:^|\s|-)\S/g,function(c){return c.toUpperCase()})}},{"./helper/makeString":19}],56:[function(_dereq_,module,exports){function boolMatch(s,matchers){var i,matcher,down=s.toLowerCase();for(matchers=[].concat(matchers),i=0;i<matchers.length;i+=1)if(matcher=matchers[i]){if(matcher.test&&matcher.test(s))return!0;if(matcher.toLowerCase()===down)return!0}}var trim=_dereq_("./trim");module.exports=function(str,trueValues,falseValues){return"number"==typeof str&&(str=""+str),"string"!=typeof str?!!str:(str=trim(str),boolMatch(str,trueValues||["true","1"])?!0:boolMatch(str,falseValues||["false","0"])?!1:void 0)}},{"./trim":60}],57:[function(_dereq_,module,exports){_dereq_("./trim");module.exports=function(num,precision){if(null==num)return 0;var factor=Math.pow(10,isFinite(precision)?precision:0);return Math.round(num*factor)/factor}},{"./trim":60}],58:[function(_dereq_,module,exports){var rtrim=_dereq_("./rtrim");module.exports=function(array,separator,lastSeparator,serial){separator=separator||", ",lastSeparator=lastSeparator||" and ";var a=array.slice(),lastMember=a.pop();return array.length>2&&serial&&(lastSeparator=rtrim(separator)+lastSeparator),a.length?a.join(separator)+lastSeparator+lastMember:lastMember}},{"./rtrim":42}],59:[function(_dereq_,module,exports){var toSentence=_dereq_("./toSentence");module.exports=function(array,sep,lastSep){return toSentence(array,sep,lastSep,!0)}},{"./toSentence":58}],60:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),defaultToWhiteSpace=_dereq_("./helper/defaultToWhiteSpace"),nativeTrim=String.prototype.trim;module.exports=function(str,characters){return str=makeString(str),!characters&&nativeTrim?nativeTrim.call(str):(characters=defaultToWhiteSpace(characters),str.replace(new RegExp("^"+characters+"+|"+characters+"+$","g"),""))}},{"./helper/defaultToWhiteSpace":16,"./helper/makeString":19}],61:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString");module.exports=function(str,length,truncateStr){return str=makeString(str),truncateStr=truncateStr||"...",length=~~length,str.length>length?str.slice(0,length)+truncateStr:str}},{"./helper/makeString":19}],62:[function(_dereq_,module,exports){var trim=_dereq_("./trim");module.exports=function(str){return trim(str).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()}},{"./trim":60}],63:[function(_dereq_,module,exports){var makeString=_dereq_("./helper/makeString"),escapeChars=_dereq_("./helper/escapeChars");module.exports=function(str){return makeString(str).replace(/\&([^;]+);/g,function(entity,entityCode){var match;return entityCode in escapeChars?escapeChars[entityCode]:(match=entityCode.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(match[1],16)):(match=entityCode.match(/^#(\d+)$/))?String.fromCharCode(~~match[1]):entity})}},{"./helper/escapeChars":17,"./helper/makeString":19}],64:[function(_dereq_,module,exports){module.exports=function(str,quoteChar){return quoteChar=quoteChar||'"',str[0]===quoteChar&&str[str.length-1]===quoteChar?str.slice(1,str.length-1):str}},{}],65:[function(_dereq_,module,exports){var sprintf=_dereq_("./sprintf");module.exports=function(fmt,argv){return argv.unshift(fmt),sprintf.apply(null,argv)}},{"./sprintf":45}],66:[function(_dereq_,module,exports){var isBlank=_dereq_("./isBlank"),trim=_dereq_("./trim");module.exports=function(str,delimiter){return isBlank(str)?[]:trim(str,delimiter).split(delimiter||/\s+/)}},{"./isBlank":25,"./trim":60}]},{},[14])(14)}),function(definition){"use strict";if("function"==typeof bootstrap)bootstrap("promise",definition);else if("object"==typeof exports&&"object"==typeof module)module.exports=definition();else if("function"==typeof define&&define.amd)define(definition);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=definition}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=definition()}}(function(){"use strict";function uncurryThis(f){return function(){return call.apply(f,arguments)}}function isObject(value){return value===Object(value)}function isStopIteration(exception){return"[object StopIteration]"===object_toString(exception)||exception instanceof QReturnValue}function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&"object"==typeof error&&null!==error&&error.stack&&-1===error.stack.indexOf(STACK_JUMP_SEPARATOR)){for(var stacks=[],p=promise;p;p=p.source)p.stack&&stacks.unshift(p.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0;i<lines.length;++i){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isNodeFrame(stackLine){return-1!==stackLine.indexOf("(module.js:")||-1!==stackLine.indexOf("(node.js:")}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&qEndingLine>=lineNumber}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return qFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack),callback.apply(callback,arguments)}}function Q(value){return value instanceof Promise?value:isPromiseAlike(value)?coerce(value):fulfill(value)}function defer(){function become(newPromise){resolvedPromise=newPromise,promise.source=newPromise,array_reduce(messages,function(undefined,message){Q.nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0),messages=void 0,progressListeners=void 0}var resolvedPromise,messages=[],progressListeners=[],deferred=object_create(defer.prototype),promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);messages?(messages.push(args),"when"===op&&operands[1]&&progressListeners.push(operands[1])):Q.nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})},promise.valueOf=function(){if(messages)return promise;var nearerValue=nearer(resolvedPromise);return isPromise(nearerValue)&&(resolvedPromise=nearerValue),nearerValue},promise.inspect=function(){return resolvedPromise?resolvedPromise.inspect():{state:"pending"}},Q.longStackSupport&&hasStacks)try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return deferred.promise=promise,deferred.resolve=function(value){resolvedPromise||become(Q(value))},deferred.fulfill=function(value){resolvedPromise||become(fulfill(value))},deferred.reject=function(reason){resolvedPromise||become(reject(reason))},deferred.notify=function(progress){resolvedPromise||array_reduce(progressListeners,function(undefined,progressListener){Q.nextTick(function(){progressListener(progress)})},void 0)},deferred}function promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function.");var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;len>i;i++)Q(answerPs[i]).then(resolve,reject)})}function Promise(descriptor,fallback,inspect){void 0===fallback&&(fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}),void 0===inspect&&(inspect=function(){return{state:"unknown"}});var promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,args){var result;try{result=descriptor[op]?descriptor[op].apply(promise,args):fallback.call(promise,op,args)}catch(exception){result=reject(exception)}resolve&&resolve(result)},promise.inspect=inspect,inspect){var inspected=inspect();"rejected"===inspected.state&&(promise.exception=inspected.reason),promise.valueOf=function(){var inspected=inspect();return"pending"===inspected.state||"rejected"===inspected.state?promise:inspected.value}}return promise}function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}function nearer(value){if(isPromise(value)){var inspected=value.inspect();if("fulfilled"===inspected.state)return inspected.value}return value}function isPromise(object){return object instanceof Promise}function isPromiseAlike(object){return isObject(object)&&"function"==typeof object.then}function isPending(object){return isPromise(object)&&"pending"===object.inspect().state}function isFulfilled(object){return!isPromise(object)||"fulfilled"===object.inspect().state}function isRejected(object){return isPromise(object)&&"rejected"===object.inspect().state}function resetUnhandledRejections(){unhandledReasons.length=0,unhandledRejections.length=0,trackUnhandledRejections||(trackUnhandledRejections=!0)}function trackRejection(promise,reason){trackUnhandledRejections&&(unhandledRejections.push(promise),reason&&"undefined"!=typeof reason.stack?unhandledReasons.push(reason.stack):unhandledReasons.push("(no stack) "+reason))}function untrackRejection(promise){if(trackUnhandledRejections){var at=array_indexOf(unhandledRejections,promise);-1!==at&&(unhandledRejections.splice(at,1),unhandledReasons.splice(at,1))}}function reject(reason){var rejection=Promise({when:function(rejected){return rejected&&untrackRejection(this),rejected?rejected(reason):this}},function(){return this},function(){return{state:"rejected",reason:reason}});return trackRejection(rejection,reason),rejection}function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},"delete":function(name){delete value[name]},post:function(name,args){return null===name||void 0===name?value.apply(void 0,args):value[name].apply(value,args)},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();return Q.nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}}),deferred.promise}function master(object){return Promise({isDef:function(){}},function(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}function async(makeGenerator){return function(){function continuer(verb,arg){var result;if("undefined"==typeof StopIteration){try{result=generator[verb](arg)}catch(exception){return reject(exception)}return result.done?Q(result.value):when(result.value,callback,errback)}try{result=generator[verb](arg)}catch(exception){return isStopIteration(exception)?Q(exception.value):reject(exception)}return when(result,callback,errback)}var generator=makeGenerator.apply(this,arguments),callback=continuer.bind(continuer,"next"),errback=continuer.bind(continuer,"throw");return callback()}}function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}function _return(value){throw new QReturnValue(value)}function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}function dispatch(object,op,args){return Q(object).dispatch(op,args)}function all(promises){return when(promises,function(promises){var countDown=0,deferred=defer();return array_reduce(promises,function(undefined,promise,index){var snapshot;isPromise(promise)&&"fulfilled"===(snapshot=promise.inspect()).state?promises[index]=snapshot.value:(++countDown,when(promise,function(value){promises[index]=value,0===--countDown&&deferred.resolve(promises)},deferred.reject,function(progress){deferred.notify({index:index,value:progress})}))},void 0),0===countDown&&deferred.resolve(promises),deferred.promise})}function allResolved(promises){return when(promises,function(promises){return promises=array_map(promises,Q),when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}function allSettled(promises){return Q(promises).allSettled()}function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}var hasStacks=!1;try{throw new Error}catch(e){hasStacks=!!e.stack}var qFileName,QReturnValue,qStartingLine=captureLine(),noop=function(){},nextTick=function(){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}var head={task:void 0,next:null},tail=head,flushing=!1,requestTick=void 0,isNodeJS=!1;if(nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestTick())},"undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestTick=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestTick="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick,channel.port1.onmessage=flush,flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0),requestPortTick()}}else requestTick=function(){setTimeout(flush,0)};return nextTick}(),call=Function.call,array_slice=uncurryThis(Array.prototype.slice),array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(1===arguments.length)for(;;){if(index in this){basis=this[index++];break}if(++index>=length)throw new TypeError}for(;length>index;index++)index in this&&(basis=callback(basis,this[index],index));return basis}),array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return i;return-1}),array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this,collect=[];return array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0),collect}),object_create=Object.create||function(prototype){function Type(){}return Type.prototype=prototype,new Type},object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty),object_keys=Object.keys||function(object){var keys=[];for(var key in object)object_hasOwnProperty(object,key)&&keys.push(key);return keys},object_toString=uncurryThis(Object.prototype.toString);QReturnValue="undefined"!=typeof ReturnValue?ReturnValue:function(value){this.value=value};var STACK_JUMP_SEPARATOR="From previous event:";Q.resolve=Q,Q.nextTick=nextTick,Q.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(Q.longStackSupport=!0),Q.defer=defer,defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){error?self.reject(error):arguments.length>2?self.resolve(array_slice(arguments,1)):self.resolve(value)}},Q.Promise=promise,Q.promise=promise,promise.race=race,promise.all=all,promise.reject=reject,promise.resolve=Q,Q.passByCopy=function(object){return object},Promise.prototype.passByCopy=function(){return this},Q.join=function(x,y){return Q(x).join(y)},Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y)return x;throw new Error("Can't join: not the same: "+x+" "+y)})},Q.race=race,Promise.prototype.race=function(){return this.then(Q.race)},Q.makePromise=Promise,Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.then=function(fulfilled,rejected,progressed){function _fulfilled(value){try{return"function"==typeof fulfilled?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if("function"==typeof rejected){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return"function"==typeof progressed?progressed(value):value}var self=this,deferred=defer(),done=!1;return Q.nextTick(function(){self.promiseDispatch(function(value){done||(done=!0,deferred.resolve(_fulfilled(value)))},"when",[function(exception){done||(done=!0,deferred.resolve(_rejected(exception)))}])}),self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue,threw=!1;try{newValue=_progressed(value)}catch(e){if(threw=!0,!Q.onerror)throw e;Q.onerror(e)}threw||deferred.notify(newValue)}]),deferred.promise},Q.tap=function(promise,callback){return Q(promise).tap(callback)},Promise.prototype.tap=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall(value).thenResolve(value)})},Q.when=when,Promise.prototype.thenResolve=function(value){return this.then(function(){return value})},Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)},Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})},Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)},Q.nearer=nearer,Q.isPromise=isPromise,Q.isPromiseAlike=isPromiseAlike,Q.isPending=isPending,Promise.prototype.isPending=function(){return"pending"===this.inspect().state},Q.isFulfilled=isFulfilled,Promise.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},Q.isRejected=isRejected,Promise.prototype.isRejected=function(){return"rejected"===this.inspect().state};var unhandledReasons=[],unhandledRejections=[],trackUnhandledRejections=!0;Q.resetUnhandledRejections=resetUnhandledRejections,Q.getUnhandledReasons=function(){return unhandledReasons.slice()},Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections(),trackUnhandledRejections=!1},resetUnhandledRejections(),Q.reject=reject,Q.fulfill=fulfill,Q.master=master,Q.spread=spread,Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)},Q.async=async,Q.spawn=spawn,Q["return"]=_return,Q.promised=promised,Q.dispatch=dispatch,Promise.prototype.dispatch=function(op,args){var self=this,deferred=defer();return Q.nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)}),deferred.promise},Q.get=function(object,key){return Q(object).dispatch("get",[key])},Promise.prototype.get=function(key){return this.dispatch("get",[key])},Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])},Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])},Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])},Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])},Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])},Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])},Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])},Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])},Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])},Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])},Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])},Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])},Q.fbind=function(object){var promise=Q(object),args=array_slice(arguments,1);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Promise.prototype.fbind=function(){var promise=this,args=array_slice(arguments);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Q.keys=function(object){return Q(object).dispatch("keys",[])},Promise.prototype.keys=function(){return this.dispatch("keys",[])},Q.all=all,Promise.prototype.all=function(){return all(this)},Q.allResolved=deprecate(allResolved,"allResolved","allSettled"),
Promise.prototype.allResolved=function(){return allResolved(this)},Q.allSettled=allSettled,Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){function regardless(){return promise.inspect()}return promise=Q(promise),promise.then(regardless,regardless)}))})},Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)},Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)},Q.progress=progress,Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)},Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)},Promise.prototype.fin=Promise.prototype["finally"]=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})},Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)},Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){Q.nextTick(function(){if(makeStackTraceLong(error,promise),!Q.onerror)throw error;Q.onerror(error)})},promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;"object"==typeof process&&process&&process.domain&&(onUnhandledError=process.domain.bind(onUnhandledError)),promise.then(void 0,onUnhandledError)},Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)},Promise.prototype.timeout=function(ms,error){var deferred=defer(),timeoutId=setTimeout(function(){error&&"string"!=typeof error||(error=new Error(error||"Timed out after "+ms+" ms"),error.code="ETIMEDOUT"),deferred.reject(error)},ms);return this.then(function(value){clearTimeout(timeoutId),deferred.resolve(value)},function(exception){clearTimeout(timeoutId),deferred.reject(exception)},deferred.notify),deferred.promise},Q.delay=function(object,timeout){return void 0===timeout&&(timeout=object,object=void 0),Q(object).delay(timeout)},Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();return setTimeout(function(){deferred.resolve(value)},timeout),deferred.promise})},Q.nfapply=function(callback,args){return Q(callback).nfapply(args)},Promise.prototype.nfapply=function(args){var deferred=defer(),nodeArgs=array_slice(args);return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)},Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(callback).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);return args.unshift(this),Q.denodeify.apply(void 0,args)},Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){function bound(){return callback.apply(thisp,arguments)}var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(bound).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nbind=function(){var args=array_slice(arguments,0);return args.unshift(this),Q.nbind.apply(void 0,args)},Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)},Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nodeify=nodeify,Promise.prototype.nodeify=function(nodeback){return nodeback?void this.then(function(value){Q.nextTick(function(){nodeback(null,value)})},function(error){Q.nextTick(function(){nodeback(error)})}):this};var qEndingLine=captureLine();return Q}),function($){"use strict";$.fn.fileinputLocales={},String.prototype.repl=function(from,to){return this.split(from).join(to)};var isIE=function(ver){var status,div=document.createElement("div");return div.innerHTML="<!--[if IE "+ver+"]><i></i><![endif]-->",status=1===div.getElementsByTagName("i").length,document.body.appendChild(div),div.parentNode.removeChild(div),status},previewCache={data:{},init:function(obj){var content=obj.initialPreview,id=obj.id;content.length>0&&!isArray(content)&&(content=content.split(obj.initialPreviewDelimiter)),previewCache.data[id]={content:content,config:obj.initialPreviewConfig,tags:obj.initialPreviewThumbTags,delimiter:obj.initialPreviewDelimiter,template:obj.previewGenericTemplate,msg:function(n){return obj.getMsgSelected(n)},initId:obj.previewInitId,footer:obj.getLayoutTemplate("footer"),isDelete:obj.initialPreviewShowDelete,caption:obj.initialCaption,actions:function(showUpload,showDelete,disabled,url,key){return obj.renderFileActions(showUpload,showDelete,disabled,url,key)}}},fetch:function(id){return previewCache.data[id].content.filter(function(n){return null!==n})},count:function(id,all){return previewCache.data[id]&&previewCache.data[id].content?all?previewCache.data[id].content.length:previewCache.fetch(id).length:0},get:function(id,i,isDisabled){var out,ind="init_"+i,data=previewCache.data[id],previewId=data.initId+"-"+ind;return isDisabled=void 0===isDisabled?!0:isDisabled,null===data.content[i]?"":(out=data.template.repl("{previewId}",previewId).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",ind).repl("{content}",data.content[i]).repl("{footer}",previewCache.footer(id,i,isDisabled)),data.tags.length&&data.tags[i]&&(out=replaceTags(out,data.tags[i])),out)},add:function(id,content,config,tags,append){var index,data=$.extend(!0,{},previewCache.data[id]);return isArray(content)||(content=content.split(data.delimiter)),append?(index=data.content.push(content)-1,data.config[index]=config,data.tags[index]=tags):(index=content.length,data.content=content,data.config=config,data.tags=tags),previewCache.data[id]=data,index},set:function(id,content,config,tags,append){var i,data=$.extend(!0,{},previewCache.data[id]);if(isArray(content)||(content=content.split(data.delimiter)),append){for(i=0;i<content.length;i++)data.content.push(content[i]);for(i=0;i<config.length;i++)data.config.push(config[i]);for(i=0;i<tags.length;i++)data.tags.push(tags[i])}else data.content=content,data.config=config,data.tags=tags;previewCache.data[id]=data},unset:function(id,index){var chk=previewCache.count(id);if(chk){if(1===chk)return previewCache.data[id].content=[],void(previewCache.data[id].config=[]);previewCache.data[id].content[index]=null,previewCache.data[id].config[index]=null}},out:function(id){var caption,html="",data=previewCache.data[id],len=previewCache.count(id,!0);if(0===len)return{content:"",caption:""};for(var i=0;len>i;i++)html+=previewCache.get(id,i);return caption=data.msg(previewCache.count(id)),{content:html,caption:caption}},footer:function(id,i,isDisabled){var data=previewCache.data[id];if(isDisabled=void 0===isDisabled?!0:isDisabled,0===data.config.length||isEmpty(data.config[i]))return"";var config=data.config[i],caption=isSet("caption",config)?config.caption:"",width=isSet("width",config)?config.width:"auto",url=isSet("url",config)?config.url:!1,key=isSet("key",config)?config.key:null,disabled=url===!1&&isDisabled,actions=data.isDelete?data.actions(!1,!0,disabled,url,key):"",footer=data.footer.repl("{actions}",actions);return footer.repl("{caption}",caption).repl("{width}",width).repl("{indicator}","").repl("{indicatorTitle}","")}},getNum=function(num,def){return def=def||0,"number"==typeof num?num:("string"==typeof num&&(num=parseFloat(num)),isNaN(num)?def:num)},hasFileAPISupport=function(){return window.File&&window.FileReader},hasDragDropSupport=function(){var $div=document.createElement("div");return!isIE(9)&&(void 0!==$div.draggable||void 0!==$div.ondragstart&&void 0!==$div.ondrop)},hasFileUploadSupport=function(){return hasFileAPISupport&&window.FormData},addCss=function($el,css){$el.removeClass(css).addClass(css)},STYLE_SETTING='style="width:{width};height:{height};"',OBJECT_PARAMS='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',DEFAULT_PREVIEW='<div class="file-preview-other">\n       {previewFileIcon}\n   </div>',defaultFileActionSettings={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},tMain1='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',tMain2='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',tPreview='<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',tIcon='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',tCaption='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',tModal='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',tProgress='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',tFooter='<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',tActions='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',tActionDelete='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',tActionUpload='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',tGeneric='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',tHtml='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+DEFAULT_PREVIEW+"\n    </object>\n   {footer}\n</div>",tImage='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+STYLE_SETTING+">\n   {footer}\n</div>\n",tText='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+STYLE_SETTING+">\n       {data}\n   </div>\n   {footer}\n</div>",tVideo='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+DEFAULT_PREVIEW+"\n   </video>\n   {footer}\n</div>\n",tAudio='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+DEFAULT_PREVIEW+"\n   </audio>\n   {footer}\n</div>",tFlash='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+OBJECT_PARAMS+"       "+DEFAULT_PREVIEW+"\n   </object>\n   {footer}\n</div>\n",tObject='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+OBJECT_PARAMS+"         "+DEFAULT_PREVIEW+"\n   </object>\n   {footer}\n</div>",tOther='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+STYLE_SETTING+">\n   "+DEFAULT_PREVIEW+"\n   {footer}\n</div>",defaultLayoutTemplates={main1:tMain1,main2:tMain2,preview:tPreview,icon:tIcon,caption:tCaption,modal:tModal,progress:tProgress,footer:tFooter,actions:tActions,actionDelete:tActionDelete,actionUpload:tActionUpload},defaultPreviewTemplates={generic:tGeneric,html:tHtml,image:tImage,text:tText,video:tVideo,audio:tAudio,flash:tFlash,object:tObject,other:tOther},defaultPreviewTypes=["image","html","text","video","audio","flash","object"],defaultPreviewSettings={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},defaultFileTypeSettings={image:function(vType,vName){return void 0!==vType?vType.match("image.*"):vName.match(/\.(gif|png|jpe?g)$/i)},html:function(vType,vName){return void 0!==vType?"text/html"===vType:vName.match(/\.(htm|html)$/i)},text:function(vType,vName){return void 0!==vType&&vType.match("text.*")||vName.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(vType,vName){return void 0!==vType&&vType.match(/\.video\/(ogg|mp4|webm)$/i)||vName.match(/\.(og?|mp4|webm)$/i)},audio:function(vType,vName){return void 0!==vType&&vType.match(/\.audio\/(ogg|mp3|wav)$/i)||vName.match(/\.(ogg|mp3|wav)$/i)},flash:function(vType,vName){return void 0!==vType&&"application/x-shockwave-flash"===vType||vName.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},isEmpty=function(value,trim){return null===value||void 0===value||0===value.length||trim&&""===$.trim(value)},isArray=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},isSet=function(needle,haystack){return"object"==typeof haystack&&needle in haystack},getElement=function(options,param,value){return isEmpty(options)||isEmpty(options[param])?value:$(options[param])},uniqId=function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode=function(str){return String(str).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},replaceTags=function(str,tags){var out=str;return tags=tags||{},$.each(tags,function(key,value){"function"==typeof value&&(value=value()),out=out.repl(key,value)}),out},objUrl=window.URL||window.webkitURL,FileInput=function(element,options){var self=this;self.$element=$(element),self.validate()&&(hasFileAPISupport()||isIE(9)?(self.init(options),self.listen()):self.$element.removeClass("file-loading"))};FileInput.prototype={constructor:FileInput,validate:function(){var $exception,self=this;return"file"===self.$element.attr("type")?!0:($exception='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',self.$element.after($exception),!1)},init:function(options){var t,self=this,$el=self.$element;$.each(options,function(key,value){self[key]="maxFileCount"===key||"maxFileSize"===key?getNum(value):value}),self.fileInputCleared=!1,self.fileBatchCompleted=!0,isEmpty(self.allowedPreviewTypes)&&(self.allowedPreviewTypes=defaultPreviewTypes),self.uploadFileAttr=isEmpty($el.attr("name"))?"file_data":$el.attr("name"),self.reader=null,self.formdata={},self.isIE9=isIE(9),self.isIE10=isIE(10),self.filestack=[],self.ajaxRequests=[],self.isError=!1,self.ajaxAborted=!1,self.dropZoneEnabled=hasDragDropSupport()&&self.dropZoneEnabled,self.isDisabled=self.$element.attr("disabled")||self.$element.attr("readonly"),self.isUploadable=hasFileUploadSupport&&!isEmpty(self.uploadUrl),self.slug="function"==typeof options.slugCallback?options.slugCallback:self.slugDefault,self.mainTemplate=self.showCaption?self.getLayoutTemplate("main1"):self.getLayoutTemplate("main2"),self.captionTemplate=self.getLayoutTemplate("caption"),self.previewGenericTemplate=self.getPreviewTemplate("generic"),isEmpty(self.$element.attr("id"))&&self.$element.attr("id",uniqId()),void 0===self.$container?self.$container=self.createContainer():self.refreshContainer(),self.$progress=self.$container.find(".kv-upload-progress"),self.$btnUpload=self.$container.find(".kv-fileinput-upload"),self.$captionContainer=getElement(options,"elCaptionContainer",self.$container.find(".file-caption")),self.$caption=getElement(options,"elCaptionText",self.$container.find(".file-caption-name")),self.$previewContainer=getElement(options,"elPreviewContainer",self.$container.find(".file-preview")),self.$preview=getElement(options,"elPreviewImage",self.$container.find(".file-preview-thumbnails")),self.$previewStatus=getElement(options,"elPreviewStatus",self.$container.find(".file-preview-status")),self.$errorContainer=getElement(options,"elErrorContainer",self.$previewContainer.find(".kv-fileinput-error")),isEmpty(self.msgErrorClass)||addCss(self.$errorContainer,self.msgErrorClass),self.$errorContainer.hide(),self.fileActionSettings=$.extend(defaultFileActionSettings,options.fileActionSettings),self.previewInitId="preview-"+uniqId(),self.id=self.$element.attr("id"),previewCache.init(self),self.initPreview(!0),self.initPreviewDeletes(),self.options=options,self.setFileDropZoneTitle(),self.uploadCount=0,self.uploadPercent=0,self.$element.removeClass("file-loading"),t=self.getLayoutTemplate("progress"),self.progressTemplate=t.replace("{class}",self.progressClass),self.progressCompleteTemplate=t.replace("{class}",self.progressCompleteClass),self.setEllipsis()},parseError:function(jqXHR,errorThrown,fileName){var self=this,errMsg=$.trim(errorThrown+""),dot="."===errMsg.slice(-1)?"":".",text=$(jqXHR.responseText).text();return self.showAjaxErrorDetails?(text=$.trim(text.replace(/\n\s*\n/g,"\n")),text=text.length>0?"<pre>"+text+"</pre>":"",errMsg+=dot+text):errMsg+=dot,fileName?"<b>"+fileName+": </b>"+jqXHR:errMsg},raise:function(event,params){var self=this,e=$.Event(event),out=!1;if(void 0!==params?self.$element.trigger(e,params):self.$element.trigger(e),e.result&&(out=!0),out)switch(event){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":break;default:self.ajaxAborted=out}},getLayoutTemplate:function(t){var self=this,template=isSet(t,self.layoutTemplates)?self.layoutTemplates[t]:defaultLayoutTemplates[t];return isEmpty(self.customLayoutTags)?template:replaceTags(template,self.customLayoutTags)},getPreviewTemplate:function(t){var self=this,template=isSet(t,self.previewTemplates)?self.previewTemplates[t]:defaultPreviewTemplates[t];return template=template.repl("{previewFileIcon}",self.previewFileIcon),isEmpty(self.customPreviewTags)?template:replaceTags(template,self.customPreviewTags)},getOutData:function(jqXHR,responseData,filesData){var self=this;return jqXHR=jqXHR||{},responseData=responseData||{},filesData=filesData||self.filestack.slice(0)||{},{form:self.formdata,files:filesData,extra:self.getExtraData(),response:responseData,reader:self.reader,jqXHR:jqXHR}},setEllipsis:function(){var self=this,$capCont=self.$captionContainer,$cap=self.$caption,$div=$cap.clone().css("height","auto").hide();$capCont.parent().before($div),$capCont.removeClass("kv-has-ellipsis"),$div.outerWidth()>$cap.outerWidth()&&$capCont.addClass("kv-has-ellipsis"),$div.remove()},listen:function(){var self=this,$el=self.$element,$cap=self.$captionContainer,$btnFile=self.$btnFile,$form=$el.closest("form");$el.on("change",$.proxy(self.change,self)),$(window).on("resize",function(){self.setEllipsis()}),$btnFile.off("click").on("click",function(){self.raise("filebrowse"),self.isError&&!self.isUploadable&&self.clear(),$cap.focus()}),$form.off("reset").on("reset",$.proxy(self.reset,self)),self.$container.off("click").on("click",".fileinput-remove:not([disabled])",$.proxy(self.clear,self)).on("click",".fileinput-cancel",$.proxy(self.cancel,self)),self.isUploadable&&self.dropZoneEnabled&&self.showPreview&&self.initDragDrop(),self.isUploadable||$form.on("submit",$.proxy(self.submitForm,self)),self.$container.find(".kv-fileinput-upload").off("click").on("click",function(e){self.isUploadable&&(e.preventDefault(),!$(this).hasClass("disabled")&&isEmpty($(this).attr("disabled"))&&self.upload())})},submitForm:function(){var self=this,$el=self.$element,files=$el.get(0).files;return files&&files.length<self.minFileCount&&self.minFileCount>0?(self.noFilesError({}),!1):!self.abort({})},abort:function(params){var data,self=this;return self.ajaxAborted&&"object"==typeof self.ajaxAborted&&void 0!==self.ajaxAborted.message?(data=void 0!==self.ajaxAborted.data?self.getOutData({},self.ajaxAborted.data):self.getOutData(),data=$.extend(data,params),self.showUploadError(self.ajaxAborted.message,data,"filecustomerror"),!0):!1},noFilesError:function(params){var self=this,label=self.minFileCount>1?self.filePlural:self.fileSingle,msg=self.msgFilesTooLess.repl("{n}",self.minFileCount).repl("{files}",label),$error=self.$errorContainer;$error.html(msg),self.isError=!0,self.updateFileDetails(0),$error.fadeIn(800),self.raise("fileerror",[params]),self.clearFileInput(),addCss(self.$container,"has-error")},setProgress:function(p){var self=this,pct=Math.min(p,100),template=100>pct?self.progressTemplate:self.progressCompleteTemplate;self.$progress.html(template.repl("{percent}",pct))},upload:function(){var i,outData,len,self=this,totLen=self.getFileStack().length,params={},hasExtraData=!$.isEmptyObject(self.getExtraData());if(totLen<self.minFileCount&&self.minFileCount>0)return void self.noFilesError(params);if(self.isUploadable&&!self.isDisabled&&(0!==totLen||hasExtraData)){if(self.resetUpload(),self.$progress.removeClass("hide"),self.uploadCount=0,self.uploadPercent=0,self.lock(),self.setProgress(0),0===totLen&&hasExtraData)return void self.uploadExtraOnly();if(len=self.filestack.length,self.hasInitData=!1,self.uploadAsync&&self.showPreview)for(outData=self.getOutData(),self.raise("filebatchpreupload",[outData]),self.fileBatchCompleted=!1,self.uploadCache={content:[],config:[],tags:[],append:!0},i=0;len>i;i+=1)void 0!==self.filestack[i]&&self.uploadSingle(i,self.filestack,!0);else self.uploadBatch()}},lock:function(){var self=this;self.resetErrors(),self.disable(),self.showRemove&&addCss(self.$container.find(".fileinput-remove"),"hide"),self.showCancel&&self.$container.find(".fileinput-cancel").removeClass("hide"),self.raise("filelock",[self.filestack,self.getExtraData()])},unlock:function(reset){var self=this;void 0===reset&&(reset=!0),self.enable(),self.showCancel&&addCss(self.$container.find(".fileinput-cancel"),"hide"),self.showRemove&&self.$container.find(".fileinput-remove").removeClass("hide"),reset&&self.resetFileStack(),self.raise("fileunlock",[self.filestack,self.getExtraData()])},resetFileStack:function(){var self=this,i=0,newstack=[];self.getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex"),file=self.filestack[ind];-1!==ind&&(void 0!==file?(newstack[i]=file,$thumb.attr({id:self.previewInitId+"-"+i,"data-fileindex":i}),i+=1):$thumb.attr({id:"uploaded-"+uniqId(),"data-fileindex":"-1"}))}),self.filestack=newstack},refresh:function(options){var $zone,self=this,$el=self.$element,params=arguments.length?$.extend(self.options,options):self.options;$el.off(),self.init(params),$zone=self.$container.find(".file-drop-zone"),$zone.off("dragenter dragover drop"),$(document).off("dragenter dragover drop"),self.listen(),self.setFileDropZoneTitle()},initDragDrop:function(){var self=this,$zone=self.$container.find(".file-drop-zone");$zone.off("dragenter dragover drop"),$(document).off("dragenter dragover drop"),$zone.on("dragenter dragover",function(e){e.stopPropagation(),e.preventDefault(),self.isDisabled||addCss($(this),"highlighted")}),$zone.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),self.isDisabled||$(this).removeClass("highlighted")}),$zone.on("drop",function(e){e.preventDefault(),self.isDisabled||(self.change(e,"dragdrop"),$(this).removeClass("highlighted"))}),$(document).on("dragenter dragover drop",function(e){e.stopPropagation(),e.preventDefault()})},setFileDropZoneTitle:function(){var self=this,$zone=self.$container.find(".file-drop-zone");$zone.find("."+self.dropZoneTitleClass).remove(),self.isUploadable&&self.showPreview&&0!==$zone.length&&!(self.getFileStack().length>0)&&self.dropZoneEnabled&&(0===$zone.find(".file-preview-frame").length&&$zone.prepend('<div class="'+self.dropZoneTitleClass+'">'+self.dropZoneTitle+"</div>"),self.$container.removeClass("file-input-new"),addCss(self.$container,"file-input-ajax-new"))},initFileActions:function(){var self=this;self.$preview.find(".kv-file-remove").each(function(){var n,cap,$el=$(this),$frame=$el.closest(".file-preview-frame"),ind=$frame.attr("data-fileindex");$el.off("click").on("click",function(){$frame.fadeOut("slow",function(){self.filestack[ind]=void 0,self.clearObjects($frame),$frame.remove();var filestack=self.getFileStack(),len=filestack.length,chk=previewCache.count(self.id);self.clearFileInput(),0===len&&0===chk?self.reset():(n=chk+len,cap=n>1?self.getMsgSelected(n):filestack[0].name,self.setCaption(cap))})})}),self.$preview.find(".kv-file-upload").each(function(){var $el=$(this);$el.off("click").on("click",function(){var $frame=$el.closest(".file-preview-frame"),ind=$frame.attr("data-fileindex");self.uploadSingle(ind,self.filestack,!1)})})},getMsgSelected:function(n){var self=this,strFiles=1===n?self.fileSingle:self.filePlural;return self.msgSelected.repl("{n}",n).repl("{files}",strFiles)},renderFileFooter:function(caption,width){var footer,out,self=this,config=self.fileActionSettings,template=self.getLayoutTemplate("footer");return self.isUploadable?(footer=template.repl("{actions}",self.renderFileActions(!0,!0,!1,!1,!1)),out=footer.repl("{caption}",caption).repl("{width}",width).repl("{indicator}",config.indicatorNew).repl("{indicatorTitle}",config.indicatorNewTitle)):out=template.repl("{actions}","").repl("{caption}",caption).repl("{width}",width).repl("{indicator}","").repl("{indicatorTitle}",""),out=replaceTags(out,self.previewThumbTags)},renderFileActions:function(showUpload,showDelete,disabled,url,key){if(!showUpload&&!showDelete)return"";var self=this,vUrl=url===!1?"":' data-url="'+url+'"',vKey=key===!1?"":' data-key="'+key+'"',btnDelete=self.getLayoutTemplate("actionDelete"),btnUpload="",template=self.getLayoutTemplate("actions"),otherButtons=self.otherActionButtons.repl("{dataKey}",vKey),config=self.fileActionSettings,removeClass=disabled?config.removeClass+" disabled":config.removeClass;return btnDelete=btnDelete.repl("{removeClass}",removeClass).repl("{removeIcon}",config.removeIcon).repl("{removeTitle}",config.removeTitle).repl("{dataUrl}",vUrl).repl("{dataKey}",vKey),showUpload&&(btnUpload=self.getLayoutTemplate("actionUpload").repl("{uploadClass}",config.uploadClass).repl("{uploadIcon}",config.uploadIcon).repl("{uploadTitle}",config.uploadTitle)),template.repl("{delete}",btnDelete).repl("{upload}",btnUpload).repl("{other}",otherButtons)},initPreview:function(isInit){var out,self=this,cap=self.initialCaption||"";return previewCache.count(self.id)?(out=previewCache.out(self.id),cap=isInit&&self.initialCaption?self.initialCaption:out.caption,self.$preview.html(out.content),self.setCaption(cap),void(isEmpty(out.content)||self.$container.removeClass("file-input-new"))):(self.$preview.html(""),void(isInit?self.setCaption(cap):self.initCaption()))},initPreviewDeletes:function(){var self=this,deleteExtraData=self.deleteExtraData||{},resetProgress=function(){0===self.$preview.find(".kv-file-remove").length&&(self.reset(),self.initialCaption="")};self.$preview.find(".kv-file-remove").each(function(){var $el=$(this),vUrl=$el.data("url")||self.deleteUrl,vKey=$el.data("key");if(!isEmpty(vUrl)&&void 0!==vKey){var settings,params,config,extraData,$frame=$el.closest(".file-preview-frame"),cache=previewCache.data[self.id],index=$frame.data("fileindex");index=parseInt(index.replace("init_","")),config=isEmpty(cache.config)&&isEmpty(cache.config[index])?null:cache.config[index],extraData=isEmpty(config)||isEmpty(config.extra)?deleteExtraData:config.extra,"function"==typeof extraData&&(extraData=extraData()),params={id:$el.attr("id"),key:vKey,extra:extraData},settings=$.extend({url:vUrl,type:"DELETE",dataType:"json",data:$.extend({key:vKey},extraData),beforeSend:function(jqXHR){self.ajaxAborted=!1,self.raise("filepredelete",[vKey,jqXHR,extraData]),self.ajaxAborted?jqXHR.abort():(addCss($frame,"file-uploading"),addCss($el,"disabled"))},success:function(data,textStatus,jqXHR){var n,cap;return void 0!==data&&void 0!==data.error?(params.jqXHR=jqXHR,params.response=data,self.showError(data.error,params,"filedeleteerror"),$frame.removeClass("file-uploading"),$el.removeClass("disabled"),void resetProgress()):(previewCache.unset(self.id,index),n=previewCache.count(self.id),cap=n>0?self.getMsgSelected(n):"",self.raise("filedeleted",[vKey,jqXHR,extraData]),self.setCaption(cap),$frame.removeClass("file-uploading").addClass("file-deleted"),void $frame.fadeOut("slow",function(){self.clearObjects($frame),
$frame.remove(),resetProgress(),n||0!==self.getFileStack().length||(self.setCaption(""),self.reset())}))},error:function(jqXHR,textStatus,errorThrown){var errMsg=self.parseError(jqXHR,errorThrown);params.jqXHR=jqXHR,params.response={},self.showError(errMsg,params,"filedeleteerror"),$frame.removeClass("file-uploading"),resetProgress()}},self.ajaxDeleteSettings),$el.off("click").on("click",function(){$.ajax(settings)})}})},clearObjects:function($el){$el.find("video audio").each(function(){this.pause(),$(this).remove()}),$el.find("img object div").each(function(){$(this).remove()})},clearFileInput:function(){var $srcFrm,$tmpFrm,$tmpEl,self=this,$el=self.$element;isEmpty($el.val())||(self.isIE9||self.isIE10?($srcFrm=$el.closest("form"),$tmpFrm=$(document.createElement("form")),$tmpEl=$(document.createElement("div")),$el.before($tmpEl),$srcFrm.length?$srcFrm.after($tmpFrm):$tmpEl.after($tmpFrm),$tmpFrm.append($el).trigger("reset"),$tmpEl.before($el).remove(),$tmpFrm.remove()):$el.val(""),self.fileInputCleared=!0)},resetUpload:function(){var self=this;self.uploadCache={content:[],config:[],tags:[],append:!0},self.uploadCount=0,self.uploadPercent=0,self.$btnUpload.removeAttr("disabled"),self.setProgress(0),addCss(self.$progress,"hide"),self.resetErrors(!1),self.ajaxAborted=!1,self.ajaxRequests=[]},cancel:function(){var i,self=this,xhr=self.ajaxRequests,len=xhr.length;if(len>0)for(i=0;len>i;i+=1)xhr[i].abort();self.getThumbs().each(function(){var $thumb=$(this),ind=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[ind]&&($thumb.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),$thumb.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),self.unlock()})},clear:function(){var cap,self=this;self.$btnUpload.removeAttr("disabled"),self.resetUpload(),self.filestack=[],self.clearFileInput(),self.resetErrors(!0),self.raise("fileclear"),!self.overwriteInitial&&previewCache.count(self.id)?(self.showFileIcon(),self.resetPreview(),self.setEllipsis(),self.initPreviewDeletes(),self.$container.removeClass("file-input-new")):(self.getThumbs().each(function(){self.clearObjects($(this))}),self.$preview.html(""),cap=!self.overwriteInitial&&self.initialCaption.length>0?self.initialCaption:"",self.setCaption(cap),self.setEllipsis(),self.$caption.attr("title",""),addCss(self.$container,"file-input-new")),0===self.$container.find(".file-preview-frame").length&&(self.initCaption()||self.$captionContainer.find(".kv-caption-icon").hide(),self.setEllipsis()),self.hideFileIcon(),self.raise("filecleared"),self.$captionContainer.focus(),self.setFileDropZoneTitle()},resetPreview:function(){var out,self=this;previewCache.count(self.id)?(out=previewCache.out(self.id),self.$preview.html(out.content),self.setCaption(out.caption)):(self.$preview.html(""),self.initCaption())},reset:function(){var self=this;self.clear(),self.resetPreview(),self.setEllipsis(),self.$container.find(".fileinput-filename").text(""),self.raise("filereset"),self.initialPreview.length>0&&self.$container.removeClass("file-input-new"),self.setFileDropZoneTitle(),self.filestack=[],self.formdata={}},disable:function(){var self=this;self.isDisabled=!0,self.raise("filedisabled"),self.$element.attr("disabled","disabled"),self.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0),self.initDragDrop()},enable:function(){var self=this;self.isDisabled=!1,self.raise("fileenabled"),self.$element.removeAttr("disabled"),self.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),self.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled"),self.initDragDrop()},getThumbs:function(css){return css=css||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+css)},getExtraData:function(){var self=this,data=self.uploadExtraData;return"function"==typeof self.uploadExtraData&&(data=self.uploadExtraData()),data},uploadExtra:function(){var self=this,data=self.getExtraData();0!==data.length&&$.each(data,function(key,value){self.formdata.append(key,value)})},initXhr:function(xhrobj,factor){var self=this;return xhrobj.upload&&xhrobj.upload.addEventListener("progress",function(event){var pct=0,position=event.loaded||event.position,total=event.total;event.lengthComputable&&(pct=Math.ceil(position/total*factor)),self.uploadPercent=Math.max(pct,self.uploadPercent),self.setProgress(self.uploadPercent)},!1),xhrobj},ajaxSubmit:function(fnBefore,fnSuccess,fnComplete,fnError){var settings,self=this;self.uploadExtra(),settings=$.extend({xhr:function(){var xhrobj=$.ajaxSettings.xhr();return self.initXhr(xhrobj,98)},url:self.uploadUrl,type:"POST",dataType:"json",data:self.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:fnBefore,success:fnSuccess,complete:fnComplete,error:fnError},self.ajaxSettings),self.ajaxRequests.push($.ajax(settings))},initUploadSuccess:function(out,$thumb,allFiles){var append,data,index,$newThumb,content,config,tags,self=this;"object"!=typeof out||$.isEmptyObject(out)||void 0!==out.initialPreview&&out.initialPreview.length>0&&(self.hasInitData=!0,content=out.initialPreview||[],config=out.initialPreviewConfig||[],tags=out.initialPreviewThumbTags||[],append=void 0===out.append||out.append?!0:!1,self.overwriteInitial=!1,void 0===$thumb||allFiles?allFiles?(self.uploadCache.content.push(content[0]),self.uploadCache.config.push(config[0]),self.uploadCache.tags.push(tags[0]),self.uploadCache.append=append):(previewCache.set(self.id,content,config,tags,append),self.initPreview(),self.initPreviewDeletes()):(index=previewCache.add(self.id,content,config[0],tags[0],append),data=previewCache.get(self.id,index,!1),$newThumb=$(data).hide(),$thumb.after($newThumb).fadeOut("slow",function(){$newThumb.fadeIn("slow").css("display:inline-block"),self.initPreviewDeletes(),self.clearFileInput()})))},uploadSingle:function(i,files,allFiles){var outData,pct,chkComplete,setIndicator,updateProgress,resetActions,fnBefore,fnSuccess,fnComplete,fnError,self=this,total=self.getFileStack().length,formdata=new FormData,previewId=self.previewInitId+"-"+i,$thumb=$("#"+previewId+":not(.file-preview-initial)"),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove"),$indicator=$thumb.find(".file-upload-indicator"),config=self.fileActionSettings,hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData),params={id:previewId,index:i};self.formdata=formdata,0===total||!hasPostData||$btnUpload.hasClass("disabled")||self.abort(params)||(chkComplete=function(){var $thumbs=self.getThumbs(".file-uploading");$thumbs.length>0||self.fileBatchCompleted||(self.fileBatchCompleted=!0,setTimeout(function(){previewCache.set(self.id,self.uploadCache.content,self.uploadCache.config,self.uploadCache.tags,self.uploadCache.append),self.hasInitData&&(self.initPreview(),self.initPreviewDeletes()),self.setProgress(100),self.unlock(),self.clearFileInput(),self.raise("filebatchuploadcomplete",[self.filestack,self.getExtraData()])},100))},setIndicator=function(icon,msg){$indicator.html(config[icon]),$indicator.attr("title",config[msg])},updateProgress=function(){!allFiles||0===total||self.uploadPercent>=100||(self.uploadCount+=1,pct=80+Math.ceil(20*self.uploadCount/total),self.uploadPercent=Math.max(pct,self.uploadPercent),self.setProgress(self.uploadPercent),self.initPreviewDeletes())},resetActions=function(){$btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled"),$thumb.removeClass("file-uploading")},fnBefore=function(jqXHR){outData=self.getOutData(jqXHR),setIndicator("indicatorLoading","indicatorLoadingTitle"),addCss($thumb,"file-uploading"),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0),allFiles||self.lock(),self.raise("filepreupload",[outData,previewId,i]),params=$.extend(params,outData),self.abort(params)&&(jqXHR.abort(),self.setProgress(100))},fnSuccess=function(data,textStatus,jqXHR){outData=self.getOutData(jqXHR,data),params=$.extend(params,outData),setTimeout(function(){void 0===data.error?(setIndicator("indicatorSuccess","indicatorSuccessTitle"),$btnUpload.hide(),$btnDelete.hide(),self.filestack[i]=void 0,self.raise("fileuploaded",[outData,previewId,i]),self.initUploadSuccess(data,$thumb,allFiles),allFiles||self.resetFileStack()):(setIndicator("indicatorError","indicatorErrorTitle"),self.showUploadError(data.error,params))},100)},fnComplete=function(){setTimeout(function(){updateProgress(),resetActions(),allFiles?chkComplete():self.unlock(!1)},100)},fnError=function(jqXHR,textStatus,errorThrown){var errMsg=self.parseError(jqXHR,errorThrown,allFiles?files[i].name:null);setIndicator("indicatorError","indicatorErrorTitle"),params=$.extend(params,self.getOutData(jqXHR)),self.showUploadError(errMsg,params)},formdata.append(self.uploadFileAttr,files[i]),formdata.append("file_id",i),self.ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},uploadBatch:function(){var config,setIndicator,setAllUploaded,enableActions,fnBefore,fnSuccess,fnComplete,fnError,self=this,files=self.filestack,total=files.length,hasPostData=self.filestack.length>0||!$.isEmptyObject(self.uploadExtraData),params={};self.formdata=new FormData,0!==total&&hasPostData&&!self.abort(params)&&(config=self.fileActionSettings,setIndicator=function(i,icon,msg){var $indicator=$("#"+self.previewInitId+"-"+i).find(".file-upload-indicator");$indicator.html(config[icon]),$indicator.attr("title",config[msg])},enableActions=function(i){var $thumb=$("#"+self.previewInitId+"-"+i+":not(.file-preview-initial)"),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-delete");$thumb.removeClass("file-uploading"),$btnUpload.removeAttr("disabled"),$btnDelete.removeAttr("disabled")},setAllUploaded=function(){$.each(files,function(key){self.filestack[key]=void 0}),self.clearFileInput()},fnBefore=function(jqXHR){self.lock();var outData=self.getOutData(jqXHR);self.showPreview&&self.getThumbs().each(function(){var $thumb=$(this),$btnUpload=$thumb.find(".kv-file-upload"),$btnDelete=$thumb.find(".kv-file-remove");addCss($thumb,"file-uploading"),$btnUpload.attr("disabled",!0),$btnDelete.attr("disabled",!0)}),self.raise("filebatchpreupload",[outData]),self.abort(outData)&&jqXHR.abort()},fnSuccess=function(data,textStatus,jqXHR){var outData=self.getOutData(jqXHR,data),$thumbs=self.getThumbs(),keys=isEmpty(data.errorkeys)?[]:data.errorkeys;void 0===data.error||isEmpty(data.error)?(self.raise("filebatchuploadsuccess",[outData]),setAllUploaded(),self.showPreview?($thumbs.find(".kv-file-upload").hide(),$thumbs.find(".kv-file-remove").hide(),$thumbs.each(function(){var $thumb=$(this),key=$thumb.attr("data-fileindex");setIndicator(key,"indicatorSuccess","indicatorSuccessTitle"),enableActions(key)}),self.initUploadSuccess(data)):self.reset()):(self.showPreview&&($thumbs.each(function(){var $thumb=$(this),key=parseInt($thumb.attr("data-fileindex"),10);return enableActions(key),0===keys.length?void setIndicator(key,"indicatorError","indicatorErrorTitle"):void(-1!==$.inArray(key,keys)?setIndicator(key,"indicatorError","indicatorErrorTitle"):($thumb.find(".kv-file-upload").hide(),$thumb.find(".kv-file-remove").hide(),setIndicator(key,"indicatorSuccess","indicatorSuccessTitle"),self.filestack[key]=void 0))}),self.initUploadSuccess(data)),self.showUploadError(data.error,outData,"filebatchuploaderror"))},fnComplete=function(){self.setProgress(100),self.unlock(),self.raise("filebatchuploadcomplete",[self.filestack,self.getExtraData()]),self.clearFileInput()},fnError=function(jqXHR,textStatus,errorThrown){var outData=self.getOutData(jqXHR),errMsg=self.parseError(jqXHR,errorThrown);self.showUploadError(errMsg,outData,"filebatchuploaderror"),self.uploadFileCount=total-1,self.showPreview&&(self.getThumbs().each(function(){var $thumb=$(this),key=$thumb.attr("data-fileindex");$thumb.removeClass("file-uploading"),void 0!==self.filestack[key]&&setIndicator(key,"indicatorError","indicatorErrorTitle")}),self.getThumbs().removeClass("file-uploading"),self.getThumbs(" .kv-file-upload").removeAttr("disabled"),self.getThumbs(" .kv-file-delete").removeAttr("disabled"))},$.each(files,function(key,data){isEmpty(files[key])||self.formdata.append(self.uploadFileAttr,data)}),self.ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},uploadExtraOnly:function(){var fnBefore,fnSuccess,fnComplete,fnError,self=this,params={};self.formdata=new FormData,self.abort(params)||(fnBefore=function(jqXHR){self.lock();var outData=self.getOutData(jqXHR);self.raise("filebatchpreupload",[outData]),self.setProgress(50),params.data=outData,params.xhr=jqXHR,self.abort(params)&&(jqXHR.abort(),self.setProgress(100))},fnSuccess=function(data,textStatus,jqXHR){var outData=self.getOutData(jqXHR,data);void 0===data.error||isEmpty(data.error)?(self.raise("filebatchuploadsuccess",[outData]),self.clearFileInput(),self.initUploadSuccess(data)):self.showUploadError(data.error,outData,"filebatchuploaderror")},fnComplete=function(){self.setProgress(100),self.unlock(),self.raise("filebatchuploadcomplete",[self.filestack,self.getExtraData()]),self.clearFileInput()},fnError=function(jqXHR,textStatus,errorThrown){var outData=self.getOutData(jqXHR),errMsg=self.parseError(jqXHR,errorThrown);params.data=outData,self.showUploadError(errMsg,outData,"filebatchuploaderror")},self.ajaxSubmit(fnBefore,fnSuccess,fnComplete,fnError))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(fade){var self=this,$error=self.$errorContainer;self.isError=!1,self.$container.removeClass("has-error"),$error.html(""),fade?$error.fadeOut("slow"):$error.hide()},showFolderError:function(folders){var self=this,$error=self.$errorContainer;folders&&($error.html(self.msgFoldersNotAllowed.repl("{n}",folders)),$error.fadeIn(800),addCss(self.$container,"has-error"),self.raise("filefoldererror",[folders]))},showUploadError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileuploaderror";return 0===$error.find("ul").length?$error.html("<ul><li>"+msg+"</li></ul>"):$error.find("ul").append("<li>"+msg+"</li>"),$error.fadeIn(800),self.raise(ev,[params]),addCss(self.$container,"has-error"),!0},showError:function(msg,params,event){var self=this,$error=self.$errorContainer,ev=event||"fileerror";return params=params||{},params.reader=self.reader,$error.html(msg),$error.fadeIn(800),self.raise(ev,[params]),self.isUploadable||self.clearFileInput(),addCss(self.$container,"has-error"),self.$btnUpload.attr("disabled",!0),!0},errorHandler:function(evt,caption){var self=this,err=evt.target.error;switch(err.code){case err.NOT_FOUND_ERR:self.showError(self.msgFileNotFound.repl("{name}",caption));break;case err.SECURITY_ERR:self.showError(self.msgFileSecured.repl("{name}",caption));break;case err.NOT_READABLE_ERR:self.showError(self.msgFileNotReadable.repl("{name}",caption));break;case err.ABORT_ERR:self.showError(self.msgFilePreviewAborted.repl("{name}",caption));break;default:self.showError(self.msgFilePreviewError.repl("{name}",caption))}},parseFileType:function(file){var isValid,vType,cat,i,self=this;for(i=0;i<defaultPreviewTypes.length;i+=1)if(cat=defaultPreviewTypes[i],isValid=isSet(cat,self.fileTypeSettings)?self.fileTypeSettings[cat]:defaultFileTypeSettings[cat],vType=isValid(file.type,file.name)?cat:"",!isEmpty(vType))return vType;return"other"},previewDefault:function(file,previewId,isDisabled){if(this.showPreview){var self=this,data=objUrl.createObjectURL(file),$obj=$("#"+previewId),config=self.previewSettings.other,footer=self.renderFileFooter(file.name,config.width),previewOtherTemplate=self.getPreviewTemplate("other"),ind=previewId.slice(previewId.lastIndexOf("-")+1),frameClass="";isDisabled===!0&&(frameClass=" btn disabled",footer+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'),self.$preview.append("\n"+previewOtherTemplate.repl("{previewId}",previewId).repl("{frameClass}",frameClass).repl("{fileindex}",ind).repl("{caption}",self.slug(file.name)).repl("{width}",config.width).repl("{height}",config.height).repl("{type}",file.type).repl("{data}",data).repl("{footer}",footer)),$obj.on("load",function(){objUrl.revokeObjectURL($obj.attr("data"))})}},previewFile:function(file,theFile,previewId,data){if(this.showPreview){var content,strText,id,height,self=this,cat=self.parseFileType(file),caption=self.slug(file.name),types=self.allowedPreviewTypes,mimes=self.allowedPreviewMimeTypes,tmplt=self.getPreviewTemplate(cat),config=isSet(cat,self.previewSettings)?self.previewSettings[cat]:defaultPreviewSettings[cat],wrapLen=parseInt(self.wrapTextLength,10),wrapInd=self.wrapIndicator,chkTypes=types.indexOf(cat)>=0,chkMimes=isEmpty(mimes)||!isEmpty(mimes)&&-1!==mimes.indexOf(file.type),footer=self.renderFileFooter(caption,config.width),modal="",ind=previewId.slice(previewId.lastIndexOf("-")+1);chkTypes&&chkMimes?("text"===cat?(strText=htmlEncode(theFile.target.result),objUrl.revokeObjectURL(data),strText.length>wrapLen&&(id="text-"+uniqId(),height=.75*window.innerHeight,modal=self.getLayoutTemplate("modal").repl("{id}",id).repl("{title}",caption).repl("{height}",height).repl("{body}",strText),wrapInd=wrapInd.repl("{title}",caption).repl("{dialog}","$('#"+id+"').modal('show')"),strText=strText.substring(0,wrapLen-1)+wrapInd),content=tmplt.repl("{previewId}",previewId).repl("{caption}",caption).repl("{frameClass}","").repl("{type}",file.type).repl("{width}",config.width).repl("{height}",config.height).repl("{data}",strText).repl("{footer}",footer).repl("{fileindex}",ind)+modal):content=tmplt.repl("{previewId}",previewId).repl("{caption}",caption).repl("{frameClass}","").repl("{type}",file.type).repl("{data}",data).repl("{width}",config.width).repl("{height}",config.height).repl("{footer}",footer).repl("{fileindex}",ind),self.$preview.append("\n"+content),self.autoSizeImage(previewId)):self.previewDefault(file,previewId)}},slugDefault:function(text){return isEmpty(text)?"":text.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},getFileStack:function(){var self=this;return self.filestack.filter(function(n){return void 0!==n})},readFiles:function(files){function readFile(i){if(isEmpty($el.attr("multiple"))&&(numFiles=1),i>=numFiles)return self.isUploadable&&self.filestack.length>0?self.raise("filebatchselected",[self.getFileStack()]):self.raise("filebatchselected",[files]),$container.removeClass("loading"),void $status.html("");var isText,checkFile,j,msg,typ,chk,node=ctr+i,previewId=previewInitId+"-"+node,file=files[i],caption=self.slug(file.name),fileSize=(file.size||0)/1e3,fileExtExpr="",previewData=objUrl.createObjectURL(file),fileCount=0,fileTypes=self.allowedFileTypes,strTypes=isEmpty(fileTypes)?"":fileTypes.join(", "),fileExt=self.allowedFileExtensions,strExt=isEmpty(fileExt)?"":fileExt.join(", ");if(isEmpty(fileExt)||(fileExtExpr=new RegExp("\\.("+fileExt.join("|")+")$","i")),fileSize=fileSize.toFixed(2),self.maxFileSize>0&&fileSize>self.maxFileSize)return msg=self.msgSizeTooLarge.repl("{name}",caption).repl("{size}",fileSize).repl("{maxSize}",self.maxFileSize),void(self.isError=throwError(msg,file,previewId,i));if(!isEmpty(fileTypes)&&isArray(fileTypes)){for(j=0;j<fileTypes.length;j+=1)typ=fileTypes[j],checkFile=settings[typ],chk=void 0!==checkFile&&checkFile(file.type,caption),fileCount+=isEmpty(chk)?0:chk.length;if(0===fileCount)return msg=self.msgInvalidFileType.repl("{name}",caption).repl("{types}",strTypes),void(self.isError=throwError(msg,file,previewId,i))}return 0!==fileCount||isEmpty(fileExt)||!isArray(fileExt)||isEmpty(fileExtExpr)||(chk=caption.match(fileExtExpr),fileCount+=isEmpty(chk)?0:chk.length,0!==fileCount)?self.showPreview?($preview.length>0&&void 0!==FileReader?($status.html(msgLoading.repl("{index}",i+1).repl("{files}",numFiles)),$container.addClass("loading"),reader.onerror=function(evt){self.errorHandler(evt,caption)},reader.onload=function(theFile){self.previewFile(file,theFile,previewId,previewData),self.initFileActions()},reader.onloadend=function(){msg=msgProgress.repl("{index}",i+1).repl("{files}",numFiles).repl("{percent}",50).repl("{name}",caption),setTimeout(function(){$status.html(msg),objUrl.revokeObjectURL(previewData)},100),setTimeout(function(){readFile(i+1),self.updateFileDetails(numFiles)},100),self.raise("fileloaded",[file,previewId,i,reader])},reader.onprogress=function(data){if(data.lengthComputable){var fact=data.loaded/data.total*100,progress=Math.ceil(fact);msg=msgProgress.repl("{index}",i+1).repl("{files}",numFiles).repl("{percent}",progress).repl("{name}",caption),setTimeout(function(){$status.html(msg)},100)}},isText=isSet("text",settings)?settings.text:defaultFileTypeSettings.text,isText(file.type,caption)?reader.readAsText(file,self.textEncoding):reader.readAsArrayBuffer(file)):(self.previewDefault(file,previewId),setTimeout(function(){readFile(i+1),self.updateFileDetails(numFiles)},100),self.raise("fileloaded",[file,previewId,i,reader])),void self.filestack.push(file)):(self.filestack.push(file),setTimeout(readFile(i+1),100),void self.raise("fileloaded",[file,previewId,i,reader])):(msg=self.msgInvalidFileExtension.repl("{name}",caption).repl("{extensions}",strExt),void(self.isError=throwError(msg,file,previewId,i)))}this.reader=new FileReader;var self=this,$el=self.$element,$preview=self.$preview,reader=self.reader,$container=self.$previewContainer,$status=self.$previewStatus,msgLoading=self.msgLoading,msgProgress=self.msgProgress,previewInitId=self.previewInitId,numFiles=files.length,settings=self.fileTypeSettings,ctr=self.filestack.length,throwError=function(msg,file,previewId,index){var p1=$.extend(self.getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self.previewDefault(file,previewId,!0),self.isUploadable?self.showUploadError(msg,p1):self.showError(msg,p2)};readFile(0),self.updateFileDetails(numFiles,!1)},updateFileDetails:function(numFiles){var self=this,$el=self.$element,fileStack=self.getFileStack(),name=$el.val()||fileStack.length&&fileStack[0].name||"",label=self.slug(name),n=self.isUploadable?fileStack.length:numFiles,nFiles=previewCache.count(self.id)+n,log=n>1?self.getMsgSelected(nFiles):label;self.isError?(self.$previewContainer.removeClass("loading"),self.$previewStatus.html(""),self.$captionContainer.find(".kv-caption-icon").hide()):self.showFileIcon(),self.setCaption(log,self.isError),self.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&self.raise("fileselect",[numFiles,label]),previewCache.count(self.id)&&self.initPreviewDeletes()},change:function(e){var self=this,$el=self.$element;if(!self.isUploadable&&isEmpty($el.val())&&self.fileInputCleared)return void(self.fileInputCleared=!1);self.fileInputCleared=!1;var tfiles,msg,total,f,$preview=self.$preview,isDragDrop=arguments.length>1,files=isDragDrop?e.originalEvent.dataTransfer.files:$el.get(0).files,isSingleUpload=isEmpty($el.attr("multiple")),i=0,folders=0,ctr=self.filestack.length,isAjaxUpload=self.isUploadable,throwError=function(mesg,file,previewId,index){var p1=$.extend(self.getOutData({},{},files),{id:previewId,index:index}),p2={id:previewId,index:index,file:file,files:files};return self.isUploadable?self.showUploadError(mesg,p1):self.showError(mesg,p2)};if(self.reader=null,self.resetUpload(),self.hideFileIcon(),self.isUploadable&&self.$container.find(".file-drop-zone ."+self.dropZoneTitleClass).remove(),isDragDrop)for(tfiles=[];files[i];)f=files[i],f.type||f.size%4096!==0?tfiles.push(f):folders++,i++;else tfiles=void 0===e.target.files?e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files;if(isEmpty(tfiles)||0===tfiles.length)return isAjaxUpload||self.clear(),self.showFolderError(folders),void self.raise("fileselectnone");if(self.resetErrors(),!isAjaxUpload||isSingleUpload&&ctr>0){if(!self.overwriteInitial&&previewCache.count(self.id)){var out=previewCache.out(self.id);$preview.html(out.content),self.setCaption(out.caption),self.initPreviewDeletes()}else $preview.html("");isSingleUpload&&ctr>0&&(self.filestack=[])}return total=self.isUploadable?self.getFileStack().length+tfiles.length:tfiles.length,self.maxFileCount>0&&total>self.maxFileCount?(msg=self.msgFilesTooMany.repl("{m}",self.maxFileCount).repl("{n}",total),self.isError=throwError(msg,null,null,null),self.$captionContainer.find(".kv-caption-icon").hide(),self.$caption.html(self.msgValidationError),self.setEllipsis(),void self.$container.removeClass("file-input-new file-input-ajax-new")):(self.isIE9?self.updateFileDetails(1):self.readFiles(tfiles),void self.showFolderError(folders))},autoSizeImage:function(previewId){var w1,w2,$cap,self=this,$preview=self.$preview,$thumb=$preview.find("#"+previewId),$img=$thumb.find("img");$img.length&&$img.on("load",function(){w1=$thumb.width(),w2=$preview.width(),w1>w2&&($img.css("width","100%"),$thumb.css("width","97%")),$cap=$img.closest(".file-preview-frame").find(".file-caption-name"),$cap.length&&($cap.width($img.width()),$cap.attr("title",$cap.text())),self.raise("fileimageloaded",previewId)})},initCaption:function(){var self=this,cap=self.initialCaption||"";return self.overwriteInitial||isEmpty(cap)?(self.$caption.html(""),!1):(self.setCaption(cap),!0)},setCaption:function(content,isError){var title,out,self=this,err=isError||!1;if(err)title=$("<div>"+self.msgValidationError+"</div>").text(),out='<span class="'+self.msgValidationErrorClass+'">'+self.msgValidationErrorIcon+title+"</span>";else{if(isEmpty(content)||0===self.$caption.length)return;title=$("<div>"+content+"</div>").text(),out=self.getLayoutTemplate("icon")+title}self.$caption.html(out),self.$caption.attr("title",title),self.$captionContainer.find(".file-caption-ellipsis").attr("title",title),self.setEllipsis()},initBrowse:function($container){var self=this;self.$btnFile=$container.find(".btn-file"),self.$btnFile.append(self.$element)},createContainer:function(){var self=this,$container=$(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(self.renderMain());return self.$element.before($container),self.initBrowse($container),$container},refreshContainer:function(){var self=this,$container=self.$container;$container.before(self.$element),$container.html(self.renderMain()),self.initBrowse($container)},renderMain:function(){var self=this,dropCss=self.isUploadable&&self.dropZoneEnabled?" file-drop-zone":"",preview=self.showPreview?self.getLayoutTemplate("preview").repl("{class}",self.previewClass).repl("{dropClass}",dropCss):"",css=self.isDisabled?self.captionClass+" file-caption-disabled":self.captionClass,caption=self.captionTemplate.repl("{class}",css+" kv-fileinput-caption");return self.mainTemplate.repl("{class}",self.mainClass).repl("{preview}",preview).repl("{caption}",caption).repl("{upload}",self.renderUpload()).repl("{remove}",self.renderRemove()).repl("{cancel}",self.renderCancel()).repl("{browse}",self.renderBrowse())},renderBrowse:function(){var self=this,css=self.browseClass+" btn-file",status="";return self.isDisabled&&(status=" disabled "),'<div class="'+css+'"'+status+"> "+self.browseIcon+self.browseLabel+" </div>"},renderRemove:function(){var self=this,css=self.removeClass+" fileinput-remove fileinput-remove-button",status="";return self.showRemove?(self.isDisabled&&(status=" disabled "),'<button type="button" title="'+self.removeTitle+'" class="'+css+'"'+status+">"+self.removeIcon+self.removeLabel+"</button>"):""},renderCancel:function(){var self=this,css=self.cancelClass+" fileinput-cancel fileinput-cancel-button";return self.showCancel?'<button type="button" title="'+self.cancelTitle+'" class="hide '+css+'">'+self.cancelIcon+self.cancelLabel+"</button>":""},renderUpload:function(){var self=this,css=self.uploadClass+" kv-fileinput-upload fileinput-upload-button",content="",status="";return self.showUpload?(self.isDisabled&&(status=" disabled "),content=!self.isUploadable||self.isDisabled?'<button type="submit" title="'+self.uploadTitle+'"class="'+css+'"'+status+">"+self.uploadIcon+self.uploadLabel+"</button>":'<a href="'+self.uploadUrl+'" title="'+self.uploadTitle+'" class="'+css+'"'+status+">"+self.uploadIcon+self.uploadLabel+"</a>"):""}},$.fn.fileinput=function(option){if(hasFileAPISupport()||isIE(9)){var args=Array.apply(null,arguments);return args.shift(),this.each(function(){var defaults,$this=$(this),data=$this.data("fileinput"),options="object"==typeof option&&option,lang=options.language||$this.data("language")||"en";data||(defaults=$.extend({},$.fn.fileinput.defaults),"en"===lang||isEmpty($.fn.fileinputLocales[lang])||(defaults=$.extend(defaults,$.fn.fileinputLocales[lang])),data=new FileInput(this,$.extend(defaults,options,$this.data())),$this.data("fileinput",data)),"string"==typeof option&&data[option].apply(data,args)})}},$.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:defaultLayoutTemplates,previewTemplates:defaultPreviewTemplates,allowedPreviewTypes:defaultPreviewTypes,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:defaultPreviewSettings,fileTypeSettings:defaultFileTypeSettings,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},$.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',
msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",dropZoneTitle:"Drag & drop files here &hellip;"},$.extend($.fn.fileinput.defaults,$.fn.fileinputLocales.en),$.fn.fileinput.Constructor=FileInput,$(document).ready(function(){var $input=$("input.file[type=file]");$input.length&&$input.fileinput()})}(window.jQuery),function(factory){"use strict";"object"==typeof exports?module.exports=factory(window.jQuery):"function"==typeof define&&define.amd?define(["jquery"],factory):window.jQuery&&!window.jQuery.fn.colorpicker&&factory(window.jQuery)}(function($){"use strict";var Color=function(val){this.value={h:0,s:0,b:0,a:1},this.origFormat=null,val&&(void 0!==val.toLowerCase?(val+="",this.setColor(val)):void 0!==val.h&&(this.value=val))};Color.prototype={constructor:Color,colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"},_sanitizeNumber:function(val){return"number"==typeof val?val:isNaN(val)||null===val||""===val||void 0===val?1:void 0!==val.toLowerCase?parseFloat(val):1},isTransparent:function(strVal){return strVal?(strVal=strVal.toLowerCase().trim(),"transparent"===strVal||strVal.match(/#?00000000/)||strVal.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/)):!1},rgbaIsTransparent:function(rgba){return 0===rgba.r&&0===rgba.g&&0===rgba.b&&0===rgba.a},setColor:function(strVal){strVal=strVal.toLowerCase().trim(),strVal&&(this.isTransparent(strVal)?this.value={h:0,s:0,b:0,a:0}:this.value=this.stringToHSB(strVal)||{h:0,s:0,b:0,a:1})},stringToHSB:function(strVal){strVal=strVal.toLowerCase();var that=this,result=!1;return $.each(this.stringParsers,function(i,parser){var match=parser.re.exec(strVal),values=match&&parser.parse.apply(that,[match]),format=parser.format||"rgba";return values?(result=format.match(/hsla?/)?that.RGBtoHSB.apply(that,that.HSLtoRGB.apply(that,values)):that.RGBtoHSB.apply(that,values),that.origFormat=format,!1):!0}),result},setHue:function(h){this.value.h=1-h},setSaturation:function(s){this.value.s=s},setBrightness:function(b){this.value.b=1-b},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(h,s,b,a){h||(h=this.value.h,s=this.value.s,b=this.value.b),h*=360;var R,G,B,X,C;return h=h%360/60,C=b*s,X=C*(1-Math.abs(h%2-1)),R=G=B=b-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],{r:Math.round(255*R),g:Math.round(255*G),b:Math.round(255*B),a:a||this.value.a}},toHex:function(h,s,b,a){var rgb=this.toRGB(h,s,b,a);return this.rgbaIsTransparent(rgb)?"transparent":"#"+(1<<24|parseInt(rgb.r)<<16|parseInt(rgb.g)<<8|parseInt(rgb.b)).toString(16).substr(1)},toHSL:function(h,s,b,a){h=h||this.value.h,s=s||this.value.s,b=b||this.value.b,a=a||this.value.a;var H=h,L=(2-s)*b,S=s*b;return S/=L>0&&1>=L?L:2-L,L/=2,S>1&&(S=1),{h:isNaN(H)?0:H,s:isNaN(S)?0:S,l:isNaN(L)?0:L,a:isNaN(a)?0:a}},toAlias:function(r,g,b,a){var rgb=this.toHex(r,g,b,a);for(var alias in this.colors)if(this.colors[alias]===rgb)return alias;return!1},RGBtoHSB:function(r,g,b,a){r/=255,g/=255,b/=255;var H,S,V,C;return V=Math.max(r,g,b),C=V-Math.min(r,g,b),H=0===C?null:V===r?(g-b)/C:V===g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0===C?0:C/V,{h:this._sanitizeNumber(H),s:S,b:V,a:this._sanitizeNumber(a)}},HueToRGB:function(p,q,h){return 0>h?h+=1:h>1&&(h-=1),1>6*h?p+(q-p)*h*6:1>2*h?q:2>3*h?p+(q-p)*(2/3-h)*6:p},HSLtoRGB:function(h,s,l,a){0>s&&(s=0);var q;q=.5>=l?l*(1+s):l+s-l*s;var p=2*l-q,tr=h+1/3,tg=h,tb=h-1/3,r=Math.round(255*this.HueToRGB(p,q,tr)),g=Math.round(255*this.HueToRGB(p,q,tg)),b=Math.round(255*this.HueToRGB(p,q,tb));return[r,g,b,this._sanitizeNumber(a)]},toString:function(format){format=format||"rgba";var c=!1;switch(format){case"rgb":return c=this.toRGB(),this.rgbaIsTransparent(c)?"transparent":"rgb("+c.r+","+c.g+","+c.b+")";case"rgba":return c=this.toRGB(),"rgba("+c.r+","+c.g+","+c.b+","+c.a+")";case"hsl":return c=this.toHSL(),"hsl("+Math.round(360*c.h)+","+Math.round(100*c.s)+"%,"+Math.round(100*c.l)+"%)";case"hsla":return c=this.toHSL(),"hsla("+Math.round(360*c.h)+","+Math.round(100*c.s)+"%,"+Math.round(100*c.l)+"%,"+c.a+")";case"hex":return this.toHex();case"alias":return this.toAlias()||this.toHex();default:return c}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(execResult){return[execResult[1],execResult[2],execResult[3],1]}},{re:/rgb\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]]}},{re:/rgba\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(execResult){return[2.55*execResult[1],2.55*execResult[2],2.55*execResult[3],execResult[4]]}},{re:/hsl\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(execResult){return[execResult[1]/360,execResult[2]/100,execResult[3]/100,execResult[4]]}},{re:/hsla\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(execResult){return[execResult[1]/360,execResult[2]/100,execResult[3]/100,execResult[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16),1]}},{re:/^([a-z]{3,})$/,format:"alias",parse:function(execResult){var hexval=this.colorNameToHex(execResult[0])||"#000000",match=this.stringParsers[6].re.exec(hexval),values=match&&this.stringParsers[6].parse.apply(this,[match]);return values}}],colorNameToHex:function(name){return"undefined"!=typeof this.colors[name.toLowerCase()]?this.colors[name.toLowerCase()]:!1}};var defaults={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>',align:"right",customClass:null},Colorpicker=function(element,options){this.element=$(element).addClass("colorpicker-element"),this.options=$.extend(!0,{},defaults,this.element.data(),options),this.component=this.options.component,this.component=this.component!==!1?this.element.find(this.component):!1,this.component&&0===this.component.length&&(this.component=!1),this.container=this.options.container===!0?this.element:this.options.container,this.container=this.container!==!1?$(this.container):!1,this.input=this.element.is("input")?this.element:this.options.input?this.element.find(this.options.input):!1,this.input&&0===this.input.length&&(this.input=!1),this.color=new Color(this.options.color!==!1?this.options.color:this.getValue()),this.format=this.options.format!==!1?this.options.format:this.color.origFormat,this.picker=$(this.options.template),this.options.customClass&&this.picker.addClass(this.options.customClass),this.options.inline?this.picker.addClass("colorpicker-inline colorpicker-visible"):this.picker.addClass("colorpicker-hidden"),this.options.horizontal&&this.picker.addClass("colorpicker-horizontal"),("rgba"===this.format||"hsla"===this.format||this.options.format===!1)&&this.picker.addClass("colorpicker-with-alpha"),"right"===this.options.align&&this.picker.addClass("colorpicker-right"),this.picker.on("mousedown.colorpicker touchstart.colorpicker",$.proxy(this.mousedown,this)),this.picker.appendTo(this.container?this.container:$("body")),this.input!==!1&&(this.input.on({"keyup.colorpicker":$.proxy(this.keyup,this)}),this.component===!1&&this.element.on({"focus.colorpicker":$.proxy(this.show,this)}),this.options.inline===!1&&this.element.on({"focusout.colorpicker":$.proxy(this.hide,this)})),this.component!==!1&&this.component.on({"click.colorpicker":$.proxy(this.show,this)}),this.input===!1&&this.component===!1&&this.element.on({"click.colorpicker":$.proxy(this.show,this)}),this.input!==!1&&this.component!==!1&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":$.proxy(this.show,this),"focus.colorpicker":$.proxy(this.show,this)}),this.update(),$($.proxy(function(){this.element.trigger("create")},this))};Colorpicker.Color=Color,Colorpicker.prototype={constructor:Colorpicker,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker").off(".colorpicker"),this.input!==!1&&this.input.off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==!1||this.options.container)return!1;var type=this.container&&this.container[0]!==document.body?"position":"offset",element=this.component||this.element,offset=element[type]();"right"===this.options.align&&(offset.left-=this.picker.outerWidth()-element.outerWidth()),this.picker.css({top:offset.top+element.outerHeight(),left:offset.left})},show:function(e){return this.isDisabled()?!1:(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),$(window).on("resize.colorpicker",$.proxy(this.reposition,this)),!e||this.hasInput()&&"color"!==this.input.attr("type")||e.stopPropagation&&e.preventDefault&&(e.stopPropagation(),e.preventDefault()),this.options.inline===!1&&$(window.document).on({"mousedown.colorpicker":$.proxy(this.hide,this)}),void this.element.trigger({type:"showPicker",color:this.color}))},hide:function(){this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),$(window).off("resize.colorpicker",this.reposition),$(document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(val){return val=val||this.color.toString(this.format),this.element.data("color",val),val},updateInput:function(val){return val=val||this.color.toString(this.format),this.input!==!1&&this.input.prop("value",val),val},updatePicker:function(val){void 0!==val&&(this.color=new Color(val));var sl=this.options.horizontal===!1?this.options.sliders:this.options.slidersHorz,icns=this.picker.find("i");return 0!==icns.length?(this.options.horizontal===!1?(sl=this.options.sliders,icns.eq(1).css("top",sl.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",sl.alpha.maxTop*(1-this.color.value.a))):(sl=this.options.slidersHorz,icns.eq(1).css("left",sl.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",sl.alpha.maxLeft*(1-this.color.value.a))),icns.eq(0).css({top:sl.saturation.maxTop-this.color.value.b*sl.saturation.maxTop,left:this.color.value.s*sl.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex()),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format)),val):void 0},updateComponent:function(val){if(val=val||this.color.toString(this.format),this.component!==!1){var icn=this.component.find("i").eq(0);icn.length>0?icn.css({backgroundColor:val}):this.component.css({backgroundColor:val})}return val},update:function(force){var val;return(this.getValue(!1)!==!1||force===!0)&&(val=this.updateComponent(),this.updateInput(val),this.updateData(val),this.updatePicker()),val},setValue:function(val){this.color=new Color(val),this.update(),this.element.trigger({type:"changeColor",color:this.color,value:val})},getValue:function(defaultValue){defaultValue=void 0===defaultValue?"#000000":defaultValue;var val;return val=this.hasInput()?this.input.val():this.element.data("color"),(void 0===val||""===val||null===val)&&(val=defaultValue),val},hasInput:function(){return this.input!==!1},isDisabled:function(){return this.hasInput()?this.input.prop("disabled")===!0:!1},disable:function(){return this.hasInput()?(this.input.prop("disabled",!0),this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0):!1},enable:function(){return this.hasInput()?(this.input.prop("disabled",!1),this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0):!1},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(e){e.pageX||e.pageY||!e.originalEvent||(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var target=$(e.target),zone=target.closest("div"),sl=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!zone.is(".colorpicker")){if(zone.is(".colorpicker-saturation"))this.currentSlider=$.extend({},sl.saturation);else if(zone.is(".colorpicker-hue"))this.currentSlider=$.extend({},sl.hue);else{if(!zone.is(".colorpicker-alpha"))return!1;this.currentSlider=$.extend({},sl.alpha)}var offset=zone.offset();this.currentSlider.guide=zone.find("i")[0].style,this.currentSlider.left=e.pageX-offset.left,this.currentSlider.top=e.pageY-offset.top,this.mousePointer={left:e.pageX,top:e.pageY},$(document).on({"mousemove.colorpicker":$.proxy(this.mousemove,this),"touchmove.colorpicker":$.proxy(this.mousemove,this),"mouseup.colorpicker":$.proxy(this.mouseup,this),"touchend.colorpicker":$.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){e.pageX||e.pageY||!e.originalEvent||(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var left=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((e.pageX||this.mousePointer.left)-this.mousePointer.left))),top=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((e.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=left+"px",this.currentSlider.guide.top=top+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,left/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,top/this.currentSlider.maxTop),"setAlpha"===this.currentSlider.callTop&&this.options.format===!1&&(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(e){return e.stopPropagation(),e.preventDefault(),$(document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},keyup:function(e){38===e.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===e.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=new Color(this.input.val()),this.color.origFormat&&this.options.format===!1&&(this.format=this.color.origFormat),this.getValue(!1)!==!1&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},$.colorpicker=Colorpicker,$.fn.colorpicker=function(option){var rv,pickerArgs=arguments,$returnValue=this.each(function(){var $this=$(this),inst=$this.data("colorpicker"),options="object"==typeof option?option:{};inst||"string"==typeof option?"string"==typeof option&&(rv=inst[option].apply(inst,Array.prototype.slice.call(pickerArgs,1))):$this.data("colorpicker",new Colorpicker(this,options))});return"getValue"===option?rv:$returnValue},$.fn.colorpicker.constructor=Colorpicker}),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){function isDuplicateNotification(notification){var isDupe=!1;return $('[data-notify="container"]').each(function(i,el){var $el=$(el),title=$el.find('[data-notify="title"]').text().trim(),message=$el.find('[data-notify="message"]').html().trim(),isSameTitle=title===$("<div>"+notification.settings.content.title+"</div>").html().trim(),isSameMsg=message===$("<div>"+notification.settings.content.message+"</div>").html().trim(),isSameType=$el.hasClass("alert-"+notification.settings.type);return isSameTitle&&isSameMsg&&isSameType&&(isDupe=!0),!isDupe}),isDupe}function Notify(element,content,options){var contentObj={content:{message:"object"==typeof content?content.message:content,title:content.title?content.title:"",icon:content.icon?content.icon:"",url:content.url?content.url:"#",target:content.target?content.target:"-"}};options=$.extend(!0,{},contentObj,options),this.settings=$.extend(!0,{},defaults,options),this._defaults=defaults,"-"===this.settings.content.target&&(this.settings.content.target=this.settings.url_target),this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"},"number"==typeof this.settings.offset&&(this.settings.offset={x:this.settings.offset,y:this.settings.offset}),(this.settings.allow_duplicates||!this.settings.allow_duplicates&&!isDuplicateNotification(this))&&this.init()}var defaults={element:"body",position:null,type:"info",allow_dismiss:!0,allow_duplicates:!0,newest_on_top:!1,showProgressbar:!1,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){for(var str=arguments[0],i=1;i<arguments.length;i++)str=str.replace(RegExp("\\{"+(i-1)+"\\}","gm"),arguments[i]);return str},$.extend(Notify.prototype,{init:function(){var self=this;this.buildNotify(),this.settings.content.icon&&this.setIcon(),"#"!=this.settings.content.url&&this.styleURL(),this.styleDismiss(),this.placement(),this.bind(),this.notify={$ele:this.$ele,update:function(command,update){var commands={};"string"==typeof command?commands[command]=update:commands=command;for(var cmd in commands)switch(cmd){case"type":this.$ele.removeClass("alert-"+self.settings.type),this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+self.settings.type),self.settings.type=commands[cmd],this.$ele.addClass("alert-"+commands[cmd]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+commands[cmd]);break;case"icon":var $icon=this.$ele.find('[data-notify="icon"]');"class"===self.settings.icon_type.toLowerCase()?$icon.removeClass(self.settings.content.icon).addClass(commands[cmd]):($icon.is("img")||$icon.find("img"),$icon.attr("src",commands[cmd]));break;case"progress":var newDelay=self.settings.delay-self.settings.delay*(commands[cmd]/100);this.$ele.data("notify-delay",newDelay),this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",commands[cmd]).css("width",commands[cmd]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",commands[cmd]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",commands[cmd]);break;default:this.$ele.find('[data-notify="'+cmd+'"]').html(commands[cmd])}var posX=this.$ele.outerHeight()+parseInt(self.settings.spacing)+parseInt(self.settings.offset.y);self.reposition(posX)},close:function(){self.close()}}},buildNotify:function(){var content=this.settings.content;this.$ele=$(String.format(this.settings.template,this.settings.type,content.title,content.message,content.url,content.target)),this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align),this.settings.allow_dismiss||this.$ele.find('[data-notify="dismiss"]').css("display","none"),(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar)&&this.$ele.find('[data-notify="progressbar"]').remove()},setIcon:function(){"class"===this.settings.icon_type.toLowerCase()?this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon):this.$ele.find('[data-notify="icon"]').is("img")?this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon):this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')},styleDismiss:function(){this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:0,position:"absolute",top:0,width:"100%",zIndex:this.settings.z_index+1})},placement:function(){var self=this,offsetAmt=this.settings.offset.y,css={display:"inline-block",margin:"0px auto",position:this.settings.position?this.settings.position:"body"===this.settings.element?"fixed":"absolute",transition:"all .5s ease-in-out",zIndex:this.settings.z_index},hasAnimation=!1,settings=this.settings;switch($('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){offsetAmt=Math.max(offsetAmt,parseInt($(this).css(settings.placement.from))+parseInt($(this).outerHeight())+parseInt(settings.spacing))}),this.settings.newest_on_top===!0&&(offsetAmt=this.settings.offset.y),css[this.settings.placement.from]=offsetAmt+"px",this.settings.placement.align){case"left":case"right":css[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":css.left=0,css.right=0}this.$ele.css(css).addClass(this.settings.animate.enter),$.each(Array("webkit-","moz-","o-","ms-",""),function(index,prefix){self.$ele[0].style[prefix+"AnimationIterationCount"]=1}),$(this.settings.element).append(this.$ele),this.settings.newest_on_top===!0&&(offsetAmt=parseInt(offsetAmt)+parseInt(this.settings.spacing)+this.$ele.outerHeight(),this.reposition(offsetAmt)),$.isFunction(self.settings.onShow)&&self.settings.onShow.call(this.$ele),this.$ele.one(this.animations.start,function(){hasAnimation=!0}).one(this.animations.end,function(){$.isFunction(self.settings.onShown)&&self.settings.onShown.call(this)}),setTimeout(function(){hasAnimation||$.isFunction(self.settings.onShown)&&self.settings.onShown.call(this)},600)},bind:function(){var self=this;if(this.$ele.find('[data-notify="dismiss"]').on("click",function(){self.close()}),this.$ele.mouseover(function(){$(this).data("data-hover","true")}).mouseout(function(){$(this).data("data-hover","false")}),this.$ele.data("data-hover","false"),this.settings.delay>0){self.$ele.data("notify-delay",self.settings.delay);var timer=setInterval(function(){var delay=parseInt(self.$ele.data("notify-delay"))-self.settings.timer;if("false"===self.$ele.data("data-hover")&&"pause"===self.settings.mouse_over||"pause"!=self.settings.mouse_over){var percent=(self.settings.delay-delay)/self.settings.delay*100;self.$ele.data("notify-delay",delay),self.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",percent).css("width",percent+"%")}delay<=-self.settings.timer&&(clearInterval(timer),self.close())},self.settings.timer)}},close:function(){var self=this,posX=parseInt(this.$ele.css(this.settings.placement.from)),hasAnimation=!1;this.$ele.attr("data-closing","true").addClass(this.settings.animate.exit),self.reposition(posX),$.isFunction(self.settings.onClose)&&self.settings.onClose.call(this.$ele),this.$ele.one(this.animations.start,function(){hasAnimation=!0}).one(this.animations.end,function(){$(this).remove(),$.isFunction(self.settings.onClosed)&&self.settings.onClosed.call(this)}),setTimeout(function(){hasAnimation||(self.$ele.remove(),self.settings.onClosed&&self.settings.onClosed(self.$ele))},600)},reposition:function(posX){var self=this,notifies='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',$elements=this.$ele.nextAll(notifies);this.settings.newest_on_top===!0&&($elements=this.$ele.prevAll(notifies)),$elements.each(function(){$(this).css(self.settings.placement.from,posX),posX=parseInt(posX)+parseInt(self.settings.spacing)+$(this).outerHeight()})}}),$.notify=function(content,options){var plugin=new Notify(this,content,options);return plugin.notify},$.notifyDefaults=function(options){return defaults=$.extend(!0,{},defaults,options)},$.notifyClose=function(command){"undefined"==typeof command||"all"===command?$("[data-notify]").find('[data-notify="dismiss"]').trigger("click"):$('[data-notify-position="'+command+'"]').find('[data-notify="dismiss"]').trigger("click")}}),!function($){"use strict";function targetIsSelf(callback){return function(e){return e&&this===e.target?callback.apply(this,arguments):void 0}}var ModalManager=function(element,options){this.init(element,options)};ModalManager.prototype={constructor:ModalManager,init:function(element,options){if(this.$element=$(element),this.options=$.extend({},$.fn.modalmanager.defaults,this.$element.data(),"object"==typeof options&&options),this.stack=[],this.backdropCount=0,this.options.resize){var resizeTimeout,that=this;$(window).on("resize.modal",function(){resizeTimeout&&clearTimeout(resizeTimeout),resizeTimeout=setTimeout(function(){for(var i=0;i<that.stack.length;i++)that.stack[i].isShown&&that.stack[i].layout()},10)})}},createModal:function(element,options){$(element).modal($.extend({manager:this},options))},appendModal:function(modal){this.stack.push(modal);var that=this;modal.$element.on("show.modalmanager",targetIsSelf(function(e){var showModal=function(){modal.isShown=!0;var transition=$.support.transition&&modal.$element.hasClass("fade");that.$element.toggleClass("modal-open",that.hasOpenModal()).toggleClass("page-overflow",$(window).height()<that.$element.height()),modal.$parent=modal.$element.parent(),modal.$container=that.createContainer(modal),modal.$element.appendTo(modal.$container),that.backdrop(modal,function(){modal.$element.show(),transition&&modal.$element[0].offsetWidth,modal.layout(),modal.$element.addClass("in").attr("aria-hidden",!1);var complete=function(){that.setFocus(),modal.$element.trigger("shown")};transition?modal.$element.one($.support.transition.end,complete):complete()})};modal.options.replace?that.replace(showModal):showModal()})),modal.$element.on("hidden.modalmanager",targetIsSelf(function(e){if(that.backdrop(modal),modal.$element.parent().length)if(modal.$backdrop){var transition=$.support.transition&&modal.$element.hasClass("fade");transition&&modal.$element[0].offsetWidth,$.support.transition&&modal.$element.hasClass("fade")?modal.$backdrop.one($.support.transition.end,function(){modal.destroy()}):modal.destroy()}else modal.destroy();else that.destroyModal(modal)})),modal.$element.on("destroyed.modalmanager",targetIsSelf(function(e){that.destroyModal(modal)}))},getOpenModals:function(){for(var openModals=[],i=0;i<this.stack.length;i++)this.stack[i].isShown&&openModals.push(this.stack[i]);return openModals},hasOpenModal:function(){return this.getOpenModals().length>0},setFocus:function(){for(var topModal,i=0;i<this.stack.length;i++)this.stack[i].isShown&&(topModal=this.stack[i]);topModal&&topModal.focus()},destroyModal:function(modal){modal.$element.off(".modalmanager"),modal.$backdrop&&this.removeBackdrop(modal),this.stack.splice(this.getIndexOfModal(modal),1);var hasOpenModal=this.hasOpenModal();this.$element.toggleClass("modal-open",hasOpenModal),hasOpenModal||this.$element.removeClass("page-overflow"),this.removeContainer(modal),
this.setFocus()},getModalAt:function(index){return this.stack[index]},getIndexOfModal:function(modal){for(var i=0;i<this.stack.length;i++)if(modal===this.stack[i])return i},replace:function(callback){for(var topModal,i=0;i<this.stack.length;i++)this.stack[i].isShown&&(topModal=this.stack[i]);topModal?(this.$backdropHandle=topModal.$backdrop,topModal.$backdrop=null,callback&&topModal.$element.one("hidden",targetIsSelf($.proxy(callback,this))),topModal.hide()):callback&&callback()},removeBackdrop:function(modal){modal.$backdrop.remove(),modal.$backdrop=null},createBackdrop:function(animate,tmpl){var $backdrop;return this.$backdropHandle?($backdrop=this.$backdropHandle,$backdrop.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):$backdrop=$(tmpl).addClass(animate).appendTo(this.$element),$backdrop},removeContainer:function(modal){modal.$container.remove(),modal.$container=null},createContainer:function(modal){var $container;return $container=$('<div class="modal-scrollable">').css("z-index",getzIndex("modal",this.getOpenModals().length)).appendTo(this.$element),modal&&"static"!=modal.options.backdrop?$container.on("click.modal",targetIsSelf(function(e){modal.hide()})):modal&&$container.on("click.modal",targetIsSelf(function(e){modal.attention()})),$container},backdrop:function(modal,callback){var animate=modal.$element.hasClass("fade")?"fade":"",showBackdrop=modal.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(modal.isShown&&showBackdrop){var doAnimate=$.support.transition&&animate&&!this.$backdropHandle;modal.$backdrop=this.createBackdrop(animate,modal.options.backdropTemplate),modal.$backdrop.css("z-index",getzIndex("backdrop",this.getOpenModals().length)),doAnimate&&modal.$backdrop[0].offsetWidth,modal.$backdrop.addClass("in"),this.backdropCount+=1,doAnimate?modal.$backdrop.one($.support.transition.end,callback):callback()}else if(!modal.isShown&&modal.$backdrop){modal.$backdrop.removeClass("in"),this.backdropCount-=1;var that=this;$.support.transition&&modal.$element.hasClass("fade")?modal.$backdrop.one($.support.transition.end,function(){that.removeBackdrop(modal)}):that.removeBackdrop(modal)}else callback&&callback()},removeSpinner:function(){this.$spinner&&this.$spinner.remove(),this.$spinner=null,this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove(),this.$backdropHandle=null,this.removeSpinner()},loading:function(callback){if(callback=callback||function(){},this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",$(window).height()<this.$element.height()),this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var that=this;$.support.transition?this.$backdropHandle.one($.support.transition.end,function(){that.removeLoading()}):that.removeLoading()}else callback&&callback(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate),this.$backdropHandle[0].offsetWidth;var openModals=this.getOpenModals();this.$backdropHandle.css("z-index",getzIndex("backdrop",openModals.length+1)).addClass("in");var $spinner=$(this.options.spinner).css("z-index",getzIndex("modal",openModals.length+1)).appendTo(this.$element).addClass("in");this.$spinner=$(this.createContainer()).append($spinner).on("click.modalmanager",$.proxy(this.loading,this)),this.isLoading=!0,$.support.transition?this.$backdropHandle.one($.support.transition.end,callback):callback()}}};var getzIndex=function(){var zIndexFactor,baseIndex={};return function(type,pos){if("undefined"==typeof zIndexFactor){var $baseModal=$('<div class="modal hide" />').appendTo("body"),$baseBackdrop=$('<div class="modal-backdrop hide" />').appendTo("body");baseIndex.modal=+$baseModal.css("z-index"),baseIndex.backdrop=+$baseBackdrop.css("z-index"),zIndexFactor=baseIndex.modal-baseIndex.backdrop,$baseModal.remove(),$baseBackdrop.remove(),$baseBackdrop=$baseModal=null}return baseIndex[type]+zIndexFactor*pos}}();$.fn.modalmanager=function(option,args){return this.each(function(){var $this=$(this),data=$this.data("modalmanager");data||$this.data("modalmanager",data=new ModalManager(this,option)),"string"==typeof option&&data[option].apply(data,[].concat(args))})},$.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'},$.fn.modalmanager.Constructor=ModalManager,$(function(){$(document).off("show.bs.modal").off("hidden.bs.modal")})}(jQuery),!function($){"use strict";var Modal=function(element,options){this.init(element,options)};Modal.prototype={constructor:Modal,init:function(element,options){var that=this;this.options=options,this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote,function(){var e=$.Event("loaded");that.$element.trigger(e)});var manager="function"==typeof this.options.manager?this.options.manager.call(this):this.options.manager;manager=manager.appendModal?manager:$(manager).modalmanager().data("modalmanager"),manager.appendModal(this)},toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var e=$.Event("show");this.isShown||(this.$element.trigger(e),e.isDefaultPrevented()||(this.escape(),this.tab(),this.options.loading&&this.loading()))},hide:function(e){e&&e.preventDefault(),e=$.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.tab(),this.isLoading&&this.loading(),$(document).off("focusin.modal"),this.$element.removeClass("in").removeClass("animated").removeClass(this.options.attentionAnimation).removeClass("modal-overflow").attr("aria-hidden",!0),$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},layout:function(){var prop=this.options.height?"height":"max-height",value=this.options.height||this.options.maxHeight;if(this.options.width){this.$element.css("width",this.options.width);var that=this;this.$element.css("margin-left",function(){return/%/gi.test(that.options.width)?-(parseInt(that.options.width)/2)+"%":-($(this).width()/2)+"px"})}else this.$element.css("width",""),this.$element.css("margin-left","");this.$element.find(".modal-body").css("overflow","").css(prop,""),value&&this.$element.find(".modal-body").css("overflow","auto").css(prop,value);var modalOverflow=$(window).height()-10<this.$element.height();modalOverflow||this.options.modalOverflow?this.$element.css("margin-top",0).addClass("modal-overflow"):this.$element.css("margin-top",0-this.$element.height()/2).removeClass("modal-overflow")},tab:function(){var that=this;this.isShown&&this.options.consumeTab?this.$element.on("keydown.tabindex.modal","[data-tabindex]",function(e){if(e.keyCode&&9==e.keyCode){var elements=[],tabindex=Number($(this).data("tabindex"));that.$element.find("[data-tabindex]:enabled:visible:not([readonly])").each(function(ev){elements.push(Number($(this).data("tabindex")))}),elements.sort(function(a,b){return a-b});var arrayPos=$.inArray(tabindex,elements);e.shiftKey?0==arrayPos?that.$element.find("[data-tabindex="+elements[elements.length-1]+"]").focus():that.$element.find("[data-tabindex="+elements[arrayPos-1]+"]").focus():arrayPos<elements.length-1?that.$element.find("[data-tabindex="+elements[arrayPos+1]+"]").focus():that.$element.find("[data-tabindex="+elements[0]+"]").focus(),e.preventDefault()}}):this.isShown||this.$element.off("keydown.tabindex.modal")},escape:function(){var that=this;this.isShown&&this.options.keyboard?(this.$element.attr("tabindex")||this.$element.attr("tabindex",-1),this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&that.hide()})):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end),that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout),that.hideModal()})},hideModal:function(){var prop=this.options.height?"height":"max-height",value=this.options.height||this.options.maxHeight;value&&this.$element.find(".modal-body").css("overflow","").css(prop,""),this.$element.hide().trigger("hidden")},removeLoading:function(){this.$loading.remove(),this.$loading=null,this.isLoading=!1},loading:function(callback){callback=callback||function(){};var animate=this.$element.hasClass("fade")?"fade":"";if(this.isLoading)if(this.isLoading&&this.$loading){this.$loading.removeClass("in");var that=this;$.support.transition&&this.$element.hasClass("fade")?this.$loading.one($.support.transition.end,function(){that.removeLoading()}):that.removeLoading()}else callback&&callback(this.isLoading);else{var doAnimate=$.support.transition&&animate;this.$loading=$('<div class="loading-mask '+animate+'">').append(this.options.spinner).appendTo(this.$element),doAnimate&&this.$loading[0].offsetWidth,this.$loading.addClass("in"),this.isLoading=!0,doAnimate?this.$loading.one($.support.transition.end,callback):callback()}},focus:function(){var $focusElem=this.$element.find(this.options.focusOn);$focusElem=$focusElem.length?$focusElem:this.$element,$focusElem.focus()},attention:function(){if(this.options.attentionAnimation){this.$element.removeClass("animated").removeClass(this.options.attentionAnimation);var that=this;setTimeout(function(){that.$element.addClass("animated").addClass(that.options.attentionAnimation)},0)}this.focus()},destroy:function(){var e=$.Event("destroy");this.$element.trigger(e),e.isDefaultPrevented()||(this.$element.off(".modal").removeData("modal").removeClass("in").attr("aria-hidden",!0),this.$parent!==this.$element.parent()?this.$element.appendTo(this.$parent):this.$parent.length||(this.$element.remove(),this.$element=null),this.$element.trigger("destroyed"))}},$.fn.modal=function(option,args){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new Modal(this,options)),"string"==typeof option?data[option].apply(data,[].concat(args)):options.show&&data.show()})},$.fn.modal.defaults={keyboard:!0,backdrop:!0,loading:!1,show:!0,width:null,height:null,maxHeight:null,modalOverflow:!1,consumeTab:!0,focusOn:null,replace:!1,resize:!1,attentionAnimation:"shake",manager:"body",spinner:'<div class="loading-spinner" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'},$.fn.modal.Constructor=Modal,$(function(){$(document).off("click.modal").on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault(),$target.modal(option).one("hide",function(){$this.focus()})})})}(window.jQuery),!function($,window,pluginName,undefined){function d(a,b){var x=Math.max(0,a[0]-b[0],b[0]-a[1]),y=Math.max(0,a[2]-b[1],b[1]-a[3]);return x+y}function setDimensions(array,dimensions,tolerance,useOffset){var i=array.length,offsetMethod=useOffset?"offset":"position";for(tolerance=tolerance||0;i--;){var el=array[i].el?array[i].el:$(array[i]),pos=el[offsetMethod]();pos.left+=parseInt(el.css("margin-left"),10),pos.top+=parseInt(el.css("margin-top"),10),dimensions[i]=[pos.left-tolerance,pos.left+el.outerWidth()+tolerance,pos.top-tolerance,pos.top+el.outerHeight()+tolerance]}}function getRelativePosition(pointer,element){var offset=element.offset();return{left:pointer.left-offset.left,top:pointer.top-offset.top}}function sortByDistanceDesc(dimensions,pointer,lastPointer){pointer=[pointer.left,pointer.top],lastPointer=lastPointer&&[lastPointer.left,lastPointer.top];for(var dim,i=dimensions.length,distances=[];i--;)dim=dimensions[i],distances[i]=[i,d(dim,pointer),lastPointer&&d(dim,lastPointer)];return distances=distances.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function ContainerGroup(options){this.options=$.extend({},groupDefaults,options),this.containers=[],this.options.rootGroup||(this.scrollProxy=$.proxy(this.scroll,this),this.dragProxy=$.proxy(this.drag,this),this.dropProxy=$.proxy(this.drop,this),this.placeholder=$(this.options.placeholder),options.isValidTarget||(this.options.isValidTarget=undefined))}function Container(element,options){this.el=element,this.options=$.extend({},containerDefaults,options),this.group=ContainerGroup.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var itemPath=this.rootGroup.options.itemPath;this.target=itemPath?this.el.find(itemPath):this.el,this.target.on(eventNames.start,this.handle,$.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var containerDefaults={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},groupDefaults={afterMove:function($placeholder,container,$closestItemOrContainer){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function($item,container){return!0},onCancel:function($item,container,_super,event){},onDrag:function($item,position,_super,event){$item.css(position)},onDragStart:function($item,container,_super,event){$item.css({height:$item.outerHeight(),width:$item.outerWidth()}),$item.addClass(container.group.options.draggedClass),$("body").addClass(container.group.options.bodyClass)},onDrop:function($item,container,_super,event){$item.removeClass(container.group.options.draggedClass).removeAttr("style"),$("body").removeClass(container.group.options.bodyClass)},onMousedown:function($item,_super,event){return event.target.nodeName.match(/^(input|select|textarea)$/i)?void 0:(event.preventDefault(),!0)},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function($parent,$children,parentIsContainer){var result=$.extend({},$parent.data());return parentIsContainer?[$children]:($children[0]&&(result.children=$children),delete result.subContainers,delete result.sortable,result)},tolerance:0},containerGroups={},groupCounter=0,emptyBox={left:0,top:0,bottom:0,right:0},eventNames={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},subContainerKey="subContainers";ContainerGroup.get=function(options){return containerGroups[options.group]||(options.group===undefined&&(options.group=groupCounter++),containerGroups[options.group]=new ContainerGroup(options)),containerGroups[options.group]},ContainerGroup.prototype={dragInit:function(e,itemContainer){this.$document=$(itemContainer.el[0].ownerDocument);var closestItem=$(e.target).closest(this.options.itemSelector);if(closestItem.length){if(this.item=closestItem,this.itemContainer=itemContainer,this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,groupDefaults.onMousedown,e))return;this.setPointer(e),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0}},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,groupDefaults.onDragStart,e),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(e),this.options.onDrag(this.item,getRelativePosition(this.pointer,this.item.offsetParent()),groupDefaults.onDrag,e);var p=this.getPointer(e),box=this.sameResultBox,t=this.options.tolerance;(!box||box.top-t>p.top||box.bottom+t<p.top||box.left-t>p.left||box.right+t<p.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=undefined))},drop:function(e){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,groupDefaults.onCancel,e),this.options.onDrop(this.item,this.getContainer(this.item),groupDefaults.onDrop,e),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=undefined,this.dragging=!1)},searchValidTarget:function(pointer,lastPointer){pointer||(pointer=this.relativePointer||this.pointer,lastPointer=this.lastRelativePointer||this.lastPointer);for(var distances=sortByDistanceDesc(this.getContainerDimensions(),pointer,lastPointer),i=distances.length;i--;){var index=distances[i][0],distance=distances[i][1];if(!distance||this.options.pullPlaceholder){var container=this.containers[index];if(!container.disabled){if(!this.$getOffsetParent()){var offsetParent=container.getItemOffsetParent();pointer=getRelativePosition(pointer,offsetParent),lastPointer=getRelativePosition(lastPointer,offsetParent)}if(container.searchValidTarget(pointer,lastPointer))return!0}}}this.sameResultBox&&(this.sameResultBox=undefined)},movePlaceholder:function(container,item,method,sameResultBox){var lastAppendedItem=this.lastAppendedItem;(sameResultBox||!lastAppendedItem||lastAppendedItem[0]!==item[0])&&(item[method](this.placeholder),this.lastAppendedItem=item,this.sameResultBox=sameResultBox,this.options.afterMove(this.placeholder,container,item))},getContainerDimensions:function(){return this.containerDimensions||setDimensions(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(element){return element.closest(this.options.containerSelector).data(pluginName)},$getOffsetParent:function(){if(this.offsetParent===undefined){var i=this.containers.length-1,offsetParent=this.containers[i].getItemOffsetParent();if(!this.options.rootGroup)for(;i--;)if(offsetParent[0]!=this.containers[i].getItemOffsetParent()[0]){offsetParent=!1;break}this.offsetParent=offsetParent}return this.offsetParent},setPointer:function(e){var pointer=this.getPointer(e);if(this.$getOffsetParent()){var relativePointer=getRelativePosition(pointer,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=relativePointer}this.lastPointer=this.pointer,this.pointer=pointer},distanceMet:function(e){var currentPointer=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-currentPointer.left),Math.abs(this.pointer.top-currentPointer.top))>=this.options.distance},getPointer:function(e){var o=e.originalEvent||e.originalEvent.touches&&e.originalEvent.touches[0];return{left:e.pageX||o.pageX,top:e.pageY||o.pageY}},setupDelayTimer:function(){var that=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){that.delayMet=!0},this.options.delay))},scroll:function(e){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(method){var that=this,events=["drag","drop","scroll"];$.each(events,function(i,event){that.$document[method](eventNames[event],that[event+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=undefined},clearDimensions:function(){this.traverse(function(object){object._clearDimensions()})},traverse:function(callback){callback(this);for(var i=this.containers.length;i--;)this.containers[i].traverse(callback)},_clearDimensions:function(){this.containerDimensions=undefined},_destroy:function(){containerGroups[this.options.group]=undefined}},Container.prototype={dragInit:function(e){var rootGroup=this.rootGroup;!this.disabled&&!rootGroup.dragInitDone&&this.options.drag&&this.isValidDrag(e)&&rootGroup.dragInit(e,this)},isValidDrag:function(e){return 1==e.which||"touchstart"==e.type&&1==e.originalEvent.touches.length},searchValidTarget:function(pointer,lastPointer){var distances=sortByDistanceDesc(this.getItemDimensions(),pointer,lastPointer),i=distances.length,rootGroup=this.rootGroup,validTarget=!rootGroup.options.isValidTarget||rootGroup.options.isValidTarget(rootGroup.item,this);if(!i&&validTarget)return rootGroup.movePlaceholder(this,this.target,"append"),!0;for(;i--;){var index=distances[i][0],distance=distances[i][1];if(!distance&&this.hasChildGroup(index)){var found=this.getContainerGroup(index).searchValidTarget(pointer,lastPointer);if(found)return!0}else if(validTarget)return this.movePlaceholder(index,pointer),!0}},movePlaceholder:function(index,pointer){var item=$(this.items[index]),dim=this.itemDimensions[index],method="after",width=item.outerWidth(),height=item.outerHeight(),offset=item.offset(),sameResultBox={left:offset.left,right:offset.left+width,top:offset.top,bottom:offset.top+height};if(this.options.vertical){var yCenter=(dim[2]+dim[3])/2,inUpperHalf=pointer.top<=yCenter;inUpperHalf?(method="before",sameResultBox.bottom-=height/2):sameResultBox.top+=height/2}else{var xCenter=(dim[0]+dim[1])/2,inLeftHalf=pointer.left<=xCenter;inLeftHalf?(method="before",sameResultBox.right-=width/2):sameResultBox.left+=width/2}this.hasChildGroup(index)&&(sameResultBox=emptyBox),this.rootGroup.movePlaceholder(this,item,method,sameResultBox)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),setDimensions(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var offsetParent,el=this.el;return offsetParent="relative"===el.css("position")||"absolute"===el.css("position")||"fixed"===el.css("position")?el:el.offsetParent()},hasChildGroup:function(index){return this.options.nested&&this.getContainerGroup(index)},getContainerGroup:function(index){var childGroup=$.data(this.items[index],subContainerKey);if(childGroup===undefined){var childContainers=this.$getChildren(this.items[index],"container");if(childGroup=!1,childContainers[0]){var options=$.extend({},this.options,{rootGroup:this.rootGroup,group:groupCounter++});childGroup=childContainers[pluginName](options).data(pluginName).group}$.data(this.items[index],subContainerKey,childGroup)}return childGroup},$getChildren:function(parent,type){var options=this.rootGroup.options,path=options[type+"Path"],selector=options[type+"Selector"];return parent=$(parent),path&&(parent=parent.find(path)),parent.children(selector)},_serialize:function(parent,isContainer){var that=this,childType=isContainer?"item":"container",children=this.$getChildren(parent,childType).not(this.options.exclude).map(function(){return that._serialize($(this),!isContainer)}).get();return this.rootGroup.options.serialize(parent,children,isContainer)},traverse:function(callback){$.each(this.items||[],function(item){var group=$.data(this,subContainerKey);group&&group.traverse(callback)}),callback(this)},_clearDimensions:function(){this.itemDimensions=undefined},_destroy:function(){var that=this;this.target.off(eventNames.start,this.handle),this.el.removeData(pluginName),this.options.drop&&(this.group.containers=$.grep(this.group.containers,function(val){return val!=that})),$.each(this.items||[],function(){$.removeData(this,subContainerKey)})}};var API={enable:function(){this.traverse(function(object){object.disabled=!1})},disable:function(){this.traverse(function(object){object.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(object){object._clearDimensions()})},destroy:function(){this.traverse(function(object){object._destroy()})}};$.extend(Container.prototype,API),$.fn[pluginName]=function(methodOrOptions){var args=Array.prototype.slice.call(arguments,1);return this.map(function(){var $t=$(this),object=$t.data(pluginName);return object&&API[methodOrOptions]?API[methodOrOptions].apply(object,args)||this:(object||methodOrOptions!==undefined&&"object"!=typeof methodOrOptions||$t.data(pluginName,new Container($t,methodOrOptions)),this)})}}(jQuery,window,"sortable"),function(main){"use strict";function monthUpdate(arrName){return function(d,v){var index=fecha.i18n[arrName].indexOf(v.charAt(0).toUpperCase()+v.substr(1).toLowerCase());~index&&(d.month=index)}}function pad(val,len){for(val=String(val),len=len||2;val.length<len;)val="0"+val;return val}function shorten(arr,newArr,sLen){for(var i=0,len=arr.length;len>i;i++)newArr.push(arr[i].substr(0,sLen))}function DoFn(D){return D+["th","st","nd","rd"][D%10>3?0:(D-D%10!==10)*D%10]}var fecha={},token=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],amPm=["am","pm"],twoDigits=/\d\d?/,threeDigits=/\d{3}/,fourDigits=/\d{4}/,word=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,noop=function(){},dayNamesShort=[],monthNamesShort=[],parseFlags={D:[twoDigits,function(d,v){d.day=v}],M:[twoDigits,function(d,v){d.month=v-1}],YY:[twoDigits,function(d,v){var da=new Date,cent=+(""+da.getFullYear()).substr(0,2);d.year=""+(v>68?cent-1:cent)+v}],h:[twoDigits,function(d,v){d.hour=v}],m:[twoDigits,function(d,v){d.minute=v}],s:[twoDigits,function(d,v){d.second=v}],YYYY:[fourDigits,function(d,v){d.year=v}],S:[/\d/,function(d,v){d.millisecond=100*v}],SS:[/\d{2}/,function(d,v){d.millisecond=10*v}],SSS:[threeDigits,function(d,v){d.millisecond=v}],d:[twoDigits,noop],ddd:[word,noop],MMM:[word,monthUpdate("monthNamesShort")],MMMM:[word,monthUpdate("monthNames")],a:[word,function(d,v){amPm.indexOf(v.toLowerCase())&&(d.isPm=!0)}],ZZ:[/[\+\-]\d\d:?\d\d/,function(d,v){var minutes,parts=(v+"").match(/([\+\-]|\d\d)/gi);parts&&(minutes=+(60*parts[1])+parseInt(parts[2],10),d.timezoneOffset="+"===parts[0]?minutes:-minutes)}]};parseFlags.dd=parseFlags.d,parseFlags.dddd=parseFlags.ddd,parseFlags.Do=parseFlags.DD=parseFlags.D,parseFlags.mm=parseFlags.m,parseFlags.hh=parseFlags.H=parseFlags.HH=parseFlags.h,parseFlags.MM=parseFlags.M,parseFlags.ss=parseFlags.s,parseFlags.A=parseFlags.a,shorten(monthNames,monthNamesShort,3),shorten(dayNames,dayNamesShort,3),fecha.i18n={dayNamesShort:dayNamesShort,dayNames:dayNames,monthNamesShort:monthNamesShort,monthNames:monthNames,amPm:amPm,DoFn:DoFn},fecha.masks={"default":"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},fecha.format=function(dateObj,mask){if("number"==typeof dateObj&&(dateObj=new Date(dateObj)),!dateObj||"object"!=typeof dateObj&&"function"!=typeof dateObj.getDate)throw new Error("Invalid Date in fecha.format");mask=fecha.masks[mask]||mask||fecha.masks["default"];var D=dateObj.getDate(),d=dateObj.getDay(),M=dateObj.getMonth(),y=dateObj.getFullYear(),H=dateObj.getHours(),m=dateObj.getMinutes(),s=dateObj.getSeconds(),S=dateObj.getMilliseconds(),o=dateObj.getTimezoneOffset(),flags={D:D,DD:pad(D),Do:fecha.i18n.DoFn(D),d:d,dd:pad(d),ddd:fecha.i18n.dayNamesShort[d],dddd:fecha.i18n.dayNames[d],M:M+1,MM:pad(M+1),MMM:fecha.i18n.monthNamesShort[M],MMMM:fecha.i18n.monthNames[M],YY:String(y).slice(2),YYYY:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),m:m,mm:pad(m),s:s,ss:pad(s),S:Math.round(S/100),SS:pad(Math.round(S/10),2),SSS:pad(S,3),a:12>H?fecha.i18n.amPm[0]:fecha.i18n.amPm[1],A:12>H?fecha.i18n.amPm[0].toUpperCase():fecha.i18n.amPm[1].toUpperCase(),ZZ:(o>0?"-":"+")+pad(100*Math.floor(Math.abs(o)/60)+Math.abs(o)%60,4)};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})},fecha.parse=function(dateStr,format){var isValid,dateInfo,today,date,info,index;if("string"!=typeof format)throw new Error("Invalid format in fecha.parse");return format=fecha.masks[format]||format,isValid=!0,dateInfo={},format.replace(token,function($0){return parseFlags[$0]&&(info=parseFlags[$0],index=dateStr.search(info[0]),~index?dateStr.replace(info[0],function(result){return info[1](dateInfo,result),dateStr=dateStr.substr(index+result.length),result}):isValid=!1),parseFlags[$0]?"":$0.slice(1,$0.length-1)}),isValid?(today=new Date,dateInfo.isPm&&dateInfo.hour&&(dateInfo.hour=+dateInfo.hour+12),dateInfo.timezoneOffset?(dateInfo.minute=+(dateInfo.minute||0)-+dateInfo.timezoneOffset,date=new Date(Date.UTC(dateInfo.year||today.getFullYear(),dateInfo.month||0,dateInfo.day||1,dateInfo.hour||0,dateInfo.minute||0,dateInfo.second||0,dateInfo.millisecond||0))):date=new Date(dateInfo.year||today.getFullYear(),dateInfo.month||0,dateInfo.day||1,dateInfo.hour||0,dateInfo.minute||0,dateInfo.second||0,dateInfo.millisecond||0),date):!1},"undefined"!=typeof module&&module.exports?module.exports=fecha:"function"==typeof define&&define.amd?define(function(){return fecha}):main.fecha=fecha}(this),function(){var modules={};!function(){"use strict";function extend(cls,name,props){var F=function(){};F.prototype=cls.prototype;var prototype=new F,fnTest=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;props=props||{};for(var k in props){var src=props[k],parent=prototype[k];"function"==typeof parent&&"function"==typeof src&&fnTest.test(src)?prototype[k]=function(src,parent){return function(){var tmp=this.parent;this.parent=parent;var res=src.apply(this,arguments);return this.parent=tmp,res}}(src,parent):prototype[k]=src}prototype.typename=name;var new_cls=function(){prototype.init&&prototype.init.apply(this,arguments)};return new_cls.prototype=prototype,new_cls.prototype.constructor=new_cls,new_cls.extend=function(name,props){return"object"==typeof name&&(props=name,name="anonymous"),extend(new_cls,name,props)},new_cls}modules.object=extend(Object,"Object",{})}(),function(){"use strict";var ArrayProto=Array.prototype,ObjProto=Object.prototype,escapeMap={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},escapeRegex=/[&"'<>]/g,lookupEscape=function(ch){return escapeMap[ch]},exports=modules.lib={};exports.withPrettyErrors=function(path,withInternals,func){try{return func()}catch(e){if(e.Update||(e=new exports.TemplateError(e)),e.Update(path),!withInternals){var old=e;e=new Error(old.message),e.name=old.name}throw e}},exports.TemplateError=function(message,lineno,colno){var err=this;return message instanceof Error?(err=message,message=message.name+": "+message.message):Error.captureStackTrace&&Error.captureStackTrace(err),err.name="Template render error",err.message=message,err.lineno=lineno,err.colno=colno,err.firstUpdate=!0,err.Update=function(path){var message="("+(path||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?message+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(message+=" [Line "+this.lineno+"]")),message+="\n ",this.firstUpdate&&(message+=" "),this.message=message+(this.message||""),this.firstUpdate=!1,this},err},exports.TemplateError.prototype=Error.prototype,exports.escape=function(val){return val.replace(escapeRegex,lookupEscape)},exports.isFunction=function(obj){return"[object Function]"===ObjProto.toString.call(obj)},exports.isArray=Array.isArray||function(obj){return"[object Array]"===ObjProto.toString.call(obj)},exports.isString=function(obj){return"[object String]"===ObjProto.toString.call(obj)},exports.isObject=function(obj){return"[object Object]"===ObjProto.toString.call(obj)},exports.groupBy=function(obj,val){for(var result={},iterator=exports.isFunction(val)?val:function(obj){return obj[val]},i=0;i<obj.length;i++){var value=obj[i],key=iterator(value,i);(result[key]||(result[key]=[])).push(value)}return result},exports.toArray=function(obj){return Array.prototype.slice.call(obj)},exports.without=function(array){
var result=[];if(!array)return result;for(var index=-1,length=array.length,contains=exports.toArray(arguments).slice(1);++index<length;)-1===exports.indexOf(contains,array[index])&&result.push(array[index]);return result},exports.extend=function(obj,obj2){for(var k in obj2)obj[k]=obj2[k];return obj},exports.repeat=function(char_,n){for(var str="",i=0;n>i;i++)str+=char_;return str},exports.each=function(obj,func,context){if(null!=obj)if(ArrayProto.each&&obj.each===ArrayProto.each)obj.forEach(func,context);else if(obj.length===+obj.length)for(var i=0,l=obj.length;l>i;i++)func.call(context,obj[i],i,obj)},exports.map=function(obj,func){var results=[];if(null==obj)return results;if(ArrayProto.map&&obj.map===ArrayProto.map)return obj.map(func);for(var i=0;i<obj.length;i++)results[results.length]=func(obj[i],i);return obj.length===+obj.length&&(results.length=obj.length),results},exports.asyncIter=function(arr,iter,cb){function next(){i++,i<arr.length?iter(arr[i],i,next,cb):cb()}var i=-1;next()},exports.asyncFor=function(obj,iter,cb){function next(){i++;var k=keys[i];len>i?iter(k,obj[k],i,len,next):cb()}var keys=exports.keys(obj),len=keys.length,i=-1;next()},exports.indexOf=Array.prototype.indexOf?function(arr,searchElement,fromIndex){return Array.prototype.indexOf.call(arr,searchElement,fromIndex)}:function(arr,searchElement,fromIndex){var length=this.length>>>0;for(fromIndex=+fromIndex||0,Math.abs(fromIndex)===1/0&&(fromIndex=0),0>fromIndex&&(fromIndex+=length,0>fromIndex&&(fromIndex=0));length>fromIndex;fromIndex++)if(arr[fromIndex]===searchElement)return fromIndex;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),exports.keys=function(obj){if(Object.prototype.keys)return obj.keys();var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys}}(),function(){"use strict";function makeMacro(argNames,kwargNames,func){return function(){var args,argCount=numArgs(arguments),kwargs=getKeywordArgs(arguments);if(argCount>argNames.length){args=Array.prototype.slice.call(arguments,0,argNames.length);for(var vals=Array.prototype.slice.call(arguments,args.length,argCount),i=0;i<vals.length;i++)i<kwargNames.length&&(kwargs[kwargNames[i]]=vals[i]);args.push(kwargs)}else if(argCount<argNames.length){args=Array.prototype.slice.call(arguments,0,argCount);for(var i=argCount;i<argNames.length;i++){var arg=argNames[i];args.push(kwargs[arg]),delete kwargs[arg]}args.push(kwargs)}else args=arguments;return func.apply(this,args)}}function makeKeywordArgs(obj){return obj.__keywords=!0,obj}function getKeywordArgs(args){var len=args.length;if(len){var lastArg=args[len-1];if(lastArg&&lastArg.hasOwnProperty("__keywords"))return lastArg}return{}}function numArgs(args){var len=args.length;if(0===len)return 0;var lastArg=args[len-1];return lastArg&&lastArg.hasOwnProperty("__keywords")?len-1:len}function SafeString(val){return"string"!=typeof val?val:void(this.val=val)}function copySafeness(dest,target){return dest instanceof SafeString?new SafeString(target):target.toString()}function markSafe(val){var type=typeof val;return"string"===type?new SafeString(val):"function"!==type?val:function(){var ret=val.apply(this,arguments);return"string"==typeof ret?new SafeString(ret):ret}}function suppressValue(val,autoescape){return val=void 0!==val&&null!==val?val:"",autoescape&&"string"==typeof val&&(val=lib.escape(val)),val}function memberLookup(obj,val){return obj=obj||{},"function"==typeof obj[val]?function(){return obj[val].apply(obj,arguments)}:obj[val]}function callWrap(obj,name,args){if(!obj)throw new Error("Unable to call `"+name+"`, which is undefined or falsey");if("function"!=typeof obj)throw new Error("Unable to call `"+name+"`, which is not a function");return obj.apply(this,args)}function contextOrFrameLookup(context,frame,name){var val=frame.lookup(name);return void 0!==val&&null!==val?val:context.lookup(name)}function handleError(error,lineno,colno){return error.lineno?error:new lib.TemplateError(error,lineno,colno)}function asyncEach(arr,dimen,iter,cb){if(lib.isArray(arr)){var len=arr.length;lib.asyncIter(arr,function(item,i,next){switch(dimen){case 1:iter(item,i,len,next);break;case 2:iter(item[0],item[1],i,len,next);break;case 3:iter(item[0],item[1],item[2],i,len,next);break;default:item.push(i,next),iter.apply(this,item)}},cb)}else lib.asyncFor(arr,function(key,val,i,len,next){iter(key,val,i,len,next)},cb)}function asyncAll(arr,dimen,func,cb){function done(i,output){finished++,outputArr[i]=output,finished===len&&cb(null,outputArr.join(""))}var len,outputArr,finished=0;if(lib.isArray(arr))if(len=arr.length,outputArr=new Array(len),0===len)cb(null,"");else for(var i=0;i<arr.length;i++){var item=arr[i];switch(dimen){case 1:func(item,i,len,done);break;case 2:func(item[0],item[1],i,len,done);break;case 3:func(item[0],item[1],item[2],i,len,done);break;default:item.push(i,done),func.apply(this,item)}}else{var keys=lib.keys(arr);if(len=keys.length,outputArr=new Array(len),0===len)cb(null,"");else for(var i=0;i<keys.length;i++){var k=keys[i];func(k,arr[k],i,len,done)}}}var lib=modules.lib,Obj=modules.object,Frame=Obj.extend({init:function(parent){this.variables={},this.parent=parent},set:function(name,val,resolveUp){var parts=name.split("."),obj=this.variables,frame=this;if(resolveUp){if(frame=this.resolve(parts[0]))return void frame.set(name,val);frame=this}for(var i=0;i<parts.length-1;i++){var id=parts[i];obj[id]||(obj[id]={}),obj=obj[id]}obj[parts[parts.length-1]]=val},get:function(name){var val=this.variables[name];return void 0!==val&&null!==val?val:null},lookup:function(name){var p=this.parent,val=this.variables[name];return void 0!==val&&null!==val?val:p&&p.lookup(name)},resolve:function(name){var p=this.parent,val=this.variables[name];return void 0!==val&&null!==val?this:p&&p.resolve(name)},push:function(){return new Frame(this)},pop:function(){return this.parent}});SafeString.prototype=Object.create(String.prototype),SafeString.prototype.valueOf=function(){return this.val},SafeString.prototype.toString=function(){return this.val},modules.runtime={Frame:Frame,makeMacro:makeMacro,makeKeywordArgs:makeKeywordArgs,numArgs:numArgs,suppressValue:suppressValue,memberLookup:memberLookup,contextOrFrameLookup:contextOrFrameLookup,callWrap:callWrap,handleError:handleError,isArray:lib.isArray,keys:lib.keys,SafeString:SafeString,copySafeness:copySafeness,markSafe:markSafe,asyncEach:asyncEach,asyncAll:asyncAll}}(),function(){"use strict";var path=modules.path,Obj=modules.object,lib=modules.lib,Loader=Obj.extend({on:function(name,func){this.listeners=this.listeners||{},this.listeners[name]=this.listeners[name]||[],this.listeners[name].push(func)},emit:function(name){var args=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[name]&&lib.each(this.listeners[name],function(listener){listener.apply(null,args)})},resolve:function(from,to){return path.resolve(path.dirname(from),to)},isRelative:function(filename){return 0===filename.indexOf("./")||0===filename.indexOf("../")}});modules.loader=Loader}(),function(){"use strict";var Loader=modules.loader,WebLoader=Loader.extend({init:function(baseURL,neverUpdate){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=baseURL||"",this.neverUpdate=neverUpdate},getSource:function(name){if(this.precompiled[name])return{src:{type:"code",obj:this.precompiled[name]},path:name};var src=this.fetch(this.baseURL+"/"+name);return src?{src:src,path:name,noCache:!this.neverUpdate}:null},fetch:function(url,callback){var ajax,src,loading=!0;return window.XMLHttpRequest?ajax=new XMLHttpRequest:window.ActiveXObject&&(ajax=new ActiveXObject("Microsoft.XMLHTTP")),ajax.onreadystatechange=function(){4!==ajax.readyState||0!==ajax.status&&200!==ajax.status||!loading||(loading=!1,src=ajax.responseText)},url+=(-1===url.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),ajax.open("GET",url,!1),ajax.send(),src}});modules["web-loaders"]={WebLoader:WebLoader}}(),function(){"undefined"==typeof window||window!==this?modules.loaders=modules["node-loaders"]:modules.loaders=modules["web-loaders"]}(),function(){"use strict";var lib=modules.lib,r=modules.runtime,filters={abs:function(n){return Math.abs(n)},batch:function(arr,linecount,fill_with){for(var res=[],tmp=[],i=0;i<arr.length;i++)i%linecount===0&&tmp.length&&(res.push(tmp),tmp=[]),tmp.push(arr[i]);if(tmp.length){if(fill_with)for(var i=tmp.length;linecount>i;i++)tmp.push(fill_with);res.push(tmp)}return res},capitalize:function(str){var ret=str.toLowerCase();return r.copySafeness(str,ret.charAt(0).toUpperCase()+ret.slice(1))},center:function(str,width){if(width=width||80,str.length>=width)return str;var spaces=width-str.length,pre=lib.repeat(" ",spaces/2-spaces%2),post=lib.repeat(" ",spaces/2);return r.copySafeness(str,pre+str+post)},"default":function(val,def){return val?val:def},dictsort:function(val,case_sensitive,by){if(!lib.isObject(val))throw new lib.TemplateError("dictsort filter: val must be an object");var array=[];for(var k in val)array.push([k,val[k]]);var si;if(void 0===by||"key"===by)si=0;else{if("value"!==by)throw new lib.TemplateError("dictsort filter: You can only sort by either key or value");si=1}return array.sort(function(t1,t2){var a=t1[si],b=t2[si];return case_sensitive||(lib.isString(a)&&(a=a.toUpperCase()),lib.isString(b)&&(b=b.toUpperCase())),a>b?1:a===b?0:-1}),array},escape:function(str){return"string"==typeof str||str instanceof r.SafeString?lib.escape(str):str},safe:function(str){return r.markSafe(str)},first:function(arr){return arr[0]},groupby:function(arr,attr){return lib.groupBy(arr,attr)},indent:function(str,width,indentfirst){width=width||4;for(var res="",lines=str.split("\n"),sp=lib.repeat(" ",width),i=0;i<lines.length;i++)res+=0!==i||indentfirst?sp+lines[i]+"\n":lines[i]+"\n";return r.copySafeness(str,res)},join:function(arr,del,attr){return del=del||"",attr&&(arr=lib.map(arr,function(v){return v[attr]})),arr.join(del)},last:function(arr){return arr[arr.length-1]},length:function(arr){return void 0!==arr?arr.length:0},list:function(val){if(lib.isString(val))return val.split("");if(lib.isObject(val)){var keys=[];if(Object.keys)keys=Object.keys(val);else for(var k in val)keys.push(k);return lib.map(keys,function(k){return{key:k,value:val[k]}})}if(lib.isArray(val))return val;throw new lib.TemplateError("list filter: type not iterable")},lower:function(str){return str.toLowerCase()},random:function(arr){return arr[Math.floor(Math.random()*arr.length)]},rejectattr:function(arr,attr){return arr.filter(function(item){return!item[attr]})},selectattr:function(arr,attr){return arr.filter(function(item){return!!item[attr]})},replace:function(str,old,new_,maxCount){if(old instanceof RegExp)return str.replace(old,new_);var res=str,last=res,count=1;for(res=res.replace(old,new_);last!==res&&!(count>=maxCount);)last=res,res=res.replace(old,new_),count++;return r.copySafeness(str,res)},reverse:function(val){var arr;return arr=lib.isString(val)?filters.list(val):lib.map(val,function(v){return v}),arr.reverse(),lib.isString(val)?r.copySafeness(val,arr.join("")):arr},round:function(val,precision,method){precision=precision||0;var rounder,factor=Math.pow(10,precision);return rounder="ceil"===method?Math.ceil:"floor"===method?Math.floor:Math.round,rounder(val*factor)/factor},slice:function(arr,slices,fillWith){for(var sliceLength=Math.floor(arr.length/slices),extra=arr.length%slices,offset=0,res=[],i=0;slices>i;i++){var start=offset+i*sliceLength;extra>i&&offset++;var end=offset+(i+1)*sliceLength,slice=arr.slice(start,end);fillWith&&i>=extra&&slice.push(fillWith),res.push(slice)}return res},sort:function(arr,reverse,caseSens,attr){return arr=lib.map(arr,function(v){return v}),arr.sort(function(a,b){var x,y;return attr?(x=a[attr],y=b[attr]):(x=a,y=b),!caseSens&&lib.isString(x)&&lib.isString(y)&&(x=x.toLowerCase(),y=y.toLowerCase()),y>x?reverse?1:-1:x>y?reverse?-1:1:0}),arr},string:function(obj){return r.copySafeness(obj,obj)},title:function(str){for(var words=str.split(" "),i=0;i<words.length;i++)words[i]=filters.capitalize(words[i]);return r.copySafeness(str,words.join(" "))},trim:function(str){return r.copySafeness(str,str.replace(/^\s*|\s*$/g,""))},truncate:function(input,length,killwords,end){var orig=input;if(length=length||255,input.length<=length)return input;if(killwords)input=input.substring(0,length);else{var idx=input.lastIndexOf(" ",length);-1===idx&&(idx=length),input=input.substring(0,idx)}return input+=void 0!==end&&null!==end?end:"...",r.copySafeness(orig,input)},upper:function(str){return str.toUpperCase()},urlencode:function(obj){var enc=encodeURIComponent;if(lib.isString(obj))return enc(obj);var parts;if(lib.isArray(obj))parts=obj.map(function(item){return enc(item[0])+"="+enc(item[1])});else{parts=[];for(var k in obj)obj.hasOwnProperty(k)&&parts.push(enc(k)+"="+enc(obj[k]))}return parts.join("&")},urlize:function(str,length,nofollow){isNaN(length)&&(length=1/0);var noFollowAttr=nofollow===!0?' rel="nofollow"':"",puncRE=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,emailRE=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,httpHttpsRE=/^https?:\/\/.*$/,wwwRE=/^www\./,tldRE=/\.(?:org|net|com)(?:\:|\/|$)/,words=str.split(/\s+/).filter(function(word){return word&&word.length}).map(function(word){var matches=word.match(puncRE),possibleUrl=matches&&matches[1]||word;return httpHttpsRE.test(possibleUrl)?'<a href="'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":wwwRE.test(possibleUrl)?'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":emailRE.test(possibleUrl)?'<a href="mailto:'+possibleUrl+'">'+possibleUrl+"</a>":tldRE.test(possibleUrl)?'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":word});return words.join(" ")},wordcount:function(str){var words=str?str.match(/\w+/g):null;return words?words.length:null},"float":function(val,def){var res=parseFloat(val);return isNaN(res)?def:res},"int":function(val,def){var res=parseInt(val,10);return isNaN(res)?def:res}};filters.d=filters["default"],filters.e=filters.escape,modules.filters=filters}(),function(){"use strict";function cycler(items){var index=-1;return{current:null,reset:function(){index=-1,this.current=null},next:function(){return index++,index>=items.length&&(index=0),this.current=items[index],this.current}}}function joiner(sep){sep=sep||",";var first=!0;return function(){var val=first?"":sep;return first=!1,val}}var globals={range:function(start,stop,step){stop?step||(step=1):(stop=start,start=0,step=1);for(var arr=[],i=start;stop>i;i+=step)arr.push(i);return arr},cycler:function(){return cycler(Array.prototype.slice.call(arguments))},joiner:function(sep){return joiner(sep)}};modules.globals=globals}(),function(){"use strict";var path=modules.path,lib=modules.lib,Obj=modules.object,compiler=(modules.lexer,modules.compiler),builtin_filters=modules.filters,builtin_loaders=modules.loaders,runtime=modules.runtime,globals=modules.globals,Frame=runtime.Frame,Environment=Obj.extend({init:function(loaders,opts){var opts=this.opts=opts||{};this.opts.dev=!!opts.dev,this.opts.autoescape=!!opts.autoescape,this.opts.trimBlocks=!!opts.trimBlocks,this.opts.lstripBlocks=!!opts.lstripBlocks,loaders?this.loaders=lib.isArray(loaders)?loaders:[loaders]:builtin_loaders.FileSystemLoader?this.loaders=[new builtin_loaders.FileSystemLoader("views")]:this.loaders=[new builtin_loaders.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var name in builtin_filters)this.addFilter(name,builtin_filters[name])},initCache:function(){lib.each(this.loaders,function(loader){loader.cache={},"function"==typeof loader.on&&loader.on("update",function(template){loader.cache[template]=null})})},addExtension:function(name,extension){extension._name=name,this.extensions[name]=extension,this.extensionsList.push(extension)},getExtension:function(name){return this.extensions[name]},addGlobal:function(name,value){globals[name]=value},addFilter:function(name,func,async){var wrapped=func;async&&this.asyncFilters.push(name),this.filters[name]=wrapped},getFilter:function(name){if(!this.filters[name])throw new Error("filter not found: "+name);return this.filters[name]},resolveTemplate:function(loader,parentName,filename){var isRelative=loader.isRelative&&parentName?loader.isRelative(filename):!1;return isRelative&&loader.resolve?loader.resolve(parentName,filename):filename},getTemplate:function(name,eagerCompile,parentName,cb){var that=this,tmpl=null;if(name&&name.raw&&(name=name.raw),lib.isFunction(parentName)&&(cb=parentName,parentName=null,eagerCompile=eagerCompile||!1),lib.isFunction(eagerCompile)&&(cb=eagerCompile,eagerCompile=!1),"string"!=typeof name)throw new Error("template names must be a string: "+name);for(var i=0;i<this.loaders.length;i++){var _name=this.resolveTemplate(this.loaders[i],parentName,name);if(tmpl=this.loaders[i].cache[_name])break}if(!tmpl){var syncResult;return lib.asyncIter(this.loaders,function(loader,i,next,done){function handle(src){src?(src.loader=loader,done(src)):next()}name=that.resolveTemplate(loader,parentName,name),loader.async?loader.getSource(name,function(err,src){if(err)throw err;handle(src)}):handle(loader.getSource(name))},function(info){if(info){var tmpl=new Template(info.src,this,info.path,eagerCompile);info.noCache||(info.loader.cache[name]=tmpl),cb?cb(null,tmpl):syncResult=tmpl}else{var err=new Error("template not found: "+name);if(!cb)throw err;cb(err)}}.bind(this)),syncResult}return eagerCompile&&tmpl.compile(),cb?void cb(null,tmpl):tmpl},express:function(app){function NunjucksView(name,opts){if(this.name=name,this.path=name,this.defaultEngine=opts.defaultEngine,this.ext=path.extname(name),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var env=this;NunjucksView.prototype.render=function(opts,cb){env.render(this.name,opts,cb)},app.set("view",NunjucksView)},render:function(name,ctx,cb){lib.isFunction(ctx)&&(cb=ctx,ctx=null);var syncResult=null;return this.getTemplate(name,function(err,tmpl){if(err&&cb)cb(err);else{if(err)throw err;tmpl.render(ctx,cb||function(err,res){if(err)throw err;syncResult=res})}}),syncResult},renderString:function(src,ctx,opts,cb){lib.isFunction(opts)&&(cb=opts,opts={}),opts=opts||{};var tmpl=new Template(src,this,opts.path);return tmpl.render(ctx,cb)}}),Context=Obj.extend({init:function(ctx,blocks){this.ctx=ctx,this.blocks={},this.exported=[];for(var name in blocks)this.addBlock(name,blocks[name])},lookup:function(name){return name in globals&&!(name in this.ctx)?globals[name]:this.ctx[name]},setVariable:function(name,val){this.ctx[name]=val},getVariables:function(){return this.ctx},addBlock:function(name,block){this.blocks[name]=this.blocks[name]||[],this.blocks[name].push(block)},getBlock:function(name){if(!this.blocks[name])throw new Error('unknown block "'+name+'"');return this.blocks[name][0]},getSuper:function(env,name,block,frame,runtime,cb){var idx=lib.indexOf(this.blocks[name]||[],block),blk=this.blocks[name][idx+1],context=this;if(-1===idx||!blk)throw new Error('no super block available for "'+name+'"');blk(env,context,frame,runtime,cb)},addExport:function(name){this.exported.push(name)},getExported:function(){for(var exported={},i=0;i<this.exported.length;i++){var name=this.exported[i];exported[name]=this.ctx[name]}return exported}}),Template=Obj.extend({init:function(src,env,path,eagerCompile){if(this.env=env||new Environment,lib.isObject(src))switch(src.type){case"code":this.tmplProps=src.obj;break;case"string":this.tmplStr=src.obj}else{if(!lib.isString(src))throw new Error("src must be a string or an object describing the source");this.tmplStr=src}this.path=path,eagerCompile?lib.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(ctx,frame,cb){return"function"==typeof ctx?(cb=ctx,ctx={}):"function"==typeof frame&&(cb=frame,frame=null),lib.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(e){if(cb)return cb(e);throw e}var context=new Context(ctx||{},this.blocks),syncResult=null;return this.rootRenderFunc(this.env,context,frame||new Frame,runtime,cb||function(err,res){if(err)throw err;syncResult=res}),syncResult}.bind(this))},getExported:function(ctx,frame,cb){"function"==typeof ctx&&(cb=ctx,ctx={}),"function"==typeof frame&&(cb=frame,frame=null);try{this.compile()}catch(e){if(cb)return cb(e);throw e}var context=new Context(ctx||{},this.blocks);this.rootRenderFunc(this.env,context,frame||new Frame,runtime,function(){cb(null,context.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var props;if(this.tmplProps)props=this.tmplProps;else{var source=compiler.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts),func=new Function(source);props=func()}this.blocks=this._getBlocks(props),this.rootRenderFunc=props.root,this.compiled=!0},_getBlocks:function(props){var blocks={};for(var k in props)"b_"===k.slice(0,2)&&(blocks[k.slice(2)]=props[k]);return blocks}});modules.environment={Environment:Environment,Template:Template}}();var nunjucks,lib=modules.lib,env=modules.environment,compiler=modules.compiler,parser=modules.parser,lexer=modules.lexer,runtime=modules.runtime,Loader=modules.loader,loaders=modules.loaders,precompile=modules.precompile;nunjucks={},nunjucks.Environment=env.Environment,nunjucks.Template=env.Template,nunjucks.Loader=Loader,nunjucks.FileSystemLoader=loaders.FileSystemLoader,nunjucks.WebLoader=loaders.WebLoader,nunjucks.compiler=compiler,nunjucks.parser=parser,nunjucks.lexer=lexer,nunjucks.runtime=runtime;var e;nunjucks.configure=function(templatesPath,opts){opts=opts||{},lib.isObject(templatesPath)&&(opts=templatesPath,templatesPath=null);var noWatch="watch"in opts?!opts.watch:!1,loader=loaders.FileSystemLoader||loaders.WebLoader;return e=new env.Environment(new loader(templatesPath,noWatch),opts),opts&&opts.express&&e.express(opts.express),e},nunjucks.compile=function(src,env,path,eagerCompile){return e||nunjucks.configure(),new nunjucks.Template(src,env,path,eagerCompile)},nunjucks.render=function(name,ctx,cb){return e||nunjucks.configure(),e.render(name,ctx,cb)},nunjucks.renderString=function(src,ctx,cb){return e||nunjucks.configure(),e.renderString(src,ctx,cb)},precompile&&(nunjucks.precompile=precompile.precompile,nunjucks.precompileString=precompile.precompileString),nunjucks.require=function(name){return modules[name]},"function"==typeof define&&define.amd?define(function(){return nunjucks}):(window.nunjucks=nunjucks,"undefined"!=typeof module&&(module.exports=nunjucks))}(),function(){var Color,LAB_CONSTANTS,PI,PITHIRD,TWOPI,_guess_formats,_guess_formats_sorted,_input,_interpolators,abs,atan2,bezier,blend,blend_f,brewer,burn,chroma,clip_rgb,cmyk2rgb,colors,cos,css2rgb,darken,dodge,each,floor,hex2rgb,hsi2rgb,hsl2css,hsl2rgb,hsv2rgb,interpolate,interpolate_hsx,interpolate_lab,interpolate_num,interpolate_rgb,lab2lch,lab2rgb,lab_xyz,lch2lab,lch2rgb,lighten,limit,log,luminance_x,m,max,multiply,normal,num2rgb,overlay,pow,rgb2cmyk,rgb2css,rgb2hex,rgb2hsi,rgb2hsl,rgb2hsv,rgb2lab,rgb2lch,rgb2luminance,rgb2num,rgb2temperature,rgb2xyz,rgb_xyz,rnd,root,round,screen,sin,sqrt,temperature2rgb,type,unpack,w3cx11,xyz_lab,xyz_rgb,slice=[].slice;type=function(){var classToType,len,name,o,ref;for(classToType={},ref="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),o=0,len=ref.length;len>o;o++)name=ref[o],classToType["[object "+name+"]"]=name.toLowerCase();return function(obj){var strType;return strType=Object.prototype.toString.call(obj),classToType[strType]||"object"}}(),limit=function(x,min,max){return null==min&&(min=0),null==max&&(max=1),min>x&&(x=min),x>max&&(x=max),x},unpack=function(args){return args.length>=3?[].slice.call(args):args[0]},clip_rgb=function(rgb){var i;for(i in rgb)3>i?(rgb[i]<0&&(rgb[i]=0),rgb[i]>255&&(rgb[i]=255)):3===i&&(rgb[i]<0&&(rgb[i]=0),rgb[i]>1&&(rgb[i]=1));return rgb},PI=Math.PI,round=Math.round,cos=Math.cos,floor=Math.floor,pow=Math.pow,log=Math.log,sin=Math.sin,sqrt=Math.sqrt,atan2=Math.atan2,max=Math.max,abs=Math.abs,TWOPI=2*PI,PITHIRD=PI/3,chroma=function(){return arguments[0]instanceof Color?arguments[0]:function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,arguments,function(){})},_interpolators=[],"undefined"!=typeof module&&null!==module&&null!=module.exports&&(module.exports=chroma),"function"==typeof define&&define.amd?define([],function(){return chroma}):(root="undefined"!=typeof exports&&null!==exports?exports:this,root.chroma=chroma),chroma.version="1.0.2",_input={},_guess_formats=[],_guess_formats_sorted=!1,Color=function(){function Color(){var arg,args,chk,len,len1,me,mode,o,w;for(me=this,args=[],o=0,len=arguments.length;len>o;o++)arg=arguments[o],null!=arg&&args.push(arg);if(mode=args[args.length-1],null!=_input[mode])me._rgb=clip_rgb(_input[mode](unpack(args.slice(0,-1))));else{for(_guess_formats_sorted||(_guess_formats=_guess_formats.sort(function(a,b){return b.p-a.p}),_guess_formats_sorted=!0),w=0,len1=_guess_formats.length;len1>w&&(chk=_guess_formats[w],!(mode=chk.test.apply(chk,args)));w++);mode&&(me._rgb=clip_rgb(_input[mode].apply(_input,args)))}null==me._rgb&&console.warn("unknown format: "+args),null==me._rgb&&(me._rgb=[0,0,0]),3===me._rgb.length&&me._rgb.push(1)}return Color.prototype.alpha=function(alpha){return arguments.length?(this._rgb[3]=alpha,this):this._rgb[3]},Color.prototype.toString=function(){return this.name()},Color}(),chroma.brewer=brewer={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},w3cx11={indigo:"#4b0082",gold:"#ffd700",hotpink:"#ff69b4",firebrick:"#b22222",indianred:"#cd5c5c",yellow:"#ffff00",mistyrose:"#ffe4e1",darkolivegreen:"#556b2f",olive:"#808000",darkseagreen:"#8fbc8f",pink:"#ffc0cb",tomato:"#ff6347",lightcoral:"#f08080",orangered:"#ff4500",navajowhite:"#ffdead",lime:"#00ff00",palegreen:"#98fb98",darkslategrey:"#2f4f4f",greenyellow:"#adff2f",burlywood:"#deb887",seashell:"#fff5ee",mediumspringgreen:"#00fa9a",fuchsia:"#ff00ff",papayawhip:"#ffefd5",blanchedalmond:"#ffebcd",chartreuse:"#7fff00",dimgray:"#696969",black:"#000000",peachpuff:"#ffdab9",springgreen:"#00ff7f",aquamarine:"#7fffd4",white:"#ffffff",orange:"#ffa500",lightsalmon:"#ffa07a",darkslategray:"#2f4f4f",brown:"#a52a2a",ivory:"#fffff0",dodgerblue:"#1e90ff",peru:"#cd853f",lawngreen:"#7cfc00",chocolate:"#d2691e",crimson:"#dc143c",forestgreen:"#228b22",darkgrey:"#a9a9a9",lightseagreen:"#20b2aa",cyan:"#00ffff",mintcream:"#f5fffa",silver:"#c0c0c0",antiquewhite:"#faebd7",mediumorchid:"#ba55d3",skyblue:"#87ceeb",gray:"#808080",darkturquoise:"#00ced1",goldenrod:"#daa520",darkgreen:"#006400",floralwhite:"#fffaf0",darkviolet:"#9400d3",darkgray:"#a9a9a9",moccasin:"#ffe4b5",saddlebrown:"#8b4513",grey:"#808080",darkslateblue:"#483d8b",lightskyblue:"#87cefa",lightpink:"#ffb6c1",mediumvioletred:"#c71585",slategrey:"#708090",red:"#ff0000",deeppink:"#ff1493",limegreen:"#32cd32",darkmagenta:"#8b008b",palegoldenrod:"#eee8aa",plum:"#dda0dd",turquoise:"#40e0d0",lightgrey:"#d3d3d3",lightgoldenrodyellow:"#fafad2",darkgoldenrod:"#b8860b",lavender:"#e6e6fa",maroon:"#800000",yellowgreen:"#9acd32",sandybrown:"#f4a460",thistle:"#d8bfd8",violet:"#ee82ee",navy:"#000080",magenta:"#ff00ff",dimgrey:"#696969",tan:"#d2b48c",rosybrown:"#bc8f8f",olivedrab:"#6b8e23",blue:"#0000ff",lightblue:"#add8e6",ghostwhite:"#f8f8ff",honeydew:"#f0fff0",cornflowerblue:"#6495ed",slateblue:"#6a5acd",linen:"#faf0e6",darkblue:"#00008b",powderblue:"#b0e0e6",seagreen:"#2e8b57",darkkhaki:"#bdb76b",snow:"#fffafa",sienna:"#a0522d",mediumblue:"#0000cd",royalblue:"#4169e1",lightcyan:"#e0ffff",green:"#008000",mediumpurple:"#9370db",midnightblue:"#191970",cornsilk:"#fff8dc",paleturquoise:"#afeeee",bisque:"#ffe4c4",slategray:"#708090",darkcyan:"#008b8b",khaki:"#f0e68c",wheat:"#f5deb3",teal:"#008080",darkorchid:"#9932cc",deepskyblue:"#00bfff",salmon:"#fa8072",darkred:"#8b0000",steelblue:"#4682b4",palevioletred:"#db7093",lightslategray:"#778899",aliceblue:"#f0f8ff",lightslategrey:"#778899",lightgreen:"#90ee90",orchid:"#da70d6",gainsboro:"#dcdcdc",mediumseagreen:"#3cb371",
lightgray:"#d3d3d3",mediumturquoise:"#48d1cc",lemonchiffon:"#fffacd",cadetblue:"#5f9ea0",lightyellow:"#ffffe0",lavenderblush:"#fff0f5",coral:"#ff7f50",purple:"#800080",aqua:"#00ffff",whitesmoke:"#f5f5f5",mediumslateblue:"#7b68ee",darkorange:"#ff8c00",mediumaquamarine:"#66cdaa",darksalmon:"#e9967a",beige:"#f5f5dc",blueviolet:"#8a2be2",azure:"#f0ffff",lightsteelblue:"#b0c4de",oldlace:"#fdf5e6",rebeccapurple:"#663399"},chroma.colors=colors=w3cx11,lab2rgb=function(){var a,args,b,g,l,r,ref,ref1,x,y,z;return args=unpack(arguments),l=args[0],a=args[1],b=args[2],void 0!==l&&3===l.length&&(ref=l,l=ref[0],a=ref[1],b=ref[2]),void 0!==l&&3===l.length&&(ref1=l,l=ref1[0],a=ref1[1],b=ref1[2]),y=(l+16)/116,x=y+a/500,z=y-b/200,x=lab_xyz(x)*LAB_CONSTANTS.X,y=lab_xyz(y)*LAB_CONSTANTS.Y,z=lab_xyz(z)*LAB_CONSTANTS.Z,r=xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),g=xyz_rgb(-.969266*x+1.8760108*y+.041556*z),b=xyz_rgb(.0556434*x-.2040259*y+1.0572252*z),[limit(r,0,255),limit(g,0,255),limit(b,0,255),args.length>3?args[3]:1]},lab_xyz=function(x){return x>.206893034?x*x*x:(x-4/29)/7.787037},xyz_rgb=function(r){return round(255*(.00304>=r?12.92*r:1.055*pow(r,1/2.4)-.055))},LAB_CONSTANTS={K:18,X:.95047,Y:1,Z:1.08883},rgb2lab=function(){var b,g,r,ref,ref1,x,y,z;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],ref1=rgb2xyz(r,g,b),x=ref1[0],y=ref1[1],z=ref1[2],[116*y-16,500*(x-y),200*(y-z)]},rgb_xyz=function(r){return(r/=255)<=.04045?r/12.92:pow((r+.055)/1.055,2.4)},xyz_lab=function(x){return x>.008856?pow(x,1/3):7.787037*x+4/29},rgb2xyz=function(){var b,g,r,ref,x,y,z;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],r=rgb_xyz(r),g=rgb_xyz(g),b=rgb_xyz(b),x=xyz_lab((.4124564*r+.3575761*g+.1804375*b)/LAB_CONSTANTS.X),y=xyz_lab((.2126729*r+.7151522*g+.072175*b)/LAB_CONSTANTS.Y),z=xyz_lab((.0193339*r+.119192*g+.9503041*b)/LAB_CONSTANTS.Z),[x,y,z]},chroma.lab=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["lab"]),function(){})},_input.lab=lab2rgb,Color.prototype.lab=function(){return rgb2lab(this._rgb)},bezier=function(colors){var I,I0,I1,c,lab0,lab1,lab2,lab3,ref,ref1,ref2;return colors=function(){var len,o,results;for(results=[],o=0,len=colors.length;len>o;o++)c=colors[o],results.push(chroma(c));return results}(),2===colors.length?(ref=function(){var len,o,results;for(results=[],o=0,len=colors.length;len>o;o++)c=colors[o],results.push(c.lab());return results}(),lab0=ref[0],lab1=ref[1],I=function(t){var i,lab;return lab=function(){var o,results;for(results=[],i=o=0;2>=o;i=++o)results.push(lab0[i]+t*(lab1[i]-lab0[i]));return results}(),chroma.lab.apply(chroma,lab)}):3===colors.length?(ref1=function(){var len,o,results;for(results=[],o=0,len=colors.length;len>o;o++)c=colors[o],results.push(c.lab());return results}(),lab0=ref1[0],lab1=ref1[1],lab2=ref1[2],I=function(t){var i,lab;return lab=function(){var o,results;for(results=[],i=o=0;2>=o;i=++o)results.push((1-t)*(1-t)*lab0[i]+2*(1-t)*t*lab1[i]+t*t*lab2[i]);return results}(),chroma.lab.apply(chroma,lab)}):4===colors.length?(ref2=function(){var len,o,results;for(results=[],o=0,len=colors.length;len>o;o++)c=colors[o],results.push(c.lab());return results}(),lab0=ref2[0],lab1=ref2[1],lab2=ref2[2],lab3=ref2[3],I=function(t){var i,lab;return lab=function(){var o,results;for(results=[],i=o=0;2>=o;i=++o)results.push((1-t)*(1-t)*(1-t)*lab0[i]+3*(1-t)*(1-t)*t*lab1[i]+3*(1-t)*t*t*lab2[i]+t*t*t*lab3[i]);return results}(),chroma.lab.apply(chroma,lab)}):5===colors.length&&(I0=bezier(colors.slice(0,3)),I1=bezier(colors.slice(2,5)),I=function(t){return.5>t?I0(2*t):I1(2*(t-.5))}),I},chroma.bezier=function(colors){return chroma.scale(bezier(colors))},chroma.cubehelix=function(start,rotations,hue,gamma,lightness){var dh,dl;return null==start&&(start=300),null==rotations&&(rotations=-1.5),null==hue&&(hue=1),null==gamma&&(gamma=1),null==lightness&&(lightness=[0,1]),dl=lightness[1]-lightness[0],"array"===type(hue)?(dh=hue[1]-hue[0],0===dh&&(hue=hue[1])):dh=0,function(fract){var a,amp,b,cos_a,g,h,l,r,sin_a;return a=TWOPI*((start+120)/360+rotations*fract),l=pow(lightness[0]+dl*fract,gamma),h=0!==dh?hue[0]+fract*dh:hue,amp=h*l*(1-l)/2,cos_a=cos(a),sin_a=sin(a),r=l+amp*(-.14861*cos_a+1.78277*sin_a),g=l+amp*(-.29227*cos_a-.90649*sin_a),b=l+amp*(1.97294*cos_a),chroma(clip_rgb([255*r,255*g,255*b]))}},chroma.random=function(){var code,digits,i,o;for(digits="0123456789abcdef",code="#",i=o=0;6>o;i=++o)code+=digits.charAt(floor(16*Math.random()));return new Color(code)},_input.rgb=function(){var k,ref,results,v;ref=unpack(arguments),results=[];for(k in ref)v=ref[k],results.push(v);return results},chroma.rgb=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["rgb"]),function(){})},Color.prototype.rgb=function(){return this._rgb.slice(0,3)},Color.prototype.rgba=function(){return this._rgb},_guess_formats.push({p:15,test:function(n){var a;return a=unpack(arguments),"array"===type(a)&&3===a.length?"rgb":4===a.length&&"number"===type(a[3])&&a[3]>=0&&a[3]<=1?"rgb":void 0}}),hex2rgb=function(hex){var a,b,g,r,rgb,u;if(hex.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(4===hex.length||7===hex.length)&&(hex=hex.substr(1)),3===hex.length&&(hex=hex.split(""),hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]),u=parseInt(hex,16),r=u>>16,g=u>>8&255,b=255&u,[r,g,b,1];if(hex.match(/^#?([A-Fa-f0-9]{8})$/))return 9===hex.length&&(hex=hex.substr(1)),u=parseInt(hex,16),r=u>>24&255,g=u>>16&255,b=u>>8&255,a=round((255&u)/255*100)/100,[r,g,b,a];if(null!=_input.css&&(rgb=_input.css(hex)))return rgb;throw"unknown color: "+hex},rgb2hex=function(channels,mode){var a,b,g,hxa,r,str,u;return null==mode&&(mode="rgb"),r=channels[0],g=channels[1],b=channels[2],a=channels[3],u=r<<16|g<<8|b,str="000000"+u.toString(16),str=str.substr(str.length-6),hxa="0"+round(255*a).toString(16),hxa=hxa.substr(hxa.length-2),"#"+function(){switch(mode.toLowerCase()){case"rgba":return str+hxa;case"argb":return hxa+str;default:return str}}()},_input.hex=function(h){return hex2rgb(h)},chroma.hex=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["hex"]),function(){})},Color.prototype.hex=function(mode){return null==mode&&(mode="rgb"),rgb2hex(this._rgb,mode)},_guess_formats.push({p:10,test:function(n){return 1===arguments.length&&"string"===type(n)?"hex":void 0}}),hsl2rgb=function(){var args,b,c,g,h,i,l,o,r,ref,s,t1,t2,t3;if(args=unpack(arguments),h=args[0],s=args[1],l=args[2],0===s)r=g=b=255*l;else{for(t3=[0,0,0],c=[0,0,0],t2=.5>l?l*(1+s):l+s-l*s,t1=2*l-t2,h/=360,t3[0]=h+1/3,t3[1]=h,t3[2]=h-1/3,i=o=0;2>=o;i=++o)t3[i]<0&&(t3[i]+=1),t3[i]>1&&(t3[i]-=1),6*t3[i]<1?c[i]=t1+6*(t2-t1)*t3[i]:2*t3[i]<1?c[i]=t2:3*t3[i]<2?c[i]=t1+(t2-t1)*(2/3-t3[i])*6:c[i]=t1;ref=[round(255*c[0]),round(255*c[1]),round(255*c[2])],r=ref[0],g=ref[1],b=ref[2]}return args.length>3?[r,g,b,args[3]]:[r,g,b]},rgb2hsl=function(r,g,b){var h,l,min,ref,s;return void 0!==r&&r.length>=3&&(ref=r,r=ref[0],g=ref[1],b=ref[2]),r/=255,g/=255,b/=255,min=Math.min(r,g,b),max=Math.max(r,g,b),l=(max+min)/2,max===min?(s=0,h=Number.NaN):s=.5>l?(max-min)/(max+min):(max-min)/(2-max-min),r===max?h=(g-b)/(max-min):g===max?h=2+(b-r)/(max-min):b===max&&(h=4+(r-g)/(max-min)),h*=60,0>h&&(h+=360),[h,s,l]},chroma.hsl=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["hsl"]),function(){})},_input.hsl=hsl2rgb,Color.prototype.hsl=function(){return rgb2hsl(this._rgb)},hsv2rgb=function(){var args,b,f,g,h,i,p,q,r,ref,ref1,ref2,ref3,ref4,ref5,s,t,v;if(args=unpack(arguments),h=args[0],s=args[1],v=args[2],v*=255,0===s)r=g=b=v;else switch(360===h&&(h=0),h>360&&(h-=360),0>h&&(h+=360),h/=60,i=floor(h),f=h-i,p=v*(1-s),q=v*(1-s*f),t=v*(1-s*(1-f)),i){case 0:ref=[v,t,p],r=ref[0],g=ref[1],b=ref[2];break;case 1:ref1=[q,v,p],r=ref1[0],g=ref1[1],b=ref1[2];break;case 2:ref2=[p,v,t],r=ref2[0],g=ref2[1],b=ref2[2];break;case 3:ref3=[p,q,v],r=ref3[0],g=ref3[1],b=ref3[2];break;case 4:ref4=[t,p,v],r=ref4[0],g=ref4[1],b=ref4[2];break;case 5:ref5=[v,p,q],r=ref5[0],g=ref5[1],b=ref5[2]}return r=round(r),g=round(g),b=round(b),[r,g,b,args.length>3?args[3]:1]},rgb2hsv=function(){var b,delta,g,h,min,r,ref,s,v;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min,v=max/255,0===max?(h=Number.NaN,s=0):(s=delta/max,r===max&&(h=(g-b)/delta),g===max&&(h=2+(b-r)/delta),b===max&&(h=4+(r-g)/delta),h*=60,0>h&&(h+=360)),[h,s,v]},chroma.hsv=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["hsv"]),function(){})},_input.hsv=hsv2rgb,Color.prototype.hsv=function(){return rgb2hsv(this._rgb)},num2rgb=function(num){var b,g,r;return"number"===type(num)&&num>=0&&16777215>=num?(r=num>>16,g=num>>8&255,b=255&num,[r,g,b,1]):(console.warn("unknown num color: "+num),[0,0,0,1])},rgb2num=function(){var b,g,r,ref;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],(r<<16)+(g<<8)+b},chroma.num=function(num){return new Color(num,"num")},Color.prototype.num=function(mode){return null==mode&&(mode="rgb"),rgb2num(this._rgb,mode)},_input.num=num2rgb,_guess_formats.push({p:10,test:function(n){return 1===arguments.length&&"number"===type(n)&&n>=0&&16777215>=n?"num":void 0}}),css2rgb=function(css){var aa,ab,hsl,i,m,o,rgb,w;if(css=css.toLowerCase(),null!=chroma.colors&&chroma.colors[css])return hex2rgb(chroma.colors[css]);if(m=css.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(rgb=m.slice(1,4),i=o=0;2>=o;i=++o)rgb[i]=+rgb[i];rgb[3]=1}else if(m=css.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(rgb=m.slice(1,5),i=w=0;3>=w;i=++w)rgb[i]=+rgb[i];else if(m=css.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(rgb=m.slice(1,4),i=aa=0;2>=aa;i=++aa)rgb[i]=round(2.55*rgb[i]);rgb[3]=1}else if(m=css.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(rgb=m.slice(1,5),i=ab=0;2>=ab;i=++ab)rgb[i]=round(2.55*rgb[i]);rgb[3]=+rgb[3]}else(m=css.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(hsl=m.slice(1,4),hsl[1]*=.01,hsl[2]*=.01,rgb=hsl2rgb(hsl),rgb[3]=1):(m=css.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(hsl=m.slice(1,4),hsl[1]*=.01,hsl[2]*=.01,rgb=hsl2rgb(hsl),rgb[3]=+m[4]);return rgb},rgb2css=function(rgba){var mode;return mode=rgba[3]<1?"rgba":"rgb","rgb"===mode?mode+"("+rgba.slice(0,3).map(round).join(",")+")":"rgba"===mode?mode+"("+rgba.slice(0,3).map(round).join(",")+","+rgba[3]+")":void 0},rnd=function(a){return round(100*a)/100},hsl2css=function(hsl,alpha){var mode;return mode=1>alpha?"hsla":"hsl",hsl[0]=rnd(hsl[0]||0),hsl[1]=rnd(100*hsl[1])+"%",hsl[2]=rnd(100*hsl[2])+"%","hsla"===mode&&(hsl[3]=alpha),mode+"("+hsl.join(",")+")"},_input.css=function(h){return css2rgb(h)},chroma.css=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["css"]),function(){})},Color.prototype.css=function(mode){return null==mode&&(mode="rgb"),"rgb"===mode.slice(0,3)?rgb2css(this._rgb):"hsl"===mode.slice(0,3)?hsl2css(this.hsl(),this.alpha()):void 0},_input.named=function(name){return hex2rgb(w3cx11[name])},_guess_formats.push({p:20,test:function(n){return 1===arguments.length&&null!=w3cx11[n]?"named":void 0}}),Color.prototype.name=function(n){var h,k;arguments.length&&(w3cx11[n]&&(this._rgb=hex2rgb(w3cx11[n])),this._rgb[3]=1),h=this.hex();for(k in w3cx11)if(h===w3cx11[k])return k;return h},lch2lab=function(){var c,h,l,ref;return ref=unpack(arguments),l=ref[0],c=ref[1],h=ref[2],h=h*PI/180,[l,cos(h)*c,sin(h)*c]},lch2rgb=function(){var L,a,args,b,c,g,h,l,r,ref,ref1;return args=unpack(arguments),l=args[0],c=args[1],h=args[2],ref=lch2lab(l,c,h),L=ref[0],a=ref[1],b=ref[2],ref1=lab2rgb(L,a,b),r=ref1[0],g=ref1[1],b=ref1[2],[limit(r,0,255),limit(g,0,255),limit(b,0,255),args.length>3?args[3]:1]},lab2lch=function(){var a,b,c,h,l,ref;return ref=unpack(arguments),l=ref[0],a=ref[1],b=ref[2],c=sqrt(a*a+b*b),h=(atan2(b,a)/PI*180+360)%360,[l,c,h]},rgb2lch=function(){var a,b,g,l,r,ref,ref1;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],ref1=rgb2lab(r,g,b),l=ref1[0],a=ref1[1],b=ref1[2],lab2lch(l,a,b)},chroma.lch=function(){var args;return args=unpack(arguments),new Color(args,"lch")},chroma.hcl=function(){var args;return args=unpack(arguments),new Color(args,"hcl")},_input.lch=lch2rgb,_input.hcl=function(){var c,h,l,ref;return ref=unpack(arguments),h=ref[0],c=ref[1],l=ref[2],lch2rgb([l,c,h])},Color.prototype.lch=function(){return rgb2lch(this._rgb)},Color.prototype.hcl=function(){return rgb2lch(this._rgb).reverse()},rgb2cmyk=function(mode){var b,c,f,g,k,m,r,ref,y;return null==mode&&(mode="rgb"),ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],r/=255,g/=255,b/=255,k=1-Math.max(r,Math.max(g,b)),f=1>k?1/(1-k):0,c=(1-r-k)*f,m=(1-g-k)*f,y=(1-b-k)*f,[c,m,y,k]},cmyk2rgb=function(){var alpha,args,b,c,g,k,m,r,y;return args=unpack(arguments),c=args[0],m=args[1],y=args[2],k=args[3],alpha=args.length>4?args[4]:1,1===k?[0,0,0,alpha]:(r=c>=1?0:round(255*(1-c)*(1-k)),g=m>=1?0:round(255*(1-m)*(1-k)),b=y>=1?0:round(255*(1-y)*(1-k)),[r,g,b,alpha])},_input.cmyk=function(){return cmyk2rgb(unpack(arguments))},chroma.cmyk=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["cmyk"]),function(){})},Color.prototype.cmyk=function(){return rgb2cmyk(this._rgb)},_input.gl=function(){var i,k,o,rgb,v;for(rgb=function(){var ref,results;ref=unpack(arguments),results=[];for(k in ref)v=ref[k],results.push(v);return results}.apply(this,arguments),i=o=0;2>=o;i=++o)rgb[i]*=255;return rgb},chroma.gl=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["gl"]),function(){})},Color.prototype.gl=function(){var rgb;return rgb=this._rgb,[rgb[0]/255,rgb[1]/255,rgb[2]/255,rgb[3]]},rgb2luminance=function(r,g,b){var ref;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],r=luminance_x(r),g=luminance_x(g),b=luminance_x(b),.2126*r+.7152*g+.0722*b},luminance_x=function(x){return x/=255,.03928>=x?x/12.92:pow((x+.055)/1.055,2.4)},_interpolators=[],interpolate=function(col1,col2,f,m){var interpol,len,o,res;for(null==f&&(f=.5),null==m&&(m="rgb"),"object"!==type(col1)&&(col1=chroma(col1)),"object"!==type(col2)&&(col2=chroma(col2)),o=0,len=_interpolators.length;len>o;o++)if(interpol=_interpolators[o],m===interpol[0]){res=interpol[1](col1,col2,f,m);break}if(null==res)throw"color mode "+m+" is not supported";return res.alpha(col1.alpha()+f*(col2.alpha()-col1.alpha())),res},chroma.interpolate=interpolate,Color.prototype.interpolate=function(col2,f,m){return interpolate(this,col2,f,m)},chroma.mix=interpolate,Color.prototype.mix=Color.prototype.interpolate,interpolate_rgb=function(col1,col2,f,m){var xyz0,xyz1;return xyz0=col1._rgb,xyz1=col2._rgb,new Color(xyz0[0]+f*(xyz1[0]-xyz0[0]),xyz0[1]+f*(xyz1[1]-xyz0[1]),xyz0[2]+f*(xyz1[2]-xyz0[2]),m)},_interpolators.push(["rgb",interpolate_rgb]),Color.prototype.luminance=function(lum,mode){var cur_lum,eps,max_iter,test;return null==mode&&(mode="rgb"),arguments.length?(0===lum?this._rgb=[0,0,0,this._rgb[3]]:1===lum?this._rgb=[255,255,255,this._rgb[3]]:(eps=1e-7,max_iter=20,test=function(l,h){var lm,m;return m=l.interpolate(h,.5,mode),lm=m.luminance(),Math.abs(lum-lm)<eps||!max_iter--?m:lm>lum?test(l,m):test(m,h)},cur_lum=rgb2luminance(this._rgb),this._rgb=(cur_lum>lum?test(chroma("black"),this):test(this,chroma("white"))).rgba()),this):rgb2luminance(this._rgb)},temperature2rgb=function(kelvin){var b,g,r,temp;return temp=kelvin/100,66>temp?(r=255,g=-155.25485562709179-.44596950469579133*(g=temp-2)+104.49216199393888*log(g),b=20>temp?0:-254.76935184120902+.8274096064007395*(b=temp-10)+115.67994401066147*log(b)):(r=351.97690566805693+.114206453784165*(r=temp-55)-40.25366309332127*log(r),g=325.4494125711974+.07943456536662342*(g=temp-50)-28.0852963507957*log(g),b=255),clip_rgb([r,g,b])},rgb2temperature=function(){var b,eps,g,maxTemp,minTemp,r,ref,rgb,temp;for(ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],minTemp=1e3,maxTemp=4e4,eps=.4;maxTemp-minTemp>eps;)temp=.5*(maxTemp+minTemp),rgb=temperature2rgb(temp),rgb[2]/rgb[0]>=b/r?maxTemp=temp:minTemp=temp;return round(temp)},chroma.temperature=chroma.kelvin=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["temperature"]),function(){})},_input.temperature=_input.kelvin=_input.K=temperature2rgb,Color.prototype.temperature=function(){return rgb2temperature(this._rgb)},Color.prototype.kelvin=Color.prototype.temperature,chroma.contrast=function(a,b){var l1,l2,ref,ref1;return("string"===(ref=type(a))||"number"===ref)&&(a=new Color(a)),("string"===(ref1=type(b))||"number"===ref1)&&(b=new Color(b)),l1=a.luminance(),l2=b.luminance(),l1>l2?(l1+.05)/(l2+.05):(l2+.05)/(l1+.05)},Color.prototype.darken=function(amount){var lch,me;return null==amount&&(amount=20),me=this,lch=me.lch(),lch[0]-=amount,chroma.lch(lch).alpha(me.alpha())},Color.prototype.darker=Color.prototype.darken,Color.prototype.brighten=function(amount){return null==amount&&(amount=20),this.darken(-amount)},Color.prototype.brighter=Color.prototype.brighten,Color.prototype.saturate=function(amount){var lch,me;return null==amount&&(amount=20),me=this,lch=me.lch(),lch[1]+=amount,lch[1]<0&&(lch[1]=0),chroma.lch(lch).alpha(me.alpha())},Color.prototype.desaturate=function(amount){return null==amount&&(amount=20),this.saturate(-amount)},Color.prototype.premultiply=function(){var a,rgb;return rgb=this.rgb(),a=this.alpha(),chroma(rgb[0]*a,rgb[1]*a,rgb[2]*a,a)},blend=function(bottom,top,mode){if(!blend[mode])throw"unknown blend mode "+mode;return blend[mode](bottom,top)},blend_f=function(f){return function(bottom,top){var c0,c1;return c0=chroma(top).rgb(),c1=chroma(bottom).rgb(),chroma(f(c0,c1),"rgb")}},each=function(f){return function(c0,c1){var i,o,out;for(out=[],i=o=0;3>=o;i=++o)out[i]=f(c0[i],c1[i]);return out}},normal=function(a,b){return a},multiply=function(a,b){return a*b/255},darken=function(a,b){return a>b?b:a},lighten=function(a,b){return a>b?a:b},screen=function(a,b){return 255*(1-(1-a/255)*(1-b/255))},overlay=function(a,b){return 128>b?2*a*b/255:255*(1-2*(1-a/255)*(1-b/255))},burn=function(a,b){return 255*(1-(1-b/255)/(a/255))},dodge=function(a,b){return 255===a?255:(a=255*(b/255)/(1-a/255),a>255?255:a)},blend.normal=blend_f(each(normal)),blend.multiply=blend_f(each(multiply)),blend.screen=blend_f(each(screen)),blend.overlay=blend_f(each(overlay)),blend.darken=blend_f(each(darken)),blend.lighten=blend_f(each(lighten)),blend.dodge=blend_f(each(dodge)),blend.burn=blend_f(each(burn)),chroma.blend=blend,chroma.scale=function(colors,positions){var _colorCache,_colors,_correctLightness,_domain,_fixed,_max,_min,_mode,_nacol,_numClasses,_out,_pos,_spread,classifyValue,f,getClass,getColor,resetCache,setColors,setDomain,tmap;return _mode="rgb",_nacol=chroma("#ccc"),_spread=0,_fixed=!1,_domain=[0,1],_colors=[],_out=!1,_pos=[],_min=0,_max=1,_correctLightness=!1,_numClasses=0,_colorCache={},setColors=function(colors,positions){var c,col,o,ref,ref1,ref2,w;if(null==colors&&(colors=["#ddd","#222"]),null!=colors&&"string"===type(colors)&&null!=(null!=(ref=chroma.brewer)?ref[colors]:void 0)&&(colors=chroma.brewer[colors]),"array"===type(colors)){for(colors=colors.slice(0),c=o=0,ref1=colors.length-1;ref1>=0?ref1>=o:o>=ref1;c=ref1>=0?++o:--o)col=colors[c],"string"===type(col)&&(colors[c]=chroma(col));if(null!=positions)_pos=positions;else for(_pos=[],c=w=0,ref2=colors.length-1;ref2>=0?ref2>=w:w>=ref2;c=ref2>=0?++w:--w)_pos.push(c/(colors.length-1))}return resetCache(),_colors=colors},setDomain=function(domain){return null==domain&&(domain=[]),_domain=domain,_min=domain[0],_max=domain[domain.length-1],resetCache(),_numClasses=2===domain.length?0:domain.length-1},getClass=function(value){var i,n;if(null!=_domain){for(n=_domain.length-1,i=0;n>i&&value>=_domain[i];)i++;return i-1}return 0},tmap=function(t){return t},classifyValue=function(value){var i,maxc,minc,n,val;return val=value,_domain.length>2&&(n=_domain.length-1,i=getClass(value),minc=_domain[0]+(_domain[1]-_domain[0])*(0+.5*_spread),maxc=_domain[n-1]+(_domain[n]-_domain[n-1])*(1-.5*_spread),val=_min+(_domain[i]+.5*(_domain[i+1]-_domain[i])-minc)/(maxc-minc)*(_max-_min)),val},getColor=function(val,bypassMap){var c,col,f0,i,k,o,p,ref,t;if(null==bypassMap&&(bypassMap=!1),isNaN(val))return _nacol;if(bypassMap?t=val:_domain.length>2?(c=getClass(val),t=c/(_numClasses-1)):(t=f0=(val-_min)/(_max-_min),t=Math.min(1,Math.max(0,t))),bypassMap||(t=tmap(t)),k=Math.floor(1e4*t),_colorCache[k])col=_colorCache[k];else{if("array"===type(_colors))for(i=o=0,ref=_pos.length-1;ref>=0?ref>=o:o>=ref;i=ref>=0?++o:--o){if(p=_pos[i],p>=t){col=_colors[i];break}if(t>=p&&i===_pos.length-1){col=_colors[i];break}if(t>p&&t<_pos[i+1]){t=(t-p)/(_pos[i+1]-p),col=chroma.interpolate(_colors[i],_colors[i+1],t,_mode);break}}else"function"===type(_colors)&&(col=_colors(t));_colorCache[k]=col}return col},resetCache=function(){return _colorCache={}},setColors(colors,positions),f=function(v){var c;return c=getColor(v),_out&&c[_out]?c[_out]():c},f.domain=function(domain,classes,mode,key){var d;return null==mode&&(mode="e"),arguments.length?(null!=classes&&(d=chroma.analyze(domain,key),domain=0===classes?[d.min,d.max]:chroma.limits(d,mode,classes)),setDomain(domain),f):_domain},f.mode=function(_m){return arguments.length?(_mode=_m,resetCache(),f):_mode},f.range=function(colors,_pos){return setColors(colors,_pos),f},f.out=function(_o){return _out=_o,f},f.spread=function(val){return arguments.length?(_spread=val,f):_spread},f.correctLightness=function(v){return arguments.length?(_correctLightness=v,resetCache(),tmap=_correctLightness?function(t){var L0,L1,L_actual,L_diff,L_ideal,max_iter,pol,t0,t1;for(L0=getColor(0,!0).lab()[0],L1=getColor(1,!0).lab()[0],pol=L0>L1,L_actual=getColor(t,!0).lab()[0],L_ideal=L0+(L1-L0)*t,L_diff=L_actual-L_ideal,t0=0,t1=1,max_iter=20;Math.abs(L_diff)>.01&&max_iter-->0;)!function(){return pol&&(L_diff*=-1),0>L_diff?(t0=t,t+=.5*(t1-t)):(t1=t,t+=.5*(t0-t)),L_actual=getColor(t,!0).lab()[0],L_diff=L_actual-L_ideal}();return t}:function(t){return t},f):_correctLightness},f.colors=function(){var aa,i,len,numColors,out,ref,results,samples,w;if(numColors=0,out="hex",1===arguments.length&&("string"===type(arguments[0])?out=arguments[0]:numColors=arguments[0]),2===arguments.length&&(numColors=arguments[0],out=arguments[1]),numColors)return function(){results=[];for(var o=0;numColors>=0?numColors>o:o>numColors;numColors>=0?o++:o--)results.push(o);return results}.apply(this).map(function(i){return f(i/(numColors-1))[out]()});if(colors=[],samples=[],_domain.length>2)for(i=w=1,ref=_domain.length;ref>=1?ref>w:w>ref;i=ref>=1?++w:--w)samples.push(.5*(_domain[i-1]+_domain[i]));else samples=_domain;for(aa=0,len=samples.length;len>aa;aa++)i=samples[aa],colors.push(f(i)[out]());return colors},f},null==chroma.scales&&(chroma.scales={}),chroma.scales.cool=function(){return chroma.scale([chroma.hsl(180,1,.9),chroma.hsl(250,.7,.4)])},chroma.scales.hot=function(){return chroma.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},chroma.analyze=function(data,key,filter){var add,k,len,o,r,val,visit;if(r={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==filter&&(filter=function(){return!0}),add=function(val){null==val||isNaN(val)||(r.values.push(val),r.sum+=val,val<r.min&&(r.min=val),val>r.max&&(r.max=val),r.count+=1)},visit=function(val,k){return filter(val,k)?add(null!=key&&"function"===type(key)?key(val):null!=key&&"string"===type(key)||"number"===type(key)?val[key]:val):void 0},"array"===type(data))for(o=0,len=data.length;len>o;o++)val=data[o],visit(val);else for(k in data)val=data[k],visit(val,k);return r.domain=[r.min,r.max],r.limits=function(mode,num){return chroma.limits(r,mode,num)},r},chroma.limits=function(data,mode,num){var aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,assignments,best,centroids,cluster,clusterSizes,dist,i,j,kClusters,limits,max_log,min,min_log,mindist,n,nb_iters,newCentroids,o,p,pb,pr,ref,ref1,ref10,ref11,ref12,ref13,ref14,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,repeat,sum,tmpKMeansBreaks,value,values,w;if(null==mode&&(mode="equal"),null==num&&(num=7),"array"===type(data)&&(data=chroma.analyze(data)),min=data.min,max=data.max,sum=data.sum,values=data.values.sort(function(a,b){return a-b}),limits=[],"c"===mode.substr(0,1)&&(limits.push(min),limits.push(max)),"e"===mode.substr(0,1)){for(limits.push(min),i=o=1,ref=num-1;ref>=1?ref>=o:o>=ref;i=ref>=1?++o:--o)limits.push(min+i/num*(max-min));limits.push(max)}else if("l"===mode.substr(0,1)){if(0>=min)throw"Logarithmic scales are only possible for values > 0";for(min_log=Math.LOG10E*log(min),max_log=Math.LOG10E*log(max),limits.push(min),i=w=1,ref1=num-1;ref1>=1?ref1>=w:w>=ref1;i=ref1>=1?++w:--w)limits.push(pow(10,min_log+i/num*(max_log-min_log)));limits.push(max)}else if("q"===mode.substr(0,1)){for(limits.push(min),i=aa=1,ref2=num-1;ref2>=1?ref2>=aa:aa>=ref2;i=ref2>=1?++aa:--aa)p=values.length*i/num,pb=floor(p),pb===p?limits.push(values[pb]):(pr=p-pb,limits.push(values[pb]*pr+values[pb+1]*(1-pr)));limits.push(max)}else if("k"===mode.substr(0,1)){for(n=values.length,assignments=new Array(n),clusterSizes=new Array(num),repeat=!0,nb_iters=0,centroids=null,centroids=[],centroids.push(min),i=ab=1,ref3=num-1;ref3>=1?ref3>=ab:ab>=ref3;i=ref3>=1?++ab:--ab)centroids.push(min+i/num*(max-min));for(centroids.push(max);repeat;){for(j=ac=0,ref4=num-1;ref4>=0?ref4>=ac:ac>=ref4;j=ref4>=0?++ac:--ac)clusterSizes[j]=0;for(i=ad=0,ref5=n-1;ref5>=0?ref5>=ad:ad>=ref5;i=ref5>=0?++ad:--ad){for(value=values[i],mindist=Number.MAX_VALUE,j=ae=0,ref6=num-1;ref6>=0?ref6>=ae:ae>=ref6;j=ref6>=0?++ae:--ae)dist=abs(centroids[j]-value),mindist>dist&&(mindist=dist,best=j);clusterSizes[best]++,assignments[i]=best}for(newCentroids=new Array(num),j=af=0,ref7=num-1;ref7>=0?ref7>=af:af>=ref7;j=ref7>=0?++af:--af)newCentroids[j]=null;for(i=ag=0,ref8=n-1;ref8>=0?ref8>=ag:ag>=ref8;i=ref8>=0?++ag:--ag)cluster=assignments[i],null===newCentroids[cluster]?newCentroids[cluster]=values[i]:newCentroids[cluster]+=values[i];for(j=ah=0,ref9=num-1;ref9>=0?ref9>=ah:ah>=ref9;j=ref9>=0?++ah:--ah)newCentroids[j]*=1/clusterSizes[j];for(repeat=!1,j=ai=0,ref10=num-1;ref10>=0?ref10>=ai:ai>=ref10;j=ref10>=0?++ai:--ai)if(newCentroids[j]!==centroids[i]){repeat=!0;break}centroids=newCentroids,nb_iters++,nb_iters>200&&(repeat=!1)}for(kClusters={},j=aj=0,ref11=num-1;ref11>=0?ref11>=aj:aj>=ref11;j=ref11>=0?++aj:--aj)kClusters[j]=[];for(i=ak=0,ref12=n-1;ref12>=0?ref12>=ak:ak>=ref12;i=ref12>=0?++ak:--ak)cluster=assignments[i],kClusters[cluster].push(values[i]);for(tmpKMeansBreaks=[],j=al=0,ref13=num-1;ref13>=0?ref13>=al:al>=ref13;j=ref13>=0?++al:--al)tmpKMeansBreaks.push(kClusters[j][0]),tmpKMeansBreaks.push(kClusters[j][kClusters[j].length-1]);for(tmpKMeansBreaks=tmpKMeansBreaks.sort(function(a,b){return a-b}),limits.push(tmpKMeansBreaks[0]),i=am=1,ref14=tmpKMeansBreaks.length-1;ref14>=am;i=am+=2)isNaN(tmpKMeansBreaks[i])||limits.push(tmpKMeansBreaks[i])}return limits},hsi2rgb=function(h,s,i){var args,b,g,r;return args=unpack(arguments),h=args[0],s=args[1],i=args[2],h/=360,1/3>h?(b=(1-s)/3,r=(1+s*cos(TWOPI*h)/cos(PITHIRD-TWOPI*h))/3,g=1-(b+r)):2/3>h?(h-=1/3,r=(1-s)/3,g=(1+s*cos(TWOPI*h)/cos(PITHIRD-TWOPI*h))/3,b=1-(r+g)):(h-=2/3,g=(1-s)/3,b=(1+s*cos(TWOPI*h)/cos(PITHIRD-TWOPI*h))/3,r=1-(g+b)),r=limit(i*r*3),g=limit(i*g*3),b=limit(i*b*3),[255*r,255*g,255*b,args.length>3?args[3]:1]},rgb2hsi=function(){var b,g,h,i,min,r,ref,s;return ref=unpack(arguments),r=ref[0],g=ref[1],b=ref[2],TWOPI=2*Math.PI,r/=255,g/=255,b/=255,min=Math.min(r,g,b),i=(r+g+b)/3,s=1-min/i,0===s?h=0:(h=(r-g+(r-b))/2,h/=Math.sqrt((r-g)*(r-g)+(r-b)*(g-b)),h=Math.acos(h),b>g&&(h=TWOPI-h),h/=TWOPI),[360*h,s,i]},chroma.hsi=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Color,slice.call(arguments).concat(["hsi"]),function(){})},_input.hsi=hsi2rgb,Color.prototype.hsi=function(){return rgb2hsi(this._rgb)},interpolate_hsx=function(col1,col2,f,m){var dh,hue,hue0,hue1,lbv,lbv0,lbv1,res,sat,sat0,sat1,xyz0,xyz1;return"hsl"===m?(xyz0=col1.hsl(),xyz1=col2.hsl()):"hsv"===m?(xyz0=col1.hsv(),xyz1=col2.hsv()):"hsi"===m?(xyz0=col1.hsi(),xyz1=col2.hsi()):"lch"===m&&(xyz0=col1.lch(),xyz1=col2.lch()),"h"===m.substr(0,1)?(hue0=xyz0[0],sat0=xyz0[1],lbv0=xyz0[2],hue1=xyz1[0],sat1=xyz1[1],lbv1=xyz1[2]):(lbv0=xyz0[0],sat0=xyz0[1],hue0=xyz0[2],lbv1=xyz1[0],sat1=xyz1[1],hue1=xyz1[2]),isNaN(hue0)||isNaN(hue1)?isNaN(hue0)?isNaN(hue1)?hue=Number.NaN:(hue=hue1,1!==lbv0&&0!==lbv0||"hsv"===m||(sat=sat1)):(hue=hue0,1!==lbv1&&0!==lbv1||"hsv"===m||(sat=sat0)):(dh=hue1>hue0&&hue1-hue0>180?hue1-(hue0+360):hue0>hue1&&hue0-hue1>180?hue1+360-hue0:hue1-hue0,hue=hue0+f*dh),null==sat&&(sat=sat0+f*(sat1-sat0)),lbv=lbv0+f*(lbv1-lbv0),res="h"===m.substr(0,1)?new Color(hue,sat,lbv,m):new Color(lbv,sat,hue,m)},_interpolators=_interpolators.concat(function(){var len,o,ref,results;for(ref=["hsv","hsl","hsi","lch"],results=[],o=0,len=ref.length;len>o;o++)m=ref[o],results.push([m,interpolate_hsx]);return results}()),interpolate_num=function(col1,col2,f,m){var n1,n2;return n1=col1.num(),n2=col2.num(),chroma.num(n1+(n2-n1)*f,"num")},_interpolators.push(["num",interpolate_num]),interpolate_lab=function(col1,col2,f,m){var res,xyz0,xyz1;return xyz0=col1.lab(),xyz1=col2.lab(),res=new Color(xyz0[0]+f*(xyz1[0]-xyz0[0]),xyz0[1]+f*(xyz1[1]-xyz0[1]),xyz0[2]+f*(xyz1[2]-xyz0[2]),m)},_interpolators.push(["lab",interpolate_lab])}.call(this),self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{};var Prism=function(){var lang=/\blang(?:uage)?-(?!\*)(\w+)\b/i,_=self.Prism={util:{encode:function(tokens){return tokens instanceof Token?new Token(tokens.type,_.util.encode(tokens.content),tokens.alias):"Array"===_.util.type(tokens)?tokens.map(_.util.encode):tokens.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(o){return Object.prototype.toString.call(o).match(/\[object (\w+)\]/)[1]},clone:function(o){var type=_.util.type(o);switch(type){case"Object":var clone={};for(var key in o)o.hasOwnProperty(key)&&(clone[key]=_.util.clone(o[key]));return clone;case"Array":return o.map(function(v){return _.util.clone(v)})}return o}},languages:{extend:function(id,redef){var lang=_.util.clone(_.languages[id]);for(var key in redef)lang[key]=redef[key];return lang},insertBefore:function(inside,before,insert,root){root=root||_.languages;var grammar=root[inside];if(2==arguments.length){insert=arguments[1];for(var newToken in insert)insert.hasOwnProperty(newToken)&&(grammar[newToken]=insert[newToken]);return grammar}var ret={};for(var token in grammar)if(grammar.hasOwnProperty(token)){if(token==before)for(var newToken in insert)insert.hasOwnProperty(newToken)&&(ret[newToken]=insert[newToken]);
ret[token]=grammar[token]}return _.languages.DFS(_.languages,function(key,value){value===root[inside]&&key!=inside&&(this[key]=ret)}),root[inside]=ret},DFS:function(o,callback,type){for(var i in o)o.hasOwnProperty(i)&&(callback.call(o,i,o[i],type||i),"Object"===_.util.type(o[i])?_.languages.DFS(o[i],callback):"Array"===_.util.type(o[i])&&_.languages.DFS(o[i],callback,i))}},highlightAll:function(async,callback){for(var element,elements=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'),i=0;element=elements[i++];)_.highlightElement(element,async===!0,callback)},highlightElement:function(element,async,callback){for(var language,grammar,parent=element;parent&&!lang.test(parent.className);)parent=parent.parentNode;if(parent&&(language=(parent.className.match(lang)||[,""])[1],grammar=_.languages[language]),element.className=element.className.replace(lang,"").replace(/\s+/g," ")+" language-"+language,parent=element.parentNode,/pre/i.test(parent.nodeName)&&(parent.className=parent.className.replace(lang,"").replace(/\s+/g," ")+" language-"+language),grammar){var code=element.textContent;if(code){code=code.replace(/^(?:\r?\n|\r)/,"");var env={element:element,language:language,grammar:grammar,code:code};if(_.hooks.run("before-highlight",env),async&&self.Worker){var worker=new Worker(_.filename);worker.onmessage=function(evt){env.highlightedCode=Token.stringify(JSON.parse(evt.data),language),_.hooks.run("before-insert",env),env.element.innerHTML=env.highlightedCode,callback&&callback.call(env.element),_.hooks.run("after-highlight",env)},worker.postMessage(JSON.stringify({language:env.language,code:env.code}))}else env.highlightedCode=_.highlight(env.code,env.grammar,env.language),_.hooks.run("before-insert",env),env.element.innerHTML=env.highlightedCode,callback&&callback.call(element),_.hooks.run("after-highlight",env)}}},highlight:function(text,grammar,language){var tokens=_.tokenize(text,grammar);return Token.stringify(_.util.encode(tokens),language)},tokenize:function(text,grammar,language){var Token=_.Token,strarr=[text],rest=grammar.rest;if(rest){for(var token in rest)grammar[token]=rest[token];delete grammar.rest}tokenloop:for(var token in grammar)if(grammar.hasOwnProperty(token)&&grammar[token]){var patterns=grammar[token];patterns="Array"===_.util.type(patterns)?patterns:[patterns];for(var j=0;j<patterns.length;++j){var pattern=patterns[j],inside=pattern.inside,lookbehind=!!pattern.lookbehind,lookbehindLength=0,alias=pattern.alias;pattern=pattern.pattern||pattern;for(var i=0;i<strarr.length;i++){var str=strarr[i];if(strarr.length>text.length)break tokenloop;if(!(str instanceof Token)){pattern.lastIndex=0;var match=pattern.exec(str);if(match){lookbehind&&(lookbehindLength=match[1].length);var from=match.index-1+lookbehindLength,match=match[0].slice(lookbehindLength),len=match.length,to=from+len,before=str.slice(0,from+1),after=str.slice(to+1),args=[i,1];before&&args.push(before);var wrapped=new Token(token,inside?_.tokenize(match,inside):match,alias);args.push(wrapped),after&&args.push(after),Array.prototype.splice.apply(strarr,args)}}}}}return strarr},hooks:{all:{},add:function(name,callback){var hooks=_.hooks.all;hooks[name]=hooks[name]||[],hooks[name].push(callback)},run:function(name,env){var callbacks=_.hooks.all[name];if(callbacks&&callbacks.length)for(var callback,i=0;callback=callbacks[i++];)callback(env)}}},Token=_.Token=function(type,content,alias){this.type=type,this.content=content,this.alias=alias};if(Token.stringify=function(o,language,parent){if("string"==typeof o)return o;if("Array"===_.util.type(o))return o.map(function(element){return Token.stringify(element,language,o)}).join("");var env={type:o.type,content:Token.stringify(o.content,language,parent),tag:"span",classes:["token",o.type],attributes:{},language:language,parent:parent};if("comment"==env.type&&(env.attributes.spellcheck="true"),o.alias){var aliases="Array"===_.util.type(o.alias)?o.alias:[o.alias];Array.prototype.push.apply(env.classes,aliases)}_.hooks.run("wrap",env);var attributes="";for(var name in env.attributes)attributes+=name+'="'+(env.attributes[name]||"")+'"';return"<"+env.tag+' class="'+env.classes.join(" ")+'" '+attributes+">"+env.content+"</"+env.tag+">"},!self.document)return self.addEventListener?(self.addEventListener("message",function(evt){var message=JSON.parse(evt.data),lang=message.language,code=message.code;self.postMessage(JSON.stringify(_.util.encode(_.tokenize(code,_.languages[lang])))),self.close()},!1),self.Prism):self.Prism;var script=document.getElementsByTagName("script");return script=script[script.length-1],script&&(_.filename=script.src,document.addEventListener&&!script.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",_.highlightAll)),self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?[^\s>\/]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(env){"entity"===env.type&&(env.attributes.title=env.content.replace(/&amp;/,"&"))}),Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/<style[\w\W]*?>[\w\W]*?<\/style>/i,inside:{tag:{pattern:/<style[\w\W]*?>|<\/style>/i,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.css},alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:/("|')(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,"class-name":{pattern:/((?:(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee]-?\d+)?)\b/,operator:/[-+]{1,2}|!|<=?|>=?|={1,3}|&{1,2}|\|?\||\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|false|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|true|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/(?!\d)[a-z0-9_$]+(?=\()/i}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0}}),Prism.languages.insertBefore("javascript","class-name",{"template-string":{pattern:/`(?:\\`|\\?[^`])*`/,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/<script[\w\W]*?>[\w\W]*?<\/script>/i,inside:{tag:{pattern:/<script[\w\W]*?>|<\/script>/i,inside:Prism.languages.markup.tag.inside},rest:Prism.languages.javascript},alias:"language-javascript"}}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(root,factory){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)});else if("undefined"!=typeof exports){var _=require("underscore");factory(root,exports,_)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice;Backbone.VERSION="1.1.2",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events=void 0,this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=options);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return model.set(model.parse(resp,options),options)?(success&&success(model,resp,options),void model.trigger("sync",model,resp,options)):!1},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),_.isObject(serverAttrs)&&!model.set(serverAttrs,options)?!1:(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return error?(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1):!0}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model,options));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){if(attrs=models[i]||{},id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute||"id"],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),this._addReference(model,options)}model=existing||model,!order||!model.isNew()&&modelMap[model.id]||order.push(model),modelMap[model.id]=!0}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_addReference:function(model,options){this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model),model.collection||(model.collection=this),model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args),
router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},execute:function(callback,args){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);if(this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow,this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current===this.fragment?!1:(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],factory):global.Backbone.Radio=factory(global._,global.Backbone)}(this,function(_,Backbone){"use strict";function removeHandler(store,name,callback,context){var event=store[name];return callback&&callback!==event.callback&&callback!==event.callback._callback||context&&context!==event.context?void 0:(delete store[name],!0)}function removeHandlers(store,name,callback,context){store||(store={});for(var names=name?[name]:_.keys(store),matched=!1,i=0,length=names.length;length>i;i++)name=names[i],store[name]&&removeHandler(store,name,callback,context)&&(matched=!0);return matched}function _partial(channelName){return _logs[channelName]||(_logs[channelName]=_.partial(Radio.log,channelName))}function makeCallback(callback){return _.isFunction(callback)?callback:function(){return callback}}var previousRadio=Backbone.Radio,Radio=Backbone.Radio={};Radio.VERSION="1.0.1",Radio.noConflict=function(){return Backbone.Radio=previousRadio,this},Radio.DEBUG=!1,Radio._debugText=function(warning,eventName,channelName){return warning+(channelName?" on the "+channelName+" channel":"")+': "'+eventName+'"'},Radio.debugLog=function(warning,eventName,channelName){Radio.DEBUG&&console&&console.warn&&console.warn(Radio._debugText(warning,eventName,channelName))};var eventSplitter=/\s+/;Radio._eventsApi=function(obj,action,name,rest){if(!name)return!1;var results={};if("object"==typeof name){for(var key in name){var result=obj[action].apply(obj,[key,name[key]].concat(rest));eventSplitter.test(key)?_.extend(results,result):results[key]=result}return results}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)results[names[i]]=obj[action].apply(obj,[names[i]].concat(rest));return results}return!1},Radio._callHandler=function(callback,context,args){var a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:return callback.call(context);case 1:return callback.call(context,a1);case 2:return callback.call(context,a1,a2);case 3:return callback.call(context,a1,a2,a3);default:return callback.apply(context,args)}};var _logs={};_.extend(Radio,{log:function(channelName,eventName){var args=_.rest(arguments,2);console.log("["+channelName+'] "'+eventName+'"',args)},tuneIn:function(channelName){var channel=Radio.channel(channelName);return channel._tunedIn=!0,channel.on("all",_partial(channelName)),this},tuneOut:function(channelName){var channel=Radio.channel(channelName);return channel._tunedIn=!1,channel.off("all",_partial(channelName)),delete _logs[channelName],this}}),Radio.Requests={request:function(name){var args=_.rest(arguments),results=Radio._eventsApi(this,"request",name,args);if(results)return results;var channelName=this.channelName,requests=this._requests;if(channelName&&this._tunedIn&&Radio.log.apply(this,[channelName,name].concat(args)),requests&&(requests[name]||requests["default"])){var handler=requests[name]||requests["default"];return args=requests[name]?args:arguments,Radio._callHandler(handler.callback,handler.context,args)}Radio.debugLog("An unhandled request was fired",name,channelName)},reply:function(name,callback,context){return Radio._eventsApi(this,"reply",name,[callback,context])?this:(this._requests||(this._requests={}),this._requests[name]&&Radio.debugLog("A request was overwritten",name,this.channelName),this._requests[name]={callback:makeCallback(callback),context:context||this},this)},replyOnce:function(name,callback,context){if(Radio._eventsApi(this,"replyOnce",name,[callback,context]))return this;var self=this,once=_.once(function(){return self.stopReplying(name),makeCallback(callback).apply(this,arguments)});return this.reply(name,once,context)},stopReplying:function(name,callback,context){return Radio._eventsApi(this,"stopReplying",name)?this:(name||callback||context?removeHandlers(this._requests,name,callback,context)||Radio.debugLog("Attempted to remove the unregistered request",name,this.channelName):delete this._requests,this)}},Radio._channels={},Radio.channel=function(channelName){if(!channelName)throw new Error("You must provide a name for the channel.");return Radio._channels[channelName]?Radio._channels[channelName]:Radio._channels[channelName]=new Radio.Channel(channelName)},Radio.Channel=function(channelName){this.channelName=channelName},_.extend(Radio.Channel.prototype,Backbone.Events,Radio.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var channel,args,systems=[Backbone.Events,Radio.Commands,Radio.Requests];_.each(systems,function(system){_.each(system,function(method,methodName){Radio[methodName]=function(channelName){return args=_.rest(arguments),channel=this.channel(channelName),channel[methodName].apply(channel,args)}})}),Radio.reset=function(channelName){var channels=channelName?[this._channels[channelName]]:this._channels;_.invoke(channels,"reset")};var backbone_radio=Radio;return backbone_radio}),function(factory){"function"==typeof define&&define.amd?define(["underscore","backbone","exports"],factory):"object"==typeof exports?factory(require("underscore"),require("backbone"),exports):factory(_,Backbone,Backbone.Attributes={})}(function(_,Backbone,Attributes){_.extend(Attributes,Backbone.Events);var modelMethods=["get","set","unset","clear","_validate","validate","isValid","has","changed","hasChanged","changedAttributes","previous","previousAttributes"],wrappedMethods=["get","set","clear","changedAttributes"],Model=Backbone.Model.prototype;_.each(modelMethods,function(method){var fn=Model[method],wrapper=function(){return _.defaults(this.attributes||(this.attributes={}),_.result(this,"defaults")),_.each(wrappedMethods,function(m){this[m]._wrapped&&(this[m]=Model[m])},this),this.setAttribute=this.setAttributes=Model.set,this.getAttribute=Model.get,fn.apply(this,arguments)};wrapper._wrapped=!0,Attributes[method]=_.contains(wrappedMethods,method)?wrapper:fn}),Attributes.setAttribute=Attributes.setAttributes=Attributes.set,Attributes.getAttribute=Attributes.get}),function(root,factory){if("function"==typeof define&&define.amd)define(["underscore","backbone","jquery"],function(_,Backbone,$){return factory(_,Backbone,$)});else if("undefined"!=typeof exports){var _=require("underscore"),Backbone=require("backbone"),$=require("jquery");module.exports=factory(_,Backbone,$)}else factory(root._,root.Backbone,root.jQuery)}(this,function(_,Backbone,$){"use strict";var previousSyphon=Backbone.Syphon,Syphon=Backbone.Syphon={};Syphon.VERSION="0.6.2",Syphon.noConflict=function(){return Backbone.Syphon=previousSyphon,this},Syphon.ignoredTypes=["button","submit","reset","fieldset"],Syphon.serialize=function(view,options){var data={},config=buildConfig(options),elements=getInputElements(view,config);return _.each(elements,function(el){var $el=$(el),type=getElementType($el),keyExtractor=config.keyExtractors.get(type),key=keyExtractor($el),inputReader=config.inputReaders.get(type),value=inputReader($el),validKeyAssignment=config.keyAssignmentValidators.get(type);if(validKeyAssignment($el,key,value)){var keychain=config.keySplitter(key);data=assignKeyValue(data,keychain,value)}}),data},Syphon.deserialize=function(view,data,options){var config=buildConfig(options),elements=getInputElements(view,config),flattenedData=flattenData(config,data);_.each(elements,function(el){var $el=$(el),type=getElementType($el),keyExtractor=config.keyExtractors.get(type),key=keyExtractor($el),inputWriter=config.inputWriters.get(type),value=flattenedData[key];inputWriter($el,value)})};var getInputElements=function(view,config){var formInputs=getForm(view);return formInputs=_.reject(formInputs,function(el){var reject,myType=getElementType(el),extractor=config.keyExtractors.get(myType),identifier=extractor($(el)),foundInIgnored=_.find(config.ignoredTypes,function(ignoredTypeOrSelector){return ignoredTypeOrSelector===myType||$(el).is(ignoredTypeOrSelector)}),foundInInclude=_.include(config.include,identifier),foundInExclude=_.include(config.exclude,identifier);return reject=foundInInclude?!1:config.include?!0:foundInExclude||foundInIgnored})},getElementType=function(el){var typeAttr,$el=$(el),tagName=$el[0].tagName,type=tagName;return"input"===tagName.toLowerCase()&&(typeAttr=$el.attr("type"),type=typeAttr?typeAttr:"text"),type.toLowerCase()},getForm=function(viewOrForm){return _.isUndefined(viewOrForm.$el)?$(viewOrForm).find(":input"):viewOrForm.$(":input")},buildConfig=function(options){var config=_.clone(options)||{};return config.ignoredTypes=_.clone(Syphon.ignoredTypes),config.inputReaders=config.inputReaders||Syphon.InputReaders,config.inputWriters=config.inputWriters||Syphon.InputWriters,config.keyExtractors=config.keyExtractors||Syphon.KeyExtractors,config.keySplitter=config.keySplitter||Syphon.KeySplitter,config.keyJoiner=config.keyJoiner||Syphon.KeyJoiner,config.keyAssignmentValidators=config.keyAssignmentValidators||Syphon.KeyAssignmentValidators,config},assignKeyValue=function(obj,keychain,value){if(!keychain)return obj;var key=keychain.shift();return obj[key]||(obj[key]=_.isArray(key)?[]:{}),0===keychain.length&&(_.isArray(obj[key])?obj[key].push(value):obj[key]=value),keychain.length>0&&assignKeyValue(obj[key],keychain,value),obj},flattenData=function(config,data,parentKey){var flatData={};return _.each(data,function(value,keyName){var hash={};parentKey&&(keyName=config.keyJoiner(parentKey,keyName)),_.isArray(value)?(keyName+="[]",hash[keyName]=value):_.isObject(value)?hash=flattenData(config,value,keyName):hash[keyName]=value,_.extend(flatData,hash)}),flatData},TypeRegistry=Syphon.TypeRegistry=function(){this.registeredTypes={}};TypeRegistry.extend=Backbone.Model.extend,_.extend(TypeRegistry.prototype,{get:function(type){return _.has(this.registeredTypes,type)?this.registeredTypes[type]:this.registeredTypes["default"]},register:function(type,item){this.registeredTypes[type]=item},registerDefault:function(item){this.registeredTypes["default"]=item},unregister:function(type){_.has(this.registeredTypes,type)&&delete this.registeredTypes[type]}});var KeyExtractorSet=Syphon.KeyExtractorSet=TypeRegistry.extend(),KeyExtractors=Syphon.KeyExtractors=new KeyExtractorSet;KeyExtractors.registerDefault(function($el){return $el.prop("name")||""});var InputReaderSet=Syphon.InputReaderSet=TypeRegistry.extend(),InputReaders=Syphon.InputReaders=new InputReaderSet;InputReaders.registerDefault(function($el){return $el.val()}),InputReaders.register("checkbox",function($el){return $el.prop("indeterminate")?null:$el.prop("checked")});var InputWriterSet=Syphon.InputWriterSet=TypeRegistry.extend(),InputWriters=Syphon.InputWriters=new InputWriterSet;InputWriters.registerDefault(function($el,value){$el.val(value)}),InputWriters.register("checkbox",function($el,value){null===value?$el.prop("indeterminate",!0):$el.prop("checked",value)}),InputWriters.register("radio",function($el,value){$el.prop("checked",$el.val()===value.toString())});var KeyAssignmentValidatorSet=Syphon.KeyAssignmentValidatorSet=TypeRegistry.extend(),KeyAssignmentValidators=Syphon.KeyAssignmentValidators=new KeyAssignmentValidatorSet;return KeyAssignmentValidators.registerDefault(function(){return!0}),KeyAssignmentValidators.register("radio",function($el,key,value){return $el.prop("checked")}),Syphon.KeySplitter=function(key){var lastKey,matches=key.match(/[^\[\]]+/g);return key.length>1&&key.indexOf("[]")===key.length-2&&(lastKey=matches.pop(),matches.push([lastKey])),matches},Syphon.KeyJoiner=function(parentKey,childKey){return parentKey+"["+childKey+"]"},Backbone.Syphon}),function(root,factory){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(Backbone,_){return root.Marionette=root.Mn=factory(root,Backbone,_)});else if("undefined"!=typeof exports){var Backbone=require("backbone"),_=require("underscore");module.exports=factory(root,Backbone,_)}else root.Marionette=root.Mn=factory(root,root.Backbone,root._)}(this,function(root,Backbone,_){"use strict";!function(Backbone,_){var previousChildViewContainer=Backbone.ChildViewContainer;return Backbone.ChildViewContainer=function(Backbone,_){var Container=function(views){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),_.each(views,this.add,this)};_.extend(Container.prototype,{add:function(view,customIndex){var viewCid=view.cid;return this._views[viewCid]=view,view.model&&(this._indexByModel[view.model.cid]=viewCid),customIndex&&(this._indexByCustom[customIndex]=viewCid),this._updateLength(),this},findByModel:function(model){return this.findByModelCid(model.cid)},findByModelCid:function(modelCid){var viewCid=this._indexByModel[modelCid];return this.findByCid(viewCid)},findByCustom:function(index){var viewCid=this._indexByCustom[index];return this.findByCid(viewCid)},findByIndex:function(index){return _.values(this._views)[index]},findByCid:function(cid){return this._views[cid]},remove:function(view){var viewCid=view.cid;return view.model&&delete this._indexByModel[view.model.cid],_.any(this._indexByCustom,function(cid,key){return cid===viewCid?(delete this._indexByCustom[key],!0):void 0},this),delete this._views[viewCid],this._updateLength(),this},call:function(method){this.apply(method,_.tail(arguments))},apply:function(method,args){_.each(this._views,function(view){_.isFunction(view[method])&&view[method].apply(view,args||[])})},_updateLength:function(){this.length=_.size(this._views)}});var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return _.each(methods,function(method){Container.prototype[method]=function(){var views=_.values(this._views),args=[views].concat(_.toArray(arguments));return _[method].apply(_,args)}}),Container}(Backbone,_),Backbone.ChildViewContainer.VERSION="0.1.6",Backbone.ChildViewContainer.noConflict=function(){return Backbone.ChildViewContainer=previousChildViewContainer,this},Backbone.ChildViewContainer}(Backbone,_),function(Backbone,_){var previousWreqr=Backbone.Wreqr,Wreqr=Backbone.Wreqr={};return Backbone.Wreqr.VERSION="1.3.1",Backbone.Wreqr.noConflict=function(){return Backbone.Wreqr=previousWreqr,this},Wreqr.Handlers=function(Backbone,_){var Handlers=function(options){this.options=options,this._wreqrHandlers={},_.isFunction(this.initialize)&&this.initialize(options)};return Handlers.extend=Backbone.Model.extend,_.extend(Handlers.prototype,Backbone.Events,{setHandlers:function(handlers){_.each(handlers,function(handler,name){var context=null;_.isObject(handler)&&!_.isFunction(handler)&&(context=handler.context,handler=handler.callback),this.setHandler(name,handler,context)},this)},setHandler:function(name,handler,context){var config={callback:handler,context:context};this._wreqrHandlers[name]=config,this.trigger("handler:add",name,handler,context)},hasHandler:function(name){return!!this._wreqrHandlers[name]},getHandler:function(name){var config=this._wreqrHandlers[name];if(config)return function(){var args=Array.prototype.slice.apply(arguments);return config.callback.apply(config.context,args)}},removeHandler:function(name){delete this._wreqrHandlers[name]},removeAllHandlers:function(){this._wreqrHandlers={}}}),Handlers}(Backbone,_),Wreqr.CommandStorage=function(){var CommandStorage=function(options){this.options=options,this._commands={},_.isFunction(this.initialize)&&this.initialize(options)};return _.extend(CommandStorage.prototype,Backbone.Events,{getCommands:function(commandName){var commands=this._commands[commandName];return commands||(commands={command:commandName,instances:[]},this._commands[commandName]=commands),commands},addCommand:function(commandName,args){var command=this.getCommands(commandName);command.instances.push(args)},clearCommands:function(commandName){var command=this.getCommands(commandName);command.instances=[]}}),CommandStorage}(),Wreqr.Commands=function(Wreqr){return Wreqr.Handlers.extend({storageType:Wreqr.CommandStorage,constructor:function(options){this.options=options||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var args=Array.prototype.slice.call(arguments);Wreqr.Handlers.prototype.constructor.apply(this,args)},execute:function(name,args){name=arguments[0],args=Array.prototype.slice.call(arguments,1),this.hasHandler(name)?this.getHandler(name).apply(this,args):this.storage.addCommand(name,args)},_executeCommands:function(name,handler,context){var command=this.storage.getCommands(name);_.each(command.instances,function(args){handler.apply(context,args)}),this.storage.clearCommands(name)},_initializeStorage:function(options){var storage,StorageType=options.storageType||this.storageType;storage=_.isFunction(StorageType)?new StorageType:StorageType,this.storage=storage}})}(Wreqr),Wreqr.RequestResponse=function(Wreqr){return Wreqr.Handlers.extend({request:function(){var name=arguments[0],args=Array.prototype.slice.call(arguments,1);return this.hasHandler(name)?this.getHandler(name).apply(this,args):void 0}})}(Wreqr),Wreqr.EventAggregator=function(Backbone,_){var EA=function(){};return EA.extend=Backbone.Model.extend,_.extend(EA.prototype,Backbone.Events),EA}(Backbone,_),Wreqr.Channel=function(Wreqr){var Channel=function(channelName){this.vent=new Backbone.Wreqr.EventAggregator,this.reqres=new Backbone.Wreqr.RequestResponse,this.commands=new Backbone.Wreqr.Commands,this.channelName=channelName};return _.extend(Channel.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(hash,context){return this._connect("vent",hash,context),this},connectCommands:function(hash,context){return this._connect("commands",hash,context),this},connectRequests:function(hash,context){return this._connect("reqres",hash,context),this},_connect:function(type,hash,context){if(hash){context=context||this;var method="vent"===type?"on":"setHandler";_.each(hash,function(fn,eventName){this[type][method](eventName,_.bind(fn,context))},this)}}}),Channel}(Wreqr),Wreqr.radio=function(Wreqr){var Radio=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};_.extend(Radio.prototype,{channel:function(channelName){if(!channelName)throw new Error("Channel must receive a name");return this._getChannel(channelName)},_getChannel:function(channelName){var channel=this._channels[channelName];return channel||(channel=new Wreqr.Channel(channelName),this._channels[channelName]=channel),channel},_proxyMethods:function(){_.each(["vent","commands","reqres"],function(system){_.each(messageSystems[system],function(method){this[system][method]=proxyMethod(this,system,method)},this)},this)}});var messageSystems={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},proxyMethod=function(radio,system,method){return function(channelName){var messageSystem=radio._getChannel(channelName)[system],args=Array.prototype.slice.call(arguments,1);return messageSystem[method].apply(messageSystem,args)}};return new Radio}(Wreqr),Backbone.Wreqr}(Backbone,_);var previousMarionette=root.Marionette,previousMn=root.Mn,Marionette=Backbone.Marionette={};Marionette.VERSION="2.4.1",Marionette.noConflict=function(){return root.Marionette=previousMarionette,root.Mn=previousMn,this},Backbone.Marionette=Marionette,Marionette.Deferred=Backbone.$.Deferred,Marionette.extend=Backbone.Model.extend,Marionette.isNodeAttached=function(el){return Backbone.$.contains(document.documentElement,el)},Marionette.mergeOptions=function(options,keys){options&&_.extend(this,_.pick(options,keys))},Marionette.getOption=function(target,optionName){return target&&optionName?target.options&&void 0!==target.options[optionName]?target.options[optionName]:target[optionName]:void 0},Marionette.proxyGetOption=function(optionName){return Marionette.getOption(this,optionName)},Marionette._getValue=function(value,context,params){return _.isFunction(value)&&(value=params?value.apply(context,params):value.call(context)),value},Marionette.normalizeMethods=function(hash){return _.reduce(hash,function(normalizedHash,method,name){return _.isFunction(method)||(method=this[method]),method&&(normalizedHash[name]=method),normalizedHash},{},this)},Marionette.normalizeUIString=function(uiString,ui){return uiString.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(r){return ui[r.slice(4)]})},Marionette.normalizeUIKeys=function(hash,ui){return _.reduce(hash,function(memo,val,key){var normalizedKey=Marionette.normalizeUIString(key,ui);return memo[normalizedKey]=val,memo},{})},Marionette.normalizeUIValues=function(hash,ui,properties){return _.each(hash,function(val,key){_.isString(val)?hash[key]=Marionette.normalizeUIString(val,ui):_.isObject(val)&&_.isArray(properties)&&(_.extend(val,Marionette.normalizeUIValues(_.pick(val,properties),ui)),_.each(properties,function(property){var propertyVal=val[property];_.isString(propertyVal)&&(val[property]=Marionette.normalizeUIString(propertyVal,ui))}))}),hash},Marionette.actAsCollection=function(object,listProperty){var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];_.each(methods,function(method){object[method]=function(){var list=_.values(_.result(this,listProperty)),args=[list].concat(_.toArray(arguments));return _[method].apply(_,args)}})};var deprecate=Marionette.deprecate=function(message,test){_.isObject(message)&&(message=message.prev+" is going to be removed in the future. Please use "+message.next+" instead."+(message.url?" See: "+message.url:"")),void 0!==test&&test||deprecate._cache[message]||(deprecate._warn("Deprecation warning: "+message),deprecate._cache[message]=!0)};deprecate._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},deprecate._cache={},Marionette._triggerMethod=function(){function getEventName(match,prefix,eventName){return eventName.toUpperCase()}var splitter=/(^|:)(\w)/gi;return function(context,event,args){var noEventArg=arguments.length<3;noEventArg&&(args=event,event=args[0]);var result,methodName="on"+event.replace(splitter,getEventName),method=context[methodName];return _.isFunction(method)&&(result=method.apply(context,noEventArg?_.rest(args):args)),_.isFunction(context.trigger)&&(noEventArg+args.length>1?context.trigger.apply(context,noEventArg?args:[event].concat(_.drop(args,0))):context.trigger(event)),result}}(),Marionette.triggerMethod=function(event){return Marionette._triggerMethod(this,arguments)},Marionette.triggerMethodOn=function(context){var fnc=_.isFunction(context.triggerMethod)?context.triggerMethod:Marionette.triggerMethod;return fnc.apply(context,_.rest(arguments))},Marionette.MonitorDOMRefresh=function(view){function handleShow(){view._isShown=!0,triggerDOMRefresh()}function handleRender(){view._isRendered=!0,triggerDOMRefresh()}function triggerDOMRefresh(){view._isShown&&view._isRendered&&Marionette.isNodeAttached(view.el)&&_.isFunction(view.triggerMethod)&&view.triggerMethod("dom:refresh")}view.on({show:handleShow,render:handleRender})},function(Marionette){function bindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];if(!method)throw new Marionette.Error('Method "'+methodName+'" was configured as an event handler, but does not exist.');target.listenTo(entity,evt,method)})}function bindToFunction(target,entity,evt,method){target.listenTo(entity,evt,method)}function unbindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];target.stopListening(entity,evt,method)})}function unbindToFunction(target,entity,evt,method){target.stopListening(entity,evt,method)}function iterateEvents(target,entity,bindings,functionCallback,stringCallback){if(entity&&bindings){if(!_.isObject(bindings))throw new Marionette.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});bindings=Marionette._getValue(bindings,target),_.each(bindings,function(methods,evt){_.isFunction(methods)?functionCallback(target,entity,evt,methods):stringCallback(target,entity,evt,methods)})}}Marionette.bindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,bindToFunction,bindFromStrings)},Marionette.unbindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,unbindToFunction,unbindFromStrings)},Marionette.proxyBindEntityEvents=function(entity,bindings){return Marionette.bindEntityEvents(this,entity,bindings)},Marionette.proxyUnbindEntityEvents=function(entity,bindings){return Marionette.unbindEntityEvents(this,entity,bindings)}}(Marionette);var errorProps=["description","fileName","lineNumber","name","message","number"];return Marionette.Error=Marionette.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+Marionette.VERSION+"/",constructor:function(message,options){_.isObject(message)?(options=message,message=options.message):options||(options={});var error=Error.call(this,message);_.extend(this,_.pick(error,errorProps),_.pick(options,errorProps)),this.captureStackTrace(),options.url&&(this.url=this.urlRoot+options.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,Marionette.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),Marionette.Error.extend=Marionette.extend,Marionette.Callbacks=function(){this._deferred=Marionette.Deferred(),this._callbacks=[]},_.extend(Marionette.Callbacks.prototype,{add:function(callback,contextOverride){
var promise=_.result(this._deferred,"promise");this._callbacks.push({cb:callback,ctx:contextOverride}),promise.then(function(args){contextOverride&&(args.context=contextOverride),callback.call(args.context,args.options)})},run:function(options,context){this._deferred.resolve({options:options,context:context})},reset:function(){var callbacks=this._callbacks;this._deferred=Marionette.Deferred(),this._callbacks=[],_.each(callbacks,function(cb){this.add(cb.cb,cb.ctx)},this)}}),Marionette.Controller=function(options){this.options=options||{},_.isFunction(this.initialize)&&this.initialize(this.options)},Marionette.Controller.extend=Marionette.extend,_.extend(Marionette.Controller.prototype,Backbone.Events,{destroy:function(){return Marionette._triggerMethod(this,"before:destroy",arguments),Marionette._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:Marionette.triggerMethod,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption}),Marionette.Object=function(options){this.options=_.extend({},_.result(this,"options"),options),this.initialize.apply(this,arguments)},Marionette.Object.extend=Marionette.extend,_.extend(Marionette.Object.prototype,Backbone.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:Marionette.triggerMethod,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.Region=Marionette.Object.extend({constructor:function(options){if(this.options=options||{},this.el=this.getOption("el"),this.el=this.el instanceof Backbone.$?this.el[0]:this.el,!this.el)throw new Marionette.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),Marionette.Object.call(this,options)},show:function(view,options){if(this._ensureElement()){this._ensureViewIsIntact(view);var showOptions=options||{},isDifferentView=view!==this.currentView,preventDestroy=!!showOptions.preventDestroy,forceShow=!!showOptions.forceShow,isChangingView=!!this.currentView,_shouldDestroyView=isDifferentView&&!preventDestroy,_shouldShowView=isDifferentView||forceShow;if(isChangingView&&this.triggerMethod("before:swapOut",this.currentView,this,options),this.currentView&&delete this.currentView._parent,_shouldDestroyView?this.empty():isChangingView&&_shouldShowView&&this.currentView.off("destroy",this.empty,this),_shouldShowView){view.once("destroy",this.empty,this),view.render(),view._parent=this,isChangingView&&this.triggerMethod("before:swap",view,this,options),this.triggerMethod("before:show",view,this,options),Marionette.triggerMethodOn(view,"before:show",view,this,options),isChangingView&&this.triggerMethod("swapOut",this.currentView,this,options);var attachedRegion=Marionette.isNodeAttached(this.el),displayedViews=[],triggerBeforeAttach=showOptions.triggerBeforeAttach||this.triggerBeforeAttach,triggerAttach=showOptions.triggerAttach||this.triggerAttach;return attachedRegion&&triggerBeforeAttach&&(displayedViews=this._displayedViews(view),this._triggerAttach(displayedViews,"before:")),this.attachHtml(view),this.currentView=view,attachedRegion&&triggerAttach&&(displayedViews=this._displayedViews(view),this._triggerAttach(displayedViews)),isChangingView&&this.triggerMethod("swap",view,this,options),this.triggerMethod("show",view,this,options),Marionette.triggerMethodOn(view,"show",view,this,options),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(views,prefix){var eventName=(prefix||"")+"attach";_.each(views,function(view){Marionette.triggerMethodOn(view,eventName,view,this)},this)},_displayedViews:function(view){return _.union([view],_.result(view,"_getNestedViews")||[])},_ensureElement:function(){if(_.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new Marionette.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(view){if(!view)throw new Marionette.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(view.isDestroyed)throw new Marionette.Error({name:"ViewDestroyedError",message:'View (cid: "'+view.cid+'") has already been destroyed and cannot be used.'})},getEl:function(el){return Backbone.$(el,Marionette._getValue(this.options.parentEl,this))},attachHtml:function(view){this.$el.contents().detach(),this.el.appendChild(view.el)},empty:function(options){var view=this.currentView,preventDestroy=Marionette._getValue(options,"preventDestroy",this);return view?(view.off("destroy",this.empty,this),this.triggerMethod("before:empty",view),preventDestroy||this._destroyView(),this.triggerMethod("empty",view),delete this.currentView,preventDestroy&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var view=this.currentView;view.destroy&&!view.isDestroyed?view.destroy():view.remove&&(view.remove(),view.isDestroyed=!0)},attachView:function(view){return this.currentView=view,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(regionConfig,DefaultRegionClass){if(_.isString(regionConfig))return this._buildRegionFromSelector(regionConfig,DefaultRegionClass);if(regionConfig.selector||regionConfig.el||regionConfig.regionClass)return this._buildRegionFromObject(regionConfig,DefaultRegionClass);if(_.isFunction(regionConfig))return this._buildRegionFromRegionClass(regionConfig);throw new Marionette.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(selector,DefaultRegionClass){return new DefaultRegionClass({el:selector})},_buildRegionFromObject:function(regionConfig,DefaultRegionClass){var RegionClass=regionConfig.regionClass||DefaultRegionClass,options=_.omit(regionConfig,"selector","regionClass");return regionConfig.selector&&!options.el&&(options.el=regionConfig.selector),new RegionClass(options)},_buildRegionFromRegionClass:function(RegionClass){return new RegionClass}}),Marionette.RegionManager=Marionette.Controller.extend({constructor:function(options){this._regions={},this.length=0,Marionette.Controller.call(this,options),this.addRegions(this.getOption("regions"))},addRegions:function(regionDefinitions,defaults){return regionDefinitions=Marionette._getValue(regionDefinitions,this,arguments),_.reduce(regionDefinitions,function(regions,definition,name){return _.isString(definition)&&(definition={selector:definition}),definition.selector&&(definition=_.defaults({},definition,defaults)),regions[name]=this.addRegion(name,definition),regions},{},this)},addRegion:function(name,definition){var region;return region=definition instanceof Marionette.Region?definition:Marionette.Region.buildRegion(definition,Marionette.Region),this.triggerMethod("before:add:region",name,region),region._parent=this,this._store(name,region),this.triggerMethod("add:region",name,region),region},get:function(name){return this._regions[name]},getRegions:function(){return _.clone(this._regions)},removeRegion:function(name){var region=this._regions[name];return this._remove(name,region),region},removeRegions:function(){var regions=this.getRegions();return _.each(this._regions,function(region,name){this._remove(name,region)},this),regions},emptyRegions:function(){var regions=this.getRegions();return _.invoke(regions,"empty"),regions},destroy:function(){return this.removeRegions(),Marionette.Controller.prototype.destroy.apply(this,arguments)},_store:function(name,region){this._regions[name]||this.length++,this._regions[name]=region},_remove:function(name,region){this.triggerMethod("before:remove:region",name,region),region.empty(),region.stopListening(),delete region._parent,delete this._regions[name],this.length--,this.triggerMethod("remove:region",name,region)}}),Marionette.actAsCollection(Marionette.RegionManager.prototype,"_regions"),Marionette.TemplateCache=function(templateId){this.templateId=templateId},_.extend(Marionette.TemplateCache,{templateCaches:{},get:function(templateId,options){var cachedTemplate=this.templateCaches[templateId];return cachedTemplate||(cachedTemplate=new Marionette.TemplateCache(templateId),this.templateCaches[templateId]=cachedTemplate),cachedTemplate.load(options)},clear:function(){var i,args=_.toArray(arguments),length=args.length;if(length>0)for(i=0;length>i;i++)delete this.templateCaches[args[i]];else this.templateCaches={}}}),_.extend(Marionette.TemplateCache.prototype,{load:function(options){if(this.compiledTemplate)return this.compiledTemplate;var template=this.loadTemplate(this.templateId,options);return this.compiledTemplate=this.compileTemplate(template,options),this.compiledTemplate},loadTemplate:function(templateId,options){var template=Backbone.$(templateId).html();if(!template||0===template.length)throw new Marionette.Error({name:"NoTemplateError",message:'Could not find template: "'+templateId+'"'});return template},compileTemplate:function(rawTemplate,options){return _.template(rawTemplate,options)}}),Marionette.Renderer={render:function(template,data){if(!template)throw new Marionette.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var templateFunc=_.isFunction(template)?template:Marionette.TemplateCache.get(template);return templateFunc(data)}},Marionette.View=Backbone.View.extend({isDestroyed:!1,constructor:function(options){_.bindAll(this,"render"),options=Marionette._getValue(options,this),this.options=_.extend({},_.result(this,"options"),options),this._behaviors=Marionette.Behaviors(this),Backbone.View.call(this,this.options),Marionette.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(model){return model.toJSON.apply(model,_.rest(arguments))},mixinTemplateHelpers:function(target){target=target||{};var templateHelpers=this.getOption("templateHelpers");return templateHelpers=Marionette._getValue(templateHelpers,this),_.extend(target,templateHelpers)},normalizeUIKeys:function(hash){var uiBindings=_.result(this,"_uiBindings");return Marionette.normalizeUIKeys(hash,uiBindings||_.result(this,"ui"))},normalizeUIValues:function(hash,properties){var ui=_.result(this,"ui"),uiBindings=_.result(this,"_uiBindings");return Marionette.normalizeUIValues(hash,uiBindings||ui,properties)},configureTriggers:function(){if(this.triggers){var triggers=this.normalizeUIKeys(_.result(this,"triggers"));return _.reduce(triggers,function(events,value,key){return events[key]=this._buildViewTrigger(value),events},{},this)}},delegateEvents:function(events){return this._delegateDOMEvents(events),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),_.each(this._behaviors,function(behavior){behavior.bindEntityEvents(this.model,behavior.getOption("modelEvents")),behavior.bindEntityEvents(this.collection,behavior.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(eventsArg){var events=Marionette._getValue(eventsArg||this.events,this);events=this.normalizeUIKeys(events),_.isUndefined(eventsArg)&&(this.events=events);var combinedEvents={},behaviorEvents=_.result(this,"behaviorEvents")||{},triggers=this.configureTriggers(),behaviorTriggers=_.result(this,"behaviorTriggers")||{};_.extend(combinedEvents,behaviorEvents,events,triggers,behaviorTriggers),Backbone.View.prototype.delegateEvents.call(this,combinedEvents)},undelegateEvents:function(){return Backbone.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),_.each(this._behaviors,function(behavior){behavior.unbindEntityEvents(this.model,behavior.getOption("modelEvents")),behavior.unbindEntityEvents(this.collection,behavior.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new Marionette.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var args=_.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(args)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(args)),this.unbindUIElements(),this.isRendered=!1,this.remove(),_.invoke(this._behaviors,"destroy",args),this},bindUIElements:function(){this._bindUIElements(),_.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var bindings=_.result(this,"_uiBindings");this.ui={},_.each(bindings,function(selector,key){this.ui[key]=this.$(selector)},this)}},unbindUIElements:function(){this._unbindUIElements(),_.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(_.each(this.ui,function($el,name){delete this.ui[name]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(triggerDef){var hasOptions=_.isObject(triggerDef),options=_.defaults({},hasOptions?triggerDef:{},{preventDefault:!0,stopPropagation:!0}),eventName=hasOptions?options.event:triggerDef;return function(e){e&&(e.preventDefault&&options.preventDefault&&e.preventDefault(),e.stopPropagation&&options.stopPropagation&&e.stopPropagation());var args={view:this,model:this.model,collection:this.collection};this.triggerMethod(eventName,args)}},setElement:function(){var ret=Backbone.View.prototype.setElement.apply(this,arguments);return _.invoke(this._behaviors,"proxyViewProperties",this),ret},triggerMethod:function(){var ret=Marionette._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],_.rest(arguments)),ret},_triggerEventOnBehaviors:function(args){for(var triggerMethod=Marionette._triggerMethod,behaviors=this._behaviors,i=0,length=behaviors&&behaviors.length;length>i;i++)triggerMethod(behaviors[i],args)},_triggerEventOnParentLayout:function(eventName,args){var layoutView=this._parentLayoutView();if(layoutView){var eventPrefix=Marionette.getOption(layoutView,"childViewEventPrefix"),prefixedEventName=eventPrefix+":"+eventName;Marionette._triggerMethod(layoutView,[prefixedEventName,this].concat(args));var childEvents=Marionette.getOption(layoutView,"childEvents"),normalizedChildEvents=layoutView.normalizeMethods(childEvents);normalizedChildEvents&&_.isFunction(normalizedChildEvents[eventName])&&normalizedChildEvents[eventName].apply(layoutView,[this].concat(args))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var children=this._getImmediateChildren();return children.length?_.reduce(children,function(memo,view){return view._getNestedViews?memo.concat(view._getNestedViews()):memo},children):children},_getAncestors:function(){for(var ancestors=[],parent=this._parent;parent;)ancestors.push(parent),parent=parent._parent;return ancestors},_parentLayoutView:function(){var ancestors=this._getAncestors();return _.find(ancestors,function(parent){return parent instanceof Marionette.LayoutView})},normalizeMethods:Marionette.normalizeMethods,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.ItemView=Marionette.View.extend({constructor:function(){Marionette.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var args=[this.model||this.collection];return arguments.length&&args.push.apply(args,arguments),this.model?this.serializeModel.apply(this,args):{items:this.serializeCollection.apply(this,args)}},serializeCollection:function(collection){return collection.toJSON.apply(collection,_.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var template=this.getTemplate();if(template!==!1){if(!template)throw new Marionette.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var data=this.mixinTemplateHelpers(this.serializeData()),html=Marionette.Renderer.render(template,data,this);return this.attachElContent(html),this}},attachElContent:function(html){return this.$el.html(html),this}}),Marionette.CollectionView=Marionette.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(options){this.once("render",this._initialEvents),this._initChildViewStorage(),Marionette.View.apply(this,arguments),this.on("show",this._onShowCalled),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&_.each(this._bufferedChildren,_.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(_.each(this._bufferedChildren,_.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(event,childView){Marionette.triggerMethodOn(childView,event)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(child,collection,opts){var index;if(index=void 0!==opts.at?opts.at:_.indexOf(this._filteredSortedModels(),child),this._shouldAddChild(child,index)){this.destroyEmptyView();var ChildView=this.getChildView(child);this.addChild(child,ChildView,index)}},_onCollectionRemove:function(model){var view=this.children.findByModel(model);this.removeChildView(view),this.checkEmpty()},_onShowCalled:function(){this.children.each(_.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var children=this.children,models=this._filteredSortedModels(),modelsChanged=_.find(models,function(model){return!children.findByModel(model)});if(modelsChanged)this.render();else{var els=_.map(models,function(model){return children.findByModel(model).el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(els),this.triggerMethod("reorder")}},resortView:function(){Marionette.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var models=this._filteredSortedModels(),orderChanged=_.find(models,function(item,index){var view=this.children.findByModel(item);return!view||view._index!==index},this);orderChanged&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(children){this.$el.append(children)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var ChildView,models=this._filteredSortedModels();_.each(models,function(child,index){ChildView=this.getChildView(child),this.addChild(child,ChildView,index)},this)},_filteredSortedModels:function(){var models,viewComparator=this.getViewComparator();return models=viewComparator?_.isString(viewComparator)||1===viewComparator.length?this.collection.sortBy(viewComparator,this):_.clone(this.collection.models).sort(_.bind(viewComparator,this)):this.collection.models,this.getOption("filter")&&(models=_.filter(models,function(model,index){return this._shouldAddChild(model,index)},this)),models},showEmptyView:function(){var EmptyView=this.getEmptyView();if(EmptyView&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var model=new Backbone.Model;this.addEmptyView(model,EmptyView),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(child,EmptyView){var emptyViewOptions=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");_.isFunction(emptyViewOptions)&&(emptyViewOptions=emptyViewOptions.call(this,child,this._emptyViewIndex));var view=this.buildChildView(child,EmptyView,emptyViewOptions);view._parent=this,this.proxyChildEvents(view),this._isShown&&Marionette.triggerMethodOn(view,"before:show"),this.children.add(view),this.renderChildView(view,this._emptyViewIndex),this._isShown&&Marionette.triggerMethodOn(view,"show")},getChildView:function(child){var childView=this.getOption("childView");if(!childView)throw new Marionette.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return childView},addChild:function(child,ChildView,index){var childViewOptions=this.getOption("childViewOptions");childViewOptions=Marionette._getValue(childViewOptions,this,[child,index]);var view=this.buildChildView(child,ChildView,childViewOptions);return this._updateIndices(view,!0,index),this._addChildView(view,index),view._parent=this,view},_updateIndices:function(view,increment,index){this.getOption("sort")&&(increment&&(view._index=index),this.children.each(function(laterView){laterView._index>=view._index&&(laterView._index+=increment?1:-1)}))},_addChildView:function(view,index){this.proxyChildEvents(view),this.triggerMethod("before:add:child",view),this._isShown&&!this.isBuffering&&Marionette.triggerMethodOn(view,"before:show"),this.children.add(view),this.renderChildView(view,index),this._isShown&&!this.isBuffering&&Marionette.triggerMethodOn(view,"show"),this.triggerMethod("add:child",view)},renderChildView:function(view,index){return view.render(),this.attachHtml(this,view,index),view},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child},childViewOptions);return new ChildViewClass(options)},removeChildView:function(view){return view&&(this.triggerMethod("before:remove:child",view),view.destroy?view.destroy():view.remove&&view.remove(),delete view._parent,this.stopListening(view),this.children.remove(view),this.triggerMethod("remove:child",view),this._updateIndices(view,!1)),view},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(collectionView){collectionView.$el.append(this._createBuffer(collectionView))},_createBuffer:function(collectionView){var elBuffer=document.createDocumentFragment();return _.each(collectionView._bufferedChildren,function(b){elBuffer.appendChild(b.el)}),elBuffer},attachHtml:function(collectionView,childView,index){collectionView.isBuffering?collectionView._bufferedChildren.splice(index,0,childView):collectionView._insertBefore(childView,index)||collectionView._insertAfter(childView)},_insertBefore:function(childView,index){var currentView,findPosition=this.getOption("sort")&&index<this.children.length-1;return findPosition&&(currentView=this.children.find(function(view){return view._index===index+1})),currentView?(currentView.$el.before(childView.el),!0):!1},_insertAfter:function(childView){this.$el.append(childView.el)},_initChildViewStorage:function(){this.children=new Backbone.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),Marionette.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){var childViews=this.children.map(_.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),childViews},_shouldAddChild:function(child,index){var filter=this.getOption("filter");return!_.isFunction(filter)||filter.call(this,child,index,this.collection)},proxyChildEvents:function(view){var prefix=this.getOption("childViewEventPrefix");this.listenTo(view,"all",function(){var args=_.toArray(arguments),rootEvent=args[0],childEvents=this.normalizeMethods(_.result(this,"childEvents"));args[0]=prefix+":"+rootEvent,args.splice(1,0,view),"undefined"!=typeof childEvents&&_.isFunction(childEvents[rootEvent])&&childEvents[rootEvent].apply(this,args.slice(1)),this.triggerMethod.apply(this,args)})},_getImmediateChildren:function(){return _.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),Marionette.CompositeView=Marionette.CollectionView.extend({constructor:function(){Marionette.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(child){var childView=this.getOption("childView")||this.constructor;return childView},serializeData:function(){var data={};return this.model&&(data=_.partial(this.serializeModel,this.model).apply(this,arguments)),data},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&Marionette.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var data={};data=this.serializeData(),data=this.mixinTemplateHelpers(data),this.triggerMethod("before:render:template");var template=this.getTemplate(),html=Marionette.Renderer.render(template,data,this);this.attachElContent(html),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(html){return this.$el.html(html),this},attachBuffer:function(compositeView){var $container=this.getChildViewContainer(compositeView);$container.append(this._createBuffer(compositeView))},_insertAfter:function(childView){var $container=this.getChildViewContainer(this,childView);$container.append(childView.el)},_appendReorderedChildren:function(children){var $container=this.getChildViewContainer(this);$container.append(children)},getChildViewContainer:function(containerView,childView){if("$childViewContainer"in containerView)return containerView.$childViewContainer;var container,childViewContainer=Marionette.getOption(containerView,"childViewContainer");if(childViewContainer){var selector=Marionette._getValue(childViewContainer,containerView);if(container="@"===selector.charAt(0)&&containerView.ui?containerView.ui[selector.substr(4)]:containerView.$(selector),container.length<=0)throw new Marionette.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+containerView.childViewContainer})}else container=containerView.$el;return containerView.$childViewContainer=container,container},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),Marionette.LayoutView=Marionette.ItemView.extend({regionClass:Marionette.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(options){options=options||{},this._firstRender=!0,this._initializeRegions(options),Marionette.ItemView.call(this,options)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),Marionette.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),Marionette.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(regionName,view){return this.getRegion(regionName).show(view)},getChildView:function(regionName){return this.getRegion(regionName).currentView},addRegion:function(name,definition){var regions={};return regions[name]=definition,this._buildRegions(regions)[name]},addRegions:function(regions){return this.regions=_.extend({},this.regions,regions),this._buildRegions(regions)},removeRegion:function(name){return delete this.regions[name],this.regionManager.removeRegion(name)},getRegion:function(region){return this.regionManager.get(region)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(regions){var defaults={regionClass:this.getOption("regionClass"),parentEl:_.partial(_.result,this,"el")};return this.regionManager.addRegions(regions,defaults)},_initializeRegions:function(options){var regions;this._initRegionManager(),regions=Marionette._getValue(this.regions,this,[options])||{};var regionOptions=this.getOption.call(options,"regions");regionOptions=Marionette._getValue(regionOptions,this,[options]),_.extend(regions,regionOptions),regions=this.normalizeUIValues(regions,["selector","el"]),this.addRegions(regions)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new Marionette.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(name){this.triggerMethod("before:add:region",name)}),this.listenTo(this.regionManager,"add:region",function(name,region){this[name]=region,this.triggerMethod("add:region",name,region)}),this.listenTo(this.regionManager,"before:remove:region",function(name){this.triggerMethod("before:remove:region",name)}),this.listenTo(this.regionManager,"remove:region",function(name,region){delete this[name],this.triggerMethod("remove:region",name,region)})},_getImmediateChildren:function(){return _.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),Marionette.Behavior=Marionette.Object.extend({constructor:function(options,view){this.view=view,this.defaults=_.result(this,"defaults")||{},this.options=_.extend({},this.defaults,options),this.ui=_.extend({},_.result(view,"ui"),_.result(this,"ui")),Marionette.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(view){this.$el=view.$el,this.el=view.el}}),Marionette.Behaviors=function(Marionette,_){function Behaviors(view,behaviors){return _.isObject(view.behaviors)?(behaviors=Behaviors.parseBehaviors(view,behaviors||_.result(view,"behaviors")),Behaviors.wrap(view,behaviors,_.keys(methods)),behaviors):{}}function BehaviorTriggersBuilder(view,behaviors){this._view=view,this._behaviors=behaviors,this._triggers={}}function getBehaviorsUI(behavior){return behavior._uiBindings||behavior.ui}var delegateEventSplitter=/^(\S+)\s*(.*)$/,methods={behaviorTriggers:function(behaviorTriggers,behaviors){var triggerBuilder=new BehaviorTriggersBuilder(this,behaviors);return triggerBuilder.buildBehaviorTriggers()},behaviorEvents:function(behaviorEvents,behaviors){var _behaviorsEvents={};return _.each(behaviors,function(b,i){
var _events={},behaviorEvents=_.clone(_.result(b,"events"))||{};behaviorEvents=Marionette.normalizeUIKeys(behaviorEvents,getBehaviorsUI(b));var j=0;_.each(behaviorEvents,function(behaviour,key){var match=key.match(delegateEventSplitter),eventName=match[1]+"."+[this.cid,i,j++," "].join(""),selector=match[2],eventKey=eventName+selector,handler=_.isFunction(behaviour)?behaviour:b[behaviour];_events[eventKey]=_.bind(handler,b)},this),_behaviorsEvents=_.extend(_behaviorsEvents,_events)},this),_behaviorsEvents}};return _.extend(Behaviors,{behaviorsLookup:function(){throw new Marionette.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(options,key){return options.behaviorClass?options.behaviorClass:Marionette._getValue(Behaviors.behaviorsLookup,this,[options,key])[key]},parseBehaviors:function(view,behaviors){return _.chain(behaviors).map(function(options,key){var BehaviorClass=Behaviors.getBehaviorClass(options,key),behavior=new BehaviorClass(options,view),nestedBehaviors=Behaviors.parseBehaviors(view,_.result(behavior,"behaviors"));return[behavior].concat(nestedBehaviors)}).flatten().value()},wrap:function(view,behaviors,methodNames){_.each(methodNames,function(methodName){view[methodName]=_.partial(methods[methodName],view[methodName],behaviors)})}}),_.extend(BehaviorTriggersBuilder.prototype,{buildBehaviorTriggers:function(){return _.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(behavior,i){var triggersHash=_.clone(_.result(behavior,"triggers"))||{};triggersHash=Marionette.normalizeUIKeys(triggersHash,getBehaviorsUI(behavior)),_.each(triggersHash,_.bind(this._setHandlerForBehavior,this,behavior,i))},_setHandlerForBehavior:function(behavior,i,eventName,trigger){var triggerKey=trigger.replace(/^\S+/,function(triggerName){return triggerName+".behaviortriggers"+i});this._triggers[triggerKey]=this._view._buildViewTrigger(eventName)}}),Behaviors}(Marionette,_),Marionette.AppRouter=Backbone.Router.extend({constructor:function(options){this.options=options||{},Backbone.Router.apply(this,arguments);var appRoutes=this.getOption("appRoutes"),controller=this._getController();this.processAppRoutes(controller,appRoutes),this.on("route",this._processOnRoute,this)},appRoute:function(route,methodName){var controller=this._getController();this._addAppRoute(controller,route,methodName)},_processOnRoute:function(routeName,routeArgs){if(_.isFunction(this.onRoute)){var routePath=_.invert(this.getOption("appRoutes"))[routeName];this.onRoute(routeName,routePath,routeArgs)}},processAppRoutes:function(controller,appRoutes){if(appRoutes){var routeNames=_.keys(appRoutes).reverse();_.each(routeNames,function(route){this._addAppRoute(controller,route,appRoutes[route])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(controller,route,methodName){var method=controller[methodName];if(!method)throw new Marionette.Error('Method "'+methodName+'" was not found on the controller');this.route(route,methodName,_.bind(method,controller))},mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,triggerMethod:Marionette.triggerMethod,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.Application=Marionette.Object.extend({constructor:function(options){this._initializeRegions(options),this._initCallbacks=new Marionette.Callbacks,this.submodules={},_.extend(this,options),this._initChannel(),Marionette.Object.call(this,options)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(initializer){this._initCallbacks.add(initializer)},start:function(options){this.triggerMethod("before:start",options),this._initCallbacks.run(options,this),this.triggerMethod("start",options)},addRegions:function(regions){return this._regionManager.addRegions(regions)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(region){return this._regionManager.removeRegion(region)},getRegion:function(region){return this._regionManager.get(region)},getRegions:function(){return this._regionManager.getRegions()},module:function(moduleNames,moduleDefinition){var ModuleClass=Marionette.Module.getClass(moduleDefinition),args=_.toArray(arguments);return args.unshift(this),ModuleClass.create.apply(ModuleClass,args)},getRegionManager:function(){return new Marionette.RegionManager},_initializeRegions:function(options){var regions=_.isFunction(this.regions)?this.regions(options):this.regions||{};this._initRegionManager();var optionRegions=Marionette.getOption(options,"regions");return _.isFunction(optionRegions)&&(optionRegions=optionRegions.call(this,options)),_.extend(regions,optionRegions),this.addRegions(regions),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){Marionette._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(name,region){this[name]=region,Marionette._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){Marionette._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(name){delete this[name],Marionette._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=_.result(this,"channelName")||"global",this.channel=_.result(this,"channel")||Backbone.Wreqr.radio.channel(this.channelName),this.vent=_.result(this,"vent")||this.channel.vent,this.commands=_.result(this,"commands")||this.channel.commands,this.reqres=_.result(this,"reqres")||this.channel.reqres}}),Marionette.Module=function(moduleName,app,options){this.moduleName=moduleName,this.options=_.extend({},this.options,options),this.initialize=options.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=app,_.isFunction(this.initialize)&&this.initialize(moduleName,app,this.options)},Marionette.Module.extend=Marionette.extend,_.extend(Marionette.Module.prototype,Backbone.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(callback){this._initializerCallbacks.add(callback)},addFinalizer:function(callback){this._finalizerCallbacks.add(callback)},start:function(options){this._isInitialized||(_.each(this.submodules,function(mod){mod.startWithParent&&mod.start(options)}),this.triggerMethod("before:start",options),this._initializerCallbacks.run(options,this),this._isInitialized=!0,this.triggerMethod("start",options))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),_.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(moduleDefinition,customArgs){this._runModuleDefinition(moduleDefinition,customArgs)},_runModuleDefinition:function(definition,customArgs){if(definition){var args=_.flatten([this,this.app,Backbone,Marionette,Backbone.$,_,customArgs]);definition.apply(this,args)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new Marionette.Callbacks,this._finalizerCallbacks=new Marionette.Callbacks},triggerMethod:Marionette.triggerMethod}),_.extend(Marionette.Module,{create:function(app,moduleNames,moduleDefinition){var module=app,customArgs=_.drop(arguments,3);moduleNames=moduleNames.split(".");var length=moduleNames.length,moduleDefinitions=[];return moduleDefinitions[length-1]=moduleDefinition,_.each(moduleNames,function(moduleName,i){var parentModule=module;module=this._getModule(parentModule,moduleName,app,moduleDefinition),this._addModuleDefinition(parentModule,module,moduleDefinitions[i],customArgs)},this),module},_getModule:function(parentModule,moduleName,app,def,args){var options=_.extend({},def),ModuleClass=this.getClass(def),module=parentModule[moduleName];return module||(module=new ModuleClass(moduleName,app,options),parentModule[moduleName]=module,parentModule.submodules[moduleName]=module),module},getClass:function(moduleDefinition){var ModuleClass=Marionette.Module;return moduleDefinition?moduleDefinition.prototype instanceof ModuleClass?moduleDefinition:moduleDefinition.moduleClass||ModuleClass:ModuleClass},_addModuleDefinition:function(parentModule,module,def,args){var fn=this._getDefine(def),startWithParent=this._getStartWithParent(def,module);fn&&module.addDefinition(fn,args),this._addStartWithParent(parentModule,module,startWithParent)},_getStartWithParent:function(def,module){var swp;return _.isFunction(def)&&def.prototype instanceof Marionette.Module?(swp=module.constructor.prototype.startWithParent,_.isUndefined(swp)?!0:swp):_.isObject(def)?(swp=def.startWithParent,_.isUndefined(swp)?!0:swp):!0},_getDefine:function(def){return!_.isFunction(def)||def.prototype instanceof Marionette.Module?_.isObject(def)?def.define:null:def},_addStartWithParent:function(parentModule,module,startWithParent){module.startWithParent=module.startWithParent&&startWithParent,module.startWithParent&&!module.startWithParentIsConfigured&&(module.startWithParentIsConfigured=!0,parentModule.addInitializer(function(options){module.startWithParent&&module.start(options)}))}}),Marionette}),Marionette.Renderer={render:function(template,data){if(!template)throw new Marionette.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var output="";try{return output=nunjucks.render(template,data)}catch(err){throw new Marionette.Error({name:"NunjucksError",message:err.message})}}};